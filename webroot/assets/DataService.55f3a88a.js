import{P as e,g as a,L as l,e as t,p as o,n as r,o as d,m as i,A as n,C as c,D as s,u as p,y as u,q as m,w as g,M as f,x as y,v as b,K as v,N as h}from"./element-plus.3300f756.js";import{K as w,f as F,k as _,h as C,af as N,o as k,c as V,a as T,P as S,S as x,u as D,W as R,X as M,Q as I,ak as L,T as A,Y as U,n as P,M as j,aw as z,ax as B,$ as q,a0 as G}from"./@vue.73d14ebc.js";import{_ as K,u as E,v as O}from"./index.9b2cfea2.js";import{S as Q}from"./service.03d6f5db.js";import{u as H}from"./vue-router.43b9a342.js";import{I as Y}from"./interface.4c14d44d.js";import{T as J}from"./transferModel.d0202173.js";import{b as $,h as W,i as X,d as Z}from"./@element-plus.0bef5fa5.js";import{D as ee}from"./deviceModel.16d94447.js";import{P as ae}from"./product.8b7c5c3b.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.3d90a471.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./pinia.3f4aff4f.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.7828944a.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const le=e=>(z("data-v-7e4a49f2"),e=e(),B(),e),te={class:"main-container"},oe={class:"main"},re={class:"search-bar"},de={class:"search-bar",style:{display:"flex"}},ie={class:"title",style:{position:"relative","margin-right":"40px",height:"40px",padding:"0px 0","justify-content":"flex-start"}},ne={class:"tName"},ce={class:"param-content"},se={class:"pc-title"},pe={class:"pct-info"},ue={class:"pc-content"},me={class:"param-value"},ge={class:"param-name"},fe=le((()=>T("div",null,"无数据",-1))),ye={class:"pagination"},be={class:"dialog-content"},ve={class:"dialog-cLeft"},he=le((()=>T("div",{class:"card-header"},[T("span",null,"请选择采集设备")],-1))),we={class:"card-main"},Fe={class:"dialog-cRight"},_e=le((()=>T("div",{class:"card-header"},[T("span",null,"请选择一个上报模型")],-1))),Ce={class:"card-main"},Ne={class:"upload-item-text"},ke={class:"dialog-footer"},Ve={class:"dialog-content"},Te={class:"dialog-footer"},Se=le((()=>T("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),xe={class:"dialog-footer"};var De=K({__name:"NodeService",props:{curGateway:{type:Object,default:{}},pageInfo:String},emits:["changeDnFlag"],setup(v,{emit:h}){const z=v,B=E();console.log("id -> props",z);const q=w({headerCellStyle:{background:O.primaryColor,color:O.fontWhiteColor,height:"54px"},paramName:{ProductKey:"产品密钥",DeviceID:"通讯地址",DeviceSecret:"设备密钥"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,nodeTableData:[],dFlag:!1,dTitle:"添加设备",nodeInfo:"",nodeForm:{serviceName:"",collInterfaceName:"",deviceName:"",uploadModel:"",deviceAddr:"",protocol:"",deviceCode:"",productKey:"",deviceID:"",deviceSecret:""},nodeRules:{serviceName:[{required:!0,trigger:"blur"}],collInterfaceName:[{required:!0,trigger:"blur"}],deviceName:[{required:!0,trigger:"blur"}],deviceAddr:[{required:!0,trigger:"blur"}],protocol:[{required:!0,trigger:"blur"}],uploadModel:[{required:!0,message:"上报模型不能为空",trigger:"blur"}],deviceCode:[{required:!0,message:"通讯编码不能为空",trigger:"blur"}],productKey:[{required:!0,message:"产品密钥不能为空",trigger:"blur"}],deviceID:[{required:!0,message:"产品密钥不能为空",trigger:"blur"}],deviceSecret:[{required:!0,message:"产品密钥不能为空",trigger:"blur"}]},nodeModelList:[],selectedNodes:[],dpFlag:!0,interfaceList:[],nFlag:!1,treeProps:{children:"children",label:"label",isLeaf:"leaf"},deviceList:[],interfaceNames:[],uFlag:!1,filterText:"",transferModelList:[],curModelName:""}),G=e=>{const l={token:B.token,data:{serviceName:z.curGateway.serviceName}};Q.getDeviceByServiceIdList(l).then((async l=>{console.log("getDeviceByServiceIdList -> res ",l),l&&("0"===l.code?(q.nodeTableData=l.data,1===e&&a({type:"success",message:"刷新成功！"})):He(l),await P((()=>{q.tableMaxHeight=K.value.clientHeight-34-36-132})))}))};G();const K=F(null);(()=>{const e={token:B.token,data:{}};Y.getInterfaceList(e).then((e=>{console.log("getInterfaceList -> res",e),"0"===e.code?(q.interfaceList=[],q.interfaceNames=[],e.data.forEach((e=>{const a={label:e.collInterfaceName,name:e.collInterfaceName,hasChildren:!0};q.interfaceList.push(a),q.interfaceNames.push(e.collInterfaceName)}))):He(e)}))})();const H=e=>{q.selectedNodes=e},ee=e=>{q.currentPage=e},ae=_((()=>{let e=q.nodeInfo;return q.nodeTableData.filter((a=>!e||a.deviceName.toLowerCase().includes(e.toLowerCase())||a.deviceAddr.toLowerCase().includes(e.toLowerCase()))).slice((q.currentPage-1)*q.pagesize,q.currentPage*q.pagesize)})),le=_((()=>{let e=q.nodeInfo;return q.nodeTableData.filter((a=>!e||a.deviceName.toLowerCase().includes(e.toLowerCase())||a.deviceAddr.toLowerCase().includes(e.toLowerCase())))})),De=e=>{q.pagesize=e},Re=(e,a)=>(console.log("loadNode-> node === ",e),0===e.level?a(q.interfaceList):1!==e.level?a([]):(console.log("node->",e),void Me(e.data.name).then((async l=>(console.log("getCollDevices -> res",l),"0"===l.code?(q.deviceList=[],l.data.deviceNodeMap&&l.data.deviceNodeMap.forEach((a=>{const l={label:a.label,name:a.name,addr:a.addr,collName:e.data.name,hasChildren:!1};q.deviceList.push(l)})),console.log("node->ctxData.deviceList",q.deviceList),a(q.deviceList)):(He(l),a([]))))))),Me=e=>{const a={token:B.token,data:{name:e}};return Y.getCollDevices(a)};(e=>{const a={token:B.token,data:{}};J.getModelList(a).then((e=>{console.log("getModelList -> res",e),"0"===e.code?q.transferModelList=e.data:He(e)}))})();const Ie=F(null);C((()=>q.filterText),(e=>{Ie.value&&Ie.value.filter(e)}));const Le=(e,a)=>(console.log("filterNode value",e),!e||a.label.includes(e)),Ae=()=>{q.nFlag=!1},Ue=e=>{q.dFlag=!0,q.dTitle="编辑设备",q.nodeForm={serviceName:e.serviceName,collInterfaceName:e.collInterfaceName,deviceName:e.deviceName,deviceLabel:e.deviceLabel,uploadModel:e.uploadModel,deviceAddr:e.deviceAddr,protocol:e.protocol,deviceCode:""===e.param.deviceCode?e.deviceAddr:e.param.deviceCode},q.nodeForm.productKey=e.param.ProductKey,q.nodeForm.deviceID=e.param.DeviceID,q.nodeForm.deviceSecret=e.param.DeviceSecret},Pe=F(null),je=()=>{q.dFlag=!1,Pe.value.resetFields()},ze=e=>{je()},Be=()=>{Ge.value&&Ge.value.submit()},qe=e=>{},Ge=F(null),Ke=e=>{Ge.value.clearFiles();const a=e[0];Ge.value.handleStart(a)},Ee=e=>{console.log("beforeUpload -> file",e);let l=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.type)||""!=e.name&&e.name.indexOf("xlsx")>-1;if(l){if(l){let l=new FormData;l.append("file",e);const t={token:B.token,contentType:"multipart/form-data",data:l};Q.addDeviceFromCSV(t).then((e=>{"0"===e.code?(a.success(e.message),q.uFlag=!1,G()):He(e)}))}}else a({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},Oe=()=>{q.uFlag=!1,Ge.value.clearFiles()},Qe=()=>{Oe()},He=e=>{a({type:"error",message:e.message})},Ye=()=>{const e={token:B.token,responseType:"blob",data:{serviceName:z.curGateway.serviceName}};Q.exportDevice(e).then((e=>{if(console.log("exportDevice -> res",e),e&&"1"===e.code)return void He(e);const a=new Blob([e.blob]),l=e.fileName,t=document.createElement("a");t.download=l,t.style.display="none",t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))},Je=(e,l)=>{a({type:"0"===e.code?"success":"error",message:e.message}),"0"===e.code&&l&&l()};return(v,w)=>{const F=t,_=o,C=r,P=d,E=i,O=N("Icon"),Y=n,Me=c,$e=s,We=e,Xe=p,Ze=y,ea=u,aa=m,la=b,ta=g,oa=f;return k(),V("div",te,[T("div",oe,[T("div",re,[S(P,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:x((()=>[S(C,{style:{"margin-left":"20px"}},{default:x((()=>[S(_,{type:"primary",plain:"",onClick:w[0]||(w[0]=e=>{h("changeDnFlag","goBack")}),style:{"margin-right":"20px"}},{default:x((()=>[S(F,{class:"el-input__icon"},{default:x((()=>[S(D($))])),_:1}),R(" 返回上报服务 ")])),_:1})])),_:1}),S(C,null,{default:x((()=>[S(_,{type:"primary",plain:"",class:"right-btn",onClick:w[1]||(w[1]=e=>{q.uFlag=!0})},{default:x((()=>[S(F,{class:"el-input__icon"},{default:x((()=>[S(D(W))])),_:1}),R(" 导入设备 ")])),_:1})])),_:1}),S(C,null,{default:x((()=>[S(_,{type:"primary",plain:"",class:"right-btn",onClick:Ye},{default:x((()=>[S(F,{class:"el-input__icon"},{default:x((()=>[S(D(X))])),_:1}),R(" 导出设备 ")])),_:1})])),_:1})])),_:1},512)]),T("div",de,[T("div",ie,[T("div",ne,M(z.curGateway.serviceName),1)]),S(P,{inline:!0,ref:"searchFormRef2","status-icon":"","label-width":"90px"},{default:x((()=>[S(C,{label:""},{default:x((()=>[S(E,{style:{width:"200px"},placeholder:"请输入 地址/名称 过滤",clearable:"",modelValue:D(q).nodeInfo,"onUpdate:modelValue":w[2]||(w[2]=e=>D(q).nodeInfo=e)},{prefix:x((()=>[S(F,{class:"el-input__icon"},{default:x((()=>[S(D(Z))])),_:1})])),_:1},8,["modelValue"])])),_:1}),S(C,null,{default:x((()=>[S(_,{type:"primary",bg:"",class:"right-btn",onClick:w[3]||(w[3]=e=>(()=>{let e=[];if(0===q.selectedNodes.length)return void a.info("请至少选择一个设备！");q.selectedNodes.forEach((a=>{e.push(a.deviceName)}));const l={token:B.token,data:{serviceName:z.curGateway.serviceName,deviceNames:e}};J.reportNodes(l).then((e=>{"0"===e.code?a.success(e.message):He(e)}))})())},{default:x((()=>[S(F,{class:"btn-icon"},{default:x((()=>[S(O,{name:"local-report",size:"14px",color:"#ffffff"})])),_:1}),R(" 主动上报 ")])),_:1})])),_:1}),S(C,null,{default:x((()=>[S(_,{type:"primary",bg:"",class:"right-btn",onClick:w[4]||(w[4]=e=>{q.nFlag=!0})},{default:x((()=>[S(F,{class:"btn-icon"},{default:x((()=>[S(O,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),R(" 添加 ")])),_:1})])),_:1}),S(C,null,{default:x((()=>[S(_,{type:"danger",bg:"",class:"right-btn",onClick:w[5]||(w[5]=e=>(()=>{let e=[];0!==q.selectedNodes.length?(q.selectedNodes.forEach((a=>{e.push(a.deviceName)})),console.log("dList",e),l.confirm("确定要删除这些吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const a={token:B.token,data:{serviceName:z.curGateway.serviceName,deviceNames:e}};Q.deleteDevice(a).then((e=>{Je(e,G)}))})).catch((()=>{a({type:"info",message:"取消删除"})}))):a.info("请至少选择一个设备！")})())},{default:x((()=>[S(F,{class:"btn-icon"},{default:x((()=>[S(O,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),R(" 删除 ")])),_:1})])),_:1}),S(C,null,{default:x((()=>[S(_,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:w[6]||(w[6]=e=>{G(1)})},{default:x((()=>[S(F,{class:"btn-icon"},{default:x((()=>[S(O,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),R(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),T("div",{class:"content",ref_key:"contentRef",ref:K,style:{top:"136px"}},[S(Me,{data:D(ae),"cell-style":D(q).cellStyle,"header-cell-style":D(q).headerCellStyle,"max-height":D(q).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:H,onRowDblclick:Ue},{empty:x((()=>[fe])),default:x((()=>[S(Y,{type:"selection",width:"55"}),S(Y,{type:"expand"},{default:x((e=>[T("div",ce,[T("div",se,[T("div",pe,[T("b",null,M(e.row.deviceName),1),R(" 上报参数 ")])]),T("div",ue,[(k(!0),V(I,null,L(e.row.param,((e,a,l)=>(k(),V("div",{class:"param-item",key:l},[T("div",me,M(D(q).paramName[a])+"：",1),T("div",ge,M(e||"-"),1)])))),128))])])])),_:1}),S(Y,{sortable:"",prop:"deviceName",label:"设备名称",width:"auto","min-width":"180",align:"center"}),S(Y,{sortable:"",prop:"deviceLabel",label:"设备标签",width:"auto","min-width":"180",align:"center"}),S(Y,{sortable:"",prop:"deviceAddr",label:"通讯地址",width:"auto","min-width":"150",align:"center"}),S(Y,{sortable:"",prop:"uploadModel",label:"上报模型",width:"auto","min-width":"150",align:"center"}),S(Y,{sortable:"",prop:"collInterfaceName",label:"采集接口名称",width:"auto","min-width":"150",align:"center"}),S(Y,{sortable:"",label:"上报状态",width:"auto","min-width":"100",align:"center"},{default:x((e=>[R(M("onLine"===e.row.reportStatus?"在线":"离线"),1)])),_:1}),S(Y,{label:"操作",width:"auto","min-width":"120",align:"center",fixed:"right"},{default:x((e=>[S(_,{onClick:a=>Ue(e.row),text:"",type:"primary"},{default:x((()=>[R("编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),T("div",ye,[S($e,{"current-page":D(q).currentPage,"page-size":D(q).pagesize,"page-sizes":[20,50,200,500],total:D(le).length,onCurrentChange:ee,onSizeChange:De,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)]),S(aa,{modelValue:D(q).nFlag,"onUpdate:modelValue":w[11]||(w[11]=e=>D(q).nFlag=e),title:"添加设备",width:"1000px"},{footer:x((()=>[T("span",ke,[S(_,{onClick:w[9]||(w[9]=e=>Ae())},{default:x((()=>[R("取消")])),_:1}),S(_,{type:"primary",onClick:w[10]||(w[10]=e=>(()=>{var e=Ie.value.getCheckedNodes();if(e=e.filter((e=>!e.hasChildren)),console.log("checkedNodes => ",e),console.log("props.curGateway => ",z.curGateway),0!==e.length){let l=0,t=0;e.forEach((o=>{if(o.collName){const r={token:B.token,data:{serviceName:z.curGateway.serviceName,collInterfaceName:o.collName,deviceName:o.name,deviceLabel:o.label,deviceAddr:o.addr,protocol:z.curGateway.protocol,uploadModel:q.curModelName,param:{}}};console.log("pData item -> ",o),console.log("pData",r),Q.addDevice(r).then((o=>{l++,console.log("addDevice -> res ",o),"0"!==o.code?He(o):t++,l===e.length&&(a.success("添加"+l+"个设备，成功"+t+"个，失败"+(l-t)+"个。"),G())}))}})),Ae()}else a.info("请至少选择一个节点！")})())},{default:x((()=>[R("添加")])),_:1})])])),default:x((()=>[T("div",be,[T("div",ve,[S(Xe,{class:"card-box",shadow:"hover"},{header:x((()=>[he])),default:x((()=>[T("div",we,[T("div",null,[S(E,{modelValue:D(q).filterText,"onUpdate:modelValue":w[7]||(w[7]=e=>D(q).filterText=e),placeholder:"节点名称过滤"},null,8,["modelValue"])]),S(We,{ref_key:"nodeTreeRef",ref:Ie,props:D(q).treeProps,load:Re,"filter-node-method":Le,lazy:"","show-checkbox":""},null,8,["props"])])])),_:1})]),T("div",Fe,[S(Xe,{class:"card-box",shadow:"hover"},{header:x((()=>[_e])),default:x((()=>[T("div",Ce,[S(ea,{modelValue:D(q).curModelName,"onUpdate:modelValue":w[8]||(w[8]=e=>D(q).curModelName=e),style:{width:"100%"}},{default:x((()=>[(k(!0),V(I,null,L(D(q).transferModelList,(e=>(k(),V("div",{class:j(["upload-item",{isClicked:e.isClicked}]),key:"tml"+e.name},[T("div",Ne,[S(Ze,{label:e.name},{default:x((()=>[R(M(e.label+" ("+e.name+")"),1)])),_:2},1032,["label"])])],2)))),128))])),_:1},8,["modelValue"])])])),_:1})])])])),_:1},8,["modelValue"]),S(aa,{modelValue:D(q).dFlag,"onUpdate:modelValue":w[24]||(w[24]=e=>D(q).dFlag=e),title:"编辑设备",width:"600px","before-close":ze,"close-on-click-modal":!1},{footer:x((()=>[T("span",Te,[S(_,{onClick:w[22]||(w[22]=e=>je())},{default:x((()=>[R("取消")])),_:1}),S(_,{type:"primary",onClick:w[23]||(w[23]=e=>{Pe.value.validate((e=>{if(console.log("ctxData.nodeForm",q.nodeForm),!e)return!1;{const e={serviceName:q.nodeForm.serviceName,collInterfaceName:q.nodeForm.collInterfaceName,uploadModel:q.nodeForm.uploadModel,deviceName:q.nodeForm.deviceName,deviceLabel:q.nodeForm.deviceLabel,deviceAddr:q.nodeForm.deviceAddr,protocol:q.nodeForm.protocol,param:{deviceCode:q.nodeForm.deviceCode,productKey:q.nodeForm.productKey,deviceID:q.nodeForm.deviceID,deviceSecret:q.nodeForm.deviceSecret}},a={token:B.token,data:e};Q.editDevice(a).then((e=>{Je(e,G),je()}))}}))})},{default:x((()=>[R("保存")])),_:1})])])),default:x((()=>[T("div",Ve,[S(P,{model:D(q).nodeForm,rules:D(q).nodeRules,ref_key:"nodeFormRef",ref:Pe,"status-icon":"","label-position":"right","label-width":"120px"},{default:x((()=>[S(C,{label:"服务名称",prop:"serviceName"},{default:x((()=>[S(E,{disabled:"",type:"text",modelValue:D(q).nodeForm.serviceName,"onUpdate:modelValue":w[12]||(w[12]=e=>D(q).nodeForm.serviceName=e),autocomplete:"off",placeholder:"请输入服务名称"},null,8,["modelValue"])])),_:1}),S(C,{label:"采集接口名称",prop:"collInterfaceName"},{default:x((()=>[S(E,{disabled:"",type:"text",modelValue:D(q).nodeForm.collInterfaceName,"onUpdate:modelValue":w[13]||(w[13]=e=>D(q).nodeForm.collInterfaceName=e),autocomplete:"off",placeholder:"请输入采集接口名称"},null,8,["modelValue"])])),_:1}),S(C,{label:"设备名称",prop:"deviceName"},{default:x((()=>[S(E,{disabled:"",type:"text",modelValue:D(q).nodeForm.deviceName,"onUpdate:modelValue":w[14]||(w[14]=e=>D(q).nodeForm.deviceName=e),autocomplete:"off",placeholder:"请输入设备名称"},null,8,["modelValue"])])),_:1}),S(C,{label:"设备地址",prop:"deviceAddr"},{default:x((()=>[S(E,{disabled:"",type:"text",modelValue:D(q).nodeForm.deviceAddr,"onUpdate:modelValue":w[15]||(w[15]=e=>D(q).nodeForm.deviceAddr=e),autocomplete:"off",placeholder:"请输入设备地址"},null,8,["modelValue"])])),_:1}),S(C,{label:"协议名称",prop:"protocol"},{default:x((()=>[S(E,{disabled:"",type:"text",modelValue:D(q).nodeForm.protocol,"onUpdate:modelValue":w[16]||(w[16]=e=>D(q).nodeForm.protocol=e),autocomplete:"off",placeholder:"请输入协议名称"},null,8,["modelValue"])])),_:1}),S(C,{label:"上报模型",prop:"uploadModel"},{default:x((()=>[S(ta,{modelValue:D(q).nodeForm.uploadModel,"onUpdate:modelValue":w[17]||(w[17]=e=>D(q).nodeForm.uploadModel=e),style:{width:"100%"},placeholder:"请选择上报模型"},{default:x((()=>[(k(!0),V(I,null,L(D(q).transferModelList,(e=>(k(),A(la,{key:"model_"+e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"FSJY.MQTT"!=D(q).nodeForm.protocol?(k(),A(C,{key:0,label:"通讯编码",prop:"deviceCode"},{default:x((()=>[S(E,{type:"text",modelValue:D(q).nodeForm.deviceCode,"onUpdate:modelValue":w[18]||(w[18]=e=>D(q).nodeForm.deviceCode=e),autocomplete:"off",placeholder:"请输入通讯编码"},null,8,["modelValue"])])),_:1})):U("",!0),"FSJY.MQTT"==D(q).nodeForm.protocol?(k(),A(C,{key:1,label:"产品密钥",prop:"productKey"},{default:x((()=>[S(E,{type:"text",modelValue:D(q).nodeForm.productKey,"onUpdate:modelValue":w[19]||(w[19]=e=>D(q).nodeForm.productKey=e),autocomplete:"off",placeholder:"请输入网关产品密钥"},null,8,["modelValue"])])),_:1})):U("",!0),"FSJY.MQTT"==D(q).nodeForm.protocol?(k(),A(C,{key:2,label:"通讯地址",prop:"deviceID"},{default:x((()=>[S(E,{type:"text",modelValue:D(q).nodeForm.deviceID,"onUpdate:modelValue":w[20]||(w[20]=e=>D(q).nodeForm.deviceID=e),autocomplete:"off",placeholder:"请输入网关通讯地址"},null,8,["modelValue"])])),_:1})):U("",!0),"FSJY.MQTT"==D(q).nodeForm.protocol?(k(),A(C,{key:3,label:"设备密钥",prop:"deviceSecret"},{default:x((()=>[S(E,{type:"text",modelValue:D(q).nodeForm.deviceSecret,"onUpdate:modelValue":w[21]||(w[21]=e=>D(q).nodeForm.deviceSecret=e),autocomplete:"off",placeholder:"请输入网关设备密钥"},null,8,["modelValue"])])),_:1})):U("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue"]),S(aa,{modelValue:D(q).uFlag,"onUpdate:modelValue":w[25]||(w[25]=e=>D(q).uFlag=e),title:"上传设备xlsx文件",width:"600px","before-close":Qe,"close-on-click-modal":!1},{footer:x((()=>[T("span",xe,[S(_,{onClick:Oe},{default:x((()=>[R("取消")])),_:1}),S(_,{type:"primary",onClick:Be},{default:x((()=>[R("上传")])),_:1})])])),default:x((()=>[S(oa,{ref_key:"uploadRef",ref:Ge,action:"","auto-upload":!1,"http-request":qe,limit:1,"on-exceed":Ke,"before-upload":Ee},{tip:x((()=>[Se])),default:x((()=>[S(_,{type:"primary"},{default:x((()=>[R("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-7e4a49f2"]]);const Re=e=>(z("data-v-501d5432"),e=e(),B(),e),Me={class:"main-container"},Ie={class:"main"},Le={class:"search-bar"},Ae={class:"search-bar",style:{display:"flex"}},Ue={class:"title",style:{position:"relative","margin-right":"40px","justify-content":"flex-start",padding:"0px 0px",height:"40px"}},Pe={class:"tName"},je=Re((()=>T("div",null,"无数据",-1))),ze={class:"pagination"},Be={class:"dialog-content"},qe={class:"dialog-footer"},Ge=Re((()=>T("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),Ke={class:"dialog-footer"};var Ee=K({__name:"RegInfo",props:{curGateway:{type:Object,default:{}}},emits:["changeDnFlag"],setup(e,{emit:p}){const u=e,y=E();console.log("id -> props",u);const v=/^[0-9]*[1-9][0-9]*$/,h=(e,a,l)=>{0===a||v.test(a)?l():l(new Error("只能输入自然数！"))},C=w({headerCellStyle:{background:O.primaryColor,color:O.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,regTableData:[],rFlag:!1,rTitle:"添加寄存器",regInfo:"",regForm:{serviceName:"",regName:"",label:"",propertyType:0,collName:"",nodeName:"",propertyName:"",regType:0,regAddr:0,regCnt:1,rule:"Int_AB"},regRules:{regName:[{required:!0,message:"寄存器名称不能为空！",trigger:"blur"}],label:[{required:!0,message:"寄存器标签不能为空！",trigger:"blur"}],collName:[{required:!0,message:"采集接口名称不能为空！",trigger:"blur"}],nodeName:[{required:!0,message:"设备名称不能为空！",trigger:"blur"}],propertyName:[{required:!0,message:"设备属性名称不能为空！",trigger:"blur"}],regAddr:[{required:!0,message:"寄存器地址不能为空！",trigger:"blur"},{validator:h,trigger:"blur"}],regCnt:[{required:!0,message:"寄存器数量不能为空！",trigger:"blur"},{validator:h,trigger:"blur"}],rule:[{required:!0,message:"解析规则不能为空！",trigger:"blur"}]},collOptions:[],nodeOptions:[],propertyOptions:[],nameTotsl:{},typeOptions:[{name:0,label:"设备属性"},{name:1,label:"系统属性"}],regTypeOptions:[{name:0,label:"线圈状态寄存器"},{name:1,label:"离散输入状态寄存器"},{name:2,label:"保持寄存器"},{name:3,label:"输入寄存器"}],regCntOptions:[{label:1,value:1},{label:2,value:2},{label:4,value:4}],ruleTypeOptions:{rt1:[{label:"Int_AB",value:"Int_AB"},{label:"Int_BA",value:"Int_BA"}],rt2:[{label:"Long_ABCD",value:"Long_ABCD"},{label:"Long_BADC",value:"Long_BADC"},{label:"Long_DCBA",value:"Long_DCBA"},{label:"Long_CDAB",value:"Long_CDAB"},{label:"Float_ABCD",value:"Float_ABCD"},{label:"Float_BADC",value:"Float_BADC"},{label:"Float_DCBA",value:"Float_DCBA"},{label:"Float_CDAB",value:"Float_CDAB"}],rt4:[{label:"Double_ABCDEFGH",value:"Double_ABCDEFGH"},{label:"Double_GHEFCDAB",value:"Double_GHEFCDAB"},{label:"Double_BADCFEHG",value:"Double_BADCFEHG"},{label:"Double_HGFEDCBA",value:"Double_HGFEDCBA"}]},selectedNodes:[],uFlag:!1}),U=e=>{const l={token:y.token,data:{serviceName:u.curGateway.serviceName}};Q.getRegByServiceIdList(l).then((async l=>{console.log("getRegByServiceIdList -> res ",l),l&&("0"===l.code?(C.regTableData=l.data,1===e&&a({type:"success",message:"刷新成功！"})):ye(l),await P((()=>{C.tableMaxHeight=j.value.clientHeight-34-36-132})))}))};U();const j=F(null);(()=>{const e={token:y.token,data:{}};Y.getInterfaceList(e).then((e=>{console.log("getInterfaceList -> res",e),"0"===e.code?(C.collOptions=[],e.data.forEach((e=>{const a={label:e.collInterfaceName,name:e.collInterfaceName};C.collOptions.push(a)}))):ye(e)}))})();const z=e=>{q(e).then((e=>{B(e)})),C.propertyOptions=[]},B=e=>{"0"===e.code?(C.nodeOptions=[],C.nameTotsl={},e.data.deviceNodeMap.forEach((e=>{const a={label:e.label,name:e.name,tsl:e.tsl};C.nameTotsl[""+e.name]=e.tsl,C.nodeOptions.push(a)}))):ye(e)},q=e=>{const a={token:y.token,data:{name:e}};return Y.getCollDevices(a)},G=e=>{K(e)},K=e=>{const a={token:y.token,data:{name:C.nameTotsl[e]}};ee.getDeviceModelProperty(a).then((e=>{console.log("getDeviceModelProperty -> res ",e),"0"===e.code?(C.propertyOptions=[],e.data.forEach((e=>{const a={label:e.label,name:e.name};C.propertyOptions.push(a)}))):ye(e)}))},H=e=>{C.selectedNodes=e},ae=e=>{C.currentPage=e},le=_((()=>{let e=C.regInfo;return C.regTableData.filter((a=>!e||a.deviceName.toLowerCase().includes(e.toLowerCase())||a.deviceAddr.toLowerCase().includes(e.toLowerCase()))).slice((C.currentPage-1)*C.pagesize,C.currentPage*C.pagesize)})),te=_((()=>{let e=C.regInfo;return C.regTableData.filter((a=>!e||a.deviceName.toLowerCase().includes(e.toLowerCase())||a.deviceAddr.toLowerCase().includes(e.toLowerCase())))})),oe=e=>{C.pagesize=e},re=e=>{C.rFlag=!0,C.rTitle="编辑寄存器",C.regForm={regName:e.regName,label:e.label,propertyType:e.propertyType,collName:e.collName,nodeName:e.nodeName,propertyName:e.propertyName,regType:e.regType,regAddr:e.regAddr,regCnt:e.regCnt,rule:e.rule},q(C.regForm.collName).then((e=>{B(e),K(C.regForm.nodeName)}))},de=()=>{C.regForm={regName:"",label:"",propertyType:0,collName:"",nodeName:"",propertyName:"",regType:0,regAddr:0,regCnt:1,rule:"Int_AB"}},ie=F(null),ne=()=>{C.rFlag=!1,de()},ce=()=>{pe.value&&pe.value.submit()},se=e=>{},pe=F(null),ue=e=>{pe.value.clearFiles();const a=e[0];pe.value.handleStart(a)},me=e=>{console.log("beforeUpload -> file",e);let l=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.type);if(l){if(l){let l=new FormData;l.append("serviceName",u.curGateway.serviceName),l.append("fileName",e);const t={token:y.token,contentType:"multipart/form-data",data:l};Q.importReg(t).then((e=>{"0"===e.code?(a.success(e.message),C.uFlag=!1,U()):ye(e)}))}}else a({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ge=()=>{C.uFlag=!1,pe.value.clearFiles()},fe=()=>{ge()},ye=e=>{a({type:"error",message:e.message})},be=(e,l)=>{a({type:"0"===e.code?"success":"error",message:e.message}),"0"===e.code&&l&&l()};return(e,v)=>{const h=t,w=o,F=r,_=d,P=i,B=N("Icon"),q=n,K=c,E=s,O=b,Y=g,ee=m,ve=f;return k(),V("div",Me,[T("div",Ie,[T("div",Le,[S(_,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:x((()=>[S(F,{style:{"margin-left":"20px"}},{default:x((()=>[S(w,{type:"primary",plain:"",onClick:v[0]||(v[0]=e=>{p("changeDnFlag","goBack")}),style:{"margin-right":"20px"}},{default:x((()=>[S(h,{class:"el-input__icon"},{default:x((()=>[S(D($))])),_:1}),R(" 返回上报服务 ")])),_:1})])),_:1}),S(F,null,{default:x((()=>[S(w,{type:"primary",plain:"",class:"right-btn",onClick:v[1]||(v[1]=e=>{C.uFlag=!0})},{default:x((()=>[S(h,{class:"el-input__icon"},{default:x((()=>[S(D(W))])),_:1}),R(" 导入寄存器 ")])),_:1})])),_:1}),S(F,null,{default:x((()=>[S(w,{type:"primary",plain:"",class:"right-btn",onClick:v[2]||(v[2]=e=>(()=>{const e={token:y.token,responseType:"blob",data:{serviceName:u.curGateway.serviceName}};Q.exportReg(e).then((e=>{if(console.log("exportReg -> res",e),e&&"1"===e.code)return void ye(e);const a=new Blob([e.blob]),l=e.fileName,t=document.createElement("a");t.download=l,t.style.display="none",t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})())},{default:x((()=>[S(h,{class:"el-input__icon"},{default:x((()=>[S(D(X))])),_:1}),R(" 导出寄存器 ")])),_:1})])),_:1})])),_:1},512)]),T("div",Ae,[T("div",Ue,[T("div",Pe,M(u.curGateway.serviceName),1)]),S(_,{inline:!0,ref:"searchFormRef2","status-icon":"","label-width":"90px"},{default:x((()=>[S(F,{label:""},{default:x((()=>[S(P,{style:{width:"200px"},placeholder:"请输入 地址/名称 过滤",clearable:"",modelValue:D(C).regInfo,"onUpdate:modelValue":v[3]||(v[3]=e=>D(C).regInfo=e)},{prefix:x((()=>[S(h,{class:"el-input__icon"},{default:x((()=>[S(D(Z))])),_:1})])),_:1},8,["modelValue"])])),_:1}),S(F,null,{default:x((()=>[S(w,{type:"primary",bg:"",class:"right-btn",onClick:v[4]||(v[4]=e=>(()=>{let e=[];if(0===C.selectedNodes.length)return void a.info("请至少选择一个设备！");C.selectedNodes.forEach((a=>{e.push(a.deviceName)}));const l={token:y.token,data:{serviceName:u.curGateway.serviceName,deviceNames:e}};J.reportNodes(l).then((e=>{"0"===e.code?a.success(e.message):ye(e)}))})())},{default:x((()=>[S(h,{class:"btn-icon"},{default:x((()=>[S(B,{name:"local-report",size:"14px",color:"#ffffff"})])),_:1}),R(" 主动上报 ")])),_:1})])),_:1}),S(F,null,{default:x((()=>[S(w,{type:"primary",bg:"",class:"right-btn",onClick:v[5]||(v[5]=e=>(C.rFlag=!0,C.rTitle="添加寄存器",void de()))},{default:x((()=>[S(h,{class:"btn-icon"},{default:x((()=>[S(B,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),R(" 添加 ")])),_:1})])),_:1}),S(F,null,{default:x((()=>[S(w,{type:"danger",bg:"",class:"right-btn",onClick:v[6]||(v[6]=e=>(()=>{let e=[];0!==C.selectedNodes.length?(C.selectedNodes.forEach((a=>{e.push(a.regName)})),console.log("dList",e),l.confirm("确定要删除这些吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const a={token:y.token,data:{serviceName:u.curGateway.serviceName,registers:e}};Q.deleteReg(a).then((e=>{be(e,U)}))})).catch((()=>{a({type:"info",message:"取消删除"})}))):a.info("请至少选择一个寄存器！")})())},{default:x((()=>[S(h,{class:"btn-icon"},{default:x((()=>[S(B,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),R(" 删除 ")])),_:1})])),_:1}),S(F,null,{default:x((()=>[S(w,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:v[7]||(v[7]=e=>{U(1)})},{default:x((()=>[S(h,{class:"btn-icon"},{default:x((()=>[S(B,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),R(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),T("div",{class:"content",ref_key:"contentRef",ref:j,style:{top:"136px"}},[S(K,{data:D(le),"cell-style":D(C).cellStyle,"header-cell-style":D(C).headerCellStyle,"max-height":D(C).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:H,onRowDblclick:re},{empty:x((()=>[je])),default:x((()=>[S(q,{type:"selection",width:"55"}),S(q,{sortable:"",prop:"regName",label:"寄存器名称",width:"auto","min-width":"180",align:"center"}),S(q,{sortable:"",prop:"label",label:"寄存器标签",width:"auto","min-width":"180",align:"center"}),S(q,{sortable:"",prop:"propertyType",label:"属性类型",width:"auto","min-width":"120",align:"center"}),S(q,{sortable:"",prop:"collName",label:"采集接口名称",width:"auto","min-width":"180",align:"center"}),S(q,{sortable:"",prop:"nodeName",label:"设备名称",width:"auto","min-width":"180",align:"center"}),S(q,{sortable:"",prop:"propertyName",label:"设备属性名称",width:"auto","min-width":"150",align:"center"}),S(q,{sortable:"",prop:"regType",label:"寄存器类型",width:"auto","min-width":"100",align:"center"}),S(q,{sortable:"",prop:"regAddr",label:"寄存器地址",width:"auto","min-width":"100",align:"center"}),S(q,{sortable:"",prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"100",align:"center"}),S(q,{sortable:"",prop:"rule",label:"解析规则",width:"auto","min-width":"100",align:"center"}),S(q,{label:"操作",width:"auto","min-width":"120",align:"center",fixed:"right"},{default:x((e=>[S(w,{onClick:a=>re(e.row),text:"",type:"primary"},{default:x((()=>[R("编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),T("div",ze,[S(E,{"current-page":D(C).currentPage,"page-size":D(C).pagesize,"page-sizes":[20,50,200,500],total:D(te).length,onCurrentChange:ae,onSizeChange:oe,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)]),S(ee,{modelValue:D(C).rFlag,"onUpdate:modelValue":v[21]||(v[21]=e=>D(C).rFlag=e),title:D(C).rTitle,width:"600px"},{footer:x((()=>[T("span",qe,[S(w,{onClick:v[19]||(v[19]=e=>ne())},{default:x((()=>[R("取消")])),_:1}),S(w,{type:"primary",onClick:v[20]||(v[20]=e=>{ie.value.validate((e=>{if(!e)return!1;{const e={token:y.token,data:{serviceName:u.curGateway.serviceName,register:C.regForm}};C.rTitle.includes("添加")?Q.addReg(e).then((e=>{be(e,U),ne()})):Q.editReg(e).then((e=>{be(e,U),ne()}))}}))})},{default:x((()=>[R("保存")])),_:1})])])),default:x((()=>[T("div",Be,[S(_,{model:D(C).regForm,rules:D(C).regRules,ref_key:"regFormRef",ref:ie,"status-icon":"","label-position":"right","label-width":"120px"},{default:x((()=>[S(F,{label:"采集接口名称",prop:"collName"},{default:x((()=>[S(Y,{modelValue:D(C).regForm.collName,"onUpdate:modelValue":v[8]||(v[8]=e=>D(C).regForm.collName=e),style:{width:"100%"},placeholder:"请选择采集接口名称",onChange:z,clearable:"",filterable:""},{default:x((()=>[(k(!0),V(I,null,L(D(C).collOptions,(e=>(k(),A(O,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(F,{label:"设备名称",prop:"nodeName"},{default:x((()=>[S(Y,{modelValue:D(C).regForm.nodeName,"onUpdate:modelValue":v[9]||(v[9]=e=>D(C).regForm.nodeName=e),style:{width:"100%"},placeholder:"请选择设备名称",onChange:G,clearable:"",filterable:""},{default:x((()=>[(k(!0),V(I,null,L(D(C).nodeOptions,(e=>(k(),A(O,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(F,{label:"设备属性名称",prop:"propertyName"},{default:x((()=>[S(Y,{modelValue:D(C).regForm.propertyName,"onUpdate:modelValue":v[10]||(v[10]=e=>D(C).regForm.propertyName=e),style:{width:"100%"},placeholder:"请选择设备属性名称",clearable:"",filterable:""},{default:x((()=>[(k(!0),V(I,null,L(D(C).propertyOptions,(e=>(k(),A(O,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(F,{label:"寄存器名称",prop:"regName"},{default:x((()=>[S(P,{type:"text",modelValue:D(C).regForm.regName,"onUpdate:modelValue":v[11]||(v[11]=e=>D(C).regForm.regName=e),autocomplete:"off",placeholder:"请输入寄存器名称"},null,8,["modelValue"])])),_:1}),S(F,{label:"寄存器标签",prop:"label"},{default:x((()=>[S(P,{type:"text",modelValue:D(C).regForm.label,"onUpdate:modelValue":v[12]||(v[12]=e=>D(C).regForm.label=e),autocomplete:"off",placeholder:"请输入寄存器标签"},null,8,["modelValue"])])),_:1}),S(F,{label:"属性类型",prop:"propertyType"},{default:x((()=>[S(Y,{modelValue:D(C).regForm.propertyType,"onUpdate:modelValue":v[13]||(v[13]=e=>D(C).regForm.propertyType=e),style:{width:"100%"},placeholder:"请选择属性类型",clearable:"",filterable:""},{default:x((()=>[(k(!0),V(I,null,L(D(C).typeOptions,(e=>(k(),A(O,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(F,{label:"寄存器类型",prop:"regType"},{default:x((()=>[S(Y,{modelValue:D(C).regForm.regType,"onUpdate:modelValue":v[14]||(v[14]=e=>D(C).regForm.regType=e),style:{width:"100%"},placeholder:"请选择寄存器类型",clearable:"",filterable:""},{default:x((()=>[(k(!0),V(I,null,L(D(C).regTypeOptions,(e=>(k(),A(O,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(F,{label:"寄存器地址",prop:"regAddr"},{default:x((()=>[S(P,{type:"text",modelValue:D(C).regForm.regAddr,"onUpdate:modelValue":v[15]||(v[15]=e=>D(C).regForm.regAddr=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器地址"},null,8,["modelValue"])])),_:1}),S(F,{label:"寄存器数量",prop:"regCnt"},{default:x((()=>[S(Y,{modelValue:D(C).regForm.regCnt,"onUpdate:modelValue":v[16]||(v[16]=e=>D(C).regForm.regCnt=e),modelModifiers:{number:!0},style:{width:"100%"},onChange:v[17]||(v[17]=e=>(()=>{const e=C.regForm.regCnt;1===e&&(C.regForm.rule="Int_AB"),2===e&&(C.regForm.rule="Long_ABCD"),4===e&&(C.regForm.rule="Double_ABCDEFGH")})()),placeholder:"请选择寄存器数量"},{default:x((()=>[(k(!0),V(I,null,L(D(C).regCntOptions,(e=>(k(),A(O,{key:"regCount_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(F,{label:"解析规则",prop:"rule"},{default:x((()=>[S(Y,{modelValue:D(C).regForm.rule,"onUpdate:modelValue":v[18]||(v[18]=e=>D(C).regForm.rule=e),modelModifiers:{number:!0},style:{width:"100%"},placeholder:"请选择解析规则"},{default:x((()=>[(k(!0),V(I,null,L(D(C).ruleTypeOptions["rt"+D(C).regForm.regCnt],(e=>(k(),A(O,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),S(ee,{modelValue:D(C).uFlag,"onUpdate:modelValue":v[22]||(v[22]=e=>D(C).uFlag=e),title:"上传寄存器xlsx文件",width:"600px","before-close":fe,"close-on-click-modal":!1},{footer:x((()=>[T("span",Ke,[S(w,{onClick:ge},{default:x((()=>[R("取消")])),_:1}),S(w,{type:"primary",onClick:ce},{default:x((()=>[R("上传")])),_:1})])])),default:x((()=>[S(ve,{ref_key:"uploadRef",ref:pe,action:"","auto-upload":!1,"http-request":se,limit:1,"on-exceed":ue,"before-upload":me},{tip:x((()=>[Ge])),default:x((()=>[S(w,{type:"primary"},{default:x((()=>[R("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-501d5432"]]);const Oe={class:"main-container"},Qe={key:0,class:"main"},He={class:"search-bar"},Ye={class:"tool-bar"},Je={class:"param-content"},$e={class:"pc-title"},We={class:"pct-info"},Xe={class:"pc-content"},Ze={class:"param-value"},ea={class:"param-name"},aa=(e=>(z("data-v-210d3cbf"),e=e(),B(),e))((()=>T("div",null,"无数据",-1))),la={class:"pagination"},ta={class:"dialog-content"},oa={class:"dialog-footer"};var ra=K({__name:"DataService",setup(e){const p=E();console.log("window.location",window.location);const u=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,f=/^(?=^.{3,255}$)(http(s)?:\/\/)?(www\.)?[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+(:\d+)*(\/\w+\.\w+)*$/,y=/^[0-9]*[1-9][0-9]*$/,C=(e,a,l)=>{0===a||y.test(a)?l():l(new Error("只能输入自然数！"))},j=F(null),z=w({headerCellStyle:{background:O.primaryColor,color:O.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,dataServiceName:"",gatewayTableData:[],dFlag:!1,dTitle:"添加上报服务",networkNames:[],gatewayForm:{serviceName:"",ip:"",port:"",reportTime:0,protocol:"",userName:"",password:"",clientID:"",keepAlive:"",cleanSession:!1,deviceName:"",projectCode:"",token:"",slaveID:0,coilStatusRegStart:0,coilStatusRegCnt:0,inputStatusRegStart:0,inputStatusRegCnt:0,holdingRegStart:0,holdingRegCnt:0,inputRegStart:0,inputRegCnt:0,appKey:"",productKey:"",deviceID:"",deviceSecret:""},paramName:{serviceName:"服务名称",ip:"服务名称",port:"服务名称",reportTime:"上报时间",protocol:"协议名称",UserName:"用户名",Password:"密码",ClientID:"客户端名称",keepAlive:"保活时间",cleanSession:"是否清除会话",deviceName:"通信编码",projectCode:"项目编码",token:"密钥",AppKey:"appKey",ProductKey:"产品密钥",DeviceID:"通讯地址",DeviceSecret:"设备密钥"},gatewayRules:{serviceName:[{required:!0,message:"服务名称不能为空",trigger:"blur"}],ip:[{required:!0,validator:(e,a,l)=>{console.log("validateIP"),u.test(a)||f.test(a)?l():l(new Error("格式错误！"))},trigger:"blur"}],port:[{required:!0,message:"端口不能为空",trigger:"blur"}],reportTime:[{required:!0,message:"上报时间不能为空",trigger:"blur"},{type:"number",message:"上报时间只能输入数字"}],protocol:[{required:!0,message:"协议名称不能为空",trigger:"blur"}],ModbusTCP:[{required:!0,message:"上报地址不能为空",trigger:"blur"}],userName:[{required:!0,message:"用户名不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}],clientID:[{required:!0,message:"客户端名称不能为空",trigger:"blur"}],keepAlive:[{required:!0,message:"保活时间不能为空",trigger:"blur"}],deviceName:[{required:!0,message:"通讯编码不能为空",trigger:"blur"}],projectCode:[{required:!0,message:"项目编码不能为空",trigger:"blur"}],token:[{required:!0,message:"密钥不能为空",trigger:"blur"}],cleanSession:[{required:!0,message:"清除会话不能为空",trigger:"blur"}],slaveID:[{required:!0,message:"从机ID不能为空",trigger:"blur"},{validator:C,trigger:"blur"}],coilStatusRegStart:[{validator:C,trigger:"blur"}],coilStatusRegCnt:[{validator:C,trigger:"blur"}],inputStatusRegStart:[{validator:C,trigger:"blur"}],inputStatusRegCnt:[{validator:C,trigger:"blur"}],holdingRegStart:[{validator:C,trigger:"blur"}],holdingRegCnt:[{validator:C,trigger:"blur"}],inputRegStart:[{validator:C,trigger:"blur"}],inputRegCnt:[{validator:C,trigger:"blur"}],appKey:[{required:!0,message:"appKey不能为空",trigger:"blur"}],productKey:[{required:!0,message:"产品密钥不能为空",trigger:"blur"}],deviceID:[{required:!0,message:"产品密钥不能为空",trigger:"blur"}],deviceSecret:[{required:!0,message:"产品密钥不能为空",trigger:"blur"}]},protocolOptions:[{name:"EMQX.MQTT",label:"EMQX.MQTT"},{name:"RT.STLV1",label:"RT.STLV1"},{name:"RT.STLV2",label:"RT.STLV2"},{name:"RT.MQTT",label:"RT.MQTT"},{name:"ModbusTCP",label:"ModbusTCP"},{name:"FSJY.MQTT",label:"FSJY.MQTT"}],dnList:["RT.STLV1","RT.STLV2"],kaList:["EMQX.MQTT","RT.MQTT","RT.STLV2","FSJY.MQTT"],dnFlag:1,serviceName:"",handleFlag:""}),B=H();z.serviceName=B.query.serviceName;const K=e=>{const l={token:p.token,data:{}};Q.getGatewayList(l).then((async l=>{if(console.log("getGatewayList -> res",l),l){if("0"===l.code){if(z.gatewayTableData=l.data,z.serviceName&&!z.handleFlag){const e=z.gatewayTableData.find((e=>e.serviceName===z.serviceName));ee(e)}1===e&&a({type:"success",message:"刷新成功！"})}else de(l);await P((()=>{z.tableMaxHeight=j.value.clientHeight-34-36-22}))}}))};K();(()=>{const e={token:p.token,data:{}};Q.getReportProtocolList(e).then((e=>{e&&(console.log("getReportProtocolList -> res",e),"0"===e.code?z.protocolOptions=e.data:de(e))}))})();const Y=_((()=>z.gatewayTableData.filter((e=>!z.dataServiceName||e.serviceName.toLowerCase().includes(z.dataServiceName.toLowerCase()))).slice((z.currentPage-1)*z.pagesize,z.currentPage*z.pagesize))),J=_((()=>z.gatewayTableData.filter((e=>!z.dataServiceName||e.serviceName.toLowerCase().includes(z.dataServiceName.toLowerCase()))))),$=e=>{z.currentPage=e},W=e=>{z.pagesize=e},X=e=>{z.dFlag=!0,z.dTitle="编辑上报服务",z.gatewayForm={serviceName:e.serviceName,ip:e.ip,port:e.port,reportTime:e.reportTime,protocol:e.protocol},e.protocol.includes("FSJY.MQTT")?(z.gatewayForm.userName=e.param.UserName,z.gatewayForm.password=e.param.Password,z.gatewayForm.clientID=e.param.ClientID,z.gatewayForm.keepAlive=e.param.KeepAlive,z.gatewayForm.cleanSession=e.param.CleanSession,z.gatewayForm.appKey=e.param.AppKey,z.gatewayForm.productKey=e.param.ProductKey,z.gatewayForm.deviceID=e.param.DeviceID,z.gatewayForm.deviceSecret=e.param.DeviceSecret):e.protocol.includes("MQTT")?(z.gatewayForm.userName=e.param.userName,z.gatewayForm.password=e.param.password,z.gatewayForm.clientID=e.param.clientID,z.gatewayForm.keepAlive=e.param.keepAlive,z.gatewayForm.cleanSession=e.param.cleanSession):"RT.STLV1"===e.protocol?z.gatewayForm.deviceName=e.param.deviceName:"RT.STLV2"===e.protocol?(z.gatewayForm.projectCode=e.param.projectCode,z.gatewayForm.deviceName=e.param.deviceName,z.gatewayForm.keepAlive=e.param.keepAlive,z.gatewayForm.token=e.param.token):"ModbusTCP"===e.protocol&&(z.gatewayForm.ip="",z.gatewayForm.reportTime=0,z.gatewayForm.slaveID=e.param.slaveID,z.gatewayForm.coilStatusRegStart=e.param.coilStatusRegStart,z.gatewayForm.coilStatusRegCnt=e.param.coilStatusRegCnt,z.gatewayForm.inputStatusRegStart=e.param.inputStatusRegStart,z.gatewayForm.inputStatusRegCnt=e.param.inputStatusRegCnt,z.gatewayForm.holdingRegStart=e.param.holdingRegStart,z.gatewayForm.holdingRegCnt=e.param.holdingRegCnt,z.gatewayForm.inputRegStart=e.param.inputRegStart,z.gatewayForm.inputRegCnt=e.param.inputRegCnt)},ee=e=>{z.dnFlag=2,z.curGateway=e},le=e=>{z.handleFlag=e,z.dnFlag=1,K()},te=F(null),oe=()=>{z.dFlag=!1,te.value.resetFields(),z.gatewayForm={serviceName:"",ip:"",port:"",reportTime:0,protocol:"",userName:"",password:"",clientID:"",keepAlive:"",cleanSession:!1,deviceName:"",projectCode:"",token:"",appKey:"",productKey:"",deviceID:"",deviceSecret:""}},re=e=>{oe()},de=e=>{a({type:"error",message:e.message})},ie=(e,l)=>{a({type:"0"===e.code?"success":"error",message:e.message}),"0"===e.code&&l&&l()};return(e,u)=>{const f=t,y=i,w=r,F=N("Icon"),_=o,C=d,P=n,B=c,E=s,O=b,H=g,ne=v,ce=h,se=m;return k(),V("div",Oe,[1===D(z).dnFlag?(k(),V("div",Qe,[T("div",He,[S(C,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:x((()=>[S(w,{label:"上报服务名称"},{default:x((()=>[S(y,{style:{width:"200px"},placeholder:"请输入上报服务名称",clearable:"",modelValue:D(z).dataServiceName,"onUpdate:modelValue":u[0]||(u[0]=e=>D(z).dataServiceName=e)},{prefix:x((()=>[S(f,{class:"el-input__icon"},{default:x((()=>[S(D(Z))])),_:1})])),_:1},8,["modelValue"])])),_:1}),S(w,null,{default:x((()=>[S(_,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:u[1]||(u[1]=e=>{K(1)})},{default:x((()=>[S(f,{class:"btn-icon"},{default:x((()=>[S(F,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),R(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),T("div",Ye,[S(_,{type:"primary",bg:"",class:"right-btn",onClick:u[2]||(u[2]=e=>(z.dFlag=!0,void(z.dTitle="添加上报服务")))},{default:x((()=>[S(f,{class:"btn-icon"},{default:x((()=>[S(F,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),R(" 添加 ")])),_:1})]),T("div",{class:"content",ref_key:"contentRef",ref:j},[S(B,{data:D(Y),"cell-style":D(z).cellStyle,"header-cell-style":D(z).headerCellStyle,style:{width:"100%"},"max-height":D(z).tableMaxHeight,stripe:"",onRowDblclick:X},{empty:x((()=>[aa])),default:x((()=>[S(P,{type:"expand"},{default:x((e=>[T("div",Je,[T("div",$e,[T("div",We,[T("b",null,M(e.row.serviceName),1),R(" 参数详情 ")])]),T("div",Xe,[(k(!0),V(I,null,L(e.row.param,((e,a,l)=>(k(),V("div",{class:"param-item",key:l},[T("div",Ze,M(D(z).paramName[a])+"：",1),T("div",ea,M(e||"-"),1)])))),128))])])])),_:1}),S(P,{sortable:"",prop:"serviceName",label:"服务名称",width:"auto","min-width":"150",align:"center"}),S(P,{sortable:"",prop:"protocol",label:"协议名称",width:"auto","min-width":"150",align:"center"}),S(P,{sortable:"",prop:"ip",label:"上报地址",width:"auto","min-width":"150",align:"center"}),S(P,{sortable:"",prop:"port",label:"上报端口",width:"auto","min-width":"100",align:"center"}),S(P,{sortable:"",prop:"reportTime",label:"上报周期（秒）",width:"auto","min-width":"150",align:"center"}),S(P,{sortable:"",label:"在线状态",width:"auto","min-width":"100",align:"center"},{default:x((e=>[R(M("onLine"===e.row.reportStatus?"在线":"离线"),1)])),_:1}),S(P,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:x((e=>["ModbusTCP"!==e.row.protocol?(k(),A(_,{key:0,onClick:a=>ee(e.row),text:"",type:"success"},{default:x((()=>[R(" 上报节点 ")])),_:2},1032,["onClick"])):U("",!0),"ModbusTCP"==e.row.protocol?(k(),A(_,{key:1,onClick:a=>{return l=e.row,z.dnFlag=3,void(z.curGateway=l);var l},text:"",type:"success"},{default:x((()=>[R(" 寄存器详情 ")])),_:2},1032,["onClick"])):U("",!0),S(_,{onClick:a=>X(e.row),text:"",type:"primary"},{default:x((()=>[R("编辑")])),_:2},1032,["onClick"]),S(_,{onClick:t=>{return o=e.row,void l.confirm("确定要删除这个上报服务吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:p.token,data:{serviceName:o.serviceName}};Q.deleteGateway(e).then((e=>{ie(e,K)}))})).catch((()=>{a({type:"info",message:"取消删除"})}));var o},text:"",type:"danger"},{default:x((()=>[R("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),T("div",la,[S(E,{"current-page":D(z).currentPage,"page-size":D(z).pagesize,"page-sizes":[20,50,200,500],total:D(J).length,onCurrentChange:$,onSizeChange:W,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):U("",!0),2===D(z).dnFlag?(k(),A(De,{key:1,curGateway:D(z).curGateway,onChangeDnFlag:le,style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curGateway"])):U("",!0),3===D(z).dnFlag?(k(),A(Ee,{key:2,curGateway:D(z).curGateway,onChangeDnFlag:le,style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curGateway"])):U("",!0),S(se,{modelValue:D(z).dFlag,"onUpdate:modelValue":u[33]||(u[33]=e=>D(z).dFlag=e),title:D(z).dTitle,width:"600px","before-close":re,"close-on-click-modal":!1},{footer:x((()=>[T("span",oa,[S(_,{onClick:u[31]||(u[31]=e=>oe())},{default:x((()=>[R("取消")])),_:1}),S(_,{type:"primary",onClick:u[32]||(u[32]=e=>{te.value.validate((e=>{if(!e)return!1;{const e={serviceName:z.gatewayForm.serviceName,ip:z.gatewayForm.ip,port:z.gatewayForm.port,reportTime:z.gatewayForm.reportTime,protocol:z.gatewayForm.protocol,param:{}};let a={};z.gatewayForm.protocol.includes("FSJY.MQTT")?(a.userName=z.gatewayForm.userName,a.password=z.gatewayForm.password,a.clientID=z.gatewayForm.clientID,a.keepAlive=z.gatewayForm.keepAlive,a.cleanSession=z.gatewayForm.cleanSession,a.appKey=z.gatewayForm.appKey,a.productKey=z.gatewayForm.productKey,a.deviceID=z.gatewayForm.deviceID,a.deviceSecret=z.gatewayForm.deviceSecret):z.gatewayForm.protocol.includes("MQTT")?(a.userName=z.gatewayForm.userName,a.password=z.gatewayForm.password,a.clientID=z.gatewayForm.clientID,a.keepAlive=z.gatewayForm.keepAlive,a.cleanSession=z.gatewayForm.cleanSession):"RT.STLV1"===z.gatewayForm.protocol?a.deviceName=z.gatewayForm.deviceName:"RT.STLV2"===z.gatewayForm.protocol?(a.projectCode=z.gatewayForm.projectCode,a.deviceName=z.gatewayForm.deviceName,a.keepAlive=z.gatewayForm.keepAlive,a.token=z.gatewayForm.token):"ModbusTCP"===z.gatewayForm.protocol&&(a.slaveID=z.gatewayForm.slaveID,a.coilStatusRegStart=z.gatewayForm.coilStatusRegStart,a.coilStatusRegCnt=z.gatewayForm.coilStatusRegCnt,a.inputStatusRegStart=z.gatewayForm.inputStatusRegStart,a.inputStatusRegCnt=z.gatewayForm.inputStatusRegCnt,a.holdingRegStart=z.gatewayForm.holdingRegStart,a.holdingRegCnt=z.gatewayForm.holdingRegCnt,a.inputRegStart=z.gatewayForm.inputRegStart,a.inputRegCnt=z.gatewayForm.inputRegCnt),e.param=a;const l={token:p.token,data:e};z.dTitle.includes("添加")?Q.addGateway(l).then((e=>{ie(e,K),oe()})):Q.editGateway(l).then((e=>{ie(e,K),oe()}))}}))})},{default:x((()=>[R("保存")])),_:1})])])),default:x((()=>[T("div",ta,[S(C,{model:D(z).gatewayForm,rules:D(z).gatewayRules,ref_key:"gatewayFormRef",ref:te,"status-icon":"","label-position":"right","label-width":"120px",style:{height:"450px"}},{default:x((()=>[S(w,{label:"服务名称",prop:"serviceName"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.serviceName,"onUpdate:modelValue":u[3]||(u[3]=e=>D(z).gatewayForm.serviceName=e),autocomplete:"off",placeholder:"请输入服务名称"},null,8,["modelValue"])])),_:1}),S(w,{label:"协议类型",prop:"protocol"},{default:x((()=>[S(H,{modelValue:D(z).gatewayForm.protocol,"onUpdate:modelValue":u[4]||(u[4]=e=>D(z).gatewayForm.protocol=e),onChange:u[5]||(u[5]=e=>{"RT.MQTT"===D(z).gatewayForm.protocol&&(z.gatewayForm.ip="mqtt.reatgreen.com",z.gatewayForm.port="1883",z.gatewayForm.userName="reatgreen",z.gatewayForm.password="Reat@2022",z.gatewayForm.reportTime=900,z.gatewayForm.keepAlive="30",z.gatewayForm.cleanSession=!0)}),style:{width:"100%"},placeholder:"请选择协议类型"},{default:x((()=>[(k(!0),V(I,null,L(D(z).protocolOptions,(e=>(k(),A(O,{key:"protocol"+e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),q(S(w,{label:"上报地址",prop:"ModbusTCP"!==D(z).gatewayForm.protocol?"ip":""},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.ip,"onUpdate:modelValue":u[6]||(u[6]=e=>D(z).gatewayForm.ip=e),autocomplete:"off",placeholder:"请输入上报地址"},null,8,["modelValue"])])),_:1},8,["prop"]),[[G,"ModbusTCP"!==D(z).gatewayForm.protocol]]),S(w,{label:"上报端口",prop:"port"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.port,"onUpdate:modelValue":u[7]||(u[7]=e=>D(z).gatewayForm.port=e),autocomplete:"off",placeholder:"请输入上报端口"},null,8,["modelValue"])])),_:1}),q(S(w,{label:"上报周期",prop:"ModbusTCP"!==D(z).gatewayForm.protocol?"reportTime":""},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.reportTime,"onUpdate:modelValue":u[8]||(u[8]=e=>D(z).gatewayForm.reportTime=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入上报周期"},{append:x((()=>[R("单位秒")])),_:1},8,["modelValue"])])),_:1},8,["prop"]),[[G,"ModbusTCP"!==D(z).gatewayForm.protocol]]),D(z).gatewayForm.protocol.includes("MQTT")?(k(),A(w,{key:0,label:"用户名",prop:"userName"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.userName,"onUpdate:modelValue":u[9]||(u[9]=e=>D(z).gatewayForm.userName=e),autocomplete:"off",placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1})):U("",!0),D(z).gatewayForm.protocol.includes("MQTT")?(k(),A(w,{key:1,label:"密码",prop:"password"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.password,"onUpdate:modelValue":u[10]||(u[10]=e=>D(z).gatewayForm.password=e),autocomplete:"off",placeholder:"请输入密码"},null,8,["modelValue"])])),_:1})):U("",!0),D(z).gatewayForm.protocol.includes("MQTT")?(k(),A(w,{key:2,label:"客户端名称",prop:"clientID"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.clientID,"onUpdate:modelValue":u[12]||(u[12]=e=>D(z).gatewayForm.clientID=e),autocomplete:"off",placeholder:"请输入客户端名称"},{append:x((()=>[S(_,{onClick:u[11]||(u[11]=e=>(()=>{const e={token:p.token,data:{}};ae.getGatewaySN(e).then((e=>{"0"===e.code?z.gatewayForm.clientID=e.data.sn:de(e)}))})())},{default:x((()=>[R("同步SN")])),_:1})])),_:1},8,["modelValue"])])),_:1})):U("",!0),D(z).gatewayForm.protocol.includes("FSJY")?(k(),A(w,{key:3,label:"APP-KEY",prop:"appKey"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.appKey,"onUpdate:modelValue":u[13]||(u[13]=e=>D(z).gatewayForm.appKey=e),autocomplete:"off",placeholder:"请输入appKey"},null,8,["modelValue"])])),_:1})):U("",!0),D(z).gatewayForm.protocol.includes("FSJY")?(k(),A(w,{key:4,label:"产品密钥",prop:"productKey"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.productKey,"onUpdate:modelValue":u[14]||(u[14]=e=>D(z).gatewayForm.productKey=e),autocomplete:"off",placeholder:"请输入网关产品密钥"},null,8,["modelValue"])])),_:1})):U("",!0),D(z).gatewayForm.protocol.includes("FSJY")?(k(),A(w,{key:5,label:"通讯地址",prop:"deviceID"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.deviceID,"onUpdate:modelValue":u[15]||(u[15]=e=>D(z).gatewayForm.deviceID=e),autocomplete:"off",placeholder:"请输入网关通讯地址"},null,8,["modelValue"])])),_:1})):U("",!0),D(z).gatewayForm.protocol.includes("FSJY")?(k(),A(w,{key:6,label:"设备密钥",prop:"deviceSecret"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.deviceSecret,"onUpdate:modelValue":u[16]||(u[16]=e=>D(z).gatewayForm.deviceSecret=e),autocomplete:"off",placeholder:"请输入网关设备密钥"},null,8,["modelValue"])])),_:1})):U("",!0),"RT.STLV2"===D(z).gatewayForm.protocol?(k(),A(w,{key:7,label:"项目编码",prop:"projectCode"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.projectCode,"onUpdate:modelValue":u[17]||(u[17]=e=>D(z).gatewayForm.projectCode=e),autocomplete:"off",placeholder:"请输入项目编码"},null,8,["modelValue"])])),_:1})):U("",!0),D(z).dnList.includes(D(z).gatewayForm.protocol)?(k(),A(w,{key:8,label:"通信编码",prop:"deviceName"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.deviceName,"onUpdate:modelValue":u[18]||(u[18]=e=>D(z).gatewayForm.deviceName=e),autocomplete:"off",placeholder:"请输入通信编码"},null,8,["modelValue"])])),_:1})):U("",!0),D(z).kaList.includes(D(z).gatewayForm.protocol)?(k(),A(w,{key:9,label:"保活时间",prop:"keepAlive"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.keepAlive,"onUpdate:modelValue":u[19]||(u[19]=e=>D(z).gatewayForm.keepAlive=e),autocomplete:"off",placeholder:"请输入保活时间"},{append:x((()=>[R("单位秒")])),_:1},8,["modelValue"])])),_:1})):U("",!0),D(z).gatewayForm.protocol.includes("MQTT")?(k(),A(w,{key:10,label:"是否清除会话",prop:"cleanSession"},{default:x((()=>[S(ne,{modelValue:D(z).gatewayForm.cleanSession,"onUpdate:modelValue":u[20]||(u[20]=e=>D(z).gatewayForm.cleanSession=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):U("",!0),"RT.STLV2"===D(z).gatewayForm.protocol?(k(),A(w,{key:11,label:"秘钥",prop:"token"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.token,"onUpdate:modelValue":u[21]||(u[21]=e=>D(z).gatewayForm.token=e),autocomplete:"off",placeholder:"请输入秘钥"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(w,{key:12,label:"从机ID",prop:"slaveID"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.slaveID,"onUpdate:modelValue":u[22]||(u[22]=e=>D(z).gatewayForm.slaveID=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入从机ID"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(ce,{key:13,"content-position":"center"},{default:x((()=>[R(" 线圈状态寄存器 ")])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(w,{key:14,label:"起始地址",prop:"coilStatusRegStart"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.coilStatusRegStart,"onUpdate:modelValue":u[23]||(u[23]=e=>D(z).gatewayForm.coilStatusRegStart=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入线圈状态寄存器起始地址"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(w,{key:15,label:"数量",prop:"coilStatusRegCnt"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.coilStatusRegCnt,"onUpdate:modelValue":u[24]||(u[24]=e=>D(z).gatewayForm.coilStatusRegCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入线圈状态寄存器数量"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(ce,{key:16,"content-position":"center"},{default:x((()=>[R(" 离散输入状态寄存器 ")])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(w,{key:17,label:"起始地址",prop:"inputStatusRegStart"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.inputStatusRegStart,"onUpdate:modelValue":u[25]||(u[25]=e=>D(z).gatewayForm.inputStatusRegStart=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入离散输入状态寄存器起始地址"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(w,{key:18,label:"数量",prop:"inputStatusRegCnt"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.inputStatusRegCnt,"onUpdate:modelValue":u[26]||(u[26]=e=>D(z).gatewayForm.inputStatusRegCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入离散输入状态寄存器数量"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(ce,{key:19,"content-position":"center"},{default:x((()=>[R(" 保持寄存器 ")])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(w,{key:20,label:"起始地址",prop:"holdingRegStart"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.holdingRegStart,"onUpdate:modelValue":u[27]||(u[27]=e=>D(z).gatewayForm.holdingRegStart=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入保持寄存器起始地址"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(w,{key:21,label:"数量",prop:"holdingRegCnt"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.holdingRegCnt,"onUpdate:modelValue":u[28]||(u[28]=e=>D(z).gatewayForm.holdingRegCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入保持寄存器数量"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(ce,{key:22,"content-position":"center"},{default:x((()=>[R(" 输入寄存器 ")])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(w,{key:23,label:"起始地址",prop:"inputRegStart"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.inputRegStart,"onUpdate:modelValue":u[29]||(u[29]=e=>D(z).gatewayForm.inputRegStart=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入输入寄存器起始地址"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(w,{key:24,label:"数量",prop:"inputRegCnt"},{default:x((()=>[S(y,{type:"text",modelValue:D(z).gatewayForm.inputRegCnt,"onUpdate:modelValue":u[30]||(u[30]=e=>D(z).gatewayForm.inputRegCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入输入寄存器数量"},null,8,["modelValue"])])),_:1})):U("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-210d3cbf"]]);export{ra as default};
