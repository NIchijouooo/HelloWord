import{g as e,e as l,p as t,n as a,o,m as r,A as d,C as n,D as i,L as s,v as p,w as c,K as u,l as m,G as f,q as g,M as b,u as y}from"./element-plus.3300f756.js";import{s as h,_ as v,u as F,v as _}from"./index.9b2cfea2.js";import{D as w}from"./deviceModel.16d94447.js";import{b as k,i as x,d as C,h as M}from"./@element-plus.0bef5fa5.js";import{f as V,K as A,k as D,af as L,o as B,c as S,a as P,P as R,S as z,u as T,W as U,X as N,n as j,aw as O,ax as q,h as I,Q as E,ak as H,T as G,$ as W,a0 as $,Y as K,M as Q}from"./@vue.73d14ebc.js";import{u as X}from"./vue-router.43b9a342.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.3d90a471.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./pinia.3f4aff4f.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.7828944a.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";var Y=e=>h.request({url:"/tsl/modbus/cmd",method:"get",data:e}),J=e=>h.request({url:"/tsl/modbus/cmd",method:"post",data:e}),Z=e=>h.request({url:"/tsl/modbus/cmd",method:"put",data:e}),ee=e=>h.request({url:"/tsl/modbus/cmd",method:"delete",data:e}),le=e=>h.request({url:"/tsl/modbus/block/xlsx",method:"post",data:e}),te=e=>h.request({url:"/tsl/modbus/block/xlsx",method:"get",data:e}),ae=e=>h.request({url:"/tsl/modbus/cmd/params",method:"get",data:e}),oe=e=>h.request({url:"/tsl/modbus/cmd/param",method:"post",data:e}),re=e=>h.request({url:"/tsl/modbus/cmd/param",method:"put",data:e}),de=e=>h.request({url:"/tsl/modbus/cmd/params",method:"delete",data:e}),ne=e=>h.request({url:"/tsl/modbus/cmd/param/xlsx",method:"post",data:e}),ie=e=>h.request({url:"/tsl/modbus/cmd/param/xlsx",method:"get",data:e});const se={class:"main-container"},pe={class:"main"},ce={class:"search-bar"},ue={class:"search-bar",style:{display:"flex"}},me={class:"title",style:{position:"relative","margin-right":"40px",height:"40px",padding:"0px 0","justify-content":"flex-start"}},fe={class:"tName"},ge=(e=>(O("data-v-f38f3ace"),e=e(),q(),e))((()=>P("div",null,"无数据",-1))),be={class:"pagination"};var ye=v({__name:"PropertyRtu",props:{curDeviceModel:{type:Object,default:{}}},emits:["changeShowFlag"],setup(s,{emit:p}){const c=s,u=F();console.log("id -> props",c);const m=V(null),f=A({headerCellStyle:{background:_.primaryColor,color:_.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,dbNumber:"",startAddr:"",dataType:0,unit:"",decimals:0},psFlag:!1,selectedProperties:[]}),g=l=>{const t={token:u.token,data:{name:c.curDeviceModel.name}};w.getDeviceModelProperty(t).then((async t=>{console.log("getDeviceModelProperty -> res",t),t&&("0"===t.code?(f.propertyList=t.data,1===l&&e({type:"success",message:"刷新成功！"})):M(t),await j((()=>{f.tableMaxHeight=m.value.clientHeight-34-36-132})))}))};g();const b=D((()=>(console.log("ctxData.propertyList ->",f.propertyList),f.propertyList.filter((e=>{var l=!f.deviceModelProperty,t=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||t})).slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize)))),y=D((()=>f.propertyList.filter((e=>{var l=!f.deviceModelProperty,t=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||t})))),h=e=>{f.currentPage=e},v=e=>{f.pagesize=e},M=l=>{e({type:"error",message:l.message})};return(e,s)=>{const F=l,_=t,V=a,A=o,D=r,j=L("Icon"),O=d,q=n,I=i;return B(),S("div",se,[P("div",pe,[P("div",ce,[R(A,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:z((()=>[R(V,{style:{"margin-left":"20px"}},{default:z((()=>[R(_,{type:"primary",plain:"",onClick:s[0]||(s[0]=e=>{p("changeShowFlag","goBack")})},{default:z((()=>[R(F,{class:"el-input__icon"},{default:z((()=>[R(T(k))])),_:1}),U(" 返回设备模型 ")])),_:1})])),_:1}),R(V,null,{default:z((()=>[R(_,{type:"primary",plain:"",class:"right-btn",onClick:s[1]||(s[1]=e=>(()=>{console.log("exportDPS");const e={token:u.token,responseType:"blob",data:{name:c.curDeviceModel.name}};w.exportDeviceModelProptyAndService(e).then((e=>{if(e&&"1"===e.code)return void M(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:z((()=>[R(F,{class:"el-input__icon"},{default:z((()=>[R(T(x))])),_:1}),U(" 导出模型属性 ")])),_:1})])),_:1})])),_:1},512)]),P("div",ue,[P("div",me,[P("div",fe,N(c.curDeviceModel.label)+"：属性列表",1)]),R(A,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:z((()=>[R(V,{label:""},{default:z((()=>[R(D,{style:{width:"200px"},placeholder:"请输入属性名称",modelValue:T(f).deviceModelProperty,"onUpdate:modelValue":s[2]||(s[2]=e=>T(f).deviceModelProperty=e)},{prefix:z((()=>[R(F,{class:"el-input__icon"},{default:z((()=>[R(T(C))])),_:1})])),_:1},8,["modelValue"])])),_:1}),R(V,null,{default:z((()=>[R(_,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:s[3]||(s[3]=e=>{g(1)})},{default:z((()=>[R(F,{class:"btn-icon"},{default:z((()=>[R(j,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),U(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),P("div",{class:"content",ref_key:"contentRef",ref:m},[R(q,{data:T(b),"cell-style":T(f).cellStyle,"header-cell-style":T(f).headerCellStyle,style:{width:"100%"},"max-height":T(f).tableMaxHeight,stripe:""},{empty:z((()=>[ge])),default:z((()=>[R(O,{type:"index",width:"60"},{header:z((()=>[U(" 序号 ")])),_:1}),R(O,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),R(O,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),R(O,{sortable:"",label:"读写属性",width:"auto","min-width":"80",align:"center"},{default:z((e=>[U(N(T(f).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),R(O,{sortable:"",prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:z((e=>[U(N(T(f).typeNames["t"+e.row.type]),1)])),_:1}),R(O,{sortable:"",label:"小数位数",width:"auto","min-width":"80",align:"center"},{default:z((e=>[U(N(""===e.row.decimals?0:e.row.decimals),1)])),_:1}),R(O,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),R(O,{sortable:"",prop:"regAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),R(O,{sortable:"",prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"120",align:"center"}),R(O,{sortable:"",prop:"ruleType",label:"解析规则",width:"auto","min-width":"120",align:"center"}),R(O,{sortable:"",prop:"formula",label:"计算公式",width:"auto","min-width":"200",align:"center"}),R(O,{sortable:"",prop:"bitOffset",label:"位偏移",width:"auto","min-width":"120",align:"center"}),R(O,{sortable:"",prop:"step",label:"步长",width:"auto","min-width":"120",align:"center"})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),P("div",be,[R(I,{"current-page":T(f).currentPage,"page-size":T(f).pagesize,"page-sizes":[20,50,200,500],total:T(y).length,onCurrentChange:h,onSizeChange:v,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])])}}},[["__scopeId","data-v-f38f3ace"]]);const he=e=>(O("data-v-2e656c60"),e=e(),q(),e),ve={class:"main-container"},Fe={style:{display:"flex","justify-content":"space-between"}},_e={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},we={class:"tName"},ke={class:"search-bar",style:{"text-align":"right"}},xe=he((()=>P("div",null,"无数据",-1))),Ce={class:"pagination"},Me={class:"dialog-content"},Ve=he((()=>P("div",{class:"form-title"},[P("div",{class:"tName"},"配置参数")],-1))),Ae={class:"dialog-footer"},De={class:"dialog-content"},Le={style:{width:"100%"}},Be={style:{"padding-right":"10px"}},Se={class:"dialog-footer"},Pe=he((()=>P("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),Re={class:"dialog-footer"};var ze=v({__name:"BlockPropertyRtu",props:{curModelBlock:{type:Object,default:{}}},emits:["changeBShowFlag"],setup(y,{emit:h}){const v=y,k=F(),O=/^[0-9]*[1-9][0-9]*$/,q=/^[0-9]\d*$/,Q=/^[0-9]+(.[0-9]{1,2})?$/,X=V(null),Y=A({formulaForm:{},headerCellStyle:{background:_.primaryColor,color:_.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",accessModeOptions:[{label:"只读",value:0},{label:"只写",value:1},{label:"读写",value:2}],typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},regCntOptions:[{label:1,value:1},{label:2,value:2},{label:4,value:4}],pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,regCnt:1,regAddr:null,ruleType:"Int_AB",unit:"",decimals:0,formula:"",bitSwitch:!1,bitOffset:0,min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,dataLength:"",dataLengthAlarm:!1},ruleTypeOptions:{rt1:[{label:"Int_AB",value:"Int_AB"},{label:"Int_BA",value:"Int_BA"}],rt2:[{label:"Long_ABCD",value:"Long_ABCD"},{label:"Long_BADC",value:"Long_BADC"},{label:"Long_DCBA",value:"Long_DCBA"},{label:"Long_CDAB",value:"Long_CDAB"},{label:"Float_ABCD",value:"Float_ABCD"},{label:"Float_BADC",value:"Float_BADC"},{label:"Float_DCBA",value:"Float_DCBA"},{label:"Float_CDAB",value:"Float_CDAB"}],rt4:[{label:"Double_ABCDEFGH",value:"Double_ABCDEFGH"},{label:"Double_GHEFCDAB",value:"Double_GHEFCDAB"},{label:"Double_BADCFEHG",value:"Double_BADCFEHG"},{label:"Double_HGFEDCBA",value:"Double_HGFEDCBA"}]},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",decimals:"小数位数",regCnt:"寄存器数量",ruleType:"解析规则",regAddr:"寄存器地址",formula:"计算公式",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"步长",stepAlarm:"步长报警",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],accessMode:[{required:!0,message:"读写属性不能为空",trigger:"blur"}],type:[{required:!0,message:"属性类型不能为空",trigger:"blur"}],ruleType:[{required:!0,message:"解析规则不能为空",trigger:"blur"}],decimals:[{type:"number",message:"小数位数只能输入数字"}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{O.test(l)?t():t(new Error("只能输入正整数数字！"))}}],regAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{0===l||O.test(l)?t():t(new Error("只能输入自然数！"))}}],bitOffset:[{required:!0,message:"位偏移不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{!q.test(l)||l>1e3?t(new Error("只能输入0-1000的整数数字！")):t()}}],step:[{required:!0,message:"步长不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{Q.test(l)?t():t(new Error("只能输入大于等于0,最多两位小数的数字！"))}}]},psFlag:!1,selectedProperties:[],fFlag:!1,propertyInfo:[],operationList:[{name:"+",label:"+",describe:"加"},{name:"-",label:"-",describe:"减"},{name:"*",label:"*",describe:"乘"},{name:"/",label:"/",describe:"除"},{name:"%",label:"%",describe:"模"},{name:"^",label:"^",describe:"次幂"},{name:"(",label:"(",describe:"左括号"},{name:")",label:")",describe:"右括号"}],curFormula:"",selectionStart:0,pItem:""}),J=l=>{const t={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name}};ae(t).then((async t=>{t&&("0"===t.code?(Y.propertyList=null==t.data?[]:t.data,1===l&&e({type:"success",message:"刷新成功！"})):Oe(t),await j((()=>{Y.tableMaxHeight=X.value.clientHeight-34-22-82})))}))};J();const Z=D((()=>Y.propertyList.filter((e=>{var l=!Y.deviceModelProperty,t=e.name.toLowerCase().includes(Y.deviceModelProperty.toLowerCase());return l||t})).slice((Y.currentPage-1)*Y.pagesize,Y.currentPage*Y.pagesize))),ee=D((()=>Y.propertyList.filter((e=>{var l=!Y.deviceModelProperty,t=e.name.toLowerCase().includes(Y.deviceModelProperty.toLowerCase());return l||t})))),le=e=>{Y.currentPage=e},te=e=>{Y.pagesize=e},se=()=>{ce.value&&ce.value.submit()},pe=e=>{},ce=V(null),ue=e=>{ce.value.clearFiles();const l=e[0];ce.value.handleStart(l)},me=l=>{let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("tslName",v.curModelBlock.tslName),t.append("cmdName",v.curModelBlock.name),t.append("fileName",l);const a={token:k.token,contentType:"multipart/form-data",data:t};ne(a).then((l=>{"0"===l.code?(e.success(l.message),Y.psFlag=!1,J()):Oe(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},fe=()=>{Y.psFlag=!1,uploadRef.value.clearFiles()},ge=()=>{fe()},be=e=>{Y.pFlag=!0,Y.pTitle="编辑属性",Y.propertyForm.name=e.name,Y.propertyForm.label=e.label,Y.propertyForm.accessMode=e.accessMode,Y.propertyForm.type=e.type,Y.propertyForm.decimals=e.decimals,Y.propertyForm.unit=e.unit,Y.propertyForm.regCnt=e.regCnt,Y.propertyForm.regAddr=e.regAddr,Y.propertyForm.ruleType=e.ruleType,Y.propertyForm.formula=void 0===e.formula||null===e.formula?"":e.formula,Y.propertyForm.bitSwitch=void 0!==e.bitSwitch&&null!==e.bitSwitch&&e.bitSwitch,Y.propertyForm.bitOffset=void 0===e.bitOffset||null===e.bitOffset?0:e.bitOffset,3!==e.type?(Y.propertyForm.min=e.params.min,Y.propertyForm.max=e.params.max,Y.propertyForm.minMaxAlarm=e.params.minMaxAlarm,Y.propertyForm.step=void 0===e.params.step||null===e.params.step?0:e.params.step,Y.propertyForm.stepAlarm=e.params.stepAlarm):(Y.propertyForm.dataLength=e.params.dataLength,Y.propertyForm.dataLengthAlarm=e.params.dataLengthAlarm)},ye=V(null),he=()=>{Y.pFlag=!1,ye.value.resetFields(),Ue()},ze=e=>{he()},Te=e=>{Y.selectedProperties=e},Ue=()=>{Y.propertyForm={name:"",label:"",accessMode:0,type:0,decimals:0,unit:"",regCnt:1,regAddr:null,ruleType:"Int_AB",formula:"",bitSwitch:!1,bitOffset:0,step:0}},Ne=()=>{Y.fFlag=!0,Y.curFormula=Y.propertyForm.formula,(()=>{const e={token:k.token,data:{name:v.curModelBlock.tslName}};w.getDeviceModelProperty(e).then((e=>{e&&("0"===e.code?(Y.propertyInfo=[{name:"t",label:"当前属性"}],e.data.forEach((e=>{Y.propertyInfo.push({name:e.name,label:e.label})}))):Oe(e))}))})()},je=e=>{Y.selectionStart=e.srcElement.selectionStart},Oe=l=>{e({type:"error",message:l.message})},qe=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return I((()=>v.curModelBlock),((e,l)=>{J()})),(y,h)=>{const F=l,_=r,w=a,V=t,A=L("Icon"),D=o,j=d,O=n,q=i,I=p,Q=c,ae=u,ne=m,Ue=f,Ie=g,Ee=b;return B(),S("div",ve,[P("div",Fe,[P("div",_e,[P("div",we,N(v.curModelBlock.label)+"：命令参数列表",1)]),P("div",ke,[R(D,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:z((()=>[R(w,{style:{"margin-left":"20px"}},{default:z((()=>[R(_,{style:{width:"200px"},placeholder:"请输入命令参数名称",modelValue:T(Y).deviceModelProperty,"onUpdate:modelValue":h[0]||(h[0]=e=>T(Y).deviceModelProperty=e)},{prefix:z((()=>[R(F,{class:"el-input__icon"},{default:z((()=>[R(T(C))])),_:1})])),_:1},8,["modelValue"])])),_:1}),R(w,null,{default:z((()=>[R(V,{type:"primary",plain:"",class:"right-btn",onClick:h[1]||(h[1]=e=>{Y.psFlag=!0})},{default:z((()=>[R(F,{class:"el-input__icon"},{default:z((()=>[R(T(M))])),_:1}),U(" 导入命令参数 ")])),_:1})])),_:1}),R(w,null,{default:z((()=>[R(V,{type:"primary",plain:"",class:"right-btn",onClick:h[2]||(h[2]=e=>(()=>{const e={token:k.token,responseType:"blob",data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name}};ie(e).then((e=>{if(e&&"1"===e.code)return void Oe(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:z((()=>[R(F,{class:"el-input__icon"},{default:z((()=>[R(T(x))])),_:1}),U(" 导出命令参数 ")])),_:1})])),_:1}),R(w,null,{default:z((()=>[R(V,{type:"primary",bg:"",class:"right-btn",onClick:h[3]||(h[3]=e=>(Y.pFlag=!0,void(Y.pTitle="添加属性")))},{default:z((()=>[R(F,{class:"btn-icon"},{default:z((()=>[R(A,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),U(" 添加 ")])),_:1})])),_:1}),R(w,null,{default:z((()=>[R(V,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:h[4]||(h[4]=e=>{J(1)})},{default:z((()=>[R(F,{class:"btn-icon"},{default:z((()=>[R(A,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),U(" 刷新 ")])),_:1})])),_:1}),R(w,null,{default:z((()=>[R(V,{type:"danger",bg:"",class:"right-btn",onClick:h[5]||(h[5]=l=>(l=>{let t=[];0!==Y.selectedProperties.length?(Y.selectedProperties.forEach((e=>{t.push(e.name)})),s.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name,propertyNames:t}};de(e).then((e=>{qe(e,J)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:z((()=>[R(F,{class:"btn-icon"},{default:z((()=>[R(A,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),U(" 删除 ")])),_:1})])),_:1})])),_:1},512)])]),P("div",{class:"content",ref_key:"contentRef",ref:X},[R(O,{data:T(Z),"cell-style":T(Y).cellStyle,"header-cell-style":T(Y).headerCellStyle,style:{width:"100%"},stripe:"","max-height":T(Y).tableMaxHeight,onSelectionChange:Te,onRowDblclick:be},{empty:z((()=>[xe])),default:z((()=>[R(j,{type:"selection",width:"55"}),R(j,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),R(j,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),R(j,{sortable:"",label:"读写属性",width:"auto","min-width":"100",align:"center"},{default:z((e=>[U(N(T(Y).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),R(j,{sortable:"",prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:z((e=>[U(N(T(Y).typeNames["t"+e.row.type]),1)])),_:1}),R(j,{sortable:"",label:"小数位数",width:"auto","min-width":"100",align:"center"},{default:z((e=>[U(N(""===e.row.decimals?0:e.row.decimals),1)])),_:1}),R(j,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),R(j,{sortable:"",prop:"regAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),R(j,{sortable:"",prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"120",align:"center"}),R(j,{sortable:"",prop:"ruleType",label:"解析规则",width:"auto","min-width":"120",align:"center"}),R(j,{sortable:"",prop:"formula",label:"计算公式",width:"auto","min-width":"200",align:"center"}),R(j,{sortable:"",prop:"bitOffset",label:"位偏移",width:"auto","min-width":"120",align:"center"}),R(j,{sortable:"",prop:"step",label:"步长",width:"auto","min-width":"120",align:"center"}),R(j,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:z((e=>[R(V,{onClick:l=>be(e.row),text:"",type:"primary"},{default:z((()=>[U("编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),P("div",Ce,[R(q,{"current-page":T(Y).currentPage,"page-size":T(Y).pagesize,"page-sizes":[20,50,200,500],total:T(ee).length,onCurrentChange:le,onSizeChange:te,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),R(Ie,{modelValue:T(Y).pFlag,"onUpdate:modelValue":h[30]||(h[30]=e=>T(Y).pFlag=e),title:T(Y).pTitle,width:"800px","before-close":ze,"close-on-click-modal":!1},{footer:z((()=>[P("span",Ae,[R(V,{onClick:h[28]||(h[28]=e=>he())},{default:z((()=>[U("取消")])),_:1}),R(V,{type:"primary",onClick:h[29]||(h[29]=e=>{ye.value.validate((e=>{if(!e)return!1;{const e={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name,name:Y.propertyForm.name,label:Y.propertyForm.label,accessMode:Y.propertyForm.accessMode,type:Y.propertyForm.type,decimals:Y.propertyForm.decimals,unit:Y.propertyForm.unit,regCnt:Y.propertyForm.regCnt,regAddr:Y.propertyForm.regAddr,ruleType:Y.propertyForm.ruleType,formula:Y.propertyForm.formula,bitSwitch:Y.propertyForm.bitSwitch,bitOffset:Y.propertyForm.bitSwitch?Y.propertyForm.bitOffset:-1}};let l={};3!==Y.propertyForm.type?(l.min=Y.propertyForm.min,l.max=Y.propertyForm.max,l.minMaxAlarm=Y.propertyForm.minMaxAlarm,l.step=+Y.propertyForm.step,l.stepAlarm=Y.propertyForm.stepAlarm):(l.dataLength=Y.propertyForm.dataLength,l.dataLengthAlarm=Y.propertyForm.dataLengthAlarm),e.data.params=l,Y.pTitle.includes("添加")?oe(e).then((e=>{qe(e,J),he()})):re(e).then((e=>{qe(e,J),he()}))}}))})},{default:z((()=>[U("保存")])),_:1})])])),default:z((()=>[P("div",Me,[R(D,{model:T(Y).propertyForm,rules:T(Y).propertyRules,ref_key:"propertyFormRef",ref:ye,"status-icon":"","label-position":"right","label-width":"120px",inline:!0},{default:z((()=>[R(w,{label:"属性名称",prop:"name"},{default:z((()=>[R(_,{style:{width:"220px"},disabled:T(Y).pTitle.includes("编辑"),type:"text",modelValue:T(Y).propertyForm.name,"onUpdate:modelValue":h[6]||(h[6]=e=>T(Y).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),R(w,{label:"属性标签",prop:"label"},{default:z((()=>[R(_,{style:{width:"220px"},type:"text",modelValue:T(Y).propertyForm.label,"onUpdate:modelValue":h[7]||(h[7]=e=>T(Y).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),R(w,{label:"读写属性",prop:"accessMode"},{default:z((()=>[R(Q,{modelValue:T(Y).propertyForm.accessMode,"onUpdate:modelValue":h[8]||(h[8]=e=>T(Y).propertyForm.accessMode=e),style:{width:"220px"},placeholder:"请选择读写属性"},{default:z((()=>[(B(!0),S(E,null,H(T(Y).accessModeOptions,(e=>(B(),G(I,{key:"accessMode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),R(w,{label:"单位",prop:"unit"},{default:z((()=>[R(_,{style:{width:"220px"},type:"text",modelValue:T(Y).propertyForm.unit,"onUpdate:modelValue":h[9]||(h[9]=e=>T(Y).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1}),R(w,{label:"属性类型",prop:"type"},{default:z((()=>[R(Q,{modelValue:T(Y).propertyForm.type,"onUpdate:modelValue":h[10]||(h[10]=e=>T(Y).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择属性类型"},{default:z((()=>[(B(!0),S(E,null,H(T(Y).typeOptions,(e=>(B(),G(I,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),R(w,{label:"计算公式",prop:"formula"},{default:z((()=>[R(_,{style:{width:"220px"},type:"text",readonly:"",modelValue:T(Y).propertyForm.formula,"onUpdate:modelValue":h[12]||(h[12]=e=>T(Y).propertyForm.formula=e),autocomplete:"off",placeholder:"请编辑计算公式"},{append:z((()=>[R(V,{onClick:h[11]||(h[11]=e=>Ne())},{default:z((()=>[U("编辑")])),_:1})])),_:1},8,["modelValue"])])),_:1}),W(R(w,{label:"小数位数",prop:"decimals"},{default:z((()=>[R(_,{style:{width:"220px"},type:"text",modelValue:T(Y).propertyForm.decimals,"onUpdate:modelValue":h[13]||(h[13]=e=>T(Y).propertyForm.decimals=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入小数位数"},null,8,["modelValue"])])),_:1},512),[[$,2===T(Y).propertyForm.type]]),P("div",null,[3!==T(Y).propertyForm.type?(B(),G(w,{key:0,label:"范围报警",prop:"minMaxAlarm"},{default:z((()=>[R(ae,{modelValue:T(Y).propertyForm.minMaxAlarm,"onUpdate:modelValue":h[14]||(h[14]=e=>T(Y).propertyForm.minMaxAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):K("",!0)]),P("div",null,[3!==T(Y).propertyForm.type&&T(Y).propertyForm.minMaxAlarm?(B(),G(w,{key:0,label:"最小值",prop:"min"},{default:z((()=>[R(_,{type:"text",modelValue:T(Y).propertyForm.min,"onUpdate:modelValue":h[15]||(h[15]=e=>T(Y).propertyForm.min=e),autocomplete:"off",placeholder:"请输入最小值"},null,8,["modelValue"])])),_:1})):K("",!0)]),3!==T(Y).propertyForm.type&&T(Y).propertyForm.minMaxAlarm?(B(),G(w,{key:0,label:"最大值",prop:"max"},{default:z((()=>[R(_,{type:"text",modelValue:T(Y).propertyForm.max,"onUpdate:modelValue":h[16]||(h[16]=e=>T(Y).propertyForm.max=e),autocomplete:"off",placeholder:"请输入最大值"},null,8,["modelValue"])])),_:1})):K("",!0),P("div",null,[3!==T(Y).propertyForm.type?(B(),G(w,{key:0,label:"步长报警",prop:"stepAlarm"},{default:z((()=>[R(ae,{modelValue:T(Y).propertyForm.stepAlarm,"onUpdate:modelValue":h[17]||(h[17]=e=>T(Y).propertyForm.stepAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):K("",!0)]),3!==T(Y).propertyForm.type&&T(Y).propertyForm.stepAlarm?(B(),G(w,{key:1,label:"步长",prop:"step"},{default:z((()=>[R(_,{type:"text",modelValue:T(Y).propertyForm.step,"onUpdate:modelValue":h[18]||(h[18]=e=>T(Y).propertyForm.step=e),autocomplete:"off",placeholder:"请输入步长"},null,8,["modelValue"])])),_:1})):K("",!0),P("div",null,[3===T(Y).propertyForm.type?(B(),G(w,{key:0,label:"字符串长度报警",prop:"dataLengthAlarm"},{default:z((()=>[R(ae,{modelValue:T(Y).propertyForm.dataLengthAlarm,"onUpdate:modelValue":h[19]||(h[19]=e=>T(Y).propertyForm.dataLengthAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):K("",!0)]),3===T(Y).propertyForm.type&&T(Y).propertyForm.dataLengthAlarm?(B(),G(w,{key:2,label:"字符串长度",prop:"dataLength"},{default:z((()=>[R(_,{type:"text",modelValue:T(Y).propertyForm.dataLength,"onUpdate:modelValue":h[20]||(h[20]=e=>T(Y).propertyForm.dataLength=e),autocomplete:"off",placeholder:"请输入字符串长度"},null,8,["modelValue"])])),_:1})):K("",!0),Ve,R(w,{label:"寄存器地址",prop:"regAddr"},{default:z((()=>[R(_,{type:"text",style:{width:"220px"},modelValue:T(Y).propertyForm.regAddr,"onUpdate:modelValue":h[21]||(h[21]=e=>T(Y).propertyForm.regAddr=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器地址"},null,8,["modelValue"])])),_:1}),1!=v.curModelBlock.funCode?(B(),G(w,{key:3,label:"",prop:"",style:{width:"220px"}})):K("",!0),R(w,{label:"寄存器数量",prop:"regCnt"},{default:z((()=>[1==v.curModelBlock.funCode?(B(),G(_,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:T(Y).propertyForm.regCnt,"onUpdate:modelValue":h[22]||(h[22]=e=>T(Y).propertyForm.regCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器数量"},null,8,["modelValue"])):(B(),G(Q,{key:1,modelValue:T(Y).propertyForm.regCnt,"onUpdate:modelValue":h[23]||(h[23]=e=>T(Y).propertyForm.regCnt=e),modelModifiers:{number:!0},style:{width:"220px"},onChange:h[24]||(h[24]=e=>(()=>{const e=Y.propertyForm.regCnt;1===e&&(Y.propertyForm.ruleType="Int_AB"),2===e&&(Y.propertyForm.ruleType="Long_ABCD"),4===e&&(Y.propertyForm.ruleType="Double_ABCDEFGH")})()),placeholder:"请选择寄存器数量"},{default:z((()=>[(B(!0),S(E,null,H(T(Y).regCntOptions,(e=>(B(),G(I,{key:"regCount_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),1!=v.curModelBlock.funCode?(B(),G(w,{key:4,label:"解析规则",prop:"ruleType"},{default:z((()=>[R(Q,{modelValue:T(Y).propertyForm.ruleType,"onUpdate:modelValue":h[25]||(h[25]=e=>T(Y).propertyForm.ruleType=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择解析规则"},{default:z((()=>[(B(!0),S(E,null,H(T(Y).ruleTypeOptions["rt"+T(Y).propertyForm.regCnt],(e=>(B(),G(I,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):K("",!0),R(Ue,null,{default:z((()=>[3==v.curModelBlock.funCode||4==v.curModelBlock.funCode?(B(),G(w,{key:0,label:"按位解析"},{default:z((()=>[R(ne,{class:"item",effect:"dark",content:"开启后按字节位解析数据,位偏移从0开始",placement:"top"},{default:z((()=>[R(ae,{style:{width:"220px"},modelValue:T(Y).propertyForm.bitSwitch,"onUpdate:modelValue":h[26]||(h[26]=e=>T(Y).propertyForm.bitSwitch=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})])),_:1})):K("",!0),T(Y).propertyForm.bitSwitch?(B(),G(w,{key:1,label:"位偏移",prop:"bitOffset"},{default:z((()=>[R(_,{type:"text",style:{width:"220px"},modelValue:T(Y).propertyForm.bitOffset,"onUpdate:modelValue":h[27]||(h[27]=e=>T(Y).propertyForm.bitOffset=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入位偏移"},null,8,["modelValue"])])),_:1})):K("",!0)])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),R(Ie,{modelValue:T(Y).fFlag,"onUpdate:modelValue":h[36]||(h[36]=e=>T(Y).fFlag=e),title:"编辑计算公式",width:"600px"},{footer:z((()=>[P("span",Se,[R(V,{onClick:h[34]||(h[34]=e=>(Y.fFlag=!1,void(Y.curFormula="")))},{default:z((()=>[U("取消")])),_:1}),R(V,{type:"primary",onClick:h[35]||(h[35]=e=>(Y.fFlag=!1,void(Y.propertyForm.formula=Y.curFormula)))},{default:z((()=>[U("保存")])),_:1})])])),default:z((()=>[P("div",De,[R(D,{model:T(Y).formulaForm,"label-position":"right","label-width":"120px"},{default:z((()=>[R(w,{label:"运算符号"},{default:z((()=>[P("div",Le,[(B(!0),S(E,null,H(T(Y).operationList,((e,l)=>(B(),S("div",{key:l,class:"operation"},[P("div",Be,[R(V,{style:{width:"100%"},onClick:l=>(e=>{let l=Y.curFormula.length;if(l!==Y.selectionStart){let t=Y.curFormula.substr(0,Y.selectionStart),a=Y.curFormula.substr(Y.selectionStart,l-Y.selectionStart);Y.curFormula=t+e.name+a,Y.selectionStart+=e.name.length}else Y.curFormula+=e.name,Y.selectionStart+=e.name.length})(e)},{default:z((()=>[U(N(e.label),1)])),_:2},1032,["onClick"])])])))),128))])])),_:1}),R(w,{label:"设备属性"},{default:z((()=>[R(Q,{modelValue:T(Y).pItem,"onUpdate:modelValue":h[31]||(h[31]=e=>T(Y).pItem=e),filterable:"",placeholder:"请选择设备属性",onChange:h[32]||(h[32]=e=>(e=>{let l=Y.curFormula.length;if(l!==Y.selectionStart){let t=Y.curFormula.substr(0,Y.selectionStart),a=Y.curFormula.substr(Y.selectionStart,l-Y.selectionStart);Y.curFormula=t+"("+e+")"+a,Y.selectionStart+=e.length+2}else Y.curFormula+="("+e+")",Y.selectionStart+=e.length+2})(T(Y).pItem)),style:{width:"100%"}},{default:z((()=>[(B(!0),S(E,null,H(T(Y).propertyInfo,(e=>(B(),G(I,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),R(w,{label:"当前公式"},{default:z((()=>[R(_,{type:"text",clearable:"",modelValue:T(Y).curFormula,"onUpdate:modelValue":h[33]||(h[33]=e=>T(Y).curFormula=e),autocomplete:"off",placeholder:"请编辑计算公式",onBlur:je},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),R(Ie,{modelValue:T(Y).psFlag,"onUpdate:modelValue":h[37]||(h[37]=e=>T(Y).psFlag=e),title:"导入命令参数",width:"600px","before-close":ge,"close-on-click-modal":!1},{footer:z((()=>[P("span",Re,[R(V,{onClick:fe},{default:z((()=>[U("取消")])),_:1}),R(V,{type:"primary",onClick:se},{default:z((()=>[U("上传")])),_:1})])])),default:z((()=>[R(Ee,{ref_key:"uploadDPSRef",ref:ce,action:"","auto-upload":!1,"http-request":pe,limit:1,"on-exceed":ue,"before-upload":me},{tip:z((()=>[Pe])),default:z((()=>[R(V,{type:"primary"},{default:z((()=>[U("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-2e656c60"]]);const Te=e=>(O("data-v-207f4c91"),e=e(),q(),e),Ue={class:"main-container"},Ne={class:"main"},je={class:"mc-left"},Oe={class:"title"},qe={class:"mcl-content"},Ie={class:"mclc-content"},Ee={class:"mc-right"},He={class:"mcr-top"},Ge={style:{display:"flex","justify-content":"space-between"}},We={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},$e={class:"tName"},Ke={class:"search-bar",style:{"text-align":"right"}},Qe=Te((()=>P("div",null,"无数据",-1))),Xe={class:"pagination"},Ye={key:0,class:"mcr-bottom"},Je={class:"dialog-content"},Ze={class:"dialog-footer"},el=Te((()=>P("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),ll={class:"dialog-footer"};var tl=v({__name:"ModelBlockRtu",props:{curDeviceModel:{type:Object,default:{}},deviceModelList:{type:Array,default:[]}},emits:["changeShowFlag"],setup(u,{emit:m}){const f=u,h=F();console.log("id -> props",f);const v=/^[0-9]*[1-9][0-9]*$/,w=V(null),O=A({curDeviceModel:f.curDeviceModel,headerCellStyle:{background:_.primaryColor,color:_.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelBlock:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],funCodeOptions:[{label:"01(读线圈状态)",value:1},{label:"02(读离散输入状态)",value:2},{label:"03(读保持寄存器)",value:3},{label:"04(读输入寄存器)",value:4},{label:"05(写单个线圈)",value:5},{label:"06(写单个保持寄存器)",value:6},{label:"15(写多个线圈)",value:15},{label:"16(写多个保持寄存器)",value:16}],funCodeNames:{f1:"01(读线圈状态)",f2:"02(读离散输入状态)",f3:"03(读保持寄存器)",f4:"04(读输入寄存器)",f5:"05(写单个线圈)",f6:"06(写单个保持寄存器)",f15:"15(写多个线圈)",f16:"16(写多个保持寄存器)"},dataTypeOptions:[{label:"uint8",value:0},{label:"int8",value:1},{label:"uint16",value:2},{label:"int16",value:3},{label:"uint32",value:4},{label:"int32",value:5},{label:"float",value:6},{label:"double",value:7}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},dataTypeNames:{dt0:"uint8",dt1:"int8",dt2:"uint16",dt3:"int16",dt4:"uint32",dt5:"int32",dt6:"float",dt7:"double"},pFlag:!1,pTitle:"添加属性",blockForm:{name:"",label:"",funCode:null,startRegAddr:0,regCnt:0},paramName:{name:"块名称",label:"块标签",funCode:"功能码",type:"属性类型",startRegAddr:"寄存器地址",regCnt:"寄存器数量"},propertyRules:{name:[{required:!0,message:"块名称不能为空",trigger:"blur"}],label:[{required:!0,message:"块标签不能为空",trigger:"blur"}],funCode:[{required:!0,message:"功能码不能为空",trigger:"blur"}],startRegAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{0===l||v.test(l)?t():t(new Error("只能输入自然数！"))}}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{v.test(l)?t():t(new Error("只能输入正整数数字！"))}}]},psFlag:!1,selectedProperties:[],curModelBlock:{},porpFlag:!1}),q=l=>{const t={token:h.token,data:{tslName:O.curDeviceModel.name}};Y(t).then((async t=>{t&&("0"===t.code?(O.propertyList=t.data,O.propertyList.length>0?(O.curModelBlock=O.propertyList[0],O.curModelBlock.tslName=O.curDeviceModel.name,console.log("getDeviceModelBlock -> ctxData.curModelBlock",O.curModelBlock),O.porpFlag=!0):O.porpFlag=!1,1===l&&e({type:"success",message:"刷新成功！"})):ye(t),await j((()=>{O.tableMaxHeight=w.value.clientHeight-34-22-82,2===l&&be(O.curModelBlock)})))}))};q(2);const I=D((()=>(console.log("ctxData.propertyList ->",O.propertyList),O.propertyList.filter((e=>{var l=!O.deviceModelBlock,t=e.name.toLowerCase().includes(O.deviceModelBlock.toLowerCase());return l||t})).slice((O.currentPage-1)*O.pagesize,O.currentPage*O.pagesize)))),W=D((()=>O.propertyList.filter((e=>{var l=!O.deviceModelBlock,t=e.name.toLowerCase().includes(O.deviceModelBlock.toLowerCase());return l||t})))),$=e=>{O.currentPage=e},X=e=>{O.pagesize=e},ae=()=>{re.value&&re.value.submit()},oe=e=>{},re=V(null),de=e=>{re.value.clearFiles();const l=e[0];re.value.handleStart(l)},ne=l=>{console.log("beforeUpload -> file",l);let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("name",O.curDeviceModel.name),t.append("fileName",l);const a={token:h.token,contentType:"multipart/form-data",data:t};le(a).then((l=>{"0"===l.code?(e.success(l.message),O.psFlag=!1,q()):ye(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ie=()=>{O.psFlag=!1,uploadRef.value.clearFiles()},se=()=>{ie()},pe=e=>{O.pFlag=!0,O.pTitle="编辑属性",O.blockForm.name=e.name,O.blockForm.label=e.label,O.blockForm.funCode=e.funCode,O.blockForm.startRegAddr=e.startRegAddr,O.blockForm.regCnt=e.regCnt},ce=V(null),ue=()=>{O.pFlag=!1,ce.value.resetFields(),ge()},me=e=>{ue()},fe=e=>{O.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},ge=()=>{O.blockForm={name:"",label:"",funCode:null,startRegAddr:0,regCnt:0}},be=e=>{O.curModelBlock=e,O.curModelBlock.tslName=O.curDeviceModel.name},ye=l=>{e({type:"error",message:l.message})},he=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(u,v)=>{const F=l,_=t,V=y,A=r,D=a,j=L("Icon"),Y=o,le=d,ge=n,ve=i,Fe=p,_e=c,we=g,ke=b;return B(),S("div",Ue,[P("div",Ne,[P("div",je,[P("div",Oe,[R(_,{type:"primary",style:{width:"100%"},plain:"",onClick:v[0]||(v[0]=e=>{m("changeShowFlag","goBack")})},{default:z((()=>[R(F,{class:"el-input__icon"},{default:z((()=>[R(T(k))])),_:1}),U(" 返回设备模型 ")])),_:1})]),P("div",qe,[(B(!0),S(E,null,H(f.deviceModelList,((e,l)=>(B(),G(V,{key:"i"+l,shadow:"hover",class:Q({"mclc-card":!0,activeModel:e.name==T(O).curDeviceModel.name}),onClick:l=>(e=>{O.curDeviceModel.name!=e.name&&(O.curDeviceModel=e,q())})(e)},{default:z((()=>[P("div",Ie,[P("span",null,N(e.name),1)])])),_:2},1032,["class","onClick"])))),128))])]),P("div",Ee,[P("div",He,[P("div",Ge,[P("div",We,[P("div",$e,N(T(O).curDeviceModel.label)+"：命令列表",1)]),P("div",Ke,[R(Y,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:z((()=>[R(D,{style:{"margin-left":"20px"}},{default:z((()=>[R(A,{style:{width:"200px"},placeholder:"请输入命令名称",modelValue:T(O).deviceModelBlock,"onUpdate:modelValue":v[1]||(v[1]=e=>T(O).deviceModelBlock=e)},{prefix:z((()=>[R(F,{class:"el-input__icon"},{default:z((()=>[R(T(C))])),_:1})])),_:1},8,["modelValue"])])),_:1}),R(D,null,{default:z((()=>[R(_,{type:"primary",plain:"",class:"right-btn",onClick:v[2]||(v[2]=e=>(console.log("importDPS"),void(O.psFlag=!0)))},{default:z((()=>[R(F,{class:"el-input__icon"},{default:z((()=>[R(T(M))])),_:1}),U(" 导入命令 ")])),_:1})])),_:1}),R(D,null,{default:z((()=>[R(_,{type:"primary",plain:"",class:"right-btn",onClick:v[3]||(v[3]=e=>(()=>{console.log("exportDPS");const e={token:h.token,responseType:"blob",data:{name:O.curDeviceModel.name}};te(e).then((e=>{if(e&&"1"===e.code)return void ye(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:z((()=>[R(F,{class:"el-input__icon"},{default:z((()=>[R(T(x))])),_:1}),U(" 导出命令 ")])),_:1})])),_:1}),R(D,null,{default:z((()=>[R(_,{type:"primary",bg:"",class:"right-btn",onClick:v[4]||(v[4]=e=>(console.log("addDeviceModelBlock"),O.pFlag=!0,void(O.pTitle="添加属性")))},{default:z((()=>[R(F,{class:"btn-icon"},{default:z((()=>[R(j,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),U(" 添加 ")])),_:1})])),_:1}),R(D,null,{default:z((()=>[R(_,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:v[5]||(v[5]=e=>{q(1)})},{default:z((()=>[R(F,{class:"btn-icon"},{default:z((()=>[R(j,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),U(" 刷新 ")])),_:1})])),_:1}),R(D,null,{default:z((()=>[R(_,{type:"danger",bg:"",class:"right-btn",onClick:v[6]||(v[6]=l=>(l=>{let t=[];0!==O.selectedProperties.length?(O.selectedProperties.forEach((e=>{t.push(e.name)})),console.log("pList",t),s.confirm("确认要删除这些命令吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:h.token,data:{tslName:O.curDeviceModel.name,names:t}};ee(e).then((e=>{he(e,q)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个命令！")})())},{default:z((()=>[R(F,{class:"btn-icon"},{default:z((()=>[R(j,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),U(" 删除 ")])),_:1})])),_:1})])),_:1},512)])]),P("div",{class:"content",ref_key:"contentRef",ref:w},[R(ge,{data:T(I),"cell-style":T(O).cellStyle,"header-cell-style":T(O).headerCellStyle,"max-height":T(O).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:fe,onRowDblclick:pe},{empty:z((()=>[Qe])),default:z((()=>[R(le,{type:"selection",width:"55"}),R(le,{sortable:"",prop:"name",label:"命令名称",width:"auto","min-width":"150",align:"center"}),R(le,{sortable:"",prop:"label",label:"命令标签",width:"auto","min-width":"150",align:"center"}),R(le,{sortable:"",label:"功能码",width:"auto","min-width":"150",align:"center"},{default:z((e=>[U(N(T(O).funCodeNames["f"+e.row.funCode]),1)])),_:1}),R(le,{sortable:"",prop:"startRegAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),R(le,{sortable:"",prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"100",align:"center"}),R(le,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:z((e=>[R(_,{onClick:l=>pe(e.row),text:"",type:"primary"},{default:z((()=>[U("编辑")])),_:2},1032,["onClick"]),R(_,{onClick:l=>be(e.row,2),text:"",type:"success"},{default:z((()=>[U("命令参数详情")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),P("div",Xe,[R(ve,{"current-page":T(O).currentPage,"page-size":T(O).pagesize,"page-sizes":[20,50,200,500],total:T(W).length,onCurrentChange:$,onSizeChange:X,background:"",layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])],512)]),T(O).porpFlag?(B(),S("div",Ye,[R(ze,{curModelBlock:T(O).curModelBlock},null,8,["curModelBlock"])])):K("",!0)]),R(we,{modelValue:T(O).pFlag,"onUpdate:modelValue":v[14]||(v[14]=e=>T(O).pFlag=e),title:T(O).pTitle,width:"600px","before-close":me,"close-on-click-modal":!1},{footer:z((()=>[P("span",Ze,[R(_,{onClick:v[12]||(v[12]=e=>ue())},{default:z((()=>[U("取消")])),_:1}),R(_,{type:"primary",onClick:v[13]||(v[13]=e=>{ce.value.validate((e=>{if(!e)return!1;{const e={token:h.token,data:{tslName:O.curDeviceModel.name,name:O.blockForm.name,label:O.blockForm.label,funCode:O.blockForm.funCode,startRegAddr:O.blockForm.startRegAddr,regCnt:O.blockForm.regCnt}};O.pTitle.includes("添加")?J(e).then((e=>{he(e,q),ue()})):Z(e).then((e=>{he(e,q),ue()}))}}))})},{default:z((()=>[U("保存")])),_:1})])])),default:z((()=>[P("div",Je,[R(Y,{model:T(O).blockForm,rules:T(O).propertyRules,ref_key:"blockFormRef",ref:ce,"status-icon":"","label-position":"right","label-width":"120px"},{default:z((()=>[R(D,{label:"块名称",prop:"name"},{default:z((()=>[R(A,{disabled:T(O).pTitle.includes("编辑"),type:"text",modelValue:T(O).blockForm.name,"onUpdate:modelValue":v[7]||(v[7]=e=>T(O).blockForm.name=e),autocomplete:"off",placeholder:"请输入块名称"},null,8,["disabled","modelValue"])])),_:1}),R(D,{label:"块标签",prop:"label"},{default:z((()=>[R(A,{type:"text",modelValue:T(O).blockForm.label,"onUpdate:modelValue":v[8]||(v[8]=e=>T(O).blockForm.label=e),autocomplete:"off",placeholder:"请输入块标签"},null,8,["modelValue"])])),_:1}),R(D,{label:"功能码",prop:"funCode"},{default:z((()=>[R(_e,{modelValue:T(O).blockForm.funCode,"onUpdate:modelValue":v[9]||(v[9]=e=>T(O).blockForm.funCode=e),style:{width:"100%"},placeholder:"请选择功能码"},{default:z((()=>[(B(!0),S(E,null,H(T(O).funCodeOptions,(e=>(B(),G(Fe,{key:"funCode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),R(D,{label:"寄存器地址",prop:"startRegAddr"},{default:z((()=>[R(A,{type:"text",modelValue:T(O).blockForm.startRegAddr,"onUpdate:modelValue":v[10]||(v[10]=e=>T(O).blockForm.startRegAddr=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器地址"},null,8,["modelValue"])])),_:1}),R(D,{label:"寄存器数量",prop:"regCnt"},{default:z((()=>[R(A,{type:"text",modelValue:T(O).blockForm.regCnt,"onUpdate:modelValue":v[11]||(v[11]=e=>T(O).blockForm.regCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器数量"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),R(we,{modelValue:T(O).psFlag,"onUpdate:modelValue":v[15]||(v[15]=e=>T(O).psFlag=e),title:"导入命令",width:"600px","before-close":se,"close-on-click-modal":!1},{footer:z((()=>[P("span",ll,[R(_,{onClick:ie},{default:z((()=>[U("取消")])),_:1}),R(_,{type:"primary",onClick:ae},{default:z((()=>[U("上传")])),_:1})])])),default:z((()=>[R(ke,{ref_key:"uploadDPSRef",ref:re,action:"","auto-upload":!1,"http-request":oe,limit:1,"on-exceed":de,"before-upload":ne},{tip:z((()=>[el])),default:z((()=>[R(_,{type:"primary"},{default:z((()=>[U("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-207f4c91"]]);const al={class:"main-container"},ol={key:0,class:"main"},rl={class:"search-bar"},dl={class:"tool-bar"},nl=(e=>(O("data-v-911fca10"),e=e(),q(),e))((()=>P("div",null,"无数据",-1))),il={class:"pagination"},sl={class:"dialog-content"},pl={class:"dialog-footer"};var cl=v({__name:"DeviceModelRtu",setup(p){const c=F(),u=V(null),m=A({typeModel:2,showFlag:0,headerCellStyle:{background:_.primaryColor,color:_.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceModelInfo:"",tableData:[],modelForm:{name:"",label:"",type:0,param:""},modelRules:{name:[{required:!0,message:"采集模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"采集模型标识不能为空",trigger:"blur"}],param:[{required:!0,message:"采集模型插件不能为空",trigger:"blur"}]},udFlag:!1,dmFlag:!1,dmTitle:"添加采集模型",pluginList:[],curDeviceModel:"",tsl:"",handleFlag:""}),f=X();m.tsl=f.query.tsl;const b=l=>{const t={token:c.token,data:{type:m.typeModel}};w.getDeviceModelList(t).then((async t=>{if(t){if("0"===t.code){if(m.tableData=t.data,m.tsl&&!m.handleFlag){const e=m.tableData.find((e=>e.name===m.tsl));I(e)}1===l&&e({type:"success",message:"刷新成功！"})}else H(t);await j((()=>{m.tableMaxHeight=u.value.clientHeight-34-36-22}))}}))};b();const y=D((()=>m.tableData.filter((e=>{var l=!m.deviceModelInfo,t=e.name.toLowerCase().includes(m.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(m.deviceModelInfo.toLowerCase());return l||t})).slice((m.currentPage-1)*m.pagesize,m.currentPage*m.pagesize))),h=D((()=>m.tableData.filter((e=>{var l=!m.deviceModelInfo,t=e.name.toLowerCase().includes(m.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(m.deviceModelInfo.toLowerCase());return l||t})))),v=e=>{m.currentPage=e},k=e=>{m.pagesize=e},x=e=>{m.dmFlag=!0,m.dmTitle="编辑采集模型",m.modelForm={name:e.name,label:e.label,type:void 0===e.type?0:e.type,param:e.param}},M=V(null),N=()=>{m.dmFlag=!1,M.value.resetFields(),q()},O=()=>{N()},q=()=>{m.modelForm={name:"",label:"",type:0}},I=e=>{m.curDeviceModel=e,m.showFlag=2},E=e=>{m.handleFlag=e,m.showFlag=0,b()},H=l=>{e({type:"error",message:l.message})},W=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(p,f)=>{const F=l,_=r,V=a,A=L("Icon"),D=t,j=o,q=d,H=n,$=i,Q=g;return B(),S("div",al,[0===T(m).showFlag?(B(),S("div",ol,[P("div",rl,[R(j,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:z((()=>[R(V,{label:"采集模型名称"},{default:z((()=>[R(_,{style:{width:"200px"},placeholder:"请输入采集模型名称",modelValue:T(m).deviceModelInfo,"onUpdate:modelValue":f[0]||(f[0]=e=>T(m).deviceModelInfo=e)},{prefix:z((()=>[R(F,{class:"el-input__icon"},{default:z((()=>[R(T(C))])),_:1})])),_:1},8,["modelValue"])])),_:1}),R(V,null,{default:z((()=>[R(D,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:f[1]||(f[1]=e=>{b(1)})},{default:z((()=>[R(F,{class:"btn-icon"},{default:z((()=>[R(A,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),U(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),P("div",dl,[R(D,{type:"primary",bg:"",class:"right-btn",onClick:f[2]||(f[2]=e=>(m.dmFlag=!0,void(m.dmTitle="添加采集模型")))},{default:z((()=>[R(F,{class:"btn-icon"},{default:z((()=>[R(A,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),U(" 添加 ")])),_:1})]),P("div",{class:"content",ref_key:"contentRef",ref:u},[R(H,{data:T(y),"cell-style":T(m).cellStyle,"header-cell-style":T(m).headerCellStyle,"max-height":T(m).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:x},{empty:z((()=>[nl])),default:z((()=>[R(q,{sortable:"",prop:"name",label:"采集模型名称",width:"auto","min-width":"200",align:"center"}),R(q,{sortable:"",prop:"label",label:"采集模型标签",width:"auto","min-width":"200",align:"center"}),R(q,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:z((l=>[R(D,{onClick:e=>{return t=l.row,m.curDeviceModel=t,void(m.showFlag=1);var t},text:"",type:"success"},{default:z((()=>[U("变量详情")])),_:2},1032,["onClick"]),R(D,{onClick:e=>I(l.row),text:"",type:"success"},{default:z((()=>[U("命令详情")])),_:2},1032,["onClick"]),R(D,{onClick:e=>x(l.row),text:"",type:"primary"},{default:z((()=>[U("编辑")])),_:2},1032,["onClick"]),R(D,{onClick:t=>{return a=l.row,void s.confirm("确定要删除这个采集模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:c.token,data:{name:a.name,type:2}};w.deleteDeviceModel(e).then((e=>{W(e,b)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var a},text:"",type:"danger"},{default:z((()=>[U("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),P("div",il,[R($,{"current-page":T(m).currentPage,"page-size":T(m).pagesize,"page-sizes":[20,50,200,500],total:T(h).length,onCurrentChange:v,onSizeChange:k,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):K("",!0),1===T(m).showFlag?(B(),G(ye,{key:1,curDeviceModel:T(m).curDeviceModel,onChangeShowFlag:E,style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel"])):K("",!0),2===T(m).showFlag?(B(),G(tl,{key:2,curDeviceModel:T(m).curDeviceModel,deviceModelList:T(m).tableData,onChangeShowFlag:E,style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel","deviceModelList"])):K("",!0),R(Q,{modelValue:T(m).dmFlag,"onUpdate:modelValue":f[7]||(f[7]=e=>T(m).dmFlag=e),title:T(m).dmTitle,width:"600px","before-close":O,"close-on-click-modal":!1},{footer:z((()=>[P("span",pl,[R(D,{onClick:f[5]||(f[5]=e=>N())},{default:z((()=>[U("取消")])),_:1}),R(D,{type:"primary",onClick:f[6]||(f[6]=e=>{M.value.validate((e=>{if(!e)return!1;{m.modelForm.type=m.typeModel;const e={token:c.token,data:m.modelForm};m.dmTitle.includes("添加")?w.addDeviceModel(e).then((e=>{W(e,b),N()})):w.editDeviceModel(e).then((e=>{W(e,b),N()}))}}))})},{default:z((()=>[U("保存")])),_:1})])])),default:z((()=>[P("div",sl,[R(j,{model:T(m).modelForm,rules:T(m).modelRules,ref_key:"modelFormRef",ref:M,"status-icon":"","label-position":"right","label-width":"120px"},{default:z((()=>[R(V,{label:"采集模型名称",prop:"name"},{default:z((()=>[R(_,{type:"text",disabled:T(m).dmTitle.includes("编辑"),modelValue:T(m).modelForm.name,"onUpdate:modelValue":f[3]||(f[3]=e=>T(m).modelForm.name=e),autocomplete:"off",placeholder:"请输入采集模型名称"},null,8,["disabled","modelValue"])])),_:1}),R(V,{label:"采集模型标签",prop:"label"},{default:z((()=>[R(_,{type:"text",modelValue:T(m).modelForm.label,"onUpdate:modelValue":f[4]||(f[4]=e=>T(m).modelForm.label=e),autocomplete:"off",placeholder:"请输入采集模型标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-911fca10"]]);export{cl as default};
