import{U as e,v as a,w as t,e as l,p as o,A as s,B as c,C as n,D as r,g as i}from"./element-plus.64650d13.js";import{_ as p,u as d,v as g}from"./index.98f42e56.js";import{I as m}from"./interface.c4e57716.js";import{S as u}from"./service.19c72ecc.js";import{P as h}from"./papaparse.57cb6e0b.js";import{d as f}from"./dayjs.b9b14681.js";import{O as b,P as y,_ as w,L as k}from"./@element-plus.aa3ef65f.js";import{f as v,Y as _,H as j,p as N,h as S,A as T,o as C,c as z,a as L,S as x,Q as F,u as P,U,P as H,M as I,af as M,L as V,a0 as D,at as R,au as Y}from"./@vue.5db09832.js";import"./@vueuse.af8df401.js";import"./lodash-es.8ca9079f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./axios.765908e4.js";import"./vue-router.d969f71f.js";import"./pinia.69c74452.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./vue-echarts.8f00425b.js";import"./resize-detector.4e96b72b.js";import"./echarts.62a08783.js";import"./zrender.56caf4f2.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const O=e=>(R("data-v-491377ce"),e=e(),Y(),e),E={class:"SysLog"},W={class:"title"},A=D("采集日志"),B=D("上报日志"),G=D("系统日志"),J={class:"content"},Q={class:"cTitle"},q={class:"tName"},K={class:"option"},X=D(" 开始 "),Z=D(" 停止 "),$=D(" 清空 "),ee=D(" 导出 "),ae=O((()=>L("div",null,"无数据",-1))),te={class:"pagination"};var le=p({setup(p){const R=d();console.log("location -> ",location);const Y=v(null),O=_({websocket:null,headerCellStyle:{background:g.primaryColor,color:g.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,logType:0,logName:["采集日志","上报日志","系统日志"],collectName:"",collectList:[],uploadName:"",uploadList:[],startStopFlag:!0,dataTable:[],dataType:["接收方","发送方"]}),le=e=>{console.log("onChange -> val",e),O.logType=e,console.log("ctxData.startStopFlag = ",O.startStopFlag),O.startStopFlag||(O.startStopFlag=!0,ne())},oe=e=>{O.startStopFlag=e,!1===e?se():ne()},se=()=>{let e="";e=location.origin.replace("https://","").replace("http://","");let a="ws://"+e+"/api/ws"+("?type="+O.logType+"&name="+(0===O.logType?O.collectName:1===O.logType?O.uploadName:"systemLog"));console.log("url = "+a),O.websocket=new WebSocket(a),ce(),re(),ie()},ce=()=>{O.websocket.onmessage=function(e){console.log("event.data",e.data),e.data&&""!=e.data&&O.dataTable.push(JSON.parse(e.data))}},ne=()=>{O.websocket&&(console.log("关闭ws命令"),O.websocket.close(),console.log("closeWs",O.websocket))},re=()=>{O.websocket.onclose=e=>{console.log("onClose - > e",e),O.startStopFlag=!0,O.websocket=null}},ie=()=>{O.websocket.onerror=e=>{console.log("onError - > e",e),O.startStopFlag=!0,O.websocket=null}};(()=>{const e={token:R.token,data:{}};m.getInterfaceList(e).then((e=>{e&&("0"===e.code?(O.collectList=e.data,e.data.length>0&&(O.collectName=e.data[0].collInterfaceName)):me(e))}))})();(()=>{const e={token:R.token,data:{}};u.getGatewayList(e).then((e=>{e&&("0"===e.code?(O.uploadList=e.data,e.data.length>0&&(O.uploadName=e.data[0].serviceName)):me(e))}))})(),j((()=>{O.tableMaxHeight=Y.value.clientHeight-34-36-22}));const pe=e=>{O.currentPage=e},de=e=>{O.pagesize=e},ge=N((()=>O.dataTable.slice((O.currentPage-1)*O.pagesize,O.currentPage*O.pagesize)));S((()=>O.collectName),((e,a)=>{O.startStopFlag=!0,ne()})),S((()=>O.uploadName),((e,a)=>{O.startStopFlag=!0,ne()}));const me=e=>{i({type:"error",message:e.message})};return T((()=>{console.log("页面关闭了"),ne()})),(i,p)=>{const d=e,g=a,m=t,u=l,v=o,_=s,j=c,N=n,S=r;return C(),z("div",E,[L("div",W,[x(d,{size:"large",checked:0===P(O).logType,onChange:p[0]||(p[0]=e=>le(0))},{default:F((()=>[A])),_:1},8,["checked"]),x(d,{size:"large",checked:1===P(O).logType,onChange:p[1]||(p[1]=e=>le(1))},{default:F((()=>[B])),_:1},8,["checked"]),x(d,{size:"large",checked:2===P(O).logType,onChange:p[2]||(p[2]=e=>le(2))},{default:F((()=>[G])),_:1},8,["checked"])]),L("div",J,[L("div",Q,[L("div",q,U(P(O).logName[P(O).logType]),1),L("div",K,[0===P(O).logType?(C(),H(m,{key:0,modelValue:P(O).collectName,"onUpdate:modelValue":p[3]||(p[3]=e=>P(O).collectName=e),style:{width:"100%"},placeholder:"请选择采集接口"},{default:F((()=>[(C(!0),z(I,null,M(P(O).collectList,(e=>(C(),H(g,{key:"collect_"+e.collInterfaceName,label:e.collInterfaceName,value:e.collInterfaceName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):V("",!0),1===P(O).logType?(C(),H(m,{key:1,modelValue:P(O).uploadName,"onUpdate:modelValue":p[4]||(p[4]=e=>P(O).uploadName=e),style:{width:"100%"},placeholder:"请选择上报接口"},{default:F((()=>[(C(!0),z(I,null,M(P(O).uploadList,(e=>(C(),H(g,{key:"upload_"+e.serviceName,label:e.serviceName,value:e.serviceName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):V("",!0),P(O).startStopFlag?(C(),H(v,{key:2,onClick:p[5]||(p[5]=e=>oe(!1)),class:"right-btn",type:"success",plain:""},{default:F((()=>[x(u,{class:"el-input__icon"},{default:F((()=>[x(P(b))])),_:1}),X])),_:1})):(C(),H(v,{key:3,class:"right-btn",onClick:p[6]||(p[6]=e=>oe(!0)),type:"danger",plain:""},{default:F((()=>[x(u,{class:"el-input__icon"},{default:F((()=>[x(P(y))])),_:1}),Z])),_:1})),x(v,{class:"right-btn",onClick:p[7]||(p[7]=e=>{O.dataTable=[]}),type:"warning",plain:""},{default:F((()=>[x(u,{class:"el-input__icon"},{default:F((()=>[x(P(w))])),_:1}),$])),_:1}),x(v,{class:"right-btn",onClick:p[8]||(p[8]=e=>(()=>{let e=[];O.dataTable.forEach((a=>{e.push({timeStamp:a.timeStamp+"\t",direction:O.dataType[a.direction],label:a.label,content:a.content})}));var a=h.unparse(e);let t=new Blob([a]),l=window.URL||window.webkitURL||window,o=l.createObjectURL(t),s=document.createElement("a");s.href=o;let c="";c=0===O.logType?"采集日志":1===O.logType?"上报日志":"系统日志",c+=f(new Date).format("YYYY-MM-DD HH-mm-ss"),s.download=c+".csv",s.click(),l.revokeObjectURL(o)})()),type:"primary",plain:""},{default:F((()=>[x(u,{class:"el-input__icon"},{default:F((()=>[x(P(k))])),_:1}),ee])),_:1})])]),L("div",{class:"cTable",ref_key:"contentRef",ref:Y},[x(N,{data:P(ge),"cell-style":P(O).cellStyle,"header-cell-style":P(O).headerCellStyle,"max-height":P(O).tableMaxHeight,style:{width:"100%"},stripe:""},{empty:F((()=>[ae])),default:F((()=>[x(_,{prop:"timeStamp",label:"时间戳",width:"auto","min-width":"220",align:"center"}),x(_,{label:"数据方向",width:"auto","min-width":"150",align:"center"},{default:F((e=>[x(j,{type:0===e.row.direction?"success":"warning"},{default:F((()=>[D(U(P(O).dataType[e.row.direction]),1)])),_:2},1032,["type"])])),_:1}),x(_,{prop:"label",label:"数据标识",width:"auto","min-width":"150",align:"center"}),x(_,{prop:"content",label:"数据内容",width:"auto","min-width":"1000",align:"left"})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",te,[x(S,{"current-page":P(O).currentPage,"page-size":P(O).pagesize,"page-sizes":[20,50,200,500],total:P(O).dataTable.length,onCurrentChange:pe,onSizeChange:de,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])])}}},[["__scopeId","data-v-491377ce"]]);export{le as default};
