import{m as e,n as l,v as a,w as t,x as o,y as c,p as n,e as s,o as r,A as i,B as d,C as m,D as u,q as f,M as p,g,L as v}from"./element-plus.64650d13.js";import{_ as b,u as h,v as y}from"./index.98f42e56.js";import{D as _}from"./deviceModel.a85a7758.js";import{I as F}from"./interface.c4e57716.js";import{D}from"./Device-property.0d5757d6.js";import{L as k,M as x}from"./@element-plus.aa3ef65f.js";import{Y as w,f as C,p as V,X as j,o as N,c as L,u as I,a as T,S,Q as O,M as U,af as z,U as M,P as R,a0 as q,at as P,au as E,H}from"./@vue.5db09832.js";import"./@vueuse.af8df401.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./vue-router.d969f71f.js";import"./pinia.69c74452.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./vue-echarts.8f00425b.js";import"./resize-detector.4e96b72b.js";import"./echarts.62a08783.js";import"./zrender.56caf4f2.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const B=e=>(P("data-v-5fea484b"),e=e(),E(),e),A={class:"main-container"},Q={key:0,class:"main"},W={class:"search-bar"},X=q("全部"),Y=q("在线"),G=q("离线"),J=q("搜索"),K=q("重置"),Z=q(" 刷新 "),$={class:"tool-bar"},ee={class:"title-left"},le=q(" 添加 "),ae=q(" 删除 "),te=q(" 批量采集 "),oe={class:"title-count"},ce={style:{"margin-right":"10px"}},ne={style:{"padding-right":"20px"}},se=q(" 导入设备 "),re=q(" 导出设备 "),ie=q("在线"),de=q("离线"),me=q("查看变量"),ue=q("编辑"),fe=B((()=>T("div",null,"无数据",-1))),pe={class:"pagination"},ge={class:"dialog-content"},ve={class:"dialog-footer"},be=q("取消"),he=q("保存"),ye=q("选择文件"),_e=B((()=>T("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),Fe={class:"dialog-footer"},De=q("取消"),ke=q("上传");var xe=b({setup(b){const q=h(),P=w({headerCellStyle:{background:y.primaryColor,color:y.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceTableData:[],screenData:[],deviceTotal:0,deviceOnline:0,dFlag:!1,dTitle:"添加设备",deviceInfo:"",deviceForm:{interfaceName:"",name:"",label:"",addr:"",tsl:""},deviceRules:{interfaceName:[{required:!0,validator:"采集接口不能为空",trigger:"blur"}],name:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],label:[{required:!0,message:"设备标签不能为空",trigger:"blur"}],addr:[{required:!0,message:"通信地址不能为空",trigger:"blur"}],tsl:[{required:!0,message:"物模型不能为空",trigger:"blur"}]},deviceModelList:[],selectedDevices:[],idFlag:!0,uFlag:!1,commStatusOptions:[{label:"全部",value:"Line"},{label:"在线",value:"onLine"},{label:"离线",value:"offLine"}],sFlag:!1,screenForm:{name:"",label:"",tsl:"",commStatus:"Line",collInterfaceName:[],addr:""},interfaceList:[],interfaces:[],checkedInterfaceList:[],collDeviceObj:{}}),E=()=>{P.idFlag=!0,xe()};(()=>{const e={token:q.token,data:{}};F.getInterfaceList(e).then((e=>{e&&("0"===e.code?(P.interfaceList=e.data,P.interfaces=[],P.interfaceList.forEach((e=>{P.interfaces.push(e.collInterfaceName),P.checkedInterfaceList.push(e.collInterfaceName)})),xe()):Ae(e))}))})();const B=C(null),xe=e=>{const l={token:q.token,data:{names:P.checkedInterfaceList}};F.getAllCollDevices(l).then((async l=>{console.log("getCollDevices -> res",l),l&&("0"===l.code?(P.deviceTableData=null==l.data.node?[]:l.data.node,P.screenData=P.deviceTableData,P.deviceTotal=l.data.commTotalCnt,P.deviceOnline=l.data.commSuccessCnt,1===e&&g({type:"success",message:"刷新成功！"})):Ae(l),await H((()=>{P.tableMaxHeight=B.value.clientHeight-34-36-22})))}))};(()=>{const e={token:q.token,data:{}};_.getDeviceModelList(e).then((e=>{console.log("getDeviceModelList -> res",e),"0"===e.code?P.deviceModelList=e.data:Ae(e)}))})();const we=e=>{P.selectedDevices=e},Ce=e=>{P.currentPage=e},Ve=V((()=>P.screenData.slice((P.currentPage-1)*P.pagesize,P.currentPage*P.pagesize))),je=V((()=>P.screenData)),Ne=e=>{P.pagesize=e},Le=e=>{P.dFlag=!0,P.dTitle="编辑设备",P.deviceForm={interfaceName:e.collInterfaceName,name:e.name,label:e.label,addr:e.addr,tsl:e.tsl}},Ie=C(null),Te=()=>{P.dFlag=!1,Ie.value.resetFields(),Oe()},Se=e=>{Te()},Oe=()=>{P.deviceForm={interfaceName:"",name:"",label:"",addr:"",tsl:""}},Ue=async e=>{const l={token:q.token,data:{interfaceName:e,deviceNames:P.collDeviceObj[e]}};await F.deleteCollDevices(l).then((l=>{"0"===l.code?(l.message=e+l.message,Qe(l,xe)):g({type:"error",message:l.message})}))},ze=()=>{Re.value&&Re.value.submit()},Me=e=>{},Re=C(null),qe=e=>{Re.value.clearFiles();const l=e[0];Re.value.handleStart(l)},Pe=e=>{console.log("beforeUpload -> file",e);let l=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.type)||""!=e.name&&e.name.indexOf("xlsx")>-1;if(l){if(l){let l=new FormData;l.append("name",""),l.append("fileName",e);const a={token:q.token,contentType:"multipart/form-data",data:l};F.addDeviceFromCSV(a).then((e=>{"0"===e.code?(g.success(e.message),P.uFlag=!1,xe()):Ae(e)}))}}else g({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},Ee=()=>{P.uFlag=!1,Re.value.clearFiles()},He=()=>{Ee()},Be=()=>{P.screenForm={name:"",tsl:"",label:"",commStatus:"Line",collInterfaceName:[],addr:""}},Ae=e=>{g({type:"error",message:e.message})},Qe=(e,l)=>{g({type:"0"===e.code?"success":"error",message:e.message}),"0"===e.code&&l&&l()};return(b,h)=>{const y=e,_=l,w=a,C=t,V=o,H=c,Oe=n,We=j("Icon"),Xe=s,Ye=r,Ge=i,Je=d,Ke=m,Ze=u,$e=f,el=p;return N(),L("div",A,[I(P).idFlag?(N(),L("div",Q,[T("div",W,[S(Ye,{model:I(P).screenForm,inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:O((()=>[S(_,{label:"设备名称",prop:"name"},{default:O((()=>[S(y,{type:"text",modelValue:I(P).screenForm.name,"onUpdate:modelValue":h[0]||(h[0]=e=>I(P).screenForm.name=e),autocomplete:"off",placeholder:"请输入设备名称"},null,8,["modelValue"])])),_:1}),S(_,{label:"设备标签",prop:"label"},{default:O((()=>[S(y,{type:"text",modelValue:I(P).screenForm.label,"onUpdate:modelValue":h[1]||(h[1]=e=>I(P).screenForm.label=e),autocomplete:"off",placeholder:"请输入设备标签"},null,8,["modelValue"])])),_:1}),S(_,{label:"设备地址",prop:"addr"},{default:O((()=>[S(y,{type:"text",modelValue:I(P).screenForm.addr,"onUpdate:modelValue":h[2]||(h[2]=e=>I(P).screenForm.addr=e),autocomplete:"off",placeholder:"请输入设备地址"},null,8,["modelValue"])])),_:1}),S(_,{label:"设备模型",prop:"tsl"},{default:O((()=>[S(C,{modelValue:I(P).screenForm.tsl,"onUpdate:modelValue":h[3]||(h[3]=e=>I(P).screenForm.tsl=e),clearable:"",style:{width:"100%"},placeholder:"请选择设备模型"},{default:O((()=>[(N(!0),L(U,null,z(I(P).deviceModelList,((e,l)=>(N(),R(w,{key:"dm_"+l,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(_,{label:"采集接口",prop:"collInterfaceName"},{default:O((()=>[S(C,{modelValue:I(P).screenForm.collInterfaceName,"onUpdate:modelValue":h[4]||(h[4]=e=>I(P).screenForm.collInterfaceName=e),clearable:"",style:{width:"100%"},placeholder:"请选择采集接口",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:O((()=>[(N(!0),L(U,null,z(I(P).interfaceList,((e,l)=>(N(),R(w,{key:"cin_"+l,label:e.collInterfaceName,value:e.collInterfaceName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(_,{label:"通信状态"},{default:O((()=>[S(H,{modelValue:I(P).screenForm.commStatus,"onUpdate:modelValue":h[5]||(h[5]=e=>I(P).screenForm.commStatus=e)},{default:O((()=>[S(V,{label:"Line"},{default:O((()=>[X])),_:1}),S(V,{label:"onLine"},{default:O((()=>[Y])),_:1}),S(V,{label:"offLine"},{default:O((()=>[G])),_:1})])),_:1},8,["modelValue"])])),_:1}),S(_,{style:{"margin-left":"20px"}},{default:O((()=>[S(Oe,{type:"primary",onClick:h[6]||(h[6]=e=>(console.log("doScreen ctxData.deviceTableData = ",P.deviceTableData),console.log("doScreen ctxData.screenForm = ",P.screenForm),P.screenData=[],P.deviceTotal=0,P.deviceOnline=0,void P.deviceTableData.forEach((e=>{var l=e.name.includes(P.screenForm.name),a=e.label.includes(P.screenForm.label),t=e.addr.includes(P.screenForm.addr),o=""===P.screenForm.tsl||e.tsl==P.screenForm.tsl,c=0===P.screenForm.collInterfaceName.length||P.screenForm.collInterfaceName.includes(e.collInterfaceName),n="Line"===P.screenForm.commStatus||e.commStatus.includes(P.screenForm.commStatus);l&&a&&t&&o&&c&&n&&(P.screenData.push(e),"onLine"==e.commStatus&&P.deviceOnline++,P.deviceTotal++)}))))},{default:O((()=>[J])),_:1})])),_:1}),S(_,null,{default:O((()=>[S(Oe,{onClick:h[7]||(h[7]=e=>{Be()})},{default:O((()=>[K])),_:1})])),_:1}),S(_,null,{default:O((()=>[S(Oe,{style:{color:"#fff"},color:"#2EA554",onClick:h[8]||(h[8]=e=>{xe(1)})},{default:O((()=>[S(Xe,{class:"btn-icon"},{default:O((()=>[S(We,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),Z])),_:1})])),_:1})])),_:1},8,["model"])]),T("div",$,[T("div",ee,[S(Oe,{type:"primary",bg:"",class:"right-btn",onClick:h[9]||(h[9]=e=>(P.dFlag=!0,void(P.dTitle="添加设备")))},{default:O((()=>[S(Xe,{class:"btn-icon"},{default:O((()=>[S(We,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),le])),_:1}),S(Oe,{type:"danger",bg:"",class:"right-btn",onClick:h[10]||(h[10]=e=>{0!==P.selectedDevices.length?(P.collDeviceObj={},console.log("ctxData.selectedDevices = ",P.selectedDevices),P.selectedDevices.forEach((e=>{null==P.collDeviceObj[e.collInterfaceName]?(P.collDeviceObj[e.collInterfaceName]=[],P.collDeviceObj[e.collInterfaceName].push(e.name)):P.collDeviceObj[e.collInterfaceName].push(e.name)})),v.confirm("确定要删除这些吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{let e=Object.getOwnPropertyNames(P.collDeviceObj).length;for(var l in console.log("cdList",e),P.collDeviceObj)Ue(l)})).catch((e=>{console.log(e),g({type:"info",message:"取消删除"})}))):g.info("请至少选择一个设备！")})},{default:O((()=>[S(Xe,{class:"btn-icon"},{default:O((()=>[S(We,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),ae])),_:1}),S(Oe,{type:"primary",bg:"",class:"right-btn",onClick:h[11]||(h[11]=e=>(()=>{if(0!==P.selectedDevices.length){let e=0;P.selectedDevices.forEach((l=>{console.log("allCollect -> item = ",l);const a={token:q.token,data:{collInterfaceName:l.collInterfaceName,deviceName:l.name}};F.getDeviceDataReal(a).then((a=>{e++,"0"===a.code?g.success(l.label+"：采集成功！"):Ae(a),e===P.selectedDevices.length&&xe(1)}))}))}else g.info("请至少选择一个设备！")})())},{default:O((()=>[S(Xe,{class:"btn-icon"},{default:O((()=>[S(We,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),te])),_:1})]),T("div",oe,[T("div",null,[T("span",ce,"设备总数："+M(I(P).deviceTotal),1),T("span",null,"在线："+M(I(P).deviceOnline),1)])]),T("div",ne,[S(Oe,{type:"primary",plain:"",class:"right-btn",onClick:h[12]||(h[12]=e=>{P.uFlag=!0})},{default:O((()=>[S(Xe,{class:"el-input__icon"},{default:O((()=>[S(I(k))])),_:1}),se])),_:1}),S(Oe,{type:"primary",plain:"",class:"right-btn",onClick:h[13]||(h[13]=e=>(()=>{console.log("exportDevice interfaces => ",P.interfaces);const e={token:q.token,responseType:"blob",data:{names:P.interfaces}};F.exportDevice(e).then((e=>{if(e&&"1"===e.code)return void Ae(e);const l=new Blob([e.blob]),a=e.fileName,t=document.createElement("a");t.download=a,t.style.display="none",t.href=URL.createObjectURL(l),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})())},{default:O((()=>[S(Xe,{class:"el-input__icon"},{default:O((()=>[S(I(x))])),_:1}),re])),_:1})])]),T("div",{class:"content",ref_key:"contentRef",ref:B},[S(Ke,{data:I(Ve),"cell-style":I(P).cellStyle,"header-cell-style":I(P).headerCellStyle,"max-height":I(P).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:we,onRowDblclick:Le},{empty:O((()=>[fe])),default:O((()=>[S(Ge,{type:"selection",width:"55",fixed:"left"}),S(Ge,{prop:"name",label:"设备名称",width:"auto","min-width":"160",align:"center",fixed:"left"}),S(Ge,{prop:"label",label:"设备标签",width:"auto","min-width":"160",align:"center"}),S(Ge,{prop:"tsl",label:"设备模型",width:"auto","min-width":"160",align:"center"}),S(Ge,{prop:"collInterfaceName",label:"采集接口",width:"auto","min-width":"160",align:"center"}),S(Ge,{prop:"addr",label:"通讯地址",width:"auto","min-width":"100",align:"center"}),S(Ge,{label:"当前通信状态",width:"auto","min-width":"150",align:"center"},{default:O((e=>["onLine"===e.row.commStatus?(N(),R(Je,{key:0,type:"success"},{default:O((()=>[ie])),_:1})):(N(),R(Je,{key:1,type:"danger"},{default:O((()=>[de])),_:1}))])),_:1}),S(Ge,{prop:"lastCommRTC",label:"最后通信时间",width:"auto","min-width":"200",align:"center"}),S(Ge,{prop:"commTotalCnt",label:"通信总次数",width:"auto","min-width":"150",align:"center"}),S(Ge,{prop:"commSuccessCnt",label:"通信成功次数",width:"auto","min-width":"150",align:"center"}),S(Ge,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:O((e=>[S(Oe,{onClick:l=>{return a=e.row,P.idFlag=!1,void(P.curDevice=a);var a},text:"",type:"success"},{default:O((()=>[me])),_:2},1032,["onClick"]),S(Oe,{onClick:l=>Le(e.row),text:"",type:"primary"},{default:O((()=>[ue])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),T("div",pe,[S(Ze,{"current-page":I(P).currentPage,"page-size":I(P).pagesize,"page-sizes":[20,50,200,500],total:I(je).length,onCurrentChange:Ce,onSizeChange:Ne,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):(N(),R(D,{key:1,curDevice:I(P).curDevice,onChangeIdFlag:E,style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDevice"])),S($e,{modelValue:I(P).dFlag,"onUpdate:modelValue":h[21]||(h[21]=e=>I(P).dFlag=e),title:I(P).dTitle,width:"600px","before-close":Se,"close-on-click-modal":!1},{footer:O((()=>[T("span",ve,[S(Oe,{onClick:h[19]||(h[19]=e=>Te())},{default:O((()=>[be])),_:1}),S(Oe,{type:"primary",onClick:h[20]||(h[20]=e=>{Ie.value.validate((e=>{if(!e)return!1;{const e={token:q.token,data:P.deviceForm};P.dTitle.includes("添加")?F.addCollDevice(e).then((e=>{Qe(e,xe),Te()})):F.editCollDevice(e).then((e=>{Qe(e,xe),Te()}))}}))})},{default:O((()=>[he])),_:1})])])),default:O((()=>[T("div",ge,[S(Ye,{model:I(P).deviceForm,rules:I(P).deviceRules,ref_key:"deviceFormRef",ref:Ie,"status-icon":"","label-position":"right","label-width":"100px"},{default:O((()=>[S(_,{label:"设备名称",prop:"name"},{default:O((()=>[S(y,{disabled:I(P).dTitle.includes("编辑"),type:"text",modelValue:I(P).deviceForm.name,"onUpdate:modelValue":h[14]||(h[14]=e=>I(P).deviceForm.name=e),autocomplete:"off",placeholder:"请输入设备名称"},null,8,["disabled","modelValue"])])),_:1}),S(_,{label:"设备标签",prop:"label"},{default:O((()=>[S(y,{type:"text",modelValue:I(P).deviceForm.label,"onUpdate:modelValue":h[15]||(h[15]=e=>I(P).deviceForm.label=e),autocomplete:"off",placeholder:"请输入设备标签"},null,8,["modelValue"])])),_:1}),S(_,{label:"设备模型",prop:"tsl"},{default:O((()=>[S(C,{modelValue:I(P).deviceForm.tsl,"onUpdate:modelValue":h[16]||(h[16]=e=>I(P).deviceForm.tsl=e),style:{width:"100%"},placeholder:"请选择设备模型"},{default:O((()=>[(N(!0),L(U,null,z(I(P).deviceModelList,((e,l)=>(N(),R(w,{key:"dm_"+l,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(_,{label:"采集接口",prop:"interfaceName"},{default:O((()=>[S(C,{modelValue:I(P).deviceForm.interfaceName,"onUpdate:modelValue":h[17]||(h[17]=e=>I(P).deviceForm.interfaceName=e),clearable:"",style:{width:"100%"},placeholder:"请选择采集接口"},{default:O((()=>[(N(!0),L(U,null,z(I(P).interfaceList,((e,l)=>(N(),R(w,{key:"in_"+l,label:e.collInterfaceName,value:e.collInterfaceName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),S(_,{label:"通讯地址",prop:"addr"},{default:O((()=>[S(y,{type:"text",modelValue:I(P).deviceForm.addr,"onUpdate:modelValue":h[18]||(h[18]=e=>I(P).deviceForm.addr=e),autocomplete:"off",placeholder:"请输入通讯地址"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),S($e,{modelValue:I(P).uFlag,"onUpdate:modelValue":h[22]||(h[22]=e=>I(P).uFlag=e),title:"上传设备xlsx文件",width:"600px","before-close":He,"close-on-click-modal":!1},{footer:O((()=>[T("span",Fe,[S(Oe,{onClick:Ee},{default:O((()=>[De])),_:1}),S(Oe,{type:"primary",onClick:ze},{default:O((()=>[ke])),_:1})])])),default:O((()=>[S(el,{ref_key:"uploadRef",ref:Re,action:"","auto-upload":!1,"http-request":Me,limit:1,"on-exceed":qe,"before-upload":Pe},{tip:O((()=>[_e])),default:O((()=>[S(Oe,{type:"primary"},{default:O((()=>[ye])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-5fea484b"]]);export{xe as default};
