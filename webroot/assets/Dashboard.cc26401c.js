import{g as e,m as a,n as l,v as t,w as s,x as c,y as i,p as o,e as r,o as d,A as n,B as m,C as u,D as p,s as h,u as f,F as v,G as g,H as b,t as y,q as x}from"./element-plus.3300f756.js";import{K as _,f as w,k as F,af as k,o as D,c as S,u as j,a as L,P as C,S as V,Q as T,ak as I,T as P,W as N,X as z,n as M,aw as U,ax as O,$ as R,a0 as H}from"./@vue.73d14ebc.js";import{_ as q,u as A,v as E,D as G}from"./index.f61f902c.js";import{S as K}from"./service.f9434ad8.js";import{a as W}from"./vue-router.43b9a342.js";import{t as B}from"./vue3-barcode.d7f54fa0.js";import{D as Q}from"./deviceModel.7d24566f.js";import{I as X}from"./interface.868ad1a1.js";import{D as $}from"./Device-property.7aa68c6e.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.3d90a471.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./pinia.3f4aff4f.js";import"./vue-demi.b3a9cad9.js";import"./@element-plus.0bef5fa5.js";import"./screenfull.7cf96174.js";import"./vue-echarts.7828944a.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const J={class:"main-container"},Y={key:0,class:"main",style:{overflow:"hidden"}},Z={class:"search-bar"},ee=(e=>(U("data-v-c931545c"),e=e(),O(),e))((()=>L("div",null,"无数据",-1))),ae={class:"pagination",style:{bottom:"24px"}},le={key:1,class:"main"};var te=q({__name:"DeviceList",setup(h){const f=A(),v=_({headerCellStyle:{background:E.primaryColor,color:E.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceTableData:[],screenData:[],deviceTotal:0,deviceOnline:0,dFlag:!1,dTitle:"添加设备",deviceInfo:"",deviceModelList:[],selectedDevices:[],idFlag:!0,uFlag:!1,commStatusOptions:[{label:"全部",value:"Line"},{label:"在线",value:"onLine"},{label:"离线",value:"offLine"}],sFlag:!1,screenForm:{name:"",label:"",tsl:"",commStatus:"Line",collInterfaceName:[],addr:""},interfaceList:[],interfaces:[],checkedInterfaceList:[],collDeviceObj:{}}),g=()=>{v.idFlag=!0,y()};(()=>{const e={token:f.token,data:{}};X.getInterfaceList(e).then((e=>{e&&("0"===e.code?(v.interfaceList=e.data,v.interfaces=[],v.interfaceList.forEach((e=>{v.interfaces.push(e.collInterfaceName),v.checkedInterfaceList.push(e.collInterfaceName)})),y()):q(e))}))})();const b=w(null),y=a=>{const l={token:f.token,data:{names:v.checkedInterfaceList}};X.getAllCollDevices(l).then((async l=>{console.log("getCollDevices -> res",l),l&&("0"===l.code?(v.deviceTableData=null==l.data.node?[]:l.data.node,v.screenData=v.deviceTableData,v.deviceTotal=l.data.commTotalCnt,v.deviceOnline=l.data.commSuccessCnt,1===a&&e({type:"success",message:"刷新成功！"})):q(l),await M((()=>{v.tableMaxHeight=b.value.clientHeight-34-36-22})))}))};(()=>{const e={token:f.token,data:{}};Q.getDeviceModelList(e).then((e=>{console.log("getDeviceModelList -> res",e),"0"===e.code?v.deviceModelList=e.data:q(e)}))})();const x=e=>{v.currentPage=e},U=F((()=>v.screenData.slice((v.currentPage-1)*v.pagesize,v.currentPage*v.pagesize))),O=F((()=>v.screenData)),R=e=>{v.pagesize=e},H=()=>{v.screenForm={name:"",tsl:"",label:"",commStatus:"Line",collInterfaceName:[],addr:""}},q=a=>{e({type:"error",message:a.message})},G=W();return(e,h)=>{const f=a,_=l,w=t,F=s,M=c,q=i,A=o,E=k("Icon"),K=r,W=d,B=n,Q=m,X=u,te=p;return D(),S("div",J,[j(v).idFlag?(D(),S("div",Y,[L("div",Z,[C(W,{model:j(v).screenForm,inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:V((()=>[C(_,{label:"设备名称",prop:"name"},{default:V((()=>[C(f,{type:"text",modelValue:j(v).screenForm.name,"onUpdate:modelValue":h[0]||(h[0]=e=>j(v).screenForm.name=e),autocomplete:"off",placeholder:"请输入设备名称"},null,8,["modelValue"])])),_:1}),C(_,{label:"设备标签",prop:"label"},{default:V((()=>[C(f,{type:"text",modelValue:j(v).screenForm.label,"onUpdate:modelValue":h[1]||(h[1]=e=>j(v).screenForm.label=e),autocomplete:"off",placeholder:"请输入设备标签"},null,8,["modelValue"])])),_:1}),C(_,{label:"设备地址",prop:"addr"},{default:V((()=>[C(f,{type:"text",modelValue:j(v).screenForm.addr,"onUpdate:modelValue":h[2]||(h[2]=e=>j(v).screenForm.addr=e),autocomplete:"off",placeholder:"请输入设备地址"},null,8,["modelValue"])])),_:1}),C(_,{label:"设备模型",prop:"tsl"},{default:V((()=>[C(F,{modelValue:j(v).screenForm.tsl,"onUpdate:modelValue":h[3]||(h[3]=e=>j(v).screenForm.tsl=e),clearable:"",style:{width:"100%"},placeholder:"请选择设备模型"},{default:V((()=>[(D(!0),S(T,null,I(j(v).deviceModelList,((e,a)=>(D(),P(w,{key:"dm_"+a,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),C(_,{label:"采集接口",prop:"collInterfaceName"},{default:V((()=>[C(F,{modelValue:j(v).screenForm.collInterfaceName,"onUpdate:modelValue":h[4]||(h[4]=e=>j(v).screenForm.collInterfaceName=e),clearable:"",style:{width:"100%"},placeholder:"请选择采集接口",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:V((()=>[(D(!0),S(T,null,I(j(v).interfaceList,((e,a)=>(D(),P(w,{key:"cin_"+a,label:e.collInterfaceName,value:e.collInterfaceName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),C(_,{label:"通信状态"},{default:V((()=>[C(q,{modelValue:j(v).screenForm.commStatus,"onUpdate:modelValue":h[5]||(h[5]=e=>j(v).screenForm.commStatus=e)},{default:V((()=>[C(M,{label:"Line"},{default:V((()=>[N("全部")])),_:1}),C(M,{label:"onLine"},{default:V((()=>[N("在线")])),_:1}),C(M,{label:"offLine"},{default:V((()=>[N("离线")])),_:1})])),_:1},8,["modelValue"])])),_:1}),C(_,{style:{"margin-left":"20px"}},{default:V((()=>[C(A,{type:"primary",onClick:h[6]||(h[6]=e=>(console.log("doScreen ctxData.deviceTableData = ",v.deviceTableData),console.log("doScreen ctxData.screenForm = ",v.screenForm),v.screenData=[],v.deviceTotal=0,v.deviceOnline=0,void v.deviceTableData.forEach((e=>{var a=e.name.includes(v.screenForm.name),l=e.label.includes(v.screenForm.label),t=e.addr.includes(v.screenForm.addr),s=""===v.screenForm.tsl||e.tsl==v.screenForm.tsl,c=0===v.screenForm.collInterfaceName.length||v.screenForm.collInterfaceName.includes(e.collInterfaceName),i="Line"===v.screenForm.commStatus||e.commStatus.includes(v.screenForm.commStatus);a&&l&&t&&s&&c&&i&&(v.screenData.push(e),"onLine"==e.commStatus&&v.deviceOnline++,v.deviceTotal++)}))))},{default:V((()=>[N("搜索")])),_:1})])),_:1}),C(_,null,{default:V((()=>[C(A,{onClick:h[7]||(h[7]=e=>{H()})},{default:V((()=>[N("重置")])),_:1})])),_:1}),C(_,null,{default:V((()=>[C(A,{style:{color:"#fff"},color:"#2EA554",onClick:h[8]||(h[8]=e=>{y(1)})},{default:V((()=>[C(K,{class:"btn-icon"},{default:V((()=>[C(E,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),N(" 刷新 ")])),_:1})])),_:1})])),_:1},8,["model"])]),L("div",{class:"content",ref_key:"contentRef",ref:b},[C(X,{data:j(U),"cell-style":j(v).cellStyle,"header-cell-style":j(v).headerCellStyle,style:{width:"100%"},"max-height":j(v).tableMaxHeight,stripe:""},{empty:V((()=>[ee])),default:V((()=>[C(B,{sortable:"",prop:"name",label:"设备名称",width:"auto","min-width":"160",align:"center",fixed:"left"}),C(B,{sortable:"",prop:"label",label:"设备标签",width:"auto","min-width":"160",align:"center"}),C(B,{sortable:"",prop:"tsl",label:"设备模型",width:"auto","min-width":"160",align:"center"},{default:V((e=>[C(A,{type:"primary",link:"",onClick:a=>{return l=e.row,void G.push({path:"deviceModelRtu",query:{tsl:l.tsl}});var l}},{default:V((()=>[N(z(e.row.tsl),1)])),_:2},1032,["onClick"])])),_:1}),C(B,{sortable:"",prop:"collInterfaceName",label:"采集接口",width:"auto","min-width":"160",align:"center"}),C(B,{sortable:"",prop:"addr",label:"通讯地址",width:"auto","min-width":"100",align:"center"}),C(B,{sortable:"",label:"当前通信状态",width:"auto","min-width":"150",align:"center"},{default:V((e=>["onLine"===e.row.commStatus?(D(),P(Q,{key:0,type:"success"},{default:V((()=>[N("在线")])),_:1})):(D(),P(Q,{key:1,type:"danger"},{default:V((()=>[N("离线")])),_:1}))])),_:1}),C(B,{sortable:"",prop:"lastCommRTC",label:"最后通信时间",width:"auto","min-width":"200",align:"center"}),C(B,{sortable:"",prop:"commTotalCnt",label:"通信总次数",width:"auto","min-width":"150",align:"center"}),C(B,{sortable:"",prop:"commSuccessCnt",label:"通信成功次数",width:"auto","min-width":"150",align:"center"}),C(B,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:V((e=>[C(A,{onClick:a=>{return l=e.row,v.idFlag=!1,void(v.curDevice=l);var l},text:"",type:"success"},{default:V((()=>[N("查看变量")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",ae,[C(te,{"current-page":j(v).currentPage,"page-size":j(v).pagesize,"page-sizes":[20,50,200,500],total:j(O).length,onCurrentChange:x,onSizeChange:R,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):(D(),S("div",le,[C($,{curDevice:j(v).curDevice,pageInfo:"dashboard",onChangeIdFlag:g,style:{width:"100%",height:"96%",overflow:"hidden"}},null,8,["curDevice"])]))])}}},[["__scopeId","data-v-c931545c"]]);const se=e=>(U("data-v-364b7e0c"),e=e(),O(),e),ce={class:"dashboard"},ie={class:"basic-info"},oe=se((()=>L("div",{class:"bi-title"},"基本信息",-1))),re={class:"bi-body"},de={class:"cui-content"},ne={class:"card-header"},me={class:"cui-header"},ue={style:{"font-weight":"600"}},pe={class:"card-content"},he={class:"cc-body"},fe={class:"ccb-item",style:{height:"31px","line-height":"31px"}},ve=se((()=>L("div",{class:""},"硬件版本：",-1))),ge={class:"head-name"},be={class:"ccb-item",style:{height:"31px","line-height":"31px"}},ye=se((()=>L("div",{class:""},"软件版本：",-1))),xe={class:"head-name"},_e={class:"ccb-item",style:{height:"31px","line-height":"31px"}},we=se((()=>L("div",{class:""},"系统时间：",-1))),Fe={class:"head-name"},ke={class:"ccb-item",style:{height:"31px","line-height":"31px"}},De=se((()=>L("div",{class:""},"内存总量：",-1))),Se={class:"head-name"},je={class:"ccb-item",style:{height:"31px","line-height":"31px"}},Le=se((()=>L("div",{class:""},"硬盘总量：",-1))),Ce={class:"head-name"},Ve={class:"ccb-item",style:{"margin-bottom":"15px",height:"31px","line-height":"31px"}},Te=se((()=>L("div",{class:""},"运行时间：",-1))),Ie={class:"head-name"},Pe={style:{"padding-top":"10px"}},Ne=se((()=>L("div",{class:"bi-title"},"上报信息",-1))),ze={class:"bi-body"},Me={class:"info-list"},Ue={class:"cui-content"},Oe={class:"card-header"},Re={class:"cui-header"},He={style:{"font-weight":"600"}},qe={class:"card-content"},Ae={class:"cc-body"},Ee={class:"ccb-item"},Ge=se((()=>L("div",{class:""},"协议名称：",-1))),Ke={class:"head-name"},We={class:"ccb-item"},Be=se((()=>L("div",{class:""},"上报周期：",-1))),Qe={class:"head-name"},Xe={class:"ccb-item"},$e=se((()=>L("div",{class:""},"产品密钥：",-1))),Je={class:"head-name"},Ye={class:"ccb-item"},Ze=se((()=>L("div",{class:""},"通讯地址：",-1))),ea={class:"head-name"},aa={class:"ccb-item"},la=se((()=>L("div",{class:""},"设备密钥：",-1))),ta={class:"head-name"},sa={style:{display:"flex",width:"100%","justify-content":"center","text-align":"center"}};var ca=q({__name:"Dashboard",setup(a){const l=A(),t=_({sysParams:{SN:"",deviceOnline:"",devicePacketLoss:"",diskTotal:"",diskUse:"",hardVer:"",lockStatus:0,memTotal:"",memUse:"",name:"",runTime:"",softVer:"",systemRTC:""},showFlag:!1,bFlag:!1,barcodeVale:0,gatewayTableData:[]});(()=>{const e={token:l.token,data:{}};G.getSysParams(e).then((e=>{console.log("getSysParams -> res",e),"0"===e.code&&(t.sysParams=e.data,console.log("getSysParams -> ctxData.sysParams",t.sysParams),t.showFlag=!0,t.barcodeVale=t.sysParams.SN,sessionStorage.setItem("SN",t.barcodeVale))}))})();const s=W();return(a=>{const s={token:l.token,data:{}};K.getGatewayList(s).then((async l=>{console.log("getGatewayList -> res",l),l&&("0"===l.code?(t.gatewayTableData=l.data,1===a&&e({type:"success",message:"刷新成功！"})):showOneResMsg(l))}))})(),(e,a)=>{const l=h,c=o,i=f,r=v,d=m,n=g,u=b,p=y,_=x;return D(),S("div",ce,[C(p,{style:{height:"calc(100% - 10px)"}},{default:V((()=>[C(l,{style:{height:"calc(50% - 10px)"}},{default:V((()=>[C(te,{style:{width:"100%",height:"calc(63.7% - 1px)"}})])),_:1}),C(u,{style:{height:"calc(36% - 25px)",padding:"0px"}},{default:V((()=>[C(n,{gutter:20,style:{height:"calc(100%)",padding:"0px",margin:"0px"}},{default:V((()=>[C(r,{span:8,style:{height:"calc(100%)","padding-left":"0px","padding-right":"15px"}},{default:V((()=>[L("div",ie,[oe,L("div",re,[L("div",de,[C(i,{class:"box-card",shadow:"hover"},{header:V((()=>[L("div",ne,[L("div",me,[L("span",ue,"网关名称："+z(j(t).sysParams.name),1)]),L("div",null,[L("span",null,z(j(t).sysParams.SN),1),R(C(c,{class:"head-tag",text:"",type:"primary",onClick:a[0]||(a[0]=e=>{t.bFlag=!0}),size:"small",style:{"margin-left":"8px"}},{default:V((()=>[N("查看条形码")])),_:1},512),[[H,j(t).showFlag]])])])])),default:V((()=>[L("div",pe,[L("div",he,[L("div",fe,[ve,L("div",ge,z(j(t).sysParams.hardVer),1)]),L("div",be,[ye,L("div",xe,z(j(t).sysParams.softVer),1)]),L("div",_e,[we,L("div",Fe,z(j(t).sysParams.systemRTC),1)]),L("div",ke,[De,L("div",Se,z(j(t).sysParams.memTotal),1)]),L("div",je,[Le,L("div",Ce,z(j(t).sysParams.diskTotal),1)]),L("div",Ve,[Te,L("div",Ie,z(j(t).sysParams.runTime),1)])])])])),_:1})])])])])),_:1}),C(r,{span:16,style:{height:"calc(104%)","background-color":"#f5f5f5","border-radius":"4px"}},{default:V((()=>[L("div",Pe,[Ne,L("div",ze,[L("div",Me,[(D(!0),S(T,null,I(j(t).gatewayTableData,((e,a)=>(D(),S("div",{class:"info-item",key:a},[L("div",Ue,[C(i,{class:"box-card",shadow:"hover"},{header:V((()=>[L("div",Oe,[L("div",Re,[L("span",He,z(e.serviceName),1),C(d,{size:"small",style:{"margin-left":"8px"},type:"onLine"===e.reportStatus?"success":"danger"},{default:V((()=>[N(z("onLine"===e.reportStatus?"在线":"离线"),1)])),_:2},1032,["type"])]),L("div",null,[C(c,{class:"head-tag",text:"",type:"primary",onClick:a=>{return l=e,void s.push({path:"dataService",query:{serviceName:l.serviceName}});var l},size:"small"},{default:V((()=>[N("查看详情")])),_:2},1032,["onClick"])])])])),default:V((()=>[L("div",qe,[L("div",Ae,[L("div",Ee,[Ge,L("div",Ke,z(e.protocol),1)]),L("div",We,[Be,L("div",Qe,z(e.reportTime)+" 秒",1)]),L("div",Xe,[$e,L("div",Je,z(e.param.ProductKey),1)]),L("div",Ye,[Ze,L("div",ea,z(e.param.DeviceID),1)]),L("div",aa,[la,L("div",ta,z(e.param.DeviceSecret),1)])])])])),_:2},1024)])])))),128))])])])])),_:1})])),_:1})])),_:1})])),_:1}),C(_,{modelValue:j(t).bFlag,"onUpdate:modelValue":a[1]||(a[1]=e=>j(t).bFlag=e),title:"网关SN条形码",width:"30%"},{default:V((()=>[L("div",sa,[C(j(B),{value:j(t).barcodeVale,height:60},null,8,["value"])])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-364b7e0c"]]);export{ca as default};
