import{h as e,e as l,p as t,m as a,D as o,F as r,G as d,C as n,n as s,y as i,A as c,o as u,q as p,H as m,u as g}from"./element-plus.795748f2.js";import{s as f,_ as y,u as b,v as h}from"./index.3a6602e1.js";import{D as v}from"./deviceModel.eb023515.js";import{J as _,M as F,I as k,L as C}from"./@element-plus.102632fb.js";import{f as w,Y as M,p as x,X as D,o as V,c as B,a as L,S as A,Q as S,u as P,U as T,a0 as z,as as N,at as R,H as U,h as j,M as I,af as q,P as H,J as E,K as O,L as G,O as W}from"./@vue.8518410d.js";import"./@vueuse.c0256496.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./vue-router.ae8a7199.js";import"./pinia.4a496763.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./nprogress.aae2b787.js";var J=e=>f.request({url:"/tsl/modbus/cmd",method:"get",data:e}),$=e=>f.request({url:"/tsl/modbus/cmd",method:"post",data:e}),K=e=>f.request({url:"/tsl/modbus/cmd",method:"put",data:e}),Q=e=>f.request({url:"/tsl/modbus/cmd",method:"delete",data:e}),X=e=>f.request({url:"/tsl/modbus/block/xlsx",method:"post",data:e}),Y=e=>f.request({url:"/tsl/modbus/block/xlsx",method:"get",data:e}),Z=e=>f.request({url:"/tsl/modbus/cmd/params",method:"get",data:e}),ee=e=>f.request({url:"/tsl/modbus/cmd/param",method:"post",data:e}),le=e=>f.request({url:"/tsl/modbus/cmd/param",method:"put",data:e}),te=e=>f.request({url:"/tsl/modbus/cmd/params",method:"delete",data:e}),ae=e=>f.request({url:"/tsl/modbus/cmd/param/xlsx",method:"post",data:e}),oe=e=>f.request({url:"/tsl/modbus/cmd/param/xlsx",method:"get",data:e});const re=e=>(N("data-v-59e29fec"),e=e(),R(),e),de={class:"main"},ne={class:"title",style:{"justify-content":"space-between"}},se=z(" 返回设备模型 "),ie={style:{display:"flex","align-items":"center"}},ce=z(" 导出模型属性 "),ue={class:"title",style:{top:"60px",height:"76px",padding:"20px 0","justify-content":"space-between"}},pe={class:"tName"},me={style:{display:"flex"}},ge=z(" 刷新 "),fe=z(" 序号 "),ye=re((()=>L("div",null,"无数据",-1))),be={class:"pagination"};var he=y({props:{curDeviceModel:{type:Object,default:{}}},emits:["changeShowFlag"],setup(n,{emit:s}){const i=n,c=b();console.log("id -> props",i);const u=w(null),p=M({headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,dbNumber:"",startAddr:"",dataType:0,unit:"",decimals:0},psFlag:!1,selectedProperties:[]}),m=l=>{const t={token:c.token,data:{name:i.curDeviceModel.name}};v.getDeviceModelProperty(t).then((async t=>{console.log("getDeviceModelProperty -> res",t),t&&("0"===t.code?(p.propertyList=t.data,1===l&&e({type:"success",message:"刷新成功！"})):N(t),await U((()=>{p.tableMaxHeight=u.value.clientHeight-34-36-22})))}))};m();const g=x((()=>(console.log("ctxData.propertyList ->",p.propertyList),p.propertyList.filter((e=>{var l=!p.deviceModelProperty,t=e.name.toLowerCase().includes(p.deviceModelProperty.toLowerCase());return l||t})).slice((p.currentPage-1)*p.pagesize,p.currentPage*p.pagesize)))),f=x((()=>p.propertyList.filter((e=>{var l=!p.deviceModelProperty,t=e.name.toLowerCase().includes(p.deviceModelProperty.toLowerCase());return l||t})))),y=e=>{p.currentPage=e},C=e=>{p.pagesize=e},N=l=>{e({type:"error",message:l.message})};return(e,n)=>{const b=l,h=t,w=a,M=D("Icon"),x=o,R=r,U=d;return V(),B("div",de,[L("div",ne,[L("div",null,[A(h,{type:"primary",plain:"",onClick:n[0]||(n[0]=e=>(console.log("toDeviceModel"),void s("changeShowFlag")))},{default:S((()=>[A(b,{class:"el-input__icon"},{default:S((()=>[A(P(_))])),_:1}),se])),_:1})]),L("div",ie,[A(h,{type:"primary",plain:"",class:"right-btn",onClick:n[1]||(n[1]=e=>(()=>{console.log("exportDPS");const e={token:c.token,responseType:"blob",data:{name:i.curDeviceModel.name}};v.exportDeviceModelProptyAndService(e).then((e=>{if(e&&"1"===e.code)return void N(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:S((()=>[A(b,{class:"el-input__icon"},{default:S((()=>[A(P(F))])),_:1}),ce])),_:1})])]),L("div",ue,[L("div",pe,T(i.curDeviceModel.label)+"：属性列表",1),L("div",me,[A(w,{style:{width:"200px"},placeholder:"请输入属性名称",modelValue:P(p).deviceModelProperty,"onUpdate:modelValue":n[2]||(n[2]=e=>P(p).deviceModelProperty=e)},{prefix:S((()=>[A(b,{class:"el-input__icon"},{default:S((()=>[A(P(k))])),_:1})])),_:1},8,["modelValue"]),A(h,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:n[3]||(n[3]=e=>{m(1)})},{default:S((()=>[A(b,{class:"btn-icon"},{default:S((()=>[A(M,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),ge])),_:1})])]),L("div",{class:"content",ref_key:"contentRef",ref:u,style:{top:"136px"}},[A(R,{data:P(g),"cell-style":P(p).cellStyle,"header-cell-style":P(p).headerCellStyle,"max-height":P(p).tableMaxHeight,style:{width:"100%"},stripe:""},{empty:S((()=>[ye])),default:S((()=>[A(x,{type:"index",width:"60"},{header:S((()=>[fe])),_:1}),A(x,{prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),A(x,{prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),A(x,{label:"读写属性",width:"auto","min-width":"80",align:"center"},{default:S((e=>[z(T(P(p).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),A(x,{prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:S((e=>[z(T(P(p).typeNames["t"+e.row.type]),1)])),_:1}),A(x,{label:"小数位数",width:"auto","min-width":"80",align:"center"},{default:S((e=>[z(T(""===e.row.decimals?0:e.row.decimals),1)])),_:1}),A(x,{prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),A(x,{prop:"regAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),A(x,{prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"120",align:"center"}),A(x,{prop:"ruleType",label:"解析规则",width:"auto","min-width":"120",align:"center"})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",be,[A(U,{"current-page":P(p).currentPage,"page-size":P(p).pagesize,"page-sizes":[20,50,200,500],total:P(f).length,onCurrentChange:y,onSizeChange:C,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])}}},[["__scopeId","data-v-59e29fec"]]);const ve=e=>(N("data-v-243ce11a"),e=e(),R(),e),_e={class:"title",style:{"justify-content":"space-between"}},Fe={class:"tName"},ke={style:{display:"flex"}},Ce=z(" 导入命令参数 "),we=z(" 导出命令参数 "),Me=z(" 添加 "),xe=z(" 刷新 "),De=z(" 删除 "),Ve=z("编辑"),Be=ve((()=>L("div",null,"无数据",-1))),Le={class:"pagination"},Ae={class:"dialog-content"},Se=z("编辑"),Pe=ve((()=>L("div",{class:"form-title"},[L("div",{class:"tName"},"配置参数")],-1))),Te={class:"dialog-footer"},ze=z("取消"),Ne=z("保存"),Re={class:"dialog-content"},Ue={style:{width:"100%"}},je={class:"operation"},Ie={style:{"padding-right":"10px"}},qe={class:"dialog-footer"},He=z("取消"),Ee=z("保存"),Oe=z("选择文件"),Ge=ve((()=>L("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),We={class:"dialog-footer"},Je=z("取消"),$e=z("上传");var Ke=y({props:{curModelBlock:{type:Object,default:{}}},emits:["changeBShowFlag"],setup(g,{emit:f}){const y=g,_=b(),N=/^[0-9]*[1-9][0-9]*$/,R=w(null),W=M({formulaForm:{},headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",accessModeOptions:[{label:"只读",value:0},{label:"只写",value:1},{label:"读写",value:2}],typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},regCntOptions:[{label:1,value:1},{label:2,value:2},{label:4,value:4}],pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,regCnt:1,regAddr:null,ruleType:"Int_AB",unit:"",decimals:0,formula:""},ruleTypeOptions:{rt1:[{label:"Int_AB",value:"Int_AB"},{label:"Int_BA",value:"Int_BA"}],rt2:[{label:"Long_ABCD",value:"Long_ABCD"},{label:"Long_BADC",value:"Long_BADC"},{label:"Long_DCBA",value:"Long_DCBA"},{label:"Long_CDAB",value:"Long_CDAB"},{label:"Float_ABCD",value:"Float_ABCD"},{label:"Float_BADC",value:"Float_BADC"},{label:"Float_DCBA",value:"Float_DCBA"},{label:"Float_CDAB",value:"Float_CDAB"}],rt4:[{label:"Double_ABCDEFGH",value:"Double_ABCDEFGH"},{label:"Double_GHEFCDAB",value:"Double_GHEFCDAB"},{label:"Double_BADCFEHG",value:"Double_BADCFEHG"},{label:"Double_HGFEDCBA",value:"Double_HGFEDCBA"}]},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",decimals:"小数位数",regCnt:"寄存器数量",ruleType:"解析规则",regAddr:"寄存器地址",formula:"计算公式"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],accessMode:[{required:!0,message:"读写属性不能为空",trigger:"blur"}],type:[{required:!0,message:"属性类型不能为空",trigger:"blur"}],ruleType:[{required:!0,message:"解析规则不能为空",trigger:"blur"}],decimals:[{type:"number",message:"小数位数只能输入数字"}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{N.test(l)?t():t(new Error("只能输入正整数数字！"))}}],regAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{0===l||N.test(l)?t():t(new Error("只能输入自然数！"))}}]},psFlag:!1,selectedProperties:[],fFlag:!1,propertyInfo:[],operationList:[{name:"+",label:"+",describe:"加"},{name:"-",label:"-",describe:"减"},{name:"*",label:"*",describe:"乘"},{name:"/",label:"/",describe:"除"},{name:"%",label:"%",describe:"模"},{name:"^",label:"^",describe:"次幂"},{name:"(",label:"(",describe:"左括号"},{name:")",label:")",describe:"右括号"}],curFormula:"",selectionStart:0,pItem:""}),J=l=>{const t={token:_.token,data:{tslName:y.curModelBlock.tslName,cmdName:y.curModelBlock.name}};Z(t).then((async t=>{t&&("0"===t.code?(W.propertyList=null==t.data?[]:t.data,1===l&&e({type:"success",message:"刷新成功！"})):ve(t),await U((()=>{W.tableMaxHeight=R.value.clientHeight-34-22})))}))};J();const $=x((()=>W.propertyList.filter((e=>{var l=!W.deviceModelProperty,t=e.name.toLowerCase().includes(W.deviceModelProperty.toLowerCase());return l||t})).slice((W.currentPage-1)*W.pagesize,W.currentPage*W.pagesize))),K=x((()=>W.propertyList.filter((e=>{var l=!W.deviceModelProperty,t=e.name.toLowerCase().includes(W.deviceModelProperty.toLowerCase());return l||t})))),Q=e=>{W.currentPage=e},X=e=>{W.pagesize=e},Y=()=>{de.value&&de.value.submit()},re=e=>{},de=w(null),ne=e=>{de.value.clearFiles();const l=e[0];de.value.handleStart(l)},se=l=>{let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("tslName",y.curModelBlock.tslName),t.append("cmdName",y.curModelBlock.name),t.append("fileName",l);const a={token:_.token,contentType:"multipart/form-data",data:t};ae(a).then((l=>{"0"===l.code?(e.success(l.message),W.psFlag=!1,J()):ve(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ie=()=>{W.psFlag=!1,uploadRef.value.clearFiles()},ce=()=>{ie()},ue=e=>{W.pFlag=!0,W.pTitle="编辑属性",W.propertyForm.name=e.name,W.propertyForm.label=e.label,W.propertyForm.accessMode=e.accessMode,W.propertyForm.type=e.type,W.propertyForm.decimals=e.decimals,W.propertyForm.unit=e.unit,W.propertyForm.regCnt=e.regCnt,W.propertyForm.regAddr=e.regAddr,W.propertyForm.ruleType=e.ruleType,W.propertyForm.formula=void 0===e.formula||null===e.formula?"":e.formula},pe=w(null),me=()=>{W.pFlag=!1,pe.value.resetFields(),ye()},ge=e=>{me()},fe=e=>{W.selectedProperties=e},ye=()=>{W.propertyForm={name:"",label:"",accessMode:0,type:0,decimals:0,unit:"",regCnt:1,regAddr:null,ruleType:"Int_AB",formula:""}},be=()=>{W.fFlag=!0,W.curFormula=W.propertyForm.formula,(()=>{const e={token:_.token,data:{name:y.curModelBlock.tslName}};v.getDeviceModelProperty(e).then((e=>{e&&("0"===e.code?(W.propertyInfo=[{name:"t",label:"当前属性"}],e.data.forEach((e=>{W.propertyInfo.push({name:e.name,label:e.label})}))):ve(e))}))})()},he=e=>{W.selectionStart=e.srcElement.selectionStart},ve=l=>{e({type:"error",message:l.message})},Ke=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return j((()=>y.curModelBlock),((e,l)=>{J()})),(g,f)=>{const b=l,h=a,v=t,w=D("Icon"),M=o,x=r,N=d,U=s,j=i,Z=c,ae=u,ye=p,Qe=m;return V(),B(I,null,[L("div",_e,[L("div",Fe,T(y.curModelBlock.label)+"：命令参数列表",1),L("div",ke,[A(h,{style:{width:"200px"},placeholder:"请输入命令参数名称",modelValue:P(W).deviceModelProperty,"onUpdate:modelValue":f[0]||(f[0]=e=>P(W).deviceModelProperty=e)},{prefix:S((()=>[A(b,{class:"el-input__icon"},{default:S((()=>[A(P(k))])),_:1})])),_:1},8,["modelValue"]),A(v,{type:"primary",plain:"",class:"right-btn",onClick:f[1]||(f[1]=e=>{W.psFlag=!0})},{default:S((()=>[A(b,{class:"el-input__icon"},{default:S((()=>[A(P(C))])),_:1}),Ce])),_:1}),A(v,{type:"primary",plain:"",class:"right-btn",onClick:f[2]||(f[2]=e=>(()=>{const e={token:_.token,responseType:"blob",data:{tslName:y.curModelBlock.tslName,cmdName:y.curModelBlock.name}};oe(e).then((e=>{if(e&&"1"===e.code)return void ve(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:S((()=>[A(b,{class:"el-input__icon"},{default:S((()=>[A(P(F))])),_:1}),we])),_:1}),A(v,{type:"primary",bg:"",class:"right-btn",onClick:f[3]||(f[3]=e=>(W.pFlag=!0,void(W.pTitle="添加属性")))},{default:S((()=>[A(b,{class:"btn-icon"},{default:S((()=>[A(w,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),Me])),_:1}),A(v,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:f[4]||(f[4]=e=>{J(1)})},{default:S((()=>[A(b,{class:"btn-icon"},{default:S((()=>[A(w,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),xe])),_:1}),A(v,{type:"danger",bg:"",class:"right-btn",onClick:f[5]||(f[5]=l=>(l=>{let t=[];0!==W.selectedProperties.length?(W.selectedProperties.forEach((e=>{t.push(e.name)})),n.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:_.token,data:{tslName:y.curModelBlock.tslName,cmdName:y.curModelBlock.name,propertyNames:t}};te(e).then((e=>{Ke(e,J)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:S((()=>[A(b,{class:"btn-icon"},{default:S((()=>[A(w,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),De])),_:1})])]),L("div",{class:"content",ref_key:"contentRef",ref:R},[A(x,{data:P($),"cell-style":P(W).cellStyle,"header-cell-style":P(W).headerCellStyle,"max-height":P(W).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:fe,onRowDblclick:ue},{empty:S((()=>[Be])),default:S((()=>[A(M,{type:"selection",width:"55"}),A(M,{prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),A(M,{prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),A(M,{label:"读写属性",width:"auto","min-width":"80",align:"center"},{default:S((e=>[z(T(P(W).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),A(M,{prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:S((e=>[z(T(P(W).typeNames["t"+e.row.type]),1)])),_:1}),A(M,{label:"小数位数",width:"auto","min-width":"80",align:"center"},{default:S((e=>[z(T(""===e.row.decimals?0:e.row.decimals),1)])),_:1}),A(M,{prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),A(M,{prop:"regAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),A(M,{prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"120",align:"center"}),A(M,{prop:"ruleType",label:"解析规则",width:"auto","min-width":"120",align:"center"}),A(M,{prop:"formula",label:"计算公式",width:"auto","min-width":"200",align:"center"}),A(M,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:S((e=>[A(v,{onClick:l=>ue(e.row),text:"",type:"primary"},{default:S((()=>[Ve])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",Le,[A(N,{"current-page":P(W).currentPage,"page-size":P(W).pagesize,"page-sizes":[20,50,200,500],total:P(K).length,onCurrentChange:Q,onSizeChange:X,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),A(ye,{modelValue:P(W).pFlag,"onUpdate:modelValue":f[21]||(f[21]=e=>P(W).pFlag=e),title:P(W).pTitle,width:"800px","before-close":ge,"close-on-click-modal":!1},{footer:S((()=>[L("span",Te,[A(v,{onClick:f[19]||(f[19]=e=>me())},{default:S((()=>[ze])),_:1}),A(v,{type:"primary",onClick:f[20]||(f[20]=e=>{pe.value.validate((e=>{if(!e)return!1;{const e={token:_.token,data:{tslName:y.curModelBlock.tslName,cmdName:y.curModelBlock.name,name:W.propertyForm.name,label:W.propertyForm.label,accessMode:W.propertyForm.accessMode,type:W.propertyForm.type,decimals:W.propertyForm.decimals,unit:W.propertyForm.unit,regCnt:W.propertyForm.regCnt,regAddr:W.propertyForm.regAddr,ruleType:W.propertyForm.ruleType,formula:W.propertyForm.formula}};W.pTitle.includes("添加")?ee(e).then((e=>{Ke(e,J),me()})):le(e).then((e=>{Ke(e,J),me()}))}}))})},{default:S((()=>[Ne])),_:1})])])),default:S((()=>[L("div",Ae,[A(ae,{model:P(W).propertyForm,rules:P(W).propertyRules,ref_key:"propertyFormRef",ref:pe,"status-icon":"","label-position":"right","label-width":"120px",inline:!0},{default:S((()=>[A(U,{label:"属性名称",prop:"name"},{default:S((()=>[A(h,{style:{width:"220px"},disabled:P(W).pTitle.includes("编辑"),type:"text",modelValue:P(W).propertyForm.name,"onUpdate:modelValue":f[6]||(f[6]=e=>P(W).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),A(U,{label:"属性标签",prop:"label"},{default:S((()=>[A(h,{style:{width:"220px"},type:"text",modelValue:P(W).propertyForm.label,"onUpdate:modelValue":f[7]||(f[7]=e=>P(W).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),A(U,{label:"读写属性",prop:"accessMode"},{default:S((()=>[A(Z,{modelValue:P(W).propertyForm.accessMode,"onUpdate:modelValue":f[8]||(f[8]=e=>P(W).propertyForm.accessMode=e),style:{width:"220px"},placeholder:"请选择读写属性"},{default:S((()=>[(V(!0),B(I,null,q(P(W).accessModeOptions,(e=>(V(),H(j,{key:"accessMode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),A(U,{label:"单位",prop:"unit"},{default:S((()=>[A(h,{style:{width:"220px"},type:"text",modelValue:P(W).propertyForm.unit,"onUpdate:modelValue":f[9]||(f[9]=e=>P(W).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1}),A(U,{label:"属性类型",prop:"type"},{default:S((()=>[A(Z,{modelValue:P(W).propertyForm.type,"onUpdate:modelValue":f[10]||(f[10]=e=>P(W).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择属性类型"},{default:S((()=>[(V(!0),B(I,null,q(P(W).typeOptions,(e=>(V(),H(j,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),A(U,{label:"计算公式",prop:"formula"},{default:S((()=>[A(h,{style:{width:"220px"},type:"text",readonly:"",modelValue:P(W).propertyForm.formula,"onUpdate:modelValue":f[12]||(f[12]=e=>P(W).propertyForm.formula=e),autocomplete:"off",placeholder:"请编辑计算公式"},{append:S((()=>[A(v,{onClick:f[11]||(f[11]=e=>be())},{default:S((()=>[Se])),_:1})])),_:1},8,["modelValue"])])),_:1}),E(A(U,{label:"小数位数",prop:"decimals"},{default:S((()=>[A(h,{style:{width:"220px"},type:"text",modelValue:P(W).propertyForm.decimals,"onUpdate:modelValue":f[13]||(f[13]=e=>P(W).propertyForm.decimals=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入小数位数"},null,8,["modelValue"])])),_:1},512),[[O,2===P(W).propertyForm.type]]),Pe,A(U,{label:"寄存器地址",prop:"regAddr"},{default:S((()=>[A(h,{type:"text",style:{width:"220px"},modelValue:P(W).propertyForm.regAddr,"onUpdate:modelValue":f[14]||(f[14]=e=>P(W).propertyForm.regAddr=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器地址"},null,8,["modelValue"])])),_:1}),1!=y.curModelBlock.funCode?(V(),H(U,{key:0,label:"",prop:"",style:{width:"220px"}})):G("",!0),A(U,{label:"寄存器数量",prop:"regCnt"},{default:S((()=>[1==y.curModelBlock.funCode?(V(),H(h,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:P(W).propertyForm.regCnt,"onUpdate:modelValue":f[15]||(f[15]=e=>P(W).propertyForm.regCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器数量"},null,8,["modelValue"])):(V(),H(Z,{key:1,modelValue:P(W).propertyForm.regCnt,"onUpdate:modelValue":f[16]||(f[16]=e=>P(W).propertyForm.regCnt=e),modelModifiers:{number:!0},style:{width:"220px"},onChange:f[17]||(f[17]=e=>(()=>{const e=W.propertyForm.regCnt;1===e&&(W.propertyForm.ruleType="Int_AB"),2===e&&(W.propertyForm.ruleType="Long_ABCD"),4===e&&(W.propertyForm.ruleType="Double_ABCDEFGH")})()),placeholder:"请选择寄存器数量"},{default:S((()=>[(V(!0),B(I,null,q(P(W).regCntOptions,(e=>(V(),H(j,{key:"regCount_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),1!=y.curModelBlock.funCode?(V(),H(U,{key:1,label:"解析规则",prop:"ruleType"},{default:S((()=>[A(Z,{modelValue:P(W).propertyForm.ruleType,"onUpdate:modelValue":f[18]||(f[18]=e=>P(W).propertyForm.ruleType=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择解析规则"},{default:S((()=>[(V(!0),B(I,null,q(P(W).ruleTypeOptions["rt"+P(W).propertyForm.regCnt],(e=>(V(),H(j,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):G("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),A(ye,{modelValue:P(W).fFlag,"onUpdate:modelValue":f[27]||(f[27]=e=>P(W).fFlag=e),title:"编辑计算公式",width:"600px"},{footer:S((()=>[L("span",qe,[A(v,{onClick:f[25]||(f[25]=e=>(W.fFlag=!1,void(W.curFormula="")))},{default:S((()=>[He])),_:1}),A(v,{type:"primary",onClick:f[26]||(f[26]=e=>(W.fFlag=!1,void(W.propertyForm.formula=W.curFormula)))},{default:S((()=>[Ee])),_:1})])])),default:S((()=>[L("div",Re,[A(ae,{model:P(W).formulaForm,"label-position":"right","label-width":"120px"},{default:S((()=>[A(U,{label:"运算符号"},{default:S((()=>[L("div",Ue,[(V(!0),B(I,null,q(P(W).operationList,(e=>(V(),B("div",je,[L("div",Ie,[A(v,{style:{width:"100%"},onClick:l=>(e=>{let l=W.curFormula.length;if(l!==W.selectionStart){let t=W.curFormula.substr(0,W.selectionStart),a=W.curFormula.substr(W.selectionStart,l-W.selectionStart);W.curFormula=t+e.name+a,W.selectionStart+=e.name.length}else W.curFormula+=e.name,W.selectionStart+=e.name.length})(e)},{default:S((()=>[z(T(e.label),1)])),_:2},1032,["onClick"])])])))),256))])])),_:1}),A(U,{label:"设备属性"},{default:S((()=>[A(Z,{modelValue:P(W).pItem,"onUpdate:modelValue":f[22]||(f[22]=e=>P(W).pItem=e),filterable:"",placeholder:"请选择设备属性",onChange:f[23]||(f[23]=e=>(e=>{let l=W.curFormula.length;if(l!==W.selectionStart){let t=W.curFormula.substr(0,W.selectionStart),a=W.curFormula.substr(W.selectionStart,l-W.selectionStart);W.curFormula=t+"("+e+")"+a,W.selectionStart+=e.length+2}else W.curFormula+="("+e+")",W.selectionStart+=e.length+2})(P(W).pItem)),style:{width:"100%"}},{default:S((()=>[(V(!0),B(I,null,q(P(W).propertyInfo,(e=>(V(),H(j,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),A(U,{label:"当前公式"},{default:S((()=>[A(h,{type:"text",clearable:"",modelValue:P(W).curFormula,"onUpdate:modelValue":f[24]||(f[24]=e=>P(W).curFormula=e),autocomplete:"off",placeholder:"请编辑计算公式",onBlur:he},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),A(ye,{modelValue:P(W).psFlag,"onUpdate:modelValue":f[28]||(f[28]=e=>P(W).psFlag=e),title:"导入命令参数",width:"600px","before-close":ce,"close-on-click-modal":!1},{footer:S((()=>[L("span",We,[A(v,{onClick:ie},{default:S((()=>[Je])),_:1}),A(v,{type:"primary",onClick:Y},{default:S((()=>[$e])),_:1})])])),default:S((()=>[A(Qe,{ref_key:"uploadDPSRef",ref:de,action:"","auto-upload":!1,"http-request":re,limit:1,"on-exceed":ne,"before-upload":se},{tip:S((()=>[Ge])),default:S((()=>[A(v,{type:"primary"},{default:S((()=>[Oe])),_:1})])),_:1},512)])),_:1},8,["modelValue"])],64)}}},[["__scopeId","data-v-243ce11a"]]);const Qe=e=>(N("data-v-76705292"),e=e(),R(),e),Xe={class:"mc-left"},Ye={class:"title"},Ze=z(" 返回设备模型 "),el={class:"mcl-content"},ll={class:"mclc-content"},tl={class:"mc-right"},al={class:"mcr-top"},ol={class:"title",style:{"justify-content":"space-between"}},rl={class:"tName"},dl={style:{display:"flex"}},nl=z(" 导入命令 "),sl=z(" 导出命令 "),il=z(" 添加 "),cl=z(" 刷新 "),ul=z(" 删除 "),pl=z("编辑"),ml=z("命令参数详情"),gl=Qe((()=>L("div",null,"无数据",-1))),fl={class:"pagination"},yl={key:0,class:"mcr-bottom"},bl={class:"dialog-content"},hl={class:"dialog-footer"},vl=z("取消"),_l=z("保存"),Fl=z("选择文件"),kl=Qe((()=>L("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),Cl={class:"dialog-footer"},wl=z("取消"),Ml=z("上传");var xl=y({props:{curDeviceModel:{type:Object,default:{}},deviceModelList:{type:Array,default:[]}},emits:["changeShowFlag"],setup(f,{emit:y}){const v=f,N=b();console.log("id -> props",v);const R=/^[0-9]*[1-9][0-9]*$/,j=w(null),E=M({curDeviceModel:v.curDeviceModel,headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelBlock:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],funCodeOptions:[{label:"01(读线圈状态)",value:1},{label:"02(读离散输入状态)",value:2},{label:"03(读保持寄存器)",value:3},{label:"04(读输入寄存器)",value:4},{label:"05(写单个线圈)",value:5},{label:"06(写单个保持寄存器)",value:6},{label:"15(写多个线圈)",value:15},{label:"16(写多个保持寄存器)",value:16}],funCodeNames:{f1:"01(读线圈状态)",f2:"02(读离散输入状态)",f3:"03(读保持寄存器)",f4:"04(读输入寄存器)",f5:"05(写单个线圈)",f6:"06(写单个保持寄存器)",f15:"15(写多个线圈)",f16:"16(写多个保持寄存器)"},dataTypeOptions:[{label:"uint8",value:0},{label:"int8",value:1},{label:"uint16",value:2},{label:"int16",value:3},{label:"uint32",value:4},{label:"int32",value:5},{label:"float",value:6},{label:"double",value:7}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},dataTypeNames:{dt0:"uint8",dt1:"int8",dt2:"uint16",dt3:"int16",dt4:"uint32",dt5:"int32",dt6:"float",dt7:"double"},pFlag:!1,pTitle:"添加属性",blockForm:{name:"",label:"",funCode:null,startRegAddr:0,regCnt:0},paramName:{name:"块名称",label:"块标签",funCode:"功能码",type:"属性类型",startRegAddr:"寄存器地址",regCnt:"寄存器数量"},propertyRules:{name:[{required:!0,message:"块名称不能为空",trigger:"blur"}],label:[{required:!0,message:"块标签不能为空",trigger:"blur"}],funCode:[{required:!0,message:"功能码不能为空",trigger:"blur"}],startRegAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{0===l||R.test(l)?t():t(new Error("只能输入自然数！"))}}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{R.test(l)?t():t(new Error("只能输入正整数数字！"))}}]},psFlag:!1,selectedProperties:[],curModelBlock:{},porpFlag:!1}),O=l=>{const t={token:N.token,data:{tslName:E.curDeviceModel.name}};J(t).then((async t=>{t&&("0"===t.code?(E.propertyList=t.data,E.propertyList.length>0?(E.curModelBlock=E.propertyList[0],E.curModelBlock.tslName=E.curDeviceModel.name,console.log("getDeviceModelBlock -> ctxData.curModelBlock",E.curModelBlock),E.porpFlag=!0):E.porpFlag=!1,1===l&&e({type:"success",message:"刷新成功！"})):be(t),await U((()=>{E.tableMaxHeight=j.value.clientHeight-34-22,2===l&&ye(E.curModelBlock)})))}))};O(2);const Z=x((()=>(console.log("ctxData.propertyList ->",E.propertyList),E.propertyList.filter((e=>{var l=!E.deviceModelBlock,t=e.name.toLowerCase().includes(E.deviceModelBlock.toLowerCase());return l||t})).slice((E.currentPage-1)*E.pagesize,E.currentPage*E.pagesize)))),ee=x((()=>E.propertyList.filter((e=>{var l=!E.deviceModelBlock,t=e.name.toLowerCase().includes(E.deviceModelBlock.toLowerCase());return l||t})))),le=e=>{E.currentPage=e},te=e=>{E.pagesize=e},ae=()=>{re.value&&re.value.submit()},oe=e=>{},re=w(null),de=e=>{re.value.clearFiles();const l=e[0];re.value.handleStart(l)},ne=l=>{console.log("beforeUpload -> file",l);let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("name",E.curDeviceModel.name),t.append("fileName",l);const a={token:N.token,contentType:"multipart/form-data",data:t};X(a).then((l=>{"0"===l.code?(e.success(l.message),E.psFlag=!1,O()):be(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},se=()=>{E.psFlag=!1,uploadRef.value.clearFiles()},ie=()=>{se()},ce=e=>{E.pFlag=!0,E.pTitle="编辑属性",E.blockForm.name=e.name,E.blockForm.label=e.label,E.blockForm.funCode=e.funCode,E.blockForm.startRegAddr=e.startRegAddr,E.blockForm.regCnt=e.regCnt},ue=w(null),pe=()=>{E.pFlag=!1,ue.value.resetFields(),fe()},me=e=>{pe()},ge=e=>{E.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},fe=()=>{E.blockForm={name:"",label:"",funCode:null,startRegAddr:0,regCnt:0}},ye=e=>{E.curModelBlock=e,E.curModelBlock.tslName=E.curDeviceModel.name},be=l=>{e({type:"error",message:l.message})},he=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(f,b)=>{const h=l,w=t,M=g,x=a,R=D("Icon"),U=o,J=r,X=d,fe=s,ve=i,_e=c,Fe=u,ke=p,Ce=m;return V(),B(I,null,[L("div",Xe,[L("div",Ye,[A(w,{type:"primary",style:{width:"100%"},plain:"",onClick:b[0]||(b[0]=e=>{y("changeShowFlag")})},{default:S((()=>[A(h,{class:"el-input__icon"},{default:S((()=>[A(P(_))])),_:1}),Ze])),_:1})]),L("div",el,[(V(!0),B(I,null,q(v.deviceModelList,((e,l)=>(V(),H(M,{key:"i"+l,shadow:"hover",class:W({"mclc-card":!0,activeModel:e.name==P(E).curDeviceModel.name}),onClick:l=>(e=>{E.curDeviceModel.name!=e.name&&(E.curDeviceModel=e,O())})(e)},{default:S((()=>[L("div",ll,[L("span",null,T(e.name),1)])])),_:2},1032,["class","onClick"])))),128))])]),L("div",tl,[L("div",al,[L("div",ol,[L("div",rl,T(P(E).curDeviceModel.label)+"：命令列表",1),L("div",dl,[A(x,{style:{width:"200px"},placeholder:"请输入命令名称",modelValue:P(E).deviceModelBlock,"onUpdate:modelValue":b[1]||(b[1]=e=>P(E).deviceModelBlock=e)},{prefix:S((()=>[A(h,{class:"el-input__icon"},{default:S((()=>[A(P(k))])),_:1})])),_:1},8,["modelValue"]),A(w,{type:"primary",plain:"",class:"right-btn",onClick:b[2]||(b[2]=e=>(console.log("importDPS"),void(E.psFlag=!0)))},{default:S((()=>[A(h,{class:"el-input__icon"},{default:S((()=>[A(P(C))])),_:1}),nl])),_:1}),A(w,{type:"primary",plain:"",class:"right-btn",onClick:b[3]||(b[3]=e=>(()=>{console.log("exportDPS");const e={token:N.token,responseType:"blob",data:{name:E.curDeviceModel.name}};Y(e).then((e=>{if(e&&"1"===e.code)return void be(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:S((()=>[A(h,{class:"el-input__icon"},{default:S((()=>[A(P(F))])),_:1}),sl])),_:1}),A(w,{type:"primary",bg:"",class:"right-btn",onClick:b[4]||(b[4]=e=>(console.log("addDeviceModelBlock"),E.pFlag=!0,void(E.pTitle="添加属性")))},{default:S((()=>[A(h,{class:"btn-icon"},{default:S((()=>[A(R,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),il])),_:1}),A(w,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:b[5]||(b[5]=e=>{O(1)})},{default:S((()=>[A(h,{class:"btn-icon"},{default:S((()=>[A(R,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),cl])),_:1}),A(w,{type:"danger",bg:"",class:"right-btn",onClick:b[6]||(b[6]=l=>(l=>{let t=[];0!==E.selectedProperties.length?(E.selectedProperties.forEach((e=>{t.push(e.name)})),console.log("pList",t),n.confirm("确认要删除这些命令吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:N.token,data:{tslName:E.curDeviceModel.name,names:t}};Q(e).then((e=>{he(e,O)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个命令！")})())},{default:S((()=>[A(h,{class:"btn-icon"},{default:S((()=>[A(R,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),ul])),_:1})])]),L("div",{class:"content",ref_key:"contentRef",ref:j},[A(J,{data:P(Z),"cell-style":P(E).cellStyle,"header-cell-style":P(E).headerCellStyle,"max-height":P(E).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:ge,onRowDblclick:ce},{empty:S((()=>[gl])),default:S((()=>[A(U,{type:"selection",width:"55"}),A(U,{prop:"name",label:"命令名称",width:"auto","min-width":"150",align:"center"}),A(U,{prop:"label",label:"命令标签",width:"auto","min-width":"150",align:"center"}),A(U,{label:"功能码",width:"auto","min-width":"150",align:"center"},{default:S((e=>[z(T(P(E).funCodeNames["f"+e.row.funCode]),1)])),_:1}),A(U,{prop:"startRegAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),A(U,{prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"100",align:"center"}),A(U,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:S((e=>[A(w,{onClick:l=>ce(e.row),text:"",type:"primary"},{default:S((()=>[pl])),_:2},1032,["onClick"]),A(w,{onClick:l=>ye(e.row),text:"",type:"success"},{default:S((()=>[ml])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",fl,[A(X,{"current-page":P(E).currentPage,"page-size":P(E).pagesize,"page-sizes":[20,50,200,500],total:P(ee).length,onCurrentChange:le,onSizeChange:te,background:"",layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])],512)]),P(E).porpFlag?(V(),B("div",yl,[A(Ke,{curModelBlock:P(E).curModelBlock},null,8,["curModelBlock"])])):G("",!0)]),A(ke,{modelValue:P(E).pFlag,"onUpdate:modelValue":b[14]||(b[14]=e=>P(E).pFlag=e),title:P(E).pTitle,width:"600px","before-close":me,"close-on-click-modal":!1},{footer:S((()=>[L("span",hl,[A(w,{onClick:b[12]||(b[12]=e=>pe())},{default:S((()=>[vl])),_:1}),A(w,{type:"primary",onClick:b[13]||(b[13]=e=>{ue.value.validate((e=>{if(!e)return!1;{const e={token:N.token,data:{tslName:E.curDeviceModel.name,name:E.blockForm.name,label:E.blockForm.label,funCode:E.blockForm.funCode,startRegAddr:E.blockForm.startRegAddr,regCnt:E.blockForm.regCnt}};E.pTitle.includes("添加")?$(e).then((e=>{he(e,O),pe()})):K(e).then((e=>{he(e,O),pe()}))}}))})},{default:S((()=>[_l])),_:1})])])),default:S((()=>[L("div",bl,[A(Fe,{model:P(E).blockForm,rules:P(E).propertyRules,ref_key:"blockFormRef",ref:ue,"status-icon":"","label-position":"right","label-width":"120px"},{default:S((()=>[A(fe,{label:"块名称",prop:"name"},{default:S((()=>[A(x,{disabled:P(E).pTitle.includes("编辑"),type:"text",modelValue:P(E).blockForm.name,"onUpdate:modelValue":b[7]||(b[7]=e=>P(E).blockForm.name=e),autocomplete:"off",placeholder:"请输入块名称"},null,8,["disabled","modelValue"])])),_:1}),A(fe,{label:"块标签",prop:"label"},{default:S((()=>[A(x,{type:"text",modelValue:P(E).blockForm.label,"onUpdate:modelValue":b[8]||(b[8]=e=>P(E).blockForm.label=e),autocomplete:"off",placeholder:"请输入块标签"},null,8,["modelValue"])])),_:1}),A(fe,{label:"功能码",prop:"funCode"},{default:S((()=>[A(_e,{modelValue:P(E).blockForm.funCode,"onUpdate:modelValue":b[9]||(b[9]=e=>P(E).blockForm.funCode=e),style:{width:"100%"},placeholder:"请选择功能码"},{default:S((()=>[(V(!0),B(I,null,q(P(E).funCodeOptions,(e=>(V(),H(ve,{key:"funCode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),A(fe,{label:"寄存器地址",prop:"startRegAddr"},{default:S((()=>[A(x,{type:"text",modelValue:P(E).blockForm.startRegAddr,"onUpdate:modelValue":b[10]||(b[10]=e=>P(E).blockForm.startRegAddr=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器地址"},null,8,["modelValue"])])),_:1}),A(fe,{label:"寄存器数量",prop:"regCnt"},{default:S((()=>[A(x,{type:"text",modelValue:P(E).blockForm.regCnt,"onUpdate:modelValue":b[11]||(b[11]=e=>P(E).blockForm.regCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器数量"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),A(ke,{modelValue:P(E).psFlag,"onUpdate:modelValue":b[15]||(b[15]=e=>P(E).psFlag=e),title:"导入命令",width:"600px","before-close":ie,"close-on-click-modal":!1},{footer:S((()=>[L("span",Cl,[A(w,{onClick:se},{default:S((()=>[wl])),_:1}),A(w,{type:"primary",onClick:ae},{default:S((()=>[Ml])),_:1})])])),default:S((()=>[A(Ce,{ref_key:"uploadDPSRef",ref:re,action:"","auto-upload":!1,"http-request":oe,limit:1,"on-exceed":de,"before-upload":ne},{tip:S((()=>[kl])),default:S((()=>[A(w,{type:"primary"},{default:S((()=>[Fl])),_:1})])),_:1},512)])),_:1},8,["modelValue"])],64)}}},[["__scopeId","data-v-76705292"]]);const Dl=e=>(N("data-v-1be20b88"),e=e(),R(),e),Vl={class:"main-container"},Bl={key:0,class:"main"},Ll={class:"title",style:{"justify-content":"space-between"}},Al=z(" 添加 "),Sl=z(" 刷新 "),Pl=z("变量详情"),Tl=z("命令详情"),zl=z("编辑"),Nl=z("删除"),Rl=Dl((()=>L("div",null,"无数据",-1))),Ul={class:"pagination"},jl={class:"dialog-content"},Il={class:"dialog-footer"},ql=z("取消"),Hl=z("保存");var El=y({setup(i){const c=b(),m=w(null),g=M({typeModel:2,showFlag:0,headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceModelInfo:"",tableData:[],modelForm:{name:"",label:"",type:0,param:""},modelRules:{name:[{required:!0,message:"采集模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"采集模型标识不能为空",trigger:"blur"}],param:[{required:!0,message:"采集模型插件不能为空",trigger:"blur"}]},udFlag:!1,dmFlag:!1,dmTitle:"添加采集模型",pluginList:[],curDeviceModel:""}),f=l=>{const t={token:c.token,data:{type:g.typeModel}};v.getDeviceModelList(t).then((async t=>{t&&("0"===t.code?(g.tableData=t.data,1===l&&e({type:"success",message:"刷新成功！"})):q(t),await U((()=>{g.tableMaxHeight=m.value.clientHeight-34-36-22})))}))};f();const y=x((()=>g.tableData.filter((e=>{var l=!g.deviceModelInfo,t=e.name.toLowerCase().includes(g.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(g.deviceModelInfo.toLowerCase());return l||t})).slice((g.currentPage-1)*g.pagesize,g.currentPage*g.pagesize))),_=x((()=>g.tableData.filter((e=>{var l=!g.deviceModelInfo,t=e.name.toLowerCase().includes(g.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(g.deviceModelInfo.toLowerCase());return l||t})))),F=e=>{g.currentPage=e},C=e=>{g.pagesize=e},T=e=>{g.dmFlag=!0,g.dmTitle="编辑采集模型",g.modelForm={name:e.name,label:e.label,type:void 0===e.type?0:e.type,param:e.param}},z=w(null),N=()=>{g.dmFlag=!1,z.value.resetFields(),j()},R=()=>{N()},j=()=>{g.modelForm={name:"",label:"",type:0}},I=()=>{g.showFlag=0},q=l=>{e({type:"error",message:l.message})},E=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(i,b)=>{const h=l,w=a,M=D("Icon"),x=t,U=o,j=r,q=d,O=s,W=u,J=p;return V(),B("div",Vl,[0===P(g).showFlag?(V(),B("div",Bl,[L("div",Ll,[A(w,{style:{width:"200px"},placeholder:"请输入采集模型名称",modelValue:P(g).deviceModelInfo,"onUpdate:modelValue":b[0]||(b[0]=e=>P(g).deviceModelInfo=e)},{prefix:S((()=>[A(h,{class:"el-input__icon"},{default:S((()=>[A(P(k))])),_:1})])),_:1},8,["modelValue"]),L("div",null,[A(x,{type:"primary",bg:"",class:"right-btn",onClick:b[1]||(b[1]=e=>(g.dmFlag=!0,void(g.dmTitle="添加采集模型")))},{default:S((()=>[A(h,{class:"btn-icon"},{default:S((()=>[A(M,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),Al])),_:1}),A(x,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:b[2]||(b[2]=e=>{f(1)})},{default:S((()=>[A(h,{class:"btn-icon"},{default:S((()=>[A(M,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),Sl])),_:1})])]),L("div",{class:"content",ref_key:"contentRef",ref:m},[A(j,{data:P(y),"cell-style":P(g).cellStyle,"header-cell-style":P(g).headerCellStyle,"max-height":P(g).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:T},{empty:S((()=>[Rl])),default:S((()=>[A(U,{prop:"name",label:"采集模型名称",width:"auto","min-width":"200",align:"center"}),A(U,{prop:"label",label:"采集模型标签",width:"auto","min-width":"200",align:"center"}),A(U,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:S((l=>[A(x,{onClick:e=>{return t=l.row,g.curDeviceModel=t,void(g.showFlag=1);var t},text:"",type:"success"},{default:S((()=>[Pl])),_:2},1032,["onClick"]),A(x,{onClick:e=>{return t=l.row,g.curDeviceModel=t,void(g.showFlag=2);var t},text:"",type:"success"},{default:S((()=>[Tl])),_:2},1032,["onClick"]),A(x,{onClick:e=>T(l.row),text:"",type:"primary"},{default:S((()=>[zl])),_:2},1032,["onClick"]),A(x,{onClick:t=>{return a=l.row,void n.confirm("确定要删除这个采集模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:c.token,data:{name:a.name,type:2}};v.deleteDeviceModel(e).then((e=>{E(e,f)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var a},text:"",type:"danger"},{default:S((()=>[Nl])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",Ul,[A(q,{"current-page":P(g).currentPage,"page-size":P(g).pagesize,"page-sizes":[20,50,200,500],total:P(_).length,onCurrentChange:F,onSizeChange:C,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):G("",!0),1===P(g).showFlag?(V(),H(he,{key:1,curDeviceModel:P(g).curDeviceModel,onChangeShowFlag:b[3]||(b[3]=e=>I())},null,8,["curDeviceModel"])):G("",!0),2===P(g).showFlag?(V(),H(xl,{key:2,curDeviceModel:P(g).curDeviceModel,deviceModelList:P(g).tableData,onChangeShowFlag:b[4]||(b[4]=e=>I())},null,8,["curDeviceModel","deviceModelList"])):G("",!0),A(J,{modelValue:P(g).dmFlag,"onUpdate:modelValue":b[9]||(b[9]=e=>P(g).dmFlag=e),title:P(g).dmTitle,width:"600px","before-close":R,"close-on-click-modal":!1},{footer:S((()=>[L("span",Il,[A(x,{onClick:b[7]||(b[7]=e=>N())},{default:S((()=>[ql])),_:1}),A(x,{type:"primary",onClick:b[8]||(b[8]=e=>{z.value.validate((e=>{if(!e)return!1;{g.modelForm.type=g.typeModel;const e={token:c.token,data:g.modelForm};g.dmTitle.includes("添加")?v.addDeviceModel(e).then((e=>{E(e,f),N()})):v.editDeviceModel(e).then((e=>{E(e,f),N()}))}}))})},{default:S((()=>[Hl])),_:1})])])),default:S((()=>[L("div",jl,[A(W,{model:P(g).modelForm,rules:P(g).modelRules,ref_key:"modelFormRef",ref:z,"status-icon":"","label-position":"right","label-width":"120px"},{default:S((()=>[A(O,{label:"采集模型名称",prop:"name"},{default:S((()=>[A(w,{type:"text",disabled:P(g).dmTitle.includes("编辑"),modelValue:P(g).modelForm.name,"onUpdate:modelValue":b[5]||(b[5]=e=>P(g).modelForm.name=e),autocomplete:"off",placeholder:"请输入采集模型名称"},null,8,["disabled","modelValue"])])),_:1}),A(O,{label:"采集模型标签",prop:"label"},{default:S((()=>[A(w,{type:"text",modelValue:P(g).modelForm.label,"onUpdate:modelValue":b[6]||(b[6]=e=>P(g).modelForm.label=e),autocomplete:"off",placeholder:"请输入采集模型标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-1be20b88"]]);export{El as default};
