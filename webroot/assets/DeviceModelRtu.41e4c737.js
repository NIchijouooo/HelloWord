import{g as e,e as l,p as t,n as a,o,m as r,A as d,C as n,D as s,L as i,v as c,w as u,q as p,M as m,u as f}from"./element-plus.64650d13.js";import{s as g,_ as b,u as y,v as h}from"./index.98f42e56.js";import{D as v}from"./deviceModel.a85a7758.js";import{I as _,M as F,J as k,L as C}from"./@element-plus.aa3ef65f.js";import{f as w,Y as x,p as M,X as D,o as V,c as B,a as L,S as A,Q as S,u as P,U as z,a0 as T,at as R,au as N,H as U,h as j,M as I,af as q,P as H,J as E,K as O,L as G,O as W}from"./@vue.5db09832.js";import{u as J}from"./vue-router.d969f71f.js";import"./@vueuse.af8df401.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./pinia.69c74452.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./vue-echarts.8f00425b.js";import"./resize-detector.4e96b72b.js";import"./echarts.62a08783.js";import"./zrender.56caf4f2.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";var $=e=>g.request({url:"/tsl/modbus/cmd",method:"get",data:e}),K=e=>g.request({url:"/tsl/modbus/cmd",method:"post",data:e}),Q=e=>g.request({url:"/tsl/modbus/cmd",method:"put",data:e}),X=e=>g.request({url:"/tsl/modbus/cmd",method:"delete",data:e}),Y=e=>g.request({url:"/tsl/modbus/block/xlsx",method:"post",data:e}),Z=e=>g.request({url:"/tsl/modbus/block/xlsx",method:"get",data:e}),ee=e=>g.request({url:"/tsl/modbus/cmd/params",method:"get",data:e}),le=e=>g.request({url:"/tsl/modbus/cmd/param",method:"post",data:e}),te=e=>g.request({url:"/tsl/modbus/cmd/param",method:"put",data:e}),ae=e=>g.request({url:"/tsl/modbus/cmd/params",method:"delete",data:e}),oe=e=>g.request({url:"/tsl/modbus/cmd/param/xlsx",method:"post",data:e}),re=e=>g.request({url:"/tsl/modbus/cmd/param/xlsx",method:"get",data:e});const de=e=>(R("data-v-b367b7fa"),e=e(),N(),e),ne={class:"main-container"},se={class:"main"},ie={class:"search-bar"},ce=T(" 返回设备模型 "),ue=T(" 导出模型属性 "),pe={class:"search-bar",style:{display:"flex"}},me={class:"title",style:{position:"relative","margin-right":"40px",height:"40px",padding:"0px 0","justify-content":"flex-start"}},fe={class:"tName"},ge=T(" 刷新 "),be=T(" 序号 "),ye=de((()=>L("div",null,"无数据",-1))),he={class:"pagination"};var ve=b({props:{curDeviceModel:{type:Object,default:{}}},emits:["changeShowFlag"],setup(i,{emit:c}){const u=i,p=y();console.log("id -> props",u);const m=w(null),f=x({headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,dbNumber:"",startAddr:"",dataType:0,unit:"",decimals:0},psFlag:!1,selectedProperties:[]}),g=l=>{const t={token:p.token,data:{name:u.curDeviceModel.name}};v.getDeviceModelProperty(t).then((async t=>{console.log("getDeviceModelProperty -> res",t),t&&("0"===t.code?(f.propertyList=t.data,1===l&&e({type:"success",message:"刷新成功！"})):j(t),await U((()=>{f.tableMaxHeight=m.value.clientHeight-34-36-132})))}))};g();const b=M((()=>(console.log("ctxData.propertyList ->",f.propertyList),f.propertyList.filter((e=>{var l=!f.deviceModelProperty,t=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||t})).slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize)))),C=M((()=>f.propertyList.filter((e=>{var l=!f.deviceModelProperty,t=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||t})))),R=e=>{f.currentPage=e},N=e=>{f.pagesize=e},j=l=>{e({type:"error",message:l.message})};return(e,i)=>{const y=l,h=t,w=a,x=o,M=r,U=D("Icon"),I=d,q=n,H=s;return V(),B("div",ne,[L("div",se,[L("div",ie,[A(x,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:S((()=>[A(w,{style:{"margin-left":"20px"}},{default:S((()=>[A(h,{type:"primary",plain:"",onClick:i[0]||(i[0]=e=>(console.log("toDeviceModel"),void c("changeShowFlag")))},{default:S((()=>[A(y,{class:"el-input__icon"},{default:S((()=>[A(P(_))])),_:1}),ce])),_:1})])),_:1}),A(w,null,{default:S((()=>[A(h,{type:"primary",plain:"",class:"right-btn",onClick:i[1]||(i[1]=e=>(()=>{console.log("exportDPS");const e={token:p.token,responseType:"blob",data:{name:u.curDeviceModel.name}};v.exportDeviceModelProptyAndService(e).then((e=>{if(e&&"1"===e.code)return void j(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:S((()=>[A(y,{class:"el-input__icon"},{default:S((()=>[A(P(F))])),_:1}),ue])),_:1})])),_:1})])),_:1},512)]),L("div",pe,[L("div",me,[L("div",fe,z(u.curDeviceModel.label)+"：属性列表",1)]),A(x,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:S((()=>[A(w,{label:""},{default:S((()=>[A(M,{style:{width:"200px"},placeholder:"请输入属性名称",modelValue:P(f).deviceModelProperty,"onUpdate:modelValue":i[2]||(i[2]=e=>P(f).deviceModelProperty=e)},{prefix:S((()=>[A(y,{class:"el-input__icon"},{default:S((()=>[A(P(k))])),_:1})])),_:1},8,["modelValue"])])),_:1}),A(w,null,{default:S((()=>[A(h,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:i[3]||(i[3]=e=>{g(1)})},{default:S((()=>[A(y,{class:"btn-icon"},{default:S((()=>[A(U,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),ge])),_:1})])),_:1})])),_:1},512)]),L("div",{class:"content",ref_key:"contentRef",ref:m},[A(q,{data:P(b),"cell-style":P(f).cellStyle,"header-cell-style":P(f).headerCellStyle,style:{width:"100%"},"max-height":P(f).tableMaxHeight,stripe:""},{empty:S((()=>[ye])),default:S((()=>[A(I,{type:"index",width:"60"},{header:S((()=>[be])),_:1}),A(I,{prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),A(I,{prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),A(I,{label:"读写属性",width:"auto","min-width":"80",align:"center"},{default:S((e=>[T(z(P(f).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),A(I,{prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:S((e=>[T(z(P(f).typeNames["t"+e.row.type]),1)])),_:1}),A(I,{label:"小数位数",width:"auto","min-width":"80",align:"center"},{default:S((e=>[T(z(""===e.row.decimals?0:e.row.decimals),1)])),_:1}),A(I,{prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),A(I,{prop:"regAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),A(I,{prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"120",align:"center"}),A(I,{prop:"ruleType",label:"解析规则",width:"auto","min-width":"120",align:"center"})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",he,[A(H,{"current-page":P(f).currentPage,"page-size":P(f).pagesize,"page-sizes":[20,50,200,500],total:P(C).length,onCurrentChange:R,onSizeChange:N,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])])}}},[["__scopeId","data-v-b367b7fa"]]);const _e=e=>(R("data-v-581c1284"),e=e(),N(),e),Fe={class:"main-container"},ke={style:{display:"flex","justify-content":"space-between"}},Ce={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},we={class:"tName"},xe={class:"search-bar",style:{"text-align":"right"}},Me=T(" 导入命令参数 "),De=T(" 导出命令参数 "),Ve=T(" 添加 "),Be=T(" 刷新 "),Le=T(" 删除 "),Ae=T("编辑"),Se=_e((()=>L("div",null,"无数据",-1))),Pe={class:"pagination"},ze={class:"dialog-content"},Te=T("编辑"),Re=_e((()=>L("div",{class:"form-title"},[L("div",{class:"tName"},"配置参数")],-1))),Ne={class:"dialog-footer"},Ue=T("取消"),je=T("保存"),Ie={class:"dialog-content"},qe={style:{width:"100%"}},He={style:{"padding-right":"10px"}},Ee={class:"dialog-footer"},Oe=T("取消"),Ge=T("保存"),We=T("选择文件"),Je=_e((()=>L("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),$e={class:"dialog-footer"},Ke=T("取消"),Qe=T("上传");var Xe=b({props:{curModelBlock:{type:Object,default:{}}},emits:["changeBShowFlag"],setup(f,{emit:g}){const b=f,_=y(),R=/^[0-9]*[1-9][0-9]*$/,N=w(null),W=x({formulaForm:{},headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",accessModeOptions:[{label:"只读",value:0},{label:"只写",value:1},{label:"读写",value:2}],typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},regCntOptions:[{label:1,value:1},{label:2,value:2},{label:4,value:4}],pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,regCnt:1,regAddr:null,ruleType:"Int_AB",unit:"",decimals:0,formula:""},ruleTypeOptions:{rt1:[{label:"Int_AB",value:"Int_AB"},{label:"Int_BA",value:"Int_BA"}],rt2:[{label:"Long_ABCD",value:"Long_ABCD"},{label:"Long_BADC",value:"Long_BADC"},{label:"Long_DCBA",value:"Long_DCBA"},{label:"Long_CDAB",value:"Long_CDAB"},{label:"Float_ABCD",value:"Float_ABCD"},{label:"Float_BADC",value:"Float_BADC"},{label:"Float_DCBA",value:"Float_DCBA"},{label:"Float_CDAB",value:"Float_CDAB"}],rt4:[{label:"Double_ABCDEFGH",value:"Double_ABCDEFGH"},{label:"Double_GHEFCDAB",value:"Double_GHEFCDAB"},{label:"Double_BADCFEHG",value:"Double_BADCFEHG"},{label:"Double_HGFEDCBA",value:"Double_HGFEDCBA"}]},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",decimals:"小数位数",regCnt:"寄存器数量",ruleType:"解析规则",regAddr:"寄存器地址",formula:"计算公式"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],accessMode:[{required:!0,message:"读写属性不能为空",trigger:"blur"}],type:[{required:!0,message:"属性类型不能为空",trigger:"blur"}],ruleType:[{required:!0,message:"解析规则不能为空",trigger:"blur"}],decimals:[{type:"number",message:"小数位数只能输入数字"}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{R.test(l)?t():t(new Error("只能输入正整数数字！"))}}],regAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{0===l||R.test(l)?t():t(new Error("只能输入自然数！"))}}]},psFlag:!1,selectedProperties:[],fFlag:!1,propertyInfo:[],operationList:[{name:"+",label:"+",describe:"加"},{name:"-",label:"-",describe:"减"},{name:"*",label:"*",describe:"乘"},{name:"/",label:"/",describe:"除"},{name:"%",label:"%",describe:"模"},{name:"^",label:"^",describe:"次幂"},{name:"(",label:"(",describe:"左括号"},{name:")",label:")",describe:"右括号"}],curFormula:"",selectionStart:0,pItem:""}),J=l=>{const t={token:_.token,data:{tslName:b.curModelBlock.tslName,cmdName:b.curModelBlock.name}};ee(t).then((async t=>{t&&("0"===t.code?(W.propertyList=null==t.data?[]:t.data,1===l&&e({type:"success",message:"刷新成功！"})):ve(t),await U((()=>{W.tableMaxHeight=N.value.clientHeight-34-22-82})))}))};J();const $=M((()=>W.propertyList.filter((e=>{var l=!W.deviceModelProperty,t=e.name.toLowerCase().includes(W.deviceModelProperty.toLowerCase());return l||t})).slice((W.currentPage-1)*W.pagesize,W.currentPage*W.pagesize))),K=M((()=>W.propertyList.filter((e=>{var l=!W.deviceModelProperty,t=e.name.toLowerCase().includes(W.deviceModelProperty.toLowerCase());return l||t})))),Q=e=>{W.currentPage=e},X=e=>{W.pagesize=e},Y=()=>{de.value&&de.value.submit()},Z=e=>{},de=w(null),ne=e=>{de.value.clearFiles();const l=e[0];de.value.handleStart(l)},se=l=>{let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("tslName",b.curModelBlock.tslName),t.append("cmdName",b.curModelBlock.name),t.append("fileName",l);const a={token:_.token,contentType:"multipart/form-data",data:t};oe(a).then((l=>{"0"===l.code?(e.success(l.message),W.psFlag=!1,J()):ve(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ie=()=>{W.psFlag=!1,uploadRef.value.clearFiles()},ce=()=>{ie()},ue=e=>{W.pFlag=!0,W.pTitle="编辑属性",W.propertyForm.name=e.name,W.propertyForm.label=e.label,W.propertyForm.accessMode=e.accessMode,W.propertyForm.type=e.type,W.propertyForm.decimals=e.decimals,W.propertyForm.unit=e.unit,W.propertyForm.regCnt=e.regCnt,W.propertyForm.regAddr=e.regAddr,W.propertyForm.ruleType=e.ruleType,W.propertyForm.formula=void 0===e.formula||null===e.formula?"":e.formula},pe=w(null),me=()=>{W.pFlag=!1,pe.value.resetFields(),be()},fe=e=>{me()},ge=e=>{W.selectedProperties=e},be=()=>{W.propertyForm={name:"",label:"",accessMode:0,type:0,decimals:0,unit:"",regCnt:1,regAddr:null,ruleType:"Int_AB",formula:""}},ye=()=>{W.fFlag=!0,W.curFormula=W.propertyForm.formula,(()=>{const e={token:_.token,data:{name:b.curModelBlock.tslName}};v.getDeviceModelProperty(e).then((e=>{e&&("0"===e.code?(W.propertyInfo=[{name:"t",label:"当前属性"}],e.data.forEach((e=>{W.propertyInfo.push({name:e.name,label:e.label})}))):ve(e))}))})()},he=e=>{W.selectionStart=e.srcElement.selectionStart},ve=l=>{e({type:"error",message:l.message})},_e=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return j((()=>b.curModelBlock),((e,l)=>{J()})),(f,g)=>{const y=l,h=r,v=a,w=t,x=D("Icon"),M=o,R=d,U=n,j=s,ee=c,oe=u,be=p,Xe=m;return V(),B("div",Fe,[L("div",ke,[L("div",Ce,[L("div",we,z(b.curModelBlock.label)+"：命令参数列表",1)]),L("div",xe,[A(M,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:S((()=>[A(v,{style:{"margin-left":"20px"}},{default:S((()=>[A(h,{style:{width:"200px"},placeholder:"请输入命令参数名称",modelValue:P(W).deviceModelProperty,"onUpdate:modelValue":g[0]||(g[0]=e=>P(W).deviceModelProperty=e)},{prefix:S((()=>[A(y,{class:"el-input__icon"},{default:S((()=>[A(P(k))])),_:1})])),_:1},8,["modelValue"])])),_:1}),A(v,null,{default:S((()=>[A(w,{type:"primary",plain:"",class:"right-btn",onClick:g[1]||(g[1]=e=>{W.psFlag=!0})},{default:S((()=>[A(y,{class:"el-input__icon"},{default:S((()=>[A(P(C))])),_:1}),Me])),_:1})])),_:1}),A(v,null,{default:S((()=>[A(w,{type:"primary",plain:"",class:"right-btn",onClick:g[2]||(g[2]=e=>(()=>{const e={token:_.token,responseType:"blob",data:{tslName:b.curModelBlock.tslName,cmdName:b.curModelBlock.name}};re(e).then((e=>{if(e&&"1"===e.code)return void ve(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:S((()=>[A(y,{class:"el-input__icon"},{default:S((()=>[A(P(F))])),_:1}),De])),_:1})])),_:1}),A(v,null,{default:S((()=>[A(w,{type:"primary",bg:"",class:"right-btn",onClick:g[3]||(g[3]=e=>(W.pFlag=!0,void(W.pTitle="添加属性")))},{default:S((()=>[A(y,{class:"btn-icon"},{default:S((()=>[A(x,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),Ve])),_:1})])),_:1}),A(v,null,{default:S((()=>[A(w,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:g[4]||(g[4]=e=>{J(1)})},{default:S((()=>[A(y,{class:"btn-icon"},{default:S((()=>[A(x,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),Be])),_:1})])),_:1}),A(v,null,{default:S((()=>[A(w,{type:"danger",bg:"",class:"right-btn",onClick:g[5]||(g[5]=l=>(l=>{let t=[];0!==W.selectedProperties.length?(W.selectedProperties.forEach((e=>{t.push(e.name)})),i.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:_.token,data:{tslName:b.curModelBlock.tslName,cmdName:b.curModelBlock.name,propertyNames:t}};ae(e).then((e=>{_e(e,J)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:S((()=>[A(y,{class:"btn-icon"},{default:S((()=>[A(x,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),Le])),_:1})])),_:1})])),_:1},512)])]),L("div",{class:"content",ref_key:"contentRef",ref:N},[A(U,{data:P($),"cell-style":P(W).cellStyle,"header-cell-style":P(W).headerCellStyle,style:{width:"100%"},stripe:"","max-height":P(W).tableMaxHeight,onSelectionChange:ge,onRowDblclick:ue},{empty:S((()=>[Se])),default:S((()=>[A(R,{type:"selection",width:"55"}),A(R,{prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),A(R,{prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),A(R,{label:"读写属性",width:"auto","min-width":"80",align:"center"},{default:S((e=>[T(z(P(W).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),A(R,{prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:S((e=>[T(z(P(W).typeNames["t"+e.row.type]),1)])),_:1}),A(R,{label:"小数位数",width:"auto","min-width":"80",align:"center"},{default:S((e=>[T(z(""===e.row.decimals?0:e.row.decimals),1)])),_:1}),A(R,{prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),A(R,{prop:"regAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),A(R,{prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"120",align:"center"}),A(R,{prop:"ruleType",label:"解析规则",width:"auto","min-width":"120",align:"center"}),A(R,{prop:"formula",label:"计算公式",width:"auto","min-width":"200",align:"center"}),A(R,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:S((e=>[A(w,{onClick:l=>ue(e.row),text:"",type:"primary"},{default:S((()=>[Ae])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",Pe,[A(j,{"current-page":P(W).currentPage,"page-size":P(W).pagesize,"page-sizes":[20,50,200,500],total:P(K).length,onCurrentChange:Q,onSizeChange:X,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),A(be,{modelValue:P(W).pFlag,"onUpdate:modelValue":g[21]||(g[21]=e=>P(W).pFlag=e),title:P(W).pTitle,width:"800px","before-close":fe,"close-on-click-modal":!1},{footer:S((()=>[L("span",Ne,[A(w,{onClick:g[19]||(g[19]=e=>me())},{default:S((()=>[Ue])),_:1}),A(w,{type:"primary",onClick:g[20]||(g[20]=e=>{pe.value.validate((e=>{if(!e)return!1;{const e={token:_.token,data:{tslName:b.curModelBlock.tslName,cmdName:b.curModelBlock.name,name:W.propertyForm.name,label:W.propertyForm.label,accessMode:W.propertyForm.accessMode,type:W.propertyForm.type,decimals:W.propertyForm.decimals,unit:W.propertyForm.unit,regCnt:W.propertyForm.regCnt,regAddr:W.propertyForm.regAddr,ruleType:W.propertyForm.ruleType,formula:W.propertyForm.formula}};W.pTitle.includes("添加")?le(e).then((e=>{_e(e,J),me()})):te(e).then((e=>{_e(e,J),me()}))}}))})},{default:S((()=>[je])),_:1})])])),default:S((()=>[L("div",ze,[A(M,{model:P(W).propertyForm,rules:P(W).propertyRules,ref_key:"propertyFormRef",ref:pe,"status-icon":"","label-position":"right","label-width":"120px",inline:!0},{default:S((()=>[A(v,{label:"属性名称",prop:"name"},{default:S((()=>[A(h,{style:{width:"220px"},disabled:P(W).pTitle.includes("编辑"),type:"text",modelValue:P(W).propertyForm.name,"onUpdate:modelValue":g[6]||(g[6]=e=>P(W).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),A(v,{label:"属性标签",prop:"label"},{default:S((()=>[A(h,{style:{width:"220px"},type:"text",modelValue:P(W).propertyForm.label,"onUpdate:modelValue":g[7]||(g[7]=e=>P(W).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),A(v,{label:"读写属性",prop:"accessMode"},{default:S((()=>[A(oe,{modelValue:P(W).propertyForm.accessMode,"onUpdate:modelValue":g[8]||(g[8]=e=>P(W).propertyForm.accessMode=e),style:{width:"220px"},placeholder:"请选择读写属性"},{default:S((()=>[(V(!0),B(I,null,q(P(W).accessModeOptions,(e=>(V(),H(ee,{key:"accessMode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),A(v,{label:"单位",prop:"unit"},{default:S((()=>[A(h,{style:{width:"220px"},type:"text",modelValue:P(W).propertyForm.unit,"onUpdate:modelValue":g[9]||(g[9]=e=>P(W).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1}),A(v,{label:"属性类型",prop:"type"},{default:S((()=>[A(oe,{modelValue:P(W).propertyForm.type,"onUpdate:modelValue":g[10]||(g[10]=e=>P(W).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择属性类型"},{default:S((()=>[(V(!0),B(I,null,q(P(W).typeOptions,(e=>(V(),H(ee,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),A(v,{label:"计算公式",prop:"formula"},{default:S((()=>[A(h,{style:{width:"220px"},type:"text",readonly:"",modelValue:P(W).propertyForm.formula,"onUpdate:modelValue":g[12]||(g[12]=e=>P(W).propertyForm.formula=e),autocomplete:"off",placeholder:"请编辑计算公式"},{append:S((()=>[A(w,{onClick:g[11]||(g[11]=e=>ye())},{default:S((()=>[Te])),_:1})])),_:1},8,["modelValue"])])),_:1}),E(A(v,{label:"小数位数",prop:"decimals"},{default:S((()=>[A(h,{style:{width:"220px"},type:"text",modelValue:P(W).propertyForm.decimals,"onUpdate:modelValue":g[13]||(g[13]=e=>P(W).propertyForm.decimals=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入小数位数"},null,8,["modelValue"])])),_:1},512),[[O,2===P(W).propertyForm.type]]),Re,A(v,{label:"寄存器地址",prop:"regAddr"},{default:S((()=>[A(h,{type:"text",style:{width:"220px"},modelValue:P(W).propertyForm.regAddr,"onUpdate:modelValue":g[14]||(g[14]=e=>P(W).propertyForm.regAddr=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器地址"},null,8,["modelValue"])])),_:1}),1!=b.curModelBlock.funCode?(V(),H(v,{key:0,label:"",prop:"",style:{width:"220px"}})):G("",!0),A(v,{label:"寄存器数量",prop:"regCnt"},{default:S((()=>[1==b.curModelBlock.funCode?(V(),H(h,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:P(W).propertyForm.regCnt,"onUpdate:modelValue":g[15]||(g[15]=e=>P(W).propertyForm.regCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器数量"},null,8,["modelValue"])):(V(),H(oe,{key:1,modelValue:P(W).propertyForm.regCnt,"onUpdate:modelValue":g[16]||(g[16]=e=>P(W).propertyForm.regCnt=e),modelModifiers:{number:!0},style:{width:"220px"},onChange:g[17]||(g[17]=e=>(()=>{const e=W.propertyForm.regCnt;1===e&&(W.propertyForm.ruleType="Int_AB"),2===e&&(W.propertyForm.ruleType="Long_ABCD"),4===e&&(W.propertyForm.ruleType="Double_ABCDEFGH")})()),placeholder:"请选择寄存器数量"},{default:S((()=>[(V(!0),B(I,null,q(P(W).regCntOptions,(e=>(V(),H(ee,{key:"regCount_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),1!=b.curModelBlock.funCode?(V(),H(v,{key:1,label:"解析规则",prop:"ruleType"},{default:S((()=>[A(oe,{modelValue:P(W).propertyForm.ruleType,"onUpdate:modelValue":g[18]||(g[18]=e=>P(W).propertyForm.ruleType=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择解析规则"},{default:S((()=>[(V(!0),B(I,null,q(P(W).ruleTypeOptions["rt"+P(W).propertyForm.regCnt],(e=>(V(),H(ee,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):G("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),A(be,{modelValue:P(W).fFlag,"onUpdate:modelValue":g[27]||(g[27]=e=>P(W).fFlag=e),title:"编辑计算公式",width:"600px"},{footer:S((()=>[L("span",Ee,[A(w,{onClick:g[25]||(g[25]=e=>(W.fFlag=!1,void(W.curFormula="")))},{default:S((()=>[Oe])),_:1}),A(w,{type:"primary",onClick:g[26]||(g[26]=e=>(W.fFlag=!1,void(W.propertyForm.formula=W.curFormula)))},{default:S((()=>[Ge])),_:1})])])),default:S((()=>[L("div",Ie,[A(M,{model:P(W).formulaForm,"label-position":"right","label-width":"120px"},{default:S((()=>[A(v,{label:"运算符号"},{default:S((()=>[L("div",qe,[(V(!0),B(I,null,q(P(W).operationList,((e,l)=>(V(),B("div",{key:l,class:"operation"},[L("div",He,[A(w,{style:{width:"100%"},onClick:l=>(e=>{let l=W.curFormula.length;if(l!==W.selectionStart){let t=W.curFormula.substr(0,W.selectionStart),a=W.curFormula.substr(W.selectionStart,l-W.selectionStart);W.curFormula=t+e.name+a,W.selectionStart+=e.name.length}else W.curFormula+=e.name,W.selectionStart+=e.name.length})(e)},{default:S((()=>[T(z(e.label),1)])),_:2},1032,["onClick"])])])))),128))])])),_:1}),A(v,{label:"设备属性"},{default:S((()=>[A(oe,{modelValue:P(W).pItem,"onUpdate:modelValue":g[22]||(g[22]=e=>P(W).pItem=e),filterable:"",placeholder:"请选择设备属性",onChange:g[23]||(g[23]=e=>(e=>{let l=W.curFormula.length;if(l!==W.selectionStart){let t=W.curFormula.substr(0,W.selectionStart),a=W.curFormula.substr(W.selectionStart,l-W.selectionStart);W.curFormula=t+"("+e+")"+a,W.selectionStart+=e.length+2}else W.curFormula+="("+e+")",W.selectionStart+=e.length+2})(P(W).pItem)),style:{width:"100%"}},{default:S((()=>[(V(!0),B(I,null,q(P(W).propertyInfo,(e=>(V(),H(ee,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),A(v,{label:"当前公式"},{default:S((()=>[A(h,{type:"text",clearable:"",modelValue:P(W).curFormula,"onUpdate:modelValue":g[24]||(g[24]=e=>P(W).curFormula=e),autocomplete:"off",placeholder:"请编辑计算公式",onBlur:he},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),A(be,{modelValue:P(W).psFlag,"onUpdate:modelValue":g[28]||(g[28]=e=>P(W).psFlag=e),title:"导入命令参数",width:"600px","before-close":ce,"close-on-click-modal":!1},{footer:S((()=>[L("span",$e,[A(w,{onClick:ie},{default:S((()=>[Ke])),_:1}),A(w,{type:"primary",onClick:Y},{default:S((()=>[Qe])),_:1})])])),default:S((()=>[A(Xe,{ref_key:"uploadDPSRef",ref:de,action:"","auto-upload":!1,"http-request":Z,limit:1,"on-exceed":ne,"before-upload":se},{tip:S((()=>[Je])),default:S((()=>[A(w,{type:"primary"},{default:S((()=>[We])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-581c1284"]]);const Ye=e=>(R("data-v-46c88d4f"),e=e(),N(),e),Ze={class:"main-container"},el={class:"main"},ll={class:"mc-left"},tl={class:"title"},al=T(" 返回设备模型 "),ol={class:"mcl-content"},rl={class:"mclc-content"},dl={class:"mc-right"},nl={class:"mcr-top"},sl={style:{display:"flex","justify-content":"space-between"}},il={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},cl={class:"tName"},ul={class:"search-bar",style:{"text-align":"right"}},pl=T(" 导入命令 "),ml=T(" 导出命令 "),fl=T(" 添加 "),gl=T(" 刷新 "),bl=T(" 删除 "),yl=T("编辑"),hl=T("命令参数详情"),vl=Ye((()=>L("div",null,"无数据",-1))),_l={class:"pagination"},Fl={key:0,class:"mcr-bottom"},kl={class:"dialog-content"},Cl={class:"dialog-footer"},wl=T("取消"),xl=T("保存"),Ml=T("选择文件"),Dl=Ye((()=>L("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),Vl={class:"dialog-footer"},Bl=T("取消"),Ll=T("上传");var Al=b({props:{curDeviceModel:{type:Object,default:{}},deviceModelList:{type:Array,default:[]}},emits:["changeShowFlag"],setup(g,{emit:b}){const v=g,R=y();console.log("id -> props",v);const N=/^[0-9]*[1-9][0-9]*$/,j=w(null),E=x({curDeviceModel:v.curDeviceModel,headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelBlock:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],funCodeOptions:[{label:"01(读线圈状态)",value:1},{label:"02(读离散输入状态)",value:2},{label:"03(读保持寄存器)",value:3},{label:"04(读输入寄存器)",value:4},{label:"05(写单个线圈)",value:5},{label:"06(写单个保持寄存器)",value:6},{label:"15(写多个线圈)",value:15},{label:"16(写多个保持寄存器)",value:16}],funCodeNames:{f1:"01(读线圈状态)",f2:"02(读离散输入状态)",f3:"03(读保持寄存器)",f4:"04(读输入寄存器)",f5:"05(写单个线圈)",f6:"06(写单个保持寄存器)",f15:"15(写多个线圈)",f16:"16(写多个保持寄存器)"},dataTypeOptions:[{label:"uint8",value:0},{label:"int8",value:1},{label:"uint16",value:2},{label:"int16",value:3},{label:"uint32",value:4},{label:"int32",value:5},{label:"float",value:6},{label:"double",value:7}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},dataTypeNames:{dt0:"uint8",dt1:"int8",dt2:"uint16",dt3:"int16",dt4:"uint32",dt5:"int32",dt6:"float",dt7:"double"},pFlag:!1,pTitle:"添加属性",blockForm:{name:"",label:"",funCode:null,startRegAddr:0,regCnt:0},paramName:{name:"块名称",label:"块标签",funCode:"功能码",type:"属性类型",startRegAddr:"寄存器地址",regCnt:"寄存器数量"},propertyRules:{name:[{required:!0,message:"块名称不能为空",trigger:"blur"}],label:[{required:!0,message:"块标签不能为空",trigger:"blur"}],funCode:[{required:!0,message:"功能码不能为空",trigger:"blur"}],startRegAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{0===l||N.test(l)?t():t(new Error("只能输入自然数！"))}}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{N.test(l)?t():t(new Error("只能输入正整数数字！"))}}]},psFlag:!1,selectedProperties:[],curModelBlock:{},porpFlag:!1}),O=l=>{const t={token:R.token,data:{tslName:E.curDeviceModel.name}};$(t).then((async t=>{t&&("0"===t.code?(E.propertyList=t.data,E.propertyList.length>0?(E.curModelBlock=E.propertyList[0],E.curModelBlock.tslName=E.curDeviceModel.name,console.log("getDeviceModelBlock -> ctxData.curModelBlock",E.curModelBlock),E.porpFlag=!0):E.porpFlag=!1,1===l&&e({type:"success",message:"刷新成功！"})):ye(t),await U((()=>{E.tableMaxHeight=j.value.clientHeight-34-22-82,2===l&&be(E.curModelBlock)})))}))};O(2);const J=M((()=>(console.log("ctxData.propertyList ->",E.propertyList),E.propertyList.filter((e=>{var l=!E.deviceModelBlock,t=e.name.toLowerCase().includes(E.deviceModelBlock.toLowerCase());return l||t})).slice((E.currentPage-1)*E.pagesize,E.currentPage*E.pagesize)))),ee=M((()=>E.propertyList.filter((e=>{var l=!E.deviceModelBlock,t=e.name.toLowerCase().includes(E.deviceModelBlock.toLowerCase());return l||t})))),le=e=>{E.currentPage=e},te=e=>{E.pagesize=e},ae=()=>{re.value&&re.value.submit()},oe=e=>{},re=w(null),de=e=>{re.value.clearFiles();const l=e[0];re.value.handleStart(l)},ne=l=>{console.log("beforeUpload -> file",l);let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("name",E.curDeviceModel.name),t.append("fileName",l);const a={token:R.token,contentType:"multipart/form-data",data:t};Y(a).then((l=>{"0"===l.code?(e.success(l.message),E.psFlag=!1,O()):ye(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},se=()=>{E.psFlag=!1,uploadRef.value.clearFiles()},ie=()=>{se()},ce=e=>{E.pFlag=!0,E.pTitle="编辑属性",E.blockForm.name=e.name,E.blockForm.label=e.label,E.blockForm.funCode=e.funCode,E.blockForm.startRegAddr=e.startRegAddr,E.blockForm.regCnt=e.regCnt},ue=w(null),pe=()=>{E.pFlag=!1,ue.value.resetFields(),ge()},me=e=>{pe()},fe=e=>{E.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},ge=()=>{E.blockForm={name:"",label:"",funCode:null,startRegAddr:0,regCnt:0}},be=e=>{E.curModelBlock=e,E.curModelBlock.tslName=E.curDeviceModel.name},ye=l=>{e({type:"error",message:l.message})},he=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(g,y)=>{const h=l,w=t,x=f,M=r,N=a,U=D("Icon"),$=o,Y=d,ge=n,ve=s,_e=c,Fe=u,ke=p,Ce=m;return V(),B("div",Ze,[L("div",el,[L("div",ll,[L("div",tl,[A(w,{type:"primary",style:{width:"100%"},plain:"",onClick:y[0]||(y[0]=e=>{b("changeShowFlag")})},{default:S((()=>[A(h,{class:"el-input__icon"},{default:S((()=>[A(P(_))])),_:1}),al])),_:1})]),L("div",ol,[(V(!0),B(I,null,q(v.deviceModelList,((e,l)=>(V(),H(x,{key:"i"+l,shadow:"hover",class:W({"mclc-card":!0,activeModel:e.name==P(E).curDeviceModel.name}),onClick:l=>(e=>{E.curDeviceModel.name!=e.name&&(E.curDeviceModel=e,O())})(e)},{default:S((()=>[L("div",rl,[L("span",null,z(e.name),1)])])),_:2},1032,["class","onClick"])))),128))])]),L("div",dl,[L("div",nl,[L("div",sl,[L("div",il,[L("div",cl,z(P(E).curDeviceModel.label)+"：命令列表",1)]),L("div",ul,[A($,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:S((()=>[A(N,{style:{"margin-left":"20px"}},{default:S((()=>[A(M,{style:{width:"200px"},placeholder:"请输入命令名称",modelValue:P(E).deviceModelBlock,"onUpdate:modelValue":y[1]||(y[1]=e=>P(E).deviceModelBlock=e)},{prefix:S((()=>[A(h,{class:"el-input__icon"},{default:S((()=>[A(P(k))])),_:1})])),_:1},8,["modelValue"])])),_:1}),A(N,null,{default:S((()=>[A(w,{type:"primary",plain:"",class:"right-btn",onClick:y[2]||(y[2]=e=>(console.log("importDPS"),void(E.psFlag=!0)))},{default:S((()=>[A(h,{class:"el-input__icon"},{default:S((()=>[A(P(C))])),_:1}),pl])),_:1})])),_:1}),A(N,null,{default:S((()=>[A(w,{type:"primary",plain:"",class:"right-btn",onClick:y[3]||(y[3]=e=>(()=>{console.log("exportDPS");const e={token:R.token,responseType:"blob",data:{name:E.curDeviceModel.name}};Z(e).then((e=>{if(e&&"1"===e.code)return void ye(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:S((()=>[A(h,{class:"el-input__icon"},{default:S((()=>[A(P(F))])),_:1}),ml])),_:1})])),_:1}),A(N,null,{default:S((()=>[A(w,{type:"primary",bg:"",class:"right-btn",onClick:y[4]||(y[4]=e=>(console.log("addDeviceModelBlock"),E.pFlag=!0,void(E.pTitle="添加属性")))},{default:S((()=>[A(h,{class:"btn-icon"},{default:S((()=>[A(U,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),fl])),_:1})])),_:1}),A(N,null,{default:S((()=>[A(w,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:y[5]||(y[5]=e=>{O(1)})},{default:S((()=>[A(h,{class:"btn-icon"},{default:S((()=>[A(U,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),gl])),_:1})])),_:1}),A(N,null,{default:S((()=>[A(w,{type:"danger",bg:"",class:"right-btn",onClick:y[6]||(y[6]=l=>(l=>{let t=[];0!==E.selectedProperties.length?(E.selectedProperties.forEach((e=>{t.push(e.name)})),console.log("pList",t),i.confirm("确认要删除这些命令吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:R.token,data:{tslName:E.curDeviceModel.name,names:t}};X(e).then((e=>{he(e,O)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个命令！")})())},{default:S((()=>[A(h,{class:"btn-icon"},{default:S((()=>[A(U,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),bl])),_:1})])),_:1})])),_:1},512)])]),L("div",{class:"content",ref_key:"contentRef",ref:j},[A(ge,{data:P(J),"cell-style":P(E).cellStyle,"header-cell-style":P(E).headerCellStyle,"max-height":P(E).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:fe,onRowDblclick:ce},{empty:S((()=>[vl])),default:S((()=>[A(Y,{type:"selection",width:"55"}),A(Y,{prop:"name",label:"命令名称",width:"auto","min-width":"150",align:"center"}),A(Y,{prop:"label",label:"命令标签",width:"auto","min-width":"150",align:"center"}),A(Y,{label:"功能码",width:"auto","min-width":"150",align:"center"},{default:S((e=>[T(z(P(E).funCodeNames["f"+e.row.funCode]),1)])),_:1}),A(Y,{prop:"startRegAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),A(Y,{prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"100",align:"center"}),A(Y,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:S((e=>[A(w,{onClick:l=>ce(e.row),text:"",type:"primary"},{default:S((()=>[yl])),_:2},1032,["onClick"]),A(w,{onClick:l=>be(e.row),text:"",type:"success"},{default:S((()=>[hl])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",_l,[A(ve,{"current-page":P(E).currentPage,"page-size":P(E).pagesize,"page-sizes":[20,50,200,500],total:P(ee).length,onCurrentChange:le,onSizeChange:te,background:"",layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])],512)]),P(E).porpFlag?(V(),B("div",Fl,[A(Xe,{curModelBlock:P(E).curModelBlock},null,8,["curModelBlock"])])):G("",!0)]),A(ke,{modelValue:P(E).pFlag,"onUpdate:modelValue":y[14]||(y[14]=e=>P(E).pFlag=e),title:P(E).pTitle,width:"600px","before-close":me,"close-on-click-modal":!1},{footer:S((()=>[L("span",Cl,[A(w,{onClick:y[12]||(y[12]=e=>pe())},{default:S((()=>[wl])),_:1}),A(w,{type:"primary",onClick:y[13]||(y[13]=e=>{ue.value.validate((e=>{if(!e)return!1;{const e={token:R.token,data:{tslName:E.curDeviceModel.name,name:E.blockForm.name,label:E.blockForm.label,funCode:E.blockForm.funCode,startRegAddr:E.blockForm.startRegAddr,regCnt:E.blockForm.regCnt}};E.pTitle.includes("添加")?K(e).then((e=>{he(e,O),pe()})):Q(e).then((e=>{he(e,O),pe()}))}}))})},{default:S((()=>[xl])),_:1})])])),default:S((()=>[L("div",kl,[A($,{model:P(E).blockForm,rules:P(E).propertyRules,ref_key:"blockFormRef",ref:ue,"status-icon":"","label-position":"right","label-width":"120px"},{default:S((()=>[A(N,{label:"块名称",prop:"name"},{default:S((()=>[A(M,{disabled:P(E).pTitle.includes("编辑"),type:"text",modelValue:P(E).blockForm.name,"onUpdate:modelValue":y[7]||(y[7]=e=>P(E).blockForm.name=e),autocomplete:"off",placeholder:"请输入块名称"},null,8,["disabled","modelValue"])])),_:1}),A(N,{label:"块标签",prop:"label"},{default:S((()=>[A(M,{type:"text",modelValue:P(E).blockForm.label,"onUpdate:modelValue":y[8]||(y[8]=e=>P(E).blockForm.label=e),autocomplete:"off",placeholder:"请输入块标签"},null,8,["modelValue"])])),_:1}),A(N,{label:"功能码",prop:"funCode"},{default:S((()=>[A(Fe,{modelValue:P(E).blockForm.funCode,"onUpdate:modelValue":y[9]||(y[9]=e=>P(E).blockForm.funCode=e),style:{width:"100%"},placeholder:"请选择功能码"},{default:S((()=>[(V(!0),B(I,null,q(P(E).funCodeOptions,(e=>(V(),H(_e,{key:"funCode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),A(N,{label:"寄存器地址",prop:"startRegAddr"},{default:S((()=>[A(M,{type:"text",modelValue:P(E).blockForm.startRegAddr,"onUpdate:modelValue":y[10]||(y[10]=e=>P(E).blockForm.startRegAddr=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器地址"},null,8,["modelValue"])])),_:1}),A(N,{label:"寄存器数量",prop:"regCnt"},{default:S((()=>[A(M,{type:"text",modelValue:P(E).blockForm.regCnt,"onUpdate:modelValue":y[11]||(y[11]=e=>P(E).blockForm.regCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器数量"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),A(ke,{modelValue:P(E).psFlag,"onUpdate:modelValue":y[15]||(y[15]=e=>P(E).psFlag=e),title:"导入命令",width:"600px","before-close":ie,"close-on-click-modal":!1},{footer:S((()=>[L("span",Vl,[A(w,{onClick:se},{default:S((()=>[Bl])),_:1}),A(w,{type:"primary",onClick:ae},{default:S((()=>[Ll])),_:1})])])),default:S((()=>[A(Ce,{ref_key:"uploadDPSRef",ref:re,action:"","auto-upload":!1,"http-request":oe,limit:1,"on-exceed":de,"before-upload":ne},{tip:S((()=>[Dl])),default:S((()=>[A(w,{type:"primary"},{default:S((()=>[Ml])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-46c88d4f"]]);const Sl=e=>(R("data-v-dae64bc8"),e=e(),N(),e),Pl={class:"main-container"},zl={key:0,class:"main"},Tl={class:"search-bar"},Rl=T(" 刷新 "),Nl={class:"tool-bar"},Ul=T(" 添加 "),jl=T("变量详情"),Il=T("命令详情"),ql=T("编辑"),Hl=T("删除"),El=Sl((()=>L("div",null,"无数据",-1))),Ol={class:"pagination"},Gl={class:"dialog-content"},Wl={class:"dialog-footer"},Jl=T("取消"),$l=T("保存");var Kl=b({setup(c){const u=y(),m=w(null),f=x({typeModel:2,showFlag:0,headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceModelInfo:"",tableData:[],modelForm:{name:"",label:"",type:0,param:""},modelRules:{name:[{required:!0,message:"采集模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"采集模型标识不能为空",trigger:"blur"}],param:[{required:!0,message:"采集模型插件不能为空",trigger:"blur"}]},udFlag:!1,dmFlag:!1,dmTitle:"添加采集模型",pluginList:[],curDeviceModel:"",tsl:""}),g=J();f.tsl=g.query.tsl;const b=l=>{const t={token:u.token,data:{type:f.typeModel}};v.getDeviceModelList(t).then((async t=>{if(t){if("0"===t.code){if(f.tableData=t.data,f.tsl){const e=f.tableData.find((e=>e.name===f.tsl));q(e)}1===l&&e({type:"success",message:"刷新成功！"})}else O(t);await U((()=>{f.tableMaxHeight=m.value.clientHeight-34-36-22}))}}))};b();const _=M((()=>f.tableData.filter((e=>{var l=!f.deviceModelInfo,t=e.name.toLowerCase().includes(f.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(f.deviceModelInfo.toLowerCase());return l||t})).slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize))),F=M((()=>f.tableData.filter((e=>{var l=!f.deviceModelInfo,t=e.name.toLowerCase().includes(f.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(f.deviceModelInfo.toLowerCase());return l||t})))),C=e=>{f.currentPage=e},z=e=>{f.pagesize=e},T=e=>{f.dmFlag=!0,f.dmTitle="编辑采集模型",f.modelForm={name:e.name,label:e.label,type:void 0===e.type?0:e.type,param:e.param}},R=w(null),N=()=>{f.dmFlag=!1,R.value.resetFields(),I()},j=()=>{N()},I=()=>{f.modelForm={name:"",label:"",type:0}},q=e=>{f.curDeviceModel=e,f.showFlag=2},E=()=>{f.showFlag=0},O=l=>{e({type:"error",message:l.message})},W=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(c,g)=>{const y=l,h=r,w=a,x=D("Icon"),M=t,U=o,I=d,O=n,J=s,$=p;return V(),B("div",Pl,[0===P(f).showFlag?(V(),B("div",zl,[L("div",Tl,[A(U,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:S((()=>[A(w,{label:"采集模型名称"},{default:S((()=>[A(h,{style:{width:"200px"},placeholder:"请输入采集模型名称",modelValue:P(f).deviceModelInfo,"onUpdate:modelValue":g[0]||(g[0]=e=>P(f).deviceModelInfo=e)},{prefix:S((()=>[A(y,{class:"el-input__icon"},{default:S((()=>[A(P(k))])),_:1})])),_:1},8,["modelValue"])])),_:1}),A(w,null,{default:S((()=>[A(M,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:g[1]||(g[1]=e=>{b(1)})},{default:S((()=>[A(y,{class:"btn-icon"},{default:S((()=>[A(x,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),Rl])),_:1})])),_:1})])),_:1},512)]),L("div",Nl,[A(M,{type:"primary",bg:"",class:"right-btn",onClick:g[2]||(g[2]=e=>(f.dmFlag=!0,void(f.dmTitle="添加采集模型")))},{default:S((()=>[A(y,{class:"btn-icon"},{default:S((()=>[A(x,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),Ul])),_:1})]),L("div",{class:"content",ref_key:"contentRef",ref:m},[A(O,{data:P(_),"cell-style":P(f).cellStyle,"header-cell-style":P(f).headerCellStyle,"max-height":P(f).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:T},{empty:S((()=>[El])),default:S((()=>[A(I,{prop:"name",label:"采集模型名称",width:"auto","min-width":"200",align:"center"}),A(I,{prop:"label",label:"采集模型标签",width:"auto","min-width":"200",align:"center"}),A(I,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:S((l=>[A(M,{onClick:e=>{return t=l.row,f.curDeviceModel=t,void(f.showFlag=1);var t},text:"",type:"success"},{default:S((()=>[jl])),_:2},1032,["onClick"]),A(M,{onClick:e=>q(l.row),text:"",type:"success"},{default:S((()=>[Il])),_:2},1032,["onClick"]),A(M,{onClick:e=>T(l.row),text:"",type:"primary"},{default:S((()=>[ql])),_:2},1032,["onClick"]),A(M,{onClick:t=>{return a=l.row,void i.confirm("确定要删除这个采集模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:u.token,data:{name:a.name,type:2}};v.deleteDeviceModel(e).then((e=>{W(e,b)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var a},text:"",type:"danger"},{default:S((()=>[Hl])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",Ol,[A(J,{"current-page":P(f).currentPage,"page-size":P(f).pagesize,"page-sizes":[20,50,200,500],total:P(F).length,onCurrentChange:C,onSizeChange:z,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):G("",!0),1===P(f).showFlag?(V(),H(ve,{key:1,curDeviceModel:P(f).curDeviceModel,onChangeShowFlag:g[3]||(g[3]=e=>E()),style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel"])):G("",!0),2===P(f).showFlag?(V(),H(Al,{key:2,curDeviceModel:P(f).curDeviceModel,deviceModelList:P(f).tableData,onChangeShowFlag:g[4]||(g[4]=e=>E()),style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel","deviceModelList"])):G("",!0),A($,{modelValue:P(f).dmFlag,"onUpdate:modelValue":g[9]||(g[9]=e=>P(f).dmFlag=e),title:P(f).dmTitle,width:"600px","before-close":j,"close-on-click-modal":!1},{footer:S((()=>[L("span",Wl,[A(M,{onClick:g[7]||(g[7]=e=>N())},{default:S((()=>[Jl])),_:1}),A(M,{type:"primary",onClick:g[8]||(g[8]=e=>{R.value.validate((e=>{if(!e)return!1;{f.modelForm.type=f.typeModel;const e={token:u.token,data:f.modelForm};f.dmTitle.includes("添加")?v.addDeviceModel(e).then((e=>{W(e,b),N()})):v.editDeviceModel(e).then((e=>{W(e,b),N()}))}}))})},{default:S((()=>[$l])),_:1})])])),default:S((()=>[L("div",Gl,[A(U,{model:P(f).modelForm,rules:P(f).modelRules,ref_key:"modelFormRef",ref:R,"status-icon":"","label-position":"right","label-width":"120px"},{default:S((()=>[A(w,{label:"采集模型名称",prop:"name"},{default:S((()=>[A(h,{type:"text",disabled:P(f).dmTitle.includes("编辑"),modelValue:P(f).modelForm.name,"onUpdate:modelValue":g[5]||(g[5]=e=>P(f).modelForm.name=e),autocomplete:"off",placeholder:"请输入采集模型名称"},null,8,["disabled","modelValue"])])),_:1}),A(w,{label:"采集模型标签",prop:"label"},{default:S((()=>[A(h,{type:"text",modelValue:P(f).modelForm.label,"onUpdate:modelValue":g[6]||(g[6]=e=>P(f).modelForm.label=e),autocomplete:"off",placeholder:"请输入采集模型标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-dae64bc8"]]);export{Kl as default};
