import{g as e,L as l,e as a,p as t,n as o,x as r,y as p,N as i,o as s,m as d,A as n,C as m,D as c,w as u,K as y,q as f,M as g,v as b}from"./element-plus.2c9426ce.js";import{r as h,J as v,j as F,ae as x,o as _,c as M,a as k,O as w,R as V,u as C,V as L,W as D,X as P,P as A,aj as j,S as z,n as U,av as S,aw as R,_ as T,$ as q}from"./@vue.2c474d7f.js";import{_ as N,u as I,v as O,s as B}from"./index.d5c032bc.js";import{D as H}from"./deviceModel.d8833265.js";import{b as E,h as W,i as $,d as J}from"./@element-plus.e895b9e1.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.d618444d.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./vue-router.3b7aa6c5.js";import"./pinia.39330980.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.ebbe6a42.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const K=e=>(S("data-v-07b90ffa"),e=e(),R(),e),X={class:"main-container"},G={class:"main"},Q={class:"search-bar"},Y={key:0,style:{height:"calc(100% - 20px)"}},Z={class:"search-bar",style:{display:"flex"}},ee={class:"title",style:{position:"relative","margin-right":"40px","justify-content":"flex-start",padding:"0px 0px",height:"40px"}},le={class:"tName"},ae=K((()=>k("div",null,"无数据",-1))),te={class:"pagination"},oe=K((()=>k("div",{"e-else":""},null,-1))),re={class:"dialog-content"},pe={class:"dialog-footer"},ie=K((()=>k("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),se={class:"dialog-footer"};var de=N({__name:"PropertyLua",props:{curDeviceModel:{type:Object,default:{}}},emits:["changeDpFlag"],setup(S,{emit:R}){const T=S,q=I();console.log("id -> props",T);const N=/^[0-9]+(.[0-9]{1,2})?$/,B=(e,l,a)=>{N.test(l)?a():a(new Error("只能输入大于等于0,最多两位小数的数字！"))},K=h(null),de=v({headerCellStyle:{background:O.primaryColor,color:O.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,varParamType:"Properties",propertyList:[],serviceList:[],deviceModelProperty:"",deviceModelService:"",accessModeOptions:[{label:"只读",value:0},{label:"只写",value:1},{label:"读写",value:2}],typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,unit:"",decimals:0,min:0,max:0,minMaxAlarm:!1,step:0,stepAlarm:!1,dataLength:0,dataLengthAlarm:!1},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"步长",stepAlarm:"步长报警",unit:"单位",decimals:"小数位数",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],accessMode:[{required:!0,message:"读写属性不能为空",trigger:"blur"}],type:[{required:!0,message:"数据类型不能为空",trigger:"blur"}],decimals:[{type:"number",message:"小数位数只能输入数字",trigger:"blur"}],step:[{required:!0,message:"步长不能为空",trigger:"blur"},{trigger:"blur",validator:B}],min:[{required:!0,message:"最小值不能为空",trigger:"blur"},{trigger:"blur",validator:B}],max:[{required:!0,message:"最大值不能为空",trigger:"blur"},{trigger:"blur",validator:B}],dataLength:[{required:!0,message:"字符串长度不能为空",trigger:"blur"},{trigger:"blur",validator:/^[0-9]*[1-9][0-9]*$/}]},psFlag:!1,selectedProperties:[]}),ne=l=>{const a={token:q.token,data:{name:T.curDeviceModel.name}};H.getDeviceModelProperty(a).then((async a=>{console.log("getDeviceModelProperty -> res",a),a&&("0"===a.code?(de.propertyList=a.data,1===l&&e({type:"success",message:"刷新成功！"})):Le(a),await U((()=>{de.tableMaxHeight=K.value.clientHeight-34-36-22})))}))};ne();const me=F((()=>(console.log("ctxData.propertyList ->",de.propertyList),de.propertyList.filter((e=>{var l=!de.deviceModelProperty,a=e.name.toLowerCase().includes(de.deviceModelProperty.toLowerCase());return l||a})).slice((de.currentPage-1)*de.pagesize,de.currentPage*de.pagesize)))),ce=F((()=>de.propertyList.filter((e=>{var l=!de.deviceModelProperty,a=e.name.toLowerCase().includes(de.deviceModelProperty.toLowerCase());return l||a}))));F((()=>(console.log("ctxData.serviceList ->",de.serviceList),de.serviceList.filter((e=>{var l=!de.deviceModelService,a=e.name.toLowerCase().includes(de.deviceModelService.toLowerCase());return l||a})).slice((de.currentPage-1)*de.pagesize,de.currentPage*de.pagesize))));const ue=e=>{de.currentPage=e},ye=e=>{de.pagesize=e},fe=()=>{be.value&&be.value.submit()},ge=e=>{},be=h(null),he=e=>{be.value.clearFiles();const l=e[0];be.value.handleStart(l)},ve=l=>{console.log("beforeUpload -> file",l);let a=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(a){if(a){let a=new FormData;a.append("name",T.curDeviceModel.name),a.append("fileName",l);const t={token:q.token,contentType:"multipart/form-data",data:a};H.importDeviceModelProptyAndService(t).then((l=>{"0"===l.code?(e.success(l.message),de.psFlag=!1,ne()):Le(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},Fe=()=>{de.psFlag=!1,uploadRef.value.clearFiles()},xe=()=>{Fe()},_e=e=>{de.pFlag=!0,de.pTitle="编辑属性",de.propertyForm.name=e.name,de.propertyForm.label=e.label,de.propertyForm.accessMode=e.accessMode,de.propertyForm.type=e.type,de.propertyForm.unit=e.unit,2===e.type&&(de.propertyForm.decimals=e.decimals),3!==e.type?(de.propertyForm.min=e.params.min,de.propertyForm.max=e.params.max,de.propertyForm.minMaxAlarm=e.params.minMaxAlarm,de.propertyForm.step=e.params.step,de.propertyForm.stepAlarm=e.params.stepAlarm):(de.propertyForm.dataLength=e.params.dataLength,de.propertyForm.dataLengthAlarm=e.params.dataLengthAlarm)},Me=h(null),ke=()=>{de.pFlag=!1,Me.value.resetFields(),Ce()},we=e=>{ke()},Ve=e=>{de.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},Ce=()=>{de.propertyForm={name:"",label:"",accessMode:0,type:0,min:0,max:0,minMaxAlarm:!1,step:0,stepAlarm:!1,unit:"",decimals:0,dataLength:0,dataLengthAlarm:!1}},Le=l=>{e({type:"error",message:l.message})},De=(l,a)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&a&&a()};return(h,v)=>{const F=a,U=t,S=o,N=r,I=p,O=i,B=s,Ce=d,Pe=x("Icon"),Ae=n,je=m,ze=c,Ue=b,Se=u,Re=y,Te=f,qe=g;return _(),M("div",X,[k("div",G,[k("div",Q,[w(B,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:V((()=>[w(S,{style:{"margin-right":"20px","margin-left":"20px"}},{default:V((()=>[w(U,{type:"primary",plain:"",onClick:v[0]||(v[0]=e=>(console.log("toDeviceModel"),void R("changeDpFlag")))},{default:V((()=>[w(F,{class:"el-input__icon"},{default:V((()=>[w(C(E))])),_:1}),L(" 返回设备模型 ")])),_:1})])),_:1}),w(S,null,{default:V((()=>[w(I,{modelValue:C(de).varParamType,"onUpdate:modelValue":v[1]||(v[1]=e=>C(de).varParamType=e),style:{"margin-right":"20px"}},{default:V((()=>[w(N,{label:"Properties",border:""},{default:V((()=>[L("属性")])),_:1})])),_:1},8,["modelValue"]),w(O,{direction:"vertical",style:{height:"2em"}})])),_:1}),w(S,null,{default:V((()=>[w(U,{type:"primary",plain:"",class:"right-btn",onClick:v[2]||(v[2]=e=>(console.log("importDPS"),void(de.psFlag=!0)))},{default:V((()=>[w(F,{class:"el-input__icon"},{default:V((()=>[w(C(W))])),_:1}),L(" 导入属性 ")])),_:1})])),_:1}),w(S,null,{default:V((()=>[w(U,{type:"primary",plain:"",class:"right-btn",onClick:v[3]||(v[3]=e=>(()=>{console.log("exportDPS");const e={token:q.token,responseType:"blob",data:{name:T.curDeviceModel.name}};H.exportDeviceModelProptyAndService(e).then((e=>{if(e&&"1"===e.code)return void Le(e);const l=new Blob([e.blob]),a=e.fileName,t=document.createElement("a");t.download=a,t.style.display="none",t.href=URL.createObjectURL(l),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})())},{default:V((()=>[w(F,{class:"el-input__icon"},{default:V((()=>[w(C($))])),_:1}),L(" 导出属性 ")])),_:1})])),_:1})])),_:1},512)]),"Properties"===C(de).varParamType?(_(),M("div",Y,[k("div",Z,[k("div",ee,[k("div",le,D(T.curDeviceModel.label)+"："+D("Properties"===C(de).varParamType?"属性列表":"服务列表"),1)]),w(B,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:V((()=>[w(S,{label:""},{default:V((()=>[w(Ce,{style:{width:"200px"},placeholder:"请输入属性名称",modelValue:C(de).deviceModelProperty,"onUpdate:modelValue":v[4]||(v[4]=e=>C(de).deviceModelProperty=e)},{prefix:V((()=>[w(F,{class:"el-input__icon"},{default:V((()=>[w(C(J))])),_:1})])),_:1},8,["modelValue"])])),_:1}),w(S,null,{default:V((()=>[w(U,{type:"primary",bg:"",class:"right-btn",onClick:v[5]||(v[5]=e=>(()=>{const e={token:q.token,data:{name:T.curDeviceModel.name}};H.syncDeviceModelProperty(e).then((e=>{console.log(e),De(e,ne)}))})())},{default:V((()=>[w(F,{class:"btn-icon"},{default:V((()=>[w(Pe,{name:"local-tongbu",size:"14px",color:"#ffffff"})])),_:1}),L(" 同步 ")])),_:1})])),_:1}),w(S,null,{default:V((()=>[w(U,{type:"primary",bg:"",class:"right-btn",onClick:v[6]||(v[6]=e=>(console.log("addDeviceModelProperty"),de.pFlag=!0,void(de.pTitle="添加属性")))},{default:V((()=>[w(F,{class:"btn-icon"},{default:V((()=>[w(Pe,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),L(" 添加 ")])),_:1})])),_:1}),w(S,null,{default:V((()=>[w(U,{type:"danger",bg:"",class:"right-btn",onClick:v[7]||(v[7]=a=>(a=>{let t=[];0!==de.selectedProperties.length?(de.selectedProperties.forEach((e=>{t.push(e.name)})),console.log("pList",t),l.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:q.token,data:{name:T.curDeviceModel.name,properties:t}};H.deleteDeviceModelProperty(e).then((e=>{De(e,ne)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:V((()=>[w(F,{class:"btn-icon"},{default:V((()=>[w(Pe,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),L(" 删除 ")])),_:1})])),_:1}),w(S,null,{default:V((()=>[w(U,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:v[8]||(v[8]=e=>{ne(1)})},{default:V((()=>[w(F,{class:"btn-icon"},{default:V((()=>[w(Pe,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),L(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),k("div",{class:"content",ref_key:"contentRef",ref:K},[w(je,{data:C(me),"cell-style":C(de).cellStyle,"header-cell-style":C(de).headerCellStyle,"max-height":C(de).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:Ve,onRowDblclick:_e},{empty:V((()=>[ae])),default:V((()=>[w(Ae,{type:"selection",width:"55"}),w(Ae,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),w(Ae,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),w(Ae,{sortable:"",label:"读写属性",width:"auto","min-width":"80",align:"center"},{default:V((e=>[L(D(C(de).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),w(Ae,{sortable:"",label:"属性类型",width:"auto","min-width":"80",align:"center"},{default:V((e=>[L(D(C(de).typeNames["t"+e.row.type]),1)])),_:1}),w(Ae,{sortable:"",label:"小数位数",width:"auto","min-width":"80",align:"center"},{default:V((e=>[L(D(void 0===e.row.decimals||""===e.row.decimals?0:e.row.decimals),1)])),_:1}),w(Ae,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),w(Ae,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:V((e=>[w(U,{onClick:l=>_e(e.row),text:"",type:"primary"},{default:V((()=>[L("编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),k("div",te,[w(ze,{"current-page":C(de).currentPage,"page-size":C(de).pagesize,"page-sizes":[20,50,200,500],total:C(ce).length,onCurrentChange:ue,onSizeChange:ye,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):P("",!0),oe,w(Te,{modelValue:C(de).pFlag,"onUpdate:modelValue":v[24]||(v[24]=e=>C(de).pFlag=e),title:C(de).pTitle,width:"600px","before-close":we,"close-on-click-modal":!1},{footer:V((()=>[k("span",pe,[w(U,{onClick:v[22]||(v[22]=e=>ke())},{default:V((()=>[L("取消")])),_:1}),w(U,{type:"primary",onClick:v[23]||(v[23]=l=>{3!==de.propertyForm.type&&Number(de.propertyForm.min)>Number(de.propertyForm.max)?e.warning("最大值必须大于最小值"):Me.value.validate((e=>{if(console.log("valid",e),!e)return!1;{let e={};e.name=de.propertyForm.name,e.label=de.propertyForm.label,e.accessMode=de.propertyForm.accessMode,e.type=de.propertyForm.type,e.unit=de.propertyForm.unit,2===de.propertyForm.type&&(e.decimals=de.propertyForm.decimals);let l={};3!==de.propertyForm.type?(l.min=de.propertyForm.min.toString(),l.max=de.propertyForm.max.toString(),l.minMaxAlarm=de.propertyForm.minMaxAlarm,l.step=de.propertyForm.step.toString(),l.stepAlarm=de.propertyForm.stepAlarm):(l.dataLength=de.propertyForm.dataLength.toString(),l.dataLengthAlarm=de.propertyForm.dataLengthAlarm),e.params=l,console.log("submitPorpertyForm -> property",e);const a={token:q.token,data:{name:T.curDeviceModel.name,property:e}};de.pTitle.includes("添加")?(console.log("添加属性"),H.addDeviceModelProperty(a).then((e=>{De(e,ne),ke()}))):(console.log("编辑属性"),H.editDeviceModelProperty(a).then((e=>{De(e,ne),ke()})))}}))})},{default:V((()=>[L("保存")])),_:1})])])),default:V((()=>[k("div",re,[w(B,{model:C(de).propertyForm,rules:C(de).propertyRules,ref_key:"propertyFormRef",ref:Me,"status-icon":"","label-position":"right","label-width":"120px"},{default:V((()=>[w(S,{label:"属性名称",prop:"name"},{default:V((()=>[w(Ce,{disabled:C(de).pTitle.includes("编辑"),type:"text",modelValue:C(de).propertyForm.name,"onUpdate:modelValue":v[9]||(v[9]=e=>C(de).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),w(S,{label:"属性标签",prop:"label"},{default:V((()=>[w(Ce,{type:"text",modelValue:C(de).propertyForm.label,"onUpdate:modelValue":v[10]||(v[10]=e=>C(de).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),w(S,{label:"读写属性",prop:"accessMode"},{default:V((()=>[w(Se,{modelValue:C(de).propertyForm.accessMode,"onUpdate:modelValue":v[11]||(v[11]=e=>C(de).propertyForm.accessMode=e),style:{width:"100%"},placeholder:"请选择读写属性"},{default:V((()=>[(_(!0),M(A,null,j(C(de).accessModeOptions,(e=>(_(),z(Ue,{key:"accessMode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),w(S,{label:"属性类型",prop:"type"},{default:V((()=>[w(Se,{modelValue:C(de).propertyForm.type,"onUpdate:modelValue":v[12]||(v[12]=e=>C(de).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"100%"},placeholder:"请选择属性类型"},{default:V((()=>[(_(!0),M(A,null,j(C(de).typeOptions,(e=>(_(),z(Ue,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),2===C(de).propertyForm.type?(_(),z(S,{key:0,label:"小数位数",prop:"decimals"},{default:V((()=>[w(Ce,{type:"text",modelValue:C(de).propertyForm.decimals,"onUpdate:modelValue":v[13]||(v[13]=e=>C(de).propertyForm.decimals=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入小数位数"},null,8,["modelValue"])])),_:1})):P("",!0),3!==C(de).propertyForm.type?(_(),z(S,{key:1,label:"单位",prop:"unit"},{default:V((()=>[w(Ce,{type:"text",modelValue:C(de).propertyForm.unit,"onUpdate:modelValue":v[14]||(v[14]=e=>C(de).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1})):P("",!0),3!==C(de).propertyForm.type?(_(),z(S,{key:2,label:"范围报警",prop:"minMaxAlarm"},{default:V((()=>[w(Re,{modelValue:C(de).propertyForm.minMaxAlarm,"onUpdate:modelValue":v[15]||(v[15]=e=>C(de).propertyForm.minMaxAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):P("",!0),3!==C(de).propertyForm.type&&C(de).propertyForm.minMaxAlarm?(_(),z(S,{key:3,label:"最小值",prop:"min"},{default:V((()=>[w(Ce,{type:"text",modelValue:C(de).propertyForm.min,"onUpdate:modelValue":v[16]||(v[16]=e=>C(de).propertyForm.min=e),autocomplete:"off",placeholder:"请输入最小值"},null,8,["modelValue"])])),_:1})):P("",!0),3!==C(de).propertyForm.type&&C(de).propertyForm.minMaxAlarm?(_(),z(S,{key:4,label:"最大值",prop:"max"},{default:V((()=>[w(Ce,{type:"text",modelValue:C(de).propertyForm.max,"onUpdate:modelValue":v[17]||(v[17]=e=>C(de).propertyForm.max=e),autocomplete:"off",placeholder:"请输入最大值"},null,8,["modelValue"])])),_:1})):P("",!0),3!==C(de).propertyForm.type?(_(),z(S,{key:5,label:"步长报警",prop:"stepAlarm"},{default:V((()=>[w(Re,{modelValue:C(de).propertyForm.stepAlarm,"onUpdate:modelValue":v[18]||(v[18]=e=>C(de).propertyForm.stepAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):P("",!0),3!==C(de).propertyForm.type&&C(de).propertyForm.stepAlarm?(_(),z(S,{key:6,label:"步长",prop:"step"},{default:V((()=>[w(Ce,{type:"text",modelValue:C(de).propertyForm.step,"onUpdate:modelValue":v[19]||(v[19]=e=>C(de).propertyForm.step=e),autocomplete:"off",placeholder:"请输入步长"},null,8,["modelValue"])])),_:1})):P("",!0),3===C(de).propertyForm.type?(_(),z(S,{key:7,label:"字符串长度报警",prop:"dataLengthAlarm"},{default:V((()=>[w(Re,{modelValue:C(de).propertyForm.dataLengthAlarm,"onUpdate:modelValue":v[20]||(v[20]=e=>C(de).propertyForm.dataLengthAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):P("",!0),3===C(de).propertyForm.type&&C(de).propertyForm.dataLengthAlarm?(_(),z(S,{key:8,label:"字符串长度",prop:"dataLength"},{default:V((()=>[w(Ce,{type:"text",modelValue:C(de).propertyForm.dataLength,"onUpdate:modelValue":v[21]||(v[21]=e=>C(de).propertyForm.dataLength=e),autocomplete:"off",placeholder:"请输入字符串长度"},null,8,["modelValue"])])),_:1})):P("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),w(Te,{modelValue:C(de).psFlag,"onUpdate:modelValue":v[25]||(v[25]=e=>C(de).psFlag=e),title:"导入设备属性",width:"600px","before-close":xe,"close-on-click-modal":!1},{footer:V((()=>[k("span",se,[w(U,{onClick:Fe},{default:V((()=>[L("取消")])),_:1}),w(U,{type:"primary",onClick:fe},{default:V((()=>[L("上传")])),_:1})])])),default:V((()=>[w(qe,{ref_key:"uploadDPSRef",ref:be,action:"","auto-upload":!1,"http-request":ge,limit:1,"on-exceed":he,"before-upload":ve},{tip:V((()=>[ie])),default:V((()=>[w(U,{type:"primary"},{default:V((()=>[L("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-07b90ffa"]]);var ne=e=>B.request({url:"/tsl/plugin/file",method:"post",data:e}),me=e=>B.request({url:"/tsl/plugin/file",method:"get",data:e}),ce=e=>B.request({url:"/tsl/plugin/param",method:"get",data:e});const ue=e=>(S("data-v-70c7ffd3"),e=e(),R(),e),ye={class:"main-container"},fe={key:0,class:"main"},ge={class:"search-bar"},be={class:"tool-bar"},he={class:"param-content"},ve={class:"pc-title"},Fe={class:"pct-info"},xe={class:"pc-content"},_e={class:"param-value"},Me={class:"param-name"},ke=ue((()=>k("div",null,"无数据",-1))),we={class:"pagination"},Ve={class:"dialog-content"},Ce={class:"dialog-footer"},Le=ue((()=>k("div",{class:"el-upload__tip"},"只能上传一个文件，只支持zip格式文件，且文件尺寸不大于1MB！",-1))),De={class:"dialog-footer"};var Pe=N({__name:"DeviceModelLua",setup(r){const p=I(),i=h(null),u=v({typeModel:0,dpFlag:!0,headerCellStyle:{background:O.primaryColor,color:O.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceModelInfo:"",tableData:[],modelForm:{name:"",label:"",type:0,param:""},modelRules:{name:[{required:!0,message:"采集模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"采集模型标识不能为空",trigger:"blur"}],param:[{required:!0,message:"采集模型插件不能为空",trigger:"blur"}]},udFlag:!1,dmFlag:!1,dmTitle:"添加采集模型",pluginList:[],curDeviceModel:"",paramName:{name:"插件名称",label:"插件标签",version:"插件版本",message:"插件描述",date:"上传日期",author:"插件作者"}}),y=l=>{const a={token:p.token,data:{type:u.typeModel}};H.getDeviceModelList(a).then((async a=>{console.log("getDeviceModelList -> res = ",a),a&&("0"===a.code?(u.tableData=a.data,1===l&&e({type:"success",message:"刷新成功！"})):ae(a),await U((()=>{u.tableMaxHeight=i.value.clientHeight-34-36-22})))}))};y();const b=F((()=>u.tableData.filter((e=>{var l=!u.deviceModelInfo,a=e.name.toLowerCase().includes(u.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(u.deviceModelInfo.toLowerCase());return l||a})).slice((u.currentPage-1)*u.pagesize,u.currentPage*u.pagesize))),P=F((()=>u.tableData.filter((e=>{var l=!u.deviceModelInfo,a=e.name.toLowerCase().includes(u.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(u.deviceModelInfo.toLowerCase());return l||a})))),S=e=>{u.currentPage=e},R=e=>{u.pagesize=e},N=e=>{u.dmFlag=!0,u.dmTitle="编辑采集模型",u.modelForm={name:e.name,label:e.label,type:void 0===e.type?0:e.type,param:e.param}},B=h(null),E=()=>{u.dmFlag=!1,B.value.resetFields(),$()},W=()=>{E()},$=()=>{u.modelForm={name:"",label:"",type:0}},K=()=>{G.value&&G.value.submit()},X=e=>{},G=h(null),Q=e=>{G.value.clearFiles(),console.log("handleExceed -> files",e);const l=e[0];G.value.handleStart(l)},Y=l=>{console.log("beforeUpload -> file",l);const a=["application/x-zip-compressed","application/zip"].includes(l.type),t=l.size/1024<=1024;if(a)if(t){if(a&&t){let a=new FormData;a.append("fileName",l),console.log("formData",a.get("file"));const t={token:p.token,contentType:"multipart/form-data",data:a};ne(t).then((a=>{if("0"===a.code){e.success("导入成功！"),G.value.clearFiles();const a=l.name.substring(0,l.name.lastIndexOf("."));le(a)}else ae(a);console.log("importOnePlugin -> res = ",a)}))}}else e({type:"error",message:"文件大小不正确,不能超过1MB！"});else e({type:"error",message:"文件格式不正确,必须是zip文件！"})},Z=()=>{u.udFlag=!1,G.value.clearFiles()},ee=()=>{Z()},le=e=>{const l={token:p.token,data:{name:e}};ce(l).then((e=>{if("0"===e.code){u.curDeviceModel.param=e.data;const l={token:p.token,data:u.curDeviceModel};H.editDeviceModel(l).then((e=>{te(e,y),u.udFlag=!1}))}else ae(e)}))},ae=l=>{e({type:"error",message:l.message})},te=(l,a)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&a&&a()};return(r,h)=>{const v=a,F=d,U=o,I=x("Icon"),O=t,$=s,le=n,oe=m,re=c,pe=f,ie=g;return _(),M("div",ye,[C(u).dpFlag?(_(),M("div",fe,[k("div",ge,[w($,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:V((()=>[w(U,{label:"模型名称/标签"},{default:V((()=>[w(F,{style:{width:"200px"},placeholder:"请输入采集模型名称/标签",modelValue:C(u).deviceModelInfo,"onUpdate:modelValue":h[0]||(h[0]=e=>C(u).deviceModelInfo=e)},{prefix:V((()=>[w(v,{class:"el-input__icon"},{default:V((()=>[w(C(J))])),_:1})])),_:1},8,["modelValue"])])),_:1}),w(U,null,{default:V((()=>[w(O,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:h[1]||(h[1]=e=>{y(1)})},{default:V((()=>[w(v,{class:"btn-icon"},{default:V((()=>[w(I,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),L(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),k("div",be,[w(O,{type:"primary",bg:"",class:"right-btn",onClick:h[2]||(h[2]=e=>(u.dmFlag=!0,void(u.dmTitle="添加采集模型")))},{default:V((()=>[w(v,{class:"btn-icon"},{default:V((()=>[w(I,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),L(" 添加 ")])),_:1})]),k("div",{class:"content",ref_key:"contentRef",ref:i},[w(oe,{data:C(b),"cell-style":C(u).cellStyle,"header-cell-style":C(u).headerCellStyle,"max-height":C(u).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:N},{empty:V((()=>[ke])),default:V((()=>[w(le,{type:"expand"},{default:V((e=>[k("div",he,[k("div",ve,[k("div",Fe,[k("b",null,D(e.row.serviceName),1),L(" 参数详情 ")])]),k("div",xe,[(_(!0),M(A,null,j(e.row.param,((e,l,a)=>(_(),M("div",{class:"param-item",key:a},[k("div",_e,D(C(u).paramName[l])+"：",1),k("div",Me,D(e||"-"),1)])))),128))])])])),_:1}),w(le,{sortable:"",prop:"name",label:"采集模型名称",width:"auto","min-width":"150",align:"center"}),w(le,{sortable:"",prop:"label",label:"采集模型标签",width:"auto","min-width":"150",align:"center"}),w(le,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:V((a=>[w(O,{onClick:e=>{return l=a.row,u.udFlag=!0,u.curDeviceModel=l,void(G.value&&G.value.clearFiles());var l},text:"",type:"info"},{default:V((()=>[L("导入插件")])),_:2},1032,["onClick"]),T(w(O,{onClick:e=>(e=>{const l={token:p.token,responseType:"blob",data:{name:e.param.name}};me(l).then((e=>{if(console.log("exportOnePlugin -> res",e),e&&"1"===e.code)return void ae(e);const l=new Blob([e.blob]),a=e.fileName,t=document.createElement("a");t.download=a,t.style.display="none",t.href=URL.createObjectURL(l),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})(a.row),text:"",type:"info"},{default:V((()=>[L("导出插件")])),_:2},1032,["onClick"]),[[q,""!==a.row.param.name]]),w(O,{onClick:e=>{return l=a.row,u.curDeviceModel=l,void(u.dpFlag=!1);var l},text:"",type:"success"},{default:V((()=>[L("变量详情")])),_:2},1032,["onClick"]),w(O,{onClick:e=>N(a.row),text:"",type:"primary"},{default:V((()=>[L("编辑")])),_:2},1032,["onClick"]),w(O,{onClick:t=>{return o=a.row,void l.confirm("确定要删除这个采集模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:p.token,data:{name:o.name,type:0}};H.deleteDeviceModel(e).then((e=>{te(e,y)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var o},text:"",type:"danger"},{default:V((()=>[L("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),k("div",we,[w(re,{"current-page":C(u).currentPage,"page-size":C(u).pagesize,"page-sizes":[20,50,200,500],total:C(P).length,onCurrentChange:S,onSizeChange:R,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):(_(),z(de,{key:1,curDeviceModel:C(u).curDeviceModel,onChangeDpFlag:h[3]||(h[3]=e=>{u.dpFlag=!0}),style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel"])),w(pe,{modelValue:C(u).dmFlag,"onUpdate:modelValue":h[8]||(h[8]=e=>C(u).dmFlag=e),title:C(u).dmTitle,width:"600px","before-close":W,"close-on-click-modal":!1},{footer:V((()=>[k("span",Ce,[w(O,{onClick:h[6]||(h[6]=e=>E())},{default:V((()=>[L("取消")])),_:1}),w(O,{type:"primary",onClick:h[7]||(h[7]=e=>{B.value.validate((e=>{if(!e)return!1;{u.modelForm.type=u.typeModel;const e={token:p.token,data:u.modelForm};u.dmTitle.includes("添加")?H.addDeviceModel(e).then((e=>{te(e,y),E()})):H.editDeviceModel(e).then((e=>{te(e,y),E()}))}}))})},{default:V((()=>[L("保存")])),_:1})])])),default:V((()=>[k("div",Ve,[w($,{model:C(u).modelForm,rules:C(u).modelRules,ref_key:"modelFormRef",ref:B,"status-icon":"","label-position":"right","label-width":"120px"},{default:V((()=>[w(U,{label:"采集模型名称",prop:"name"},{default:V((()=>[w(F,{type:"text",disabled:C(u).dmTitle.includes("编辑"),modelValue:C(u).modelForm.name,"onUpdate:modelValue":h[4]||(h[4]=e=>C(u).modelForm.name=e),autocomplete:"off",placeholder:"请输入采集模型名称，必须和插件名称一致！"},null,8,["disabled","modelValue"])])),_:1}),w(U,{label:"采集模型标签",prop:"label"},{default:V((()=>[w(F,{type:"text",modelValue:C(u).modelForm.label,"onUpdate:modelValue":h[5]||(h[5]=e=>C(u).modelForm.label=e),autocomplete:"off",placeholder:"请输入采集模型标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),w(pe,{modelValue:C(u).udFlag,"onUpdate:modelValue":h[9]||(h[9]=e=>C(u).udFlag=e),title:"上传物模型插件",width:"600px","before-close":ee,"close-on-click-modal":!1},{footer:V((()=>[k("span",De,[w(O,{onClick:Z},{default:V((()=>[L("取消")])),_:1}),w(O,{type:"primary",onClick:K},{default:V((()=>[L("上传")])),_:1})])])),default:V((()=>[w(ie,{ref_key:"uploadRef",ref:G,action:"","auto-upload":!1,"http-request":X,limit:1,"on-exceed":Q,"before-upload":Y},{tip:V((()=>[Le])),default:V((()=>[w(O,{type:"primary"},{default:V((()=>[L("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-70c7ffd3"]]);export{Pe as default};
