import{e,p as l,u as a,F as s,v as t,w as o,G as n,M as d,q as i,S as r,T as u,g as c}from"./element-plus.3300f756.js";import{_ as p,u as m,S as f}from"./index.bef3255d.js";import{h as b,i as v}from"./@element-plus.0bef5fa5.js";import{K as h,f as _,o as g,c as y,a as k,P as j,S as x,u as w,W as F,Q as C,ak as L,T as V,aw as N,ax as S}from"./@vue.73d14ebc.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.3d90a471.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./vue-router.43b9a342.js";import"./pinia.3f4aff4f.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.7828944a.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const R=e=>(N("data-v-e80f383a"),e=e(),S(),e),U={class:"main-container"},z={class:"main",style:{"background-color":"inherit"}},I=R((()=>k("div",{class:"card-header"},[k("span",null,"本地备份")],-1))),T={class:"item"},q=R((()=>k("div",{class:"card-header"},[k("span",null,"备份系统文件")],-1))),B={class:"item"},O=R((()=>k("div",null,"将当前系统配置导出并保存在您的计算机中。今后若需要恢复此配置，直接导入该备份文件即可。",-1))),D=R((()=>k("br",null,null,-1))),E=R((()=>k("div",null,"提示：导出的配置文件会加密存储您的个人数据，请妥善保存。",-1))),G=R((()=>k("br",null,null,-1))),K=R((()=>k("br",null,null,-1))),M=R((()=>k("br",null,null,-1))),P={style:{"text-align":"center"}},Q=R((()=>k("div",{class:"card-header"},[k("span",null,"还原系统文件")],-1))),W={class:"item"},A=R((()=>k("div",null,"请选择您要恢复的配置文件。",-1))),H=R((()=>k("div",null," ",-1))),J=R((()=>k("div",null," ",-1))),X=R((()=>k("br",null,null,-1))),Y=R((()=>k("br",null,null,-1))),Z=R((()=>k("br",null,null,-1))),$={style:{"text-align":"center"}},ee=R((()=>k("div",{class:"card-header"},[k("span",null,"远程备份")],-1))),le={class:"item"},ae=R((()=>k("div",{class:"card-header"},[k("span",null,"备份系统文件")],-1))),se={class:"item"},te=R((()=>k("div",null,"将当前系统配置导出并保存在云平台。今后若需要恢复此配置，可以从云平台导入需要的版本即可。",-1))),oe=R((()=>k("br",null,null,-1))),ne=R((()=>k("div",null,"提示：云平台只保存最新的5次备份文件。",-1))),de=R((()=>k("br",null,null,-1))),ie=R((()=>k("br",null,null,-1))),re=R((()=>k("br",null,null,-1))),ue={style:{"text-align":"center"}},ce=R((()=>k("div",{class:"card-header"},[k("span",null,"还原系统文件")],-1))),pe={class:"item"},me=R((()=>k("div",null,"1、点击“获取远程备份文件”按钮，获取备份文件列表；",-1))),fe=R((()=>k("div",null,"2、请选择您需要的版本，点击“还原系统配置文件”按钮，来恢复系统配置文件；",-1))),be=R((()=>k("div",null,"3、请重启网关。",-1))),ve=R((()=>k("br",null,null,-1))),he=R((()=>k("br",null,null,-1))),_e=R((()=>k("br",null,null,-1))),ge={style:{"text-align":"center"}},ye=R((()=>k("div",{class:"el-upload__tip"},"只能上传一个文件，只支持zip格式文件！",-1))),ke={class:"dialog-footer"},je={class:"dialog-footer"};var xe=p({__name:"BackupRestore",setup(p){const N=m(),S=h({uFlag:!1,fileList:[],fileName:"",sn:"",sFlag:!1,checkList:["comm","coll","plugin","report"]});let R=sessionStorage.getItem("SN");""!==R&&(S.sn=R,console.log("SN = ",S.sn));const xe=()=>{const e={token:N.token,responseType:"blob",data:{names:S.checkList}};f.exportSystemConfig(e).then((e=>{if(e&&"1"===e.code)return void Re(e);const l=new Blob([e.blob]),a=e.fileName,s=document.createElement("a");s.download=a,s.style.display="none",s.href=URL.createObjectURL(l),document.body.appendChild(s),s.click(),URL.revokeObjectURL(s.href),document.body.removeChild(s)}))},we=()=>{Ce.value&&Ce.value.submit()},Fe=e=>{},Ce=_(null),Le=e=>{Ce.value.clearFiles();const l=e[0];Ce.value.handleStart(l)},Ve=e=>{console.log("beforeUpload -> file",e);const l=["application/x-zip-compressed","application/zip"].includes(e.type);if(l){if(l){let l=new FormData;l.append("file",e);const a={token:N.token,contentType:"multipart/form-data",data:l};f.importSystemConfig(a).then((e=>{"0"===e.code?(c.success(e.message),S.uFlag=!1,getNodeList()):Re(e)}))}}else c({type:"error",message:"文件格式不正确,必须是zip文件！"})},Ne=()=>{S.uFlag=!1,Ce.value.clearFiles()},Se=()=>{Ne()},Re=e=>{c({type:"error",message:e.message})};return(p,m)=>{const h=e,_=l,R=a,Ue=s,ze=t,Ie=o,Te=n,qe=d,Be=i,Oe=r,De=u;return g(),y("div",U,[k("div",z,[j(Te,{gutter:20},{default:x((()=>[j(Ue,{span:12},{default:x((()=>[j(R,{class:"box-card",shadow:"hover"},{header:x((()=>[I])),default:x((()=>[k("div",T,[j(R,{class:"box-card",shadow:"hover"},{header:x((()=>[q])),default:x((()=>[k("div",B,[O,D,E,G,K,M,k("div",P,[j(_,{type:"primary",onClick:m[0]||(m[0]=e=>{S.sFlag=!0})},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(w(b))])),_:1}),F(" 导出系统配置文件 ")])),_:1})])])])),_:1}),j(R,{class:"box-card",shadow:"hover"},{header:x((()=>[Q])),default:x((()=>[k("div",W,[A,H,J,X,Y,Z,k("div",$,[j(_,{type:"primary",onClick:m[1]||(m[1]=e=>{S.uFlag=!0})},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(w(v))])),_:1}),F(" 导入系统配置文件 ")])),_:1})])])])),_:1})])])),_:1})])),_:1}),j(Ue,{span:12},{default:x((()=>[j(R,{class:"box-card",shadow:"hover"},{header:x((()=>[ee])),default:x((()=>[k("div",le,[j(R,{class:"box-card",shadow:"hover"},{header:x((()=>[ae])),default:x((()=>[k("div",se,[te,oe,ne,de,ie,re,k("div",ue,[j(_,{type:"primary",onClick:m[2]||(m[2]=e=>(()=>{const e={token:N.token,data:{}};f.backupRemote(e).then((e=>{"0"===e.code?c({type:"success",message:e.message}):Re(e)}))})())},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(w(v))])),_:1}),F(" 备份系统配置文件至云平台 ")])),_:1})])])])),_:1}),j(R,{class:"box-card",shadow:"hover"},{header:x((()=>[ce])),default:x((()=>[k("div",pe,[me,fe,be,ve,he,_e,k("div",ge,[j(_,{type:"primary",onClick:m[3]||(m[3]=e=>(()=>{if(""===S.sn)c.warning("本网关为配置SN号！");else{const e={token:N.token,data:{sn:S.sn}};f.getRemoteFileInfo(e).then((e=>{"0"===e.code?S.fileList=e.data:Re(e)}))}})())},{default:x((()=>[F("获取远程备份文件")])),_:1}),j(Ie,{modelValue:w(S).fileName,"onUpdate:modelValue":m[4]||(m[4]=e=>w(S).fileName=e),style:{margin:"0 20px"}},{default:x((()=>[(g(!0),y(C,null,L(w(S).fileList,(e=>(g(),V(ze,{key:e.backupId+e.backupTime,label:e.backupId+"("+e.backupTime+")",value:e.backupId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),j(_,{type:"primary",onClick:m[5]||(m[5]=e=>(()=>{if(""!==S.fileName){const e={token:N.token,data:{sn:S.sn,backupId:S.fileName}};f.getRemoteFile(e).then((e=>{"0"===e.code?c.success("获取备份文件成功！"):Re(e)}))}else c.warning("请选择备份文件的版本！")})())},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(w(b))])),_:1}),F(" 还原系统配置文件 ")])),_:1})])])])),_:1})])])),_:1})])),_:1})])),_:1})]),j(Be,{modelValue:w(S).uFlag,"onUpdate:modelValue":m[6]||(m[6]=e=>w(S).uFlag=e),title:"上传系统配置文件",width:"600px","before-close":Se,"close-on-click-modal":!1},{footer:x((()=>[k("span",ke,[j(_,{onClick:Ne},{default:x((()=>[F("取消")])),_:1}),j(_,{type:"primary",onClick:we},{default:x((()=>[F("上传")])),_:1})])])),default:x((()=>[j(qe,{ref_key:"uploadRef",ref:Ce,action:"","auto-upload":!1,"http-request":Fe,limit:1,"on-exceed":Le,"before-upload":Ve},{tip:x((()=>[ye])),default:x((()=>[j(_,{type:"primary"},{default:x((()=>[F("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"]),j(Be,{modelValue:w(S).sFlag,"onUpdate:modelValue":m[8]||(m[8]=e=>w(S).sFlag=e),title:"需要导出的内容",width:"500px"},{footer:x((()=>[k("span",je,[j(_,{type:"primary",onClick:xe},{default:x((()=>[F("导出")])),_:1})])])),default:x((()=>[j(De,{modelValue:w(S).checkList,"onUpdate:modelValue":m[7]||(m[7]=e=>w(S).checkList=e)},{default:x((()=>[j(Oe,{label:"comm"},{default:x((()=>[F("通讯接口")])),_:1}),j(Oe,{label:"coll"},{default:x((()=>[F("采集接口")])),_:1}),j(Oe,{label:"plugin"},{default:x((()=>[F("驱动插件")])),_:1}),j(Oe,{label:"report"},{default:x((()=>[F("上报接口")])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-e80f383a"]]);export{xe as default};
