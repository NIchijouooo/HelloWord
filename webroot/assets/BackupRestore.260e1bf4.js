import{e,p as l,u as a,F as s,v as t,w as o,G as n,M as d,q as i,S as r,T as u,g as c}from"./element-plus.64650d13.js";import{_ as p,u as m,S as f}from"./index.98f42e56.js";import{L as b,M as v}from"./@element-plus.aa3ef65f.js";import{Y as h,f as _,o as g,c as y,a as k,S as j,Q as x,u as F,M as w,af as L,at as C,au as V,a0 as N,P as S}from"./@vue.5db09832.js";import"./@vueuse.af8df401.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./vue-router.d969f71f.js";import"./pinia.69c74452.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./vue-echarts.8f00425b.js";import"./resize-detector.4e96b72b.js";import"./echarts.62a08783.js";import"./zrender.56caf4f2.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const U=e=>(C("data-v-929dc860"),e=e(),V(),e),R={class:"main-container"},z={class:"main",style:{"background-color":"inherit"}},I=U((()=>k("div",{class:"card-header"},[k("span",null,"本地备份")],-1))),T={class:"item"},M=U((()=>k("div",{class:"card-header"},[k("span",null,"备份系统文件")],-1))),q={class:"item"},O=U((()=>k("div",null,"将当前系统配置导出并保存在您的计算机中。今后若需要恢复此配置，直接导入该备份文件即可。",-1))),B=U((()=>k("br",null,null,-1))),D=U((()=>k("div",null,"提示：导出的配置文件会加密存储您的个人数据，请妥善保存。",-1))),E=U((()=>k("br",null,null,-1))),G=U((()=>k("br",null,null,-1))),P=U((()=>k("br",null,null,-1))),Q={style:{"text-align":"center"}},Y=N(" 导出系统配置文件 "),A=U((()=>k("div",{class:"card-header"},[k("span",null,"还原系统文件")],-1))),H={class:"item"},J=U((()=>k("div",null,"请选择您要恢复的配置文件。",-1))),K=U((()=>k("div",null," ",-1))),W=U((()=>k("div",null," ",-1))),X=U((()=>k("br",null,null,-1))),Z=U((()=>k("br",null,null,-1))),$=U((()=>k("br",null,null,-1))),ee={style:{"text-align":"center"}},le=N(" 导入系统配置文件 "),ae=U((()=>k("div",{class:"card-header"},[k("span",null,"远程备份")],-1))),se={class:"item"},te=U((()=>k("div",{class:"card-header"},[k("span",null,"备份系统文件")],-1))),oe={class:"item"},ne=U((()=>k("div",null,"将当前系统配置导出并保存在云平台。今后若需要恢复此配置，可以从云平台导入需要的版本即可。",-1))),de=U((()=>k("br",null,null,-1))),ie=U((()=>k("div",null,"提示：云平台只保存最新的5次备份文件。",-1))),re=U((()=>k("br",null,null,-1))),ue=U((()=>k("br",null,null,-1))),ce=U((()=>k("br",null,null,-1))),pe={style:{"text-align":"center"}},me=N(" 备份系统配置文件至云平台 "),fe=U((()=>k("div",{class:"card-header"},[k("span",null,"还原系统文件")],-1))),be={class:"item"},ve=U((()=>k("div",null,"1、点击“获取远程备份文件”按钮，获取备份文件列表；",-1))),he=U((()=>k("div",null,"2、请选择您需要的版本，点击“还原系统配置文件”按钮，来恢复系统配置文件；",-1))),_e=U((()=>k("div",null,"3、请重启网关。",-1))),ge=U((()=>k("br",null,null,-1))),ye=U((()=>k("br",null,null,-1))),ke=U((()=>k("br",null,null,-1))),je={style:{"text-align":"center"}},xe=N("获取远程备份文件"),Fe=N(" 还原系统配置文件 "),we=N("选择文件"),Le=U((()=>k("div",{class:"el-upload__tip"},"只能上传一个文件，只支持zip格式文件！",-1))),Ce={class:"dialog-footer"},Ve=N("取消"),Ne=N("上传"),Se=N("通讯接口"),Ue=N("采集接口"),Re=N("驱动插件"),ze=N("上报接口"),Ie={class:"dialog-footer"},Te=N("导出");var Me=p({setup(p){const C=m(),V=h({uFlag:!1,fileList:[],fileName:"",sn:"",sFlag:!1,checkList:["comm","coll","plugin","report"]});let N=sessionStorage.getItem("SN");""!==N&&(V.sn=N,console.log("SN = ",V.sn));const U=()=>{const e={token:C.token,responseType:"blob",data:{names:V.checkList}};f.exportSystemConfig(e).then((e=>{if(e&&"1"===e.code)return void Pe(e);const l=new Blob([e.blob]),a=e.fileName,s=document.createElement("a");s.download=a,s.style.display="none",s.href=URL.createObjectURL(l),document.body.appendChild(s),s.click(),URL.revokeObjectURL(s.href),document.body.removeChild(s)}))},Me=()=>{Oe.value&&Oe.value.submit()},qe=e=>{},Oe=_(null),Be=e=>{Oe.value.clearFiles();const l=e[0];Oe.value.handleStart(l)},De=e=>{console.log("beforeUpload -> file",e);const l=["application/x-zip-compressed","application/zip"].includes(e.type);if(l){if(l){let l=new FormData;l.append("file",e);const a={token:C.token,contentType:"multipart/form-data",data:l};f.importSystemConfig(a).then((e=>{"0"===e.code?(c.success(e.message),V.uFlag=!1,getNodeList()):Pe(e)}))}}else c({type:"error",message:"文件格式不正确,必须是zip文件！"})},Ee=()=>{V.uFlag=!1,Oe.value.clearFiles()},Ge=()=>{Ee()},Pe=e=>{c({type:"error",message:e.message})};return(p,m)=>{const h=e,_=l,N=a,Qe=s,Ye=t,Ae=o,He=n,Je=d,Ke=i,We=r,Xe=u;return g(),y("div",R,[k("div",z,[j(He,{gutter:20},{default:x((()=>[j(Qe,{span:12},{default:x((()=>[j(N,{class:"box-card",shadow:"hover"},{header:x((()=>[I])),default:x((()=>[k("div",T,[j(N,{class:"box-card",shadow:"hover"},{header:x((()=>[M])),default:x((()=>[k("div",q,[O,B,D,E,G,P,k("div",Q,[j(_,{type:"primary",onClick:m[0]||(m[0]=e=>{V.sFlag=!0})},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(F(b))])),_:1}),Y])),_:1})])])])),_:1}),j(N,{class:"box-card",shadow:"hover"},{header:x((()=>[A])),default:x((()=>[k("div",H,[J,K,W,X,Z,$,k("div",ee,[j(_,{type:"primary",onClick:m[1]||(m[1]=e=>{V.uFlag=!0})},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(F(v))])),_:1}),le])),_:1})])])])),_:1})])])),_:1})])),_:1}),j(Qe,{span:12},{default:x((()=>[j(N,{class:"box-card",shadow:"hover"},{header:x((()=>[ae])),default:x((()=>[k("div",se,[j(N,{class:"box-card",shadow:"hover"},{header:x((()=>[te])),default:x((()=>[k("div",oe,[ne,de,ie,re,ue,ce,k("div",pe,[j(_,{type:"primary",onClick:m[2]||(m[2]=e=>(()=>{const e={token:C.token,data:{}};f.backupRemote(e).then((e=>{"0"===e.code?c({type:"success",message:e.message}):Pe(e)}))})())},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(F(v))])),_:1}),me])),_:1})])])])),_:1}),j(N,{class:"box-card",shadow:"hover"},{header:x((()=>[fe])),default:x((()=>[k("div",be,[ve,he,_e,ge,ye,ke,k("div",je,[j(_,{type:"primary",onClick:m[3]||(m[3]=e=>(()=>{if(""===V.sn)c.warning("本网关为配置SN号！");else{const e={token:C.token,data:{sn:V.sn}};f.getRemoteFileInfo(e).then((e=>{"0"===e.code?V.fileList=e.data:Pe(e)}))}})())},{default:x((()=>[xe])),_:1}),j(Ae,{modelValue:F(V).fileName,"onUpdate:modelValue":m[4]||(m[4]=e=>F(V).fileName=e),style:{margin:"0 20px"}},{default:x((()=>[(g(!0),y(w,null,L(F(V).fileList,(e=>(g(),S(Ye,{key:e.backupId+e.backupTime,label:e.backupId+"("+e.backupTime+")",value:e.backupId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),j(_,{type:"primary",onClick:m[5]||(m[5]=e=>(()=>{if(""!==V.fileName){const e={token:C.token,data:{sn:V.sn,backupId:V.fileName}};f.getRemoteFile(e).then((e=>{"0"===e.code?c.success("获取备份文件成功！"):Pe(e)}))}else c.warning("请选择备份文件的版本！")})())},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(F(b))])),_:1}),Fe])),_:1})])])])),_:1})])])),_:1})])),_:1})])),_:1})]),j(Ke,{modelValue:F(V).uFlag,"onUpdate:modelValue":m[6]||(m[6]=e=>F(V).uFlag=e),title:"上传系统配置文件",width:"600px","before-close":Ge,"close-on-click-modal":!1},{footer:x((()=>[k("span",Ce,[j(_,{onClick:Ee},{default:x((()=>[Ve])),_:1}),j(_,{type:"primary",onClick:Me},{default:x((()=>[Ne])),_:1})])])),default:x((()=>[j(Je,{ref_key:"uploadRef",ref:Oe,action:"","auto-upload":!1,"http-request":qe,limit:1,"on-exceed":Be,"before-upload":De},{tip:x((()=>[Le])),default:x((()=>[j(_,{type:"primary"},{default:x((()=>[we])),_:1})])),_:1},512)])),_:1},8,["modelValue"]),j(Ke,{modelValue:F(V).sFlag,"onUpdate:modelValue":m[8]||(m[8]=e=>F(V).sFlag=e),title:"需要导出的内容",width:"500px"},{footer:x((()=>[k("span",Ie,[j(_,{type:"primary",onClick:U},{default:x((()=>[Te])),_:1})])])),default:x((()=>[j(Xe,{modelValue:F(V).checkList,"onUpdate:modelValue":m[7]||(m[7]=e=>F(V).checkList=e)},{default:x((()=>[j(We,{label:"comm"},{default:x((()=>[Se])),_:1}),j(We,{label:"coll"},{default:x((()=>[Ue])),_:1}),j(We,{label:"plugin"},{default:x((()=>[Re])),_:1}),j(We,{label:"report"},{default:x((()=>[ze])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-929dc860"]]);export{Me as default};
