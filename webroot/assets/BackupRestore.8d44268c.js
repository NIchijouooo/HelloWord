import{e,p as l,u as a,F as s,v as t,w as o,G as n,M as d,q as i,S as r,T as u,g as c}from"./element-plus.2c9426ce.js";import{_ as p,u as m,S as f}from"./index.d5c032bc.js";import{h as b,i as v}from"./@element-plus.e895b9e1.js";import{J as h,r as _,o as g,c as y,a as k,O as j,R as x,u as w,V as F,P as V,aj as C,S as L,av as N,aw as R}from"./@vue.2c474d7f.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.d618444d.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./vue-router.3b7aa6c5.js";import"./pinia.39330980.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.ebbe6a42.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const S=e=>(N("data-v-b9650fba"),e=e(),R(),e),U={class:"main-container"},z={class:"main",style:{"background-color":"inherit"}},I=S((()=>k("div",{class:"card-header"},[k("span",null,"本地备份")],-1))),T={class:"item"},O=S((()=>k("div",{class:"card-header"},[k("span",null,"备份系统文件")],-1))),q={class:"item"},B=S((()=>k("div",null,"将当前系统配置导出并保存在您的计算机中。今后若需要恢复此配置，直接导入该备份文件即可。",-1))),D=S((()=>k("br",null,null,-1))),E=S((()=>k("div",null,"提示：导出的配置文件会加密存储您的个人数据，请妥善保存。",-1))),G=S((()=>k("br",null,null,-1))),J=S((()=>k("br",null,null,-1))),M=S((()=>k("br",null,null,-1))),P={style:{"text-align":"center"}},A=S((()=>k("div",{class:"card-header"},[k("span",null,"还原系统文件")],-1))),H={class:"item"},K=S((()=>k("div",null,"请选择您要恢复的配置文件。",-1))),Q=S((()=>k("div",null," ",-1))),W=S((()=>k("div",null," ",-1))),X=S((()=>k("br",null,null,-1))),Y=S((()=>k("br",null,null,-1))),Z=S((()=>k("br",null,null,-1))),$={style:{"text-align":"center"}},ee=S((()=>k("div",{class:"card-header"},[k("span",null,"远程备份")],-1))),le={class:"item"},ae=S((()=>k("div",{class:"card-header"},[k("span",null,"备份系统文件")],-1))),se={class:"item"},te=S((()=>k("div",null,"将当前系统配置导出并保存在云平台。今后若需要恢复此配置，可以从云平台导入需要的版本即可。",-1))),oe=S((()=>k("br",null,null,-1))),ne=S((()=>k("div",null,"提示：云平台只保存最新的5次备份文件。",-1))),de=S((()=>k("br",null,null,-1))),ie=S((()=>k("br",null,null,-1))),re=S((()=>k("br",null,null,-1))),ue={style:{"text-align":"center"}},ce=S((()=>k("div",{class:"card-header"},[k("span",null,"还原系统文件")],-1))),pe={class:"item"},me=S((()=>k("div",null,"1、点击“获取远程备份文件”按钮，获取备份文件列表；",-1))),fe=S((()=>k("div",null,"2、请选择您需要的版本，点击“还原系统配置文件”按钮，来恢复系统配置文件；",-1))),be=S((()=>k("div",null,"3、请重启网关。",-1))),ve=S((()=>k("br",null,null,-1))),he=S((()=>k("br",null,null,-1))),_e=S((()=>k("br",null,null,-1))),ge={style:{"text-align":"center"}},ye=S((()=>k("div",{class:"el-upload__tip"},"只能上传一个文件，只支持zip格式文件！",-1))),ke={class:"dialog-footer"},je={class:"dialog-footer"};var xe=p({__name:"BackupRestore",setup(p){const N=m(),R=h({uFlag:!1,fileList:[],fileName:"",sn:"",sFlag:!1,checkList:["comm","coll","plugin","report"]});let S=sessionStorage.getItem("SN");""!==S&&(R.sn=S,console.log("SN = ",R.sn));const xe=()=>{const e={token:N.token,responseType:"blob",data:{names:R.checkList}};f.exportSystemConfig(e).then((e=>{if(e&&"1"===e.code)return void Se(e);const l=new Blob([e.blob]),a=e.fileName,s=document.createElement("a");s.download=a,s.style.display="none",s.href=URL.createObjectURL(l),document.body.appendChild(s),s.click(),URL.revokeObjectURL(s.href),document.body.removeChild(s)}))},we=()=>{Ve.value&&Ve.value.submit()},Fe=e=>{},Ve=_(null),Ce=e=>{Ve.value.clearFiles();const l=e[0];Ve.value.handleStart(l)},Le=e=>{console.log("beforeUpload -> file",e);const l=["application/x-zip-compressed","application/zip"].includes(e.type);if(l){if(l){let l=new FormData;l.append("file",e);const a={token:N.token,contentType:"multipart/form-data",data:l};f.importSystemConfig(a).then((e=>{"0"===e.code?(c.success(e.message),R.uFlag=!1,getNodeList()):Se(e)}))}}else c({type:"error",message:"文件格式不正确,必须是zip文件！"})},Ne=()=>{R.uFlag=!1,Ve.value.clearFiles()},Re=()=>{Ne()},Se=e=>{c({type:"error",message:e.message})};return(p,m)=>{const h=e,_=l,S=a,Ue=s,ze=t,Ie=o,Te=n,Oe=d,qe=i,Be=r,De=u;return g(),y("div",U,[k("div",z,[j(Te,{gutter:20},{default:x((()=>[j(Ue,{span:12,style:{height:"151%"}},{default:x((()=>[j(S,{class:"box-card",shadow:"hover"},{header:x((()=>[I])),default:x((()=>[k("div",T,[j(S,{class:"box-card",shadow:"hover"},{header:x((()=>[O])),default:x((()=>[k("div",q,[B,D,E,G,J,M,k("div",P,[j(_,{type:"primary",onClick:m[0]||(m[0]=e=>{R.sFlag=!0})},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(w(b))])),_:1}),F(" 导出系统配置文件 ")])),_:1})])])])),_:1}),j(S,{class:"box-card",shadow:"hover"},{header:x((()=>[A])),default:x((()=>[k("div",H,[K,Q,W,X,Y,Z,k("div",$,[j(_,{type:"primary",onClick:m[1]||(m[1]=e=>{R.uFlag=!0})},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(w(v))])),_:1}),F(" 导入系统配置文件 ")])),_:1})])])])),_:1})])])),_:1})])),_:1}),j(Ue,{span:12},{default:x((()=>[j(S,{class:"box-card",shadow:"hover"},{header:x((()=>[ee])),default:x((()=>[k("div",le,[j(S,{class:"box-card",shadow:"hover"},{header:x((()=>[ae])),default:x((()=>[k("div",se,[te,oe,ne,de,ie,re,k("div",ue,[j(_,{type:"primary",onClick:m[2]||(m[2]=e=>(()=>{const e={token:N.token,data:{}};f.backupRemote(e).then((e=>{"0"===e.code?c({type:"success",message:e.message}):Se(e)}))})())},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(w(v))])),_:1}),F(" 备份系统配置文件至云平台 ")])),_:1})])])])),_:1}),j(S,{class:"box-card",shadow:"hover"},{header:x((()=>[ce])),default:x((()=>[k("div",pe,[me,fe,be,ve,he,_e,k("div",ge,[j(_,{type:"primary",onClick:m[3]||(m[3]=e=>(()=>{if(""===R.sn)c.warning("本网关为配置SN号！");else{const e={token:N.token,data:{sn:R.sn}};f.getRemoteFileInfo(e).then((e=>{"0"===e.code?R.fileList=e.data:Se(e)}))}})())},{default:x((()=>[F("获取远程备份文件")])),_:1}),j(Ie,{modelValue:w(R).fileName,"onUpdate:modelValue":m[4]||(m[4]=e=>w(R).fileName=e),style:{margin:"0 20px"}},{default:x((()=>[(g(!0),y(V,null,C(w(R).fileList,(e=>(g(),L(ze,{key:e.backupId+e.backupTime,label:e.backupId+"("+e.backupTime+")",value:e.backupId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),j(_,{type:"primary",onClick:m[5]||(m[5]=e=>(()=>{if(""!==R.fileName){const e={token:N.token,data:{sn:R.sn,backupId:R.fileName}};f.getRemoteFile(e).then((e=>{"0"===e.code?c.success("获取备份文件成功！"):Se(e)}))}else c.warning("请选择备份文件的版本！")})())},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(w(b))])),_:1}),F(" 还原系统配置文件 ")])),_:1})])])])),_:1})])])),_:1})])),_:1})])),_:1})]),j(qe,{modelValue:w(R).uFlag,"onUpdate:modelValue":m[6]||(m[6]=e=>w(R).uFlag=e),title:"上传系统配置文件",width:"600px","before-close":Re,"close-on-click-modal":!1},{footer:x((()=>[k("span",ke,[j(_,{onClick:Ne},{default:x((()=>[F("取消")])),_:1}),j(_,{type:"primary",onClick:we},{default:x((()=>[F("上传")])),_:1})])])),default:x((()=>[j(Oe,{ref_key:"uploadRef",ref:Ve,action:"","auto-upload":!1,"http-request":Fe,limit:1,"on-exceed":Ce,"before-upload":Le},{tip:x((()=>[ye])),default:x((()=>[j(_,{type:"primary"},{default:x((()=>[F("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"]),j(qe,{modelValue:w(R).sFlag,"onUpdate:modelValue":m[8]||(m[8]=e=>w(R).sFlag=e),title:"需要导出的内容",width:"500px"},{footer:x((()=>[k("span",je,[j(_,{type:"primary",onClick:xe},{default:x((()=>[F("导出")])),_:1})])])),default:x((()=>[j(De,{modelValue:w(R).checkList,"onUpdate:modelValue":m[7]||(m[7]=e=>w(R).checkList=e)},{default:x((()=>[j(Be,{label:"comm"},{default:x((()=>[F("通讯接口")])),_:1}),j(Be,{label:"coll"},{default:x((()=>[F("采集接口")])),_:1}),j(Be,{label:"plugin"},{default:x((()=>[F("驱动插件")])),_:1}),j(Be,{label:"report"},{default:x((()=>[F("上报接口")])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-b9650fba"]]);export{xe as default};
