import{g as e,e as l,p as t,n as a,o,m as r,A as d,C as n,D as i,L as s,v as p,w as c,K as u,l as m,G as f,q as g,M as b,u as y}from"./element-plus.3300f756.js";import{s as h,_ as v,u as F,v as _}from"./index.f61f902c.js";import{D as w}from"./deviceModel.7d24566f.js";import{b as k,i as x,d as C,h as M}from"./@element-plus.0bef5fa5.js";import{f as V,K as A,k as D,af as L,o as B,c as S,a as P,P as R,S as T,u as z,W as U,X as N,Q as j,ak as O,n as I,aw as q,ax as E,h as H,T as G,$ as W,a0 as $,Y as K,M as Q}from"./@vue.73d14ebc.js";import{u as X}from"./vue-router.43b9a342.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.3d90a471.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./pinia.3f4aff4f.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.7828944a.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";var Y=e=>h.request({url:"/tsl/modbus/cmd",method:"get",data:e}),J=e=>h.request({url:"/tsl/modbus/cmd",method:"post",data:e}),Z=e=>h.request({url:"/tsl/modbus/cmd",method:"put",data:e}),ee=e=>h.request({url:"/tsl/modbus/cmd",method:"delete",data:e}),le=e=>h.request({url:"/tsl/modbus/block/xlsx",method:"post",data:e}),te=e=>h.request({url:"/tsl/modbus/block/xlsx",method:"get",data:e}),ae=e=>h.request({url:"/tsl/modbus/cmd/params",method:"get",data:e}),oe=e=>h.request({url:"/tsl/modbus/cmd/param",method:"post",data:e}),re=e=>h.request({url:"/tsl/modbus/cmd/param",method:"put",data:e}),de=e=>h.request({url:"/tsl/modbus/cmd/params",method:"delete",data:e}),ne=e=>h.request({url:"/tsl/modbus/cmd/param/xlsx",method:"post",data:e}),ie=e=>h.request({url:"/tsl/modbus/cmd/param/xlsx",method:"get",data:e});const se={class:"main-container"},pe={class:"main"},ce={class:"search-bar"},ue={class:"search-bar",style:{display:"flex"}},me={class:"title",style:{position:"relative","margin-right":"40px",height:"40px",padding:"0px 0","justify-content":"flex-start"}},fe={class:"tName"},ge={class:"param-content"},be={class:"pc-title"},ye={class:"pct-info"},he={class:"pc-content"},ve={class:"param-value"},Fe={class:"param-name"},_e=(e=>(q("data-v-a35253b8"),e=e(),E(),e))((()=>P("div",null,"无数据",-1))),we={class:"pagination"};var ke=v({__name:"PropertyRtu",props:{curDeviceModel:{type:Object,default:{}}},emits:["changeShowFlag"],setup(s,{emit:p}){const c=s,u=F();console.log("id -> props",c);const m=V(null),f=A({headerCellStyle:{background:_.primaryColor,color:_.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",decimals:"小数位数",regCnt:"寄存器数量",ruleType:"解析规则",regAddr:"寄存器地址",formula:"计算公式",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"步长",stepAlarm:"步长报警",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,dbNumber:"",startAddr:"",dataType:0,unit:"",decimals:0},psFlag:!1,selectedProperties:[]}),g=l=>{const t={token:u.token,data:{name:c.curDeviceModel.name}};w.getDeviceModelProperty(t).then((async t=>{console.log("getDeviceModelProperty -> res",t),t&&("0"===t.code?(f.propertyList=t.data,1===l&&e({type:"success",message:"刷新成功！"})):M(t),await I((()=>{f.tableMaxHeight=m.value.clientHeight-34-36-132})))}))};g();const b=D((()=>(console.log("ctxData.propertyList ->",f.propertyList),f.propertyList.filter((e=>{var l=!f.deviceModelProperty,t=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||t})).slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize)))),y=D((()=>f.propertyList.filter((e=>{var l=!f.deviceModelProperty,t=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||t})))),h=e=>{f.currentPage=e},v=e=>{f.pagesize=e},M=l=>{e({type:"error",message:l.message})};return(e,s)=>{const F=l,_=t,V=a,A=o,D=r,I=L("Icon"),q=d,E=n,H=i;return B(),S("div",se,[P("div",pe,[P("div",ce,[R(A,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:T((()=>[R(V,{style:{"margin-left":"20px"}},{default:T((()=>[R(_,{type:"primary",plain:"",onClick:s[0]||(s[0]=e=>{p("changeShowFlag","goBack")})},{default:T((()=>[R(F,{class:"el-input__icon"},{default:T((()=>[R(z(k))])),_:1}),U(" 返回设备模型 ")])),_:1})])),_:1}),R(V,null,{default:T((()=>[R(_,{type:"primary",plain:"",class:"right-btn",onClick:s[1]||(s[1]=e=>(()=>{console.log("exportDPS");const e={token:u.token,responseType:"blob",data:{name:c.curDeviceModel.name}};w.exportDeviceModelProptyAndService(e).then((e=>{if(e&&"1"===e.code)return void M(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:T((()=>[R(F,{class:"el-input__icon"},{default:T((()=>[R(z(x))])),_:1}),U(" 导出模型属性 ")])),_:1})])),_:1})])),_:1},512)]),P("div",ue,[P("div",me,[P("div",fe,N(c.curDeviceModel.label)+"：属性列表",1)]),R(A,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:T((()=>[R(V,{label:""},{default:T((()=>[R(D,{style:{width:"200px"},placeholder:"请输入属性名称",modelValue:z(f).deviceModelProperty,"onUpdate:modelValue":s[2]||(s[2]=e=>z(f).deviceModelProperty=e)},{prefix:T((()=>[R(F,{class:"el-input__icon"},{default:T((()=>[R(z(C))])),_:1})])),_:1},8,["modelValue"])])),_:1}),R(V,null,{default:T((()=>[R(_,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:s[3]||(s[3]=e=>{g(1)})},{default:T((()=>[R(F,{class:"btn-icon"},{default:T((()=>[R(I,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),U(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),P("div",{class:"content",ref_key:"contentRef",ref:m},[R(E,{data:z(b),"cell-style":z(f).cellStyle,"header-cell-style":z(f).headerCellStyle,style:{width:"100%"},"max-height":z(f).tableMaxHeight,stripe:""},{empty:T((()=>[_e])),default:T((()=>[R(q,{type:"expand",width:"60"},{default:T((e=>[P("div",ge,[P("div",be,[P("div",ye,[P("b",null,N(e.row.name),1),U(" 参数详情 ")])]),P("div",he,[(B(!0),S(j,null,O(e.row.params,((e,l,t)=>(B(),S("div",{class:"param-item",key:t},[P("div",ve,N(z(f).paramName[l])+"：",1),P("div",Fe,N(e||"-"),1)])))),128))])])])),_:1}),R(q,{type:"index",width:"60"},{header:T((()=>[U(" 序号 ")])),_:1}),R(q,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),R(q,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),R(q,{sortable:"",label:"读写属性",width:"auto","min-width":"100",align:"center"},{default:T((e=>[U(N(z(f).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),R(q,{sortable:"",prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:T((e=>[U(N(z(f).typeNames["t"+e.row.type]),1)])),_:1}),R(q,{sortable:"",label:"小数位数",width:"auto","min-width":"100",align:"center"},{default:T((e=>[U(N(""===e.row.decimals?0:e.row.decimals),1)])),_:1}),R(q,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),R(q,{sortable:"",prop:"regAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),R(q,{sortable:"",prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"120",align:"center"}),R(q,{sortable:"",prop:"ruleType",label:"解析规则",width:"auto","min-width":"120",align:"center"}),R(q,{sortable:"",prop:"formula",label:"计算公式",width:"auto","min-width":"200",align:"center"}),R(q,{sortable:"",label:"按位解析",width:"auto","min-width":"100",align:"center"},{default:T((e=>[U(N(!1===e.row.bitOffsetSw?"否":"是"),1)])),_:1}),R(q,{sortable:"",prop:"bitOffset",label:"位偏移",width:"auto","min-width":"120",align:"center"},{default:T((e=>[U(N(!1===e.row.bitOffsetSw?"-":e.row.bitOffset),1)])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),P("div",we,[R(H,{"current-page":z(f).currentPage,"page-size":z(f).pagesize,"page-sizes":[20,50,200,500],total:z(y).length,onCurrentChange:h,onSizeChange:v,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])])}}},[["__scopeId","data-v-a35253b8"]]);const xe=e=>(q("data-v-3a17ee7e"),e=e(),E(),e),Ce={class:"main-container"},Me={style:{display:"flex","justify-content":"space-between"}},Ve={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},Ae={class:"tName"},De={class:"search-bar",style:{"text-align":"right"}},Le={class:"param-content"},Be={class:"pc-title"},Se={class:"pct-info"},Pe={class:"pc-content"},Re={class:"param-value"},Te={class:"param-name"},ze=xe((()=>P("div",null,"无数据",-1))),Ue={class:"pagination"},Ne={class:"dialog-content"},je=xe((()=>P("div",{class:"form-title"},[P("div",{class:"tName"},"配置参数")],-1))),Oe={class:"dialog-footer"},Ie={class:"dialog-content"},qe={style:{width:"100%"}},Ee={style:{"padding-right":"10px"}},He={class:"dialog-footer"},Ge=xe((()=>P("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),We={class:"dialog-footer"};var $e=v({__name:"BlockPropertyRtu",props:{curModelBlock:{type:Object,default:{}}},emits:["changeBShowFlag"],setup(y,{emit:h}){const v=y,k=F(),q=/^[0-9]*[1-9][0-9]*$/,E=/^[0-9]\d*$/,Q=V(null),X=A({formulaForm:{},headerCellStyle:{background:_.primaryColor,color:_.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",accessModeOptions:[{label:"只读",value:0},{label:"只写",value:1},{label:"读写",value:2}],typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},regCntOptions:[{label:1,value:1},{label:2,value:2},{label:4,value:4}],pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,regCnt:1,regAddr:null,ruleType:"Int_AB",unit:"",decimals:0,formula:"",bitSwitch:!1,bitOffset:0,min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,dataLength:"",dataLengthAlarm:!1},ruleTypeOptions:{rt1:[{label:"Int_AB",value:"Int_AB"},{label:"Int_BA",value:"Int_BA"}],rt2:[{label:"Long_ABCD",value:"Long_ABCD"},{label:"Long_BADC",value:"Long_BADC"},{label:"Long_DCBA",value:"Long_DCBA"},{label:"Long_CDAB",value:"Long_CDAB"},{label:"Float_ABCD",value:"Float_ABCD"},{label:"Float_BADC",value:"Float_BADC"},{label:"Float_DCBA",value:"Float_DCBA"},{label:"Float_CDAB",value:"Float_CDAB"}],rt4:[{label:"Double_ABCDEFGH",value:"Double_ABCDEFGH"},{label:"Double_GHEFCDAB",value:"Double_GHEFCDAB"},{label:"Double_BADCFEHG",value:"Double_BADCFEHG"},{label:"Double_HGFEDCBA",value:"Double_HGFEDCBA"}]},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",decimals:"小数位数",regCnt:"寄存器数量",ruleType:"解析规则",regAddr:"寄存器地址",formula:"计算公式",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"步长",stepAlarm:"步长报警",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],accessMode:[{required:!0,message:"读写属性不能为空",trigger:"blur"}],type:[{required:!0,message:"属性类型不能为空",trigger:"blur"}],ruleType:[{required:!0,message:"解析规则不能为空",trigger:"blur"}],decimals:[{type:"number",message:"小数位数只能输入数字"}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{q.test(l)?t():t(new Error("只能输入正整数数字！"))}}],regAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{0===l||q.test(l)?t():t(new Error("只能输入自然数！"))}}],bitOffset:[{required:!0,message:"位偏移不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{!E.test(l)||l>1e3?t(new Error("只能输入0-1000的整数数字！")):t()}}]},psFlag:!1,selectedProperties:[],fFlag:!1,propertyInfo:[],operationList:[{name:"+",label:"+",describe:"加"},{name:"-",label:"-",describe:"减"},{name:"*",label:"*",describe:"乘"},{name:"/",label:"/",describe:"除"},{name:"%",label:"%",describe:"模"},{name:"^",label:"^",describe:"次幂"},{name:"(",label:"(",describe:"左括号"},{name:")",label:")",describe:"右括号"}],curFormula:"",selectionStart:0,pItem:""}),Y=l=>{const t={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name}};ae(t).then((async t=>{t&&("0"===t.code?(X.propertyList=null==t.data?[]:t.data,1===l&&e({type:"success",message:"刷新成功！"})):ke(t),await I((()=>{X.tableMaxHeight=Q.value.clientHeight-34-22-82})))}))};Y();const J=D((()=>X.propertyList.filter((e=>{var l=!X.deviceModelProperty,t=e.name.toLowerCase().includes(X.deviceModelProperty.toLowerCase());return l||t})).slice((X.currentPage-1)*X.pagesize,X.currentPage*X.pagesize))),Z=D((()=>X.propertyList.filter((e=>{var l=!X.deviceModelProperty,t=e.name.toLowerCase().includes(X.deviceModelProperty.toLowerCase());return l||t})))),ee=e=>{X.currentPage=e},le=e=>{X.pagesize=e},te=()=>{pe.value&&pe.value.submit()},se=e=>{},pe=V(null),ce=e=>{pe.value.clearFiles();const l=e[0];pe.value.handleStart(l)},ue=l=>{let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("tslName",v.curModelBlock.tslName),t.append("cmdName",v.curModelBlock.name),t.append("fileName",l);const a={token:k.token,contentType:"multipart/form-data",data:t};ne(a).then((l=>{"0"===l.code?(e.success(l.message),X.psFlag=!1,Y()):ke(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},me=()=>{X.psFlag=!1,uploadRef.value.clearFiles()},fe=()=>{me()},ge=e=>{X.pFlag=!0,X.pTitle="编辑属性",X.propertyForm.name=e.name,X.propertyForm.label=e.label,X.propertyForm.accessMode=e.accessMode,X.propertyForm.type=e.type,X.propertyForm.decimals=e.decimals,X.propertyForm.unit=e.unit,X.propertyForm.regCnt=e.regCnt,X.propertyForm.regAddr=e.regAddr,X.propertyForm.ruleType=e.ruleType,X.propertyForm.formula=void 0===e.formula||null===e.formula?"":e.formula,X.propertyForm.bitSwitch=void 0!==e.bitSwitch&&null!==e.bitSwitch&&e.bitSwitch,X.propertyForm.bitOffset=void 0===e.bitOffset||null===e.bitOffset?0:e.bitOffset,3!==e.type?(X.propertyForm.min=e.params.min,X.propertyForm.max=e.params.max,X.propertyForm.minMaxAlarm=e.params.minMaxAlarm,X.propertyForm.step=void 0===e.params.step||null===e.params.step?0:e.params.step,X.propertyForm.stepAlarm=e.params.stepAlarm):(X.propertyForm.dataLength=e.params.dataLength,X.propertyForm.dataLengthAlarm=e.params.dataLengthAlarm)},be=V(null),ye=()=>{X.pFlag=!1,be.value.resetFields(),Fe()},he=e=>{ye()},ve=e=>{X.selectedProperties=e},Fe=()=>{X.propertyForm={name:"",label:"",accessMode:0,type:0,decimals:0,unit:"",regCnt:1,regAddr:null,ruleType:"Int_AB",formula:"",bitSwitch:!1,bitOffset:0,step:0}},_e=()=>{X.fFlag=!0,X.curFormula=X.propertyForm.formula,(()=>{const e={token:k.token,data:{name:v.curModelBlock.tslName}};w.getDeviceModelProperty(e).then((e=>{e&&("0"===e.code?(X.propertyInfo=[{name:"t",label:"当前属性"}],e.data.forEach((e=>{X.propertyInfo.push({name:e.name,label:e.label})}))):ke(e))}))})()},we=e=>{X.selectionStart=e.srcElement.selectionStart},ke=l=>{e({type:"error",message:l.message})},xe=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return H((()=>v.curModelBlock),((e,l)=>{Y()})),(y,h)=>{const F=l,_=r,w=a,V=t,A=L("Icon"),D=o,I=d,q=n,E=i,H=p,ae=c,ne=u,Fe=m,$e=f,Ke=g,Qe=b;return B(),S("div",Ce,[P("div",Me,[P("div",Ve,[P("div",Ae,N(v.curModelBlock.label)+"：命令参数列表",1)]),P("div",De,[R(D,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:T((()=>[R(w,{style:{"margin-left":"20px"}},{default:T((()=>[R(_,{style:{width:"200px"},placeholder:"请输入命令参数名称",modelValue:z(X).deviceModelProperty,"onUpdate:modelValue":h[0]||(h[0]=e=>z(X).deviceModelProperty=e)},{prefix:T((()=>[R(F,{class:"el-input__icon"},{default:T((()=>[R(z(C))])),_:1})])),_:1},8,["modelValue"])])),_:1}),R(w,null,{default:T((()=>[R(V,{type:"primary",plain:"",class:"right-btn",onClick:h[1]||(h[1]=e=>{X.psFlag=!0})},{default:T((()=>[R(F,{class:"el-input__icon"},{default:T((()=>[R(z(M))])),_:1}),U(" 导入命令参数 ")])),_:1})])),_:1}),R(w,null,{default:T((()=>[R(V,{type:"primary",plain:"",class:"right-btn",onClick:h[2]||(h[2]=e=>(()=>{const e={token:k.token,responseType:"blob",data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name}};ie(e).then((e=>{if(e&&"1"===e.code)return void ke(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:T((()=>[R(F,{class:"el-input__icon"},{default:T((()=>[R(z(x))])),_:1}),U(" 导出命令参数 ")])),_:1})])),_:1}),R(w,null,{default:T((()=>[R(V,{type:"primary",bg:"",class:"right-btn",onClick:h[3]||(h[3]=e=>(X.pFlag=!0,void(X.pTitle="添加属性")))},{default:T((()=>[R(F,{class:"btn-icon"},{default:T((()=>[R(A,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),U(" 添加 ")])),_:1})])),_:1}),R(w,null,{default:T((()=>[R(V,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:h[4]||(h[4]=e=>{Y(1)})},{default:T((()=>[R(F,{class:"btn-icon"},{default:T((()=>[R(A,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),U(" 刷新 ")])),_:1})])),_:1}),R(w,null,{default:T((()=>[R(V,{type:"danger",bg:"",class:"right-btn",onClick:h[5]||(h[5]=l=>(l=>{let t=[];0!==X.selectedProperties.length?(X.selectedProperties.forEach((e=>{t.push(e.name)})),s.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name,propertyNames:t}};de(e).then((e=>{xe(e,Y)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:T((()=>[R(F,{class:"btn-icon"},{default:T((()=>[R(A,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),U(" 删除 ")])),_:1})])),_:1})])),_:1},512)])]),P("div",{class:"content",ref_key:"contentRef",ref:Q},[R(q,{data:z(J),"cell-style":z(X).cellStyle,"header-cell-style":z(X).headerCellStyle,style:{width:"100%"},stripe:"","max-height":z(X).tableMaxHeight,onSelectionChange:ve,onRowDblclick:ge},{empty:T((()=>[ze])),default:T((()=>[R(I,{type:"selection",width:"55"}),R(I,{type:"expand",width:"60"},{default:T((e=>[P("div",Le,[P("div",Be,[P("div",Se,[P("b",null,N(e.row.name),1),U(" 参数详情 ")])]),P("div",Pe,[(B(!0),S(j,null,O(e.row.params,((e,l,t)=>(B(),S("div",{class:"param-item",key:t},[P("div",Re,N(z(X).paramName[l])+"：",1),P("div",Te,N(e||"-"),1)])))),128))])])])),_:1}),R(I,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),R(I,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),R(I,{sortable:"",label:"读写属性",width:"auto","min-width":"100",align:"center"},{default:T((e=>[U(N(z(X).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),R(I,{sortable:"",prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:T((e=>[U(N(z(X).typeNames["t"+e.row.type]),1)])),_:1}),R(I,{sortable:"",label:"小数位数",width:"auto","min-width":"100",align:"center"},{default:T((e=>[U(N(""===e.row.decimals?0:e.row.decimals),1)])),_:1}),R(I,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),R(I,{sortable:"",prop:"regAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),R(I,{sortable:"",prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"120",align:"center"}),R(I,{sortable:"",prop:"ruleType",label:"解析规则",width:"auto","min-width":"120",align:"center"}),R(I,{sortable:"",prop:"formula",label:"计算公式",width:"auto","min-width":"200",align:"center"}),R(I,{sortable:"",label:"按位解析",width:"auto","min-width":"100",align:"center"},{default:T((e=>[U(N(!1===e.row.bitOffsetSw?"否":"是"),1)])),_:1}),R(I,{sortable:"",prop:"bitOffset",label:"位偏移",width:"auto","min-width":"120",align:"center"},{default:T((e=>[U(N(!1===e.row.bitOffsetSw?"-":e.row.bitOffset),1)])),_:1}),R(I,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:T((e=>[R(V,{onClick:l=>ge(e.row),text:"",type:"primary"},{default:T((()=>[U("编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),P("div",Ue,[R(E,{"current-page":z(X).currentPage,"page-size":z(X).pagesize,"page-sizes":[20,50,200,500],total:z(Z).length,onCurrentChange:ee,onSizeChange:le,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),R(Ke,{modelValue:z(X).pFlag,"onUpdate:modelValue":h[30]||(h[30]=e=>z(X).pFlag=e),title:z(X).pTitle,width:"800px","before-close":he,"close-on-click-modal":!1},{footer:T((()=>[P("span",Oe,[R(V,{onClick:h[28]||(h[28]=e=>ye())},{default:T((()=>[U("取消")])),_:1}),R(V,{type:"primary",onClick:h[29]||(h[29]=e=>{be.value.validate((e=>{if(!e)return!1;{const e={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name,name:X.propertyForm.name,label:X.propertyForm.label,accessMode:X.propertyForm.accessMode,type:X.propertyForm.type,decimals:X.propertyForm.decimals,unit:X.propertyForm.unit,regCnt:X.propertyForm.regCnt,regAddr:X.propertyForm.regAddr,ruleType:X.propertyForm.ruleType,formula:X.propertyForm.formula,bitSwitch:X.propertyForm.bitSwitch,bitOffset:X.propertyForm.bitSwitch?X.propertyForm.bitOffset:-1}};let l={};3!==X.propertyForm.type?(l.min=X.propertyForm.min,l.max=X.propertyForm.max,l.minMaxAlarm=X.propertyForm.minMaxAlarm,l.step=X.propertyForm.step,l.stepAlarm=X.propertyForm.stepAlarm):(l.dataLength=X.propertyForm.dataLength,l.dataLengthAlarm=X.propertyForm.dataLengthAlarm),e.data.params=l,X.pTitle.includes("添加")?oe(e).then((e=>{xe(e,Y),ye()})):re(e).then((e=>{xe(e,Y),ye()}))}}))})},{default:T((()=>[U("保存")])),_:1})])])),default:T((()=>[P("div",Ne,[R(D,{model:z(X).propertyForm,rules:z(X).propertyRules,ref_key:"propertyFormRef",ref:be,"status-icon":"","label-position":"right","label-width":"120px",inline:!0},{default:T((()=>[R(w,{label:"属性名称",prop:"name"},{default:T((()=>[R(_,{style:{width:"220px"},disabled:z(X).pTitle.includes("编辑"),type:"text",modelValue:z(X).propertyForm.name,"onUpdate:modelValue":h[6]||(h[6]=e=>z(X).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),R(w,{label:"属性标签",prop:"label"},{default:T((()=>[R(_,{style:{width:"220px"},type:"text",modelValue:z(X).propertyForm.label,"onUpdate:modelValue":h[7]||(h[7]=e=>z(X).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),R(w,{label:"读写属性",prop:"accessMode"},{default:T((()=>[R(ae,{modelValue:z(X).propertyForm.accessMode,"onUpdate:modelValue":h[8]||(h[8]=e=>z(X).propertyForm.accessMode=e),style:{width:"220px"},placeholder:"请选择读写属性"},{default:T((()=>[(B(!0),S(j,null,O(z(X).accessModeOptions,(e=>(B(),G(H,{key:"accessMode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),R(w,{label:"单位",prop:"unit"},{default:T((()=>[R(_,{style:{width:"220px"},type:"text",modelValue:z(X).propertyForm.unit,"onUpdate:modelValue":h[9]||(h[9]=e=>z(X).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1}),R(w,{label:"属性类型",prop:"type"},{default:T((()=>[R(ae,{modelValue:z(X).propertyForm.type,"onUpdate:modelValue":h[10]||(h[10]=e=>z(X).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择属性类型"},{default:T((()=>[(B(!0),S(j,null,O(z(X).typeOptions,(e=>(B(),G(H,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),R(w,{label:"计算公式",prop:"formula"},{default:T((()=>[R(_,{style:{width:"220px"},type:"text",readonly:"",modelValue:z(X).propertyForm.formula,"onUpdate:modelValue":h[12]||(h[12]=e=>z(X).propertyForm.formula=e),autocomplete:"off",placeholder:"请编辑计算公式"},{append:T((()=>[R(V,{onClick:h[11]||(h[11]=e=>_e())},{default:T((()=>[U("编辑")])),_:1})])),_:1},8,["modelValue"])])),_:1}),W(R(w,{label:"小数位数",prop:"decimals"},{default:T((()=>[R(_,{style:{width:"220px"},type:"text",modelValue:z(X).propertyForm.decimals,"onUpdate:modelValue":h[13]||(h[13]=e=>z(X).propertyForm.decimals=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入小数位数"},null,8,["modelValue"])])),_:1},512),[[$,2===z(X).propertyForm.type]]),P("div",null,[3!==z(X).propertyForm.type?(B(),G(w,{key:0,label:"范围报警",prop:"minMaxAlarm"},{default:T((()=>[R(ne,{modelValue:z(X).propertyForm.minMaxAlarm,"onUpdate:modelValue":h[14]||(h[14]=e=>z(X).propertyForm.minMaxAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):K("",!0)]),P("div",null,[3!==z(X).propertyForm.type&&z(X).propertyForm.minMaxAlarm?(B(),G(w,{key:0,label:"最小值",prop:"min"},{default:T((()=>[R(_,{type:"text",modelValue:z(X).propertyForm.min,"onUpdate:modelValue":h[15]||(h[15]=e=>z(X).propertyForm.min=e),autocomplete:"off",placeholder:"请输入最小值"},null,8,["modelValue"])])),_:1})):K("",!0)]),3!==z(X).propertyForm.type&&z(X).propertyForm.minMaxAlarm?(B(),G(w,{key:0,label:"最大值",prop:"max"},{default:T((()=>[R(_,{type:"text",modelValue:z(X).propertyForm.max,"onUpdate:modelValue":h[16]||(h[16]=e=>z(X).propertyForm.max=e),autocomplete:"off",placeholder:"请输入最大值"},null,8,["modelValue"])])),_:1})):K("",!0),P("div",null,[3!==z(X).propertyForm.type?(B(),G(w,{key:0,label:"步长报警",prop:"stepAlarm"},{default:T((()=>[R(ne,{modelValue:z(X).propertyForm.stepAlarm,"onUpdate:modelValue":h[17]||(h[17]=e=>z(X).propertyForm.stepAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):K("",!0)]),3!==z(X).propertyForm.type&&z(X).propertyForm.stepAlarm?(B(),G(w,{key:1,label:"步长",prop:"step"},{default:T((()=>[R(_,{type:"text",modelValue:z(X).propertyForm.step,"onUpdate:modelValue":h[18]||(h[18]=e=>z(X).propertyForm.step=e),autocomplete:"off",placeholder:"请输入步长"},null,8,["modelValue"])])),_:1})):K("",!0),P("div",null,[3===z(X).propertyForm.type?(B(),G(w,{key:0,label:"字符串长度报警",prop:"dataLengthAlarm"},{default:T((()=>[R(ne,{modelValue:z(X).propertyForm.dataLengthAlarm,"onUpdate:modelValue":h[19]||(h[19]=e=>z(X).propertyForm.dataLengthAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):K("",!0)]),3===z(X).propertyForm.type&&z(X).propertyForm.dataLengthAlarm?(B(),G(w,{key:2,label:"字符串长度",prop:"dataLength"},{default:T((()=>[R(_,{type:"text",modelValue:z(X).propertyForm.dataLength,"onUpdate:modelValue":h[20]||(h[20]=e=>z(X).propertyForm.dataLength=e),autocomplete:"off",placeholder:"请输入字符串长度"},null,8,["modelValue"])])),_:1})):K("",!0),je,R(w,{label:"寄存器地址",prop:"regAddr"},{default:T((()=>[R(_,{type:"text",style:{width:"220px"},modelValue:z(X).propertyForm.regAddr,"onUpdate:modelValue":h[21]||(h[21]=e=>z(X).propertyForm.regAddr=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器地址"},null,8,["modelValue"])])),_:1}),1!=v.curModelBlock.funCode?(B(),G(w,{key:3,label:"",prop:"",style:{width:"220px"}})):K("",!0),R(w,{label:"寄存器数量",prop:"regCnt"},{default:T((()=>[1==v.curModelBlock.funCode?(B(),G(_,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:z(X).propertyForm.regCnt,"onUpdate:modelValue":h[22]||(h[22]=e=>z(X).propertyForm.regCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器数量"},null,8,["modelValue"])):(B(),G(ae,{key:1,modelValue:z(X).propertyForm.regCnt,"onUpdate:modelValue":h[23]||(h[23]=e=>z(X).propertyForm.regCnt=e),modelModifiers:{number:!0},style:{width:"220px"},onChange:h[24]||(h[24]=e=>(()=>{const e=X.propertyForm.regCnt;1===e&&(X.propertyForm.ruleType="Int_AB"),2===e&&(X.propertyForm.ruleType="Long_ABCD"),4===e&&(X.propertyForm.ruleType="Double_ABCDEFGH")})()),placeholder:"请选择寄存器数量"},{default:T((()=>[(B(!0),S(j,null,O(z(X).regCntOptions,(e=>(B(),G(H,{key:"regCount_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),1!=v.curModelBlock.funCode?(B(),G(w,{key:4,label:"解析规则",prop:"ruleType"},{default:T((()=>[R(ae,{modelValue:z(X).propertyForm.ruleType,"onUpdate:modelValue":h[25]||(h[25]=e=>z(X).propertyForm.ruleType=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择解析规则"},{default:T((()=>[(B(!0),S(j,null,O(z(X).ruleTypeOptions["rt"+z(X).propertyForm.regCnt],(e=>(B(),G(H,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):K("",!0),R($e,null,{default:T((()=>[3==v.curModelBlock.funCode||4==v.curModelBlock.funCode?(B(),G(w,{key:0,label:"按位解析"},{default:T((()=>[R(Fe,{class:"item",effect:"dark",content:"开启后按字节位解析数据,位偏移从0开始",placement:"top"},{default:T((()=>[R(ne,{style:{width:"220px"},modelValue:z(X).propertyForm.bitSwitch,"onUpdate:modelValue":h[26]||(h[26]=e=>z(X).propertyForm.bitSwitch=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})])),_:1})):K("",!0),z(X).propertyForm.bitSwitch?(B(),G(w,{key:1,label:"位偏移",prop:"bitOffset"},{default:T((()=>[R(_,{type:"text",style:{width:"220px"},modelValue:z(X).propertyForm.bitOffset,"onUpdate:modelValue":h[27]||(h[27]=e=>z(X).propertyForm.bitOffset=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入位偏移"},null,8,["modelValue"])])),_:1})):K("",!0)])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),R(Ke,{modelValue:z(X).fFlag,"onUpdate:modelValue":h[36]||(h[36]=e=>z(X).fFlag=e),title:"编辑计算公式",width:"600px"},{footer:T((()=>[P("span",He,[R(V,{onClick:h[34]||(h[34]=e=>(X.fFlag=!1,void(X.curFormula="")))},{default:T((()=>[U("取消")])),_:1}),R(V,{type:"primary",onClick:h[35]||(h[35]=e=>(X.fFlag=!1,void(X.propertyForm.formula=X.curFormula)))},{default:T((()=>[U("保存")])),_:1})])])),default:T((()=>[P("div",Ie,[R(D,{model:z(X).formulaForm,"label-position":"right","label-width":"120px"},{default:T((()=>[R(w,{label:"运算符号"},{default:T((()=>[P("div",qe,[(B(!0),S(j,null,O(z(X).operationList,((e,l)=>(B(),S("div",{key:l,class:"operation"},[P("div",Ee,[R(V,{style:{width:"100%"},onClick:l=>(e=>{let l=X.curFormula.length;if(l!==X.selectionStart){let t=X.curFormula.substr(0,X.selectionStart),a=X.curFormula.substr(X.selectionStart,l-X.selectionStart);X.curFormula=t+e.name+a,X.selectionStart+=e.name.length}else X.curFormula+=e.name,X.selectionStart+=e.name.length})(e)},{default:T((()=>[U(N(e.label),1)])),_:2},1032,["onClick"])])])))),128))])])),_:1}),R(w,{label:"设备属性"},{default:T((()=>[R(ae,{modelValue:z(X).pItem,"onUpdate:modelValue":h[31]||(h[31]=e=>z(X).pItem=e),filterable:"",placeholder:"请选择设备属性",onChange:h[32]||(h[32]=e=>(e=>{let l=X.curFormula.length;if(l!==X.selectionStart){let t=X.curFormula.substr(0,X.selectionStart),a=X.curFormula.substr(X.selectionStart,l-X.selectionStart);X.curFormula=t+"("+e+")"+a,X.selectionStart+=e.length+2}else X.curFormula+="("+e+")",X.selectionStart+=e.length+2})(z(X).pItem)),style:{width:"100%"}},{default:T((()=>[(B(!0),S(j,null,O(z(X).propertyInfo,(e=>(B(),G(H,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),R(w,{label:"当前公式"},{default:T((()=>[R(_,{type:"text",clearable:"",modelValue:z(X).curFormula,"onUpdate:modelValue":h[33]||(h[33]=e=>z(X).curFormula=e),autocomplete:"off",placeholder:"请编辑计算公式",onBlur:we},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),R(Ke,{modelValue:z(X).psFlag,"onUpdate:modelValue":h[37]||(h[37]=e=>z(X).psFlag=e),title:"导入命令参数",width:"600px","before-close":fe,"close-on-click-modal":!1},{footer:T((()=>[P("span",We,[R(V,{onClick:me},{default:T((()=>[U("取消")])),_:1}),R(V,{type:"primary",onClick:te},{default:T((()=>[U("上传")])),_:1})])])),default:T((()=>[R(Qe,{ref_key:"uploadDPSRef",ref:pe,action:"","auto-upload":!1,"http-request":se,limit:1,"on-exceed":ce,"before-upload":ue},{tip:T((()=>[Ge])),default:T((()=>[R(V,{type:"primary"},{default:T((()=>[U("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-3a17ee7e"]]);const Ke=e=>(q("data-v-207f4c91"),e=e(),E(),e),Qe={class:"main-container"},Xe={class:"main"},Ye={class:"mc-left"},Je={class:"title"},Ze={class:"mcl-content"},el={class:"mclc-content"},ll={class:"mc-right"},tl={class:"mcr-top"},al={style:{display:"flex","justify-content":"space-between"}},ol={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},rl={class:"tName"},dl={class:"search-bar",style:{"text-align":"right"}},nl=Ke((()=>P("div",null,"无数据",-1))),il={class:"pagination"},sl={key:0,class:"mcr-bottom"},pl={class:"dialog-content"},cl={class:"dialog-footer"},ul=Ke((()=>P("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),ml={class:"dialog-footer"};var fl=v({__name:"ModelBlockRtu",props:{curDeviceModel:{type:Object,default:{}},deviceModelList:{type:Array,default:[]}},emits:["changeShowFlag"],setup(u,{emit:m}){const f=u,h=F();console.log("id -> props",f);const v=/^[0-9]*[1-9][0-9]*$/,w=V(null),q=A({curDeviceModel:f.curDeviceModel,headerCellStyle:{background:_.primaryColor,color:_.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelBlock:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],funCodeOptions:[{label:"01(读线圈状态)",value:1},{label:"02(读离散输入状态)",value:2},{label:"03(读保持寄存器)",value:3},{label:"04(读输入寄存器)",value:4},{label:"05(写单个线圈)",value:5},{label:"06(写单个保持寄存器)",value:6},{label:"15(写多个线圈)",value:15},{label:"16(写多个保持寄存器)",value:16}],funCodeNames:{f1:"01(读线圈状态)",f2:"02(读离散输入状态)",f3:"03(读保持寄存器)",f4:"04(读输入寄存器)",f5:"05(写单个线圈)",f6:"06(写单个保持寄存器)",f15:"15(写多个线圈)",f16:"16(写多个保持寄存器)"},dataTypeOptions:[{label:"uint8",value:0},{label:"int8",value:1},{label:"uint16",value:2},{label:"int16",value:3},{label:"uint32",value:4},{label:"int32",value:5},{label:"float",value:6},{label:"double",value:7}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},dataTypeNames:{dt0:"uint8",dt1:"int8",dt2:"uint16",dt3:"int16",dt4:"uint32",dt5:"int32",dt6:"float",dt7:"double"},pFlag:!1,pTitle:"添加属性",blockForm:{name:"",label:"",funCode:null,startRegAddr:0,regCnt:0},paramName:{name:"块名称",label:"块标签",funCode:"功能码",type:"属性类型",startRegAddr:"寄存器地址",regCnt:"寄存器数量"},propertyRules:{name:[{required:!0,message:"块名称不能为空",trigger:"blur"}],label:[{required:!0,message:"块标签不能为空",trigger:"blur"}],funCode:[{required:!0,message:"功能码不能为空",trigger:"blur"}],startRegAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{0===l||v.test(l)?t():t(new Error("只能输入自然数！"))}}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{v.test(l)?t():t(new Error("只能输入正整数数字！"))}}]},psFlag:!1,selectedProperties:[],curModelBlock:{},porpFlag:!1}),E=l=>{const t={token:h.token,data:{tslName:q.curDeviceModel.name}};Y(t).then((async t=>{t&&("0"===t.code?(q.propertyList=t.data,q.propertyList.length>0?(q.curModelBlock=q.propertyList[0],q.curModelBlock.tslName=q.curDeviceModel.name,console.log("getDeviceModelBlock -> ctxData.curModelBlock",q.curModelBlock),q.porpFlag=!0):q.porpFlag=!1,1===l&&e({type:"success",message:"刷新成功！"})):ye(t),await I((()=>{q.tableMaxHeight=w.value.clientHeight-34-22-82,2===l&&be(q.curModelBlock)})))}))};E(2);const H=D((()=>(console.log("ctxData.propertyList ->",q.propertyList),q.propertyList.filter((e=>{var l=!q.deviceModelBlock,t=e.name.toLowerCase().includes(q.deviceModelBlock.toLowerCase());return l||t})).slice((q.currentPage-1)*q.pagesize,q.currentPage*q.pagesize)))),W=D((()=>q.propertyList.filter((e=>{var l=!q.deviceModelBlock,t=e.name.toLowerCase().includes(q.deviceModelBlock.toLowerCase());return l||t})))),$=e=>{q.currentPage=e},X=e=>{q.pagesize=e},ae=()=>{re.value&&re.value.submit()},oe=e=>{},re=V(null),de=e=>{re.value.clearFiles();const l=e[0];re.value.handleStart(l)},ne=l=>{console.log("beforeUpload -> file",l);let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("name",q.curDeviceModel.name),t.append("fileName",l);const a={token:h.token,contentType:"multipart/form-data",data:t};le(a).then((l=>{"0"===l.code?(e.success(l.message),q.psFlag=!1,E()):ye(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ie=()=>{q.psFlag=!1,uploadRef.value.clearFiles()},se=()=>{ie()},pe=e=>{q.pFlag=!0,q.pTitle="编辑属性",q.blockForm.name=e.name,q.blockForm.label=e.label,q.blockForm.funCode=e.funCode,q.blockForm.startRegAddr=e.startRegAddr,q.blockForm.regCnt=e.regCnt},ce=V(null),ue=()=>{q.pFlag=!1,ce.value.resetFields(),ge()},me=e=>{ue()},fe=e=>{q.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},ge=()=>{q.blockForm={name:"",label:"",funCode:null,startRegAddr:0,regCnt:0}},be=e=>{q.curModelBlock=e,q.curModelBlock.tslName=q.curDeviceModel.name},ye=l=>{e({type:"error",message:l.message})},he=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(u,v)=>{const F=l,_=t,V=y,A=r,D=a,I=L("Icon"),Y=o,le=d,ge=n,ve=i,Fe=p,_e=c,we=g,ke=b;return B(),S("div",Qe,[P("div",Xe,[P("div",Ye,[P("div",Je,[R(_,{type:"primary",style:{width:"100%"},plain:"",onClick:v[0]||(v[0]=e=>{m("changeShowFlag","goBack")})},{default:T((()=>[R(F,{class:"el-input__icon"},{default:T((()=>[R(z(k))])),_:1}),U(" 返回设备模型 ")])),_:1})]),P("div",Ze,[(B(!0),S(j,null,O(f.deviceModelList,((e,l)=>(B(),G(V,{key:"i"+l,shadow:"hover",class:Q({"mclc-card":!0,activeModel:e.name==z(q).curDeviceModel.name}),onClick:l=>(e=>{q.curDeviceModel.name!=e.name&&(q.curDeviceModel=e,E())})(e)},{default:T((()=>[P("div",el,[P("span",null,N(e.name),1)])])),_:2},1032,["class","onClick"])))),128))])]),P("div",ll,[P("div",tl,[P("div",al,[P("div",ol,[P("div",rl,N(z(q).curDeviceModel.label)+"：命令列表",1)]),P("div",dl,[R(Y,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:T((()=>[R(D,{style:{"margin-left":"20px"}},{default:T((()=>[R(A,{style:{width:"200px"},placeholder:"请输入命令名称",modelValue:z(q).deviceModelBlock,"onUpdate:modelValue":v[1]||(v[1]=e=>z(q).deviceModelBlock=e)},{prefix:T((()=>[R(F,{class:"el-input__icon"},{default:T((()=>[R(z(C))])),_:1})])),_:1},8,["modelValue"])])),_:1}),R(D,null,{default:T((()=>[R(_,{type:"primary",plain:"",class:"right-btn",onClick:v[2]||(v[2]=e=>(console.log("importDPS"),void(q.psFlag=!0)))},{default:T((()=>[R(F,{class:"el-input__icon"},{default:T((()=>[R(z(M))])),_:1}),U(" 导入命令 ")])),_:1})])),_:1}),R(D,null,{default:T((()=>[R(_,{type:"primary",plain:"",class:"right-btn",onClick:v[3]||(v[3]=e=>(()=>{console.log("exportDPS");const e={token:h.token,responseType:"blob",data:{name:q.curDeviceModel.name}};te(e).then((e=>{if(e&&"1"===e.code)return void ye(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:T((()=>[R(F,{class:"el-input__icon"},{default:T((()=>[R(z(x))])),_:1}),U(" 导出命令 ")])),_:1})])),_:1}),R(D,null,{default:T((()=>[R(_,{type:"primary",bg:"",class:"right-btn",onClick:v[4]||(v[4]=e=>(console.log("addDeviceModelBlock"),q.pFlag=!0,void(q.pTitle="添加属性")))},{default:T((()=>[R(F,{class:"btn-icon"},{default:T((()=>[R(I,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),U(" 添加 ")])),_:1})])),_:1}),R(D,null,{default:T((()=>[R(_,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:v[5]||(v[5]=e=>{E(1)})},{default:T((()=>[R(F,{class:"btn-icon"},{default:T((()=>[R(I,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),U(" 刷新 ")])),_:1})])),_:1}),R(D,null,{default:T((()=>[R(_,{type:"danger",bg:"",class:"right-btn",onClick:v[6]||(v[6]=l=>(l=>{let t=[];0!==q.selectedProperties.length?(q.selectedProperties.forEach((e=>{t.push(e.name)})),console.log("pList",t),s.confirm("确认要删除这些命令吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:h.token,data:{tslName:q.curDeviceModel.name,names:t}};ee(e).then((e=>{he(e,E)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个命令！")})())},{default:T((()=>[R(F,{class:"btn-icon"},{default:T((()=>[R(I,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),U(" 删除 ")])),_:1})])),_:1})])),_:1},512)])]),P("div",{class:"content",ref_key:"contentRef",ref:w},[R(ge,{data:z(H),"cell-style":z(q).cellStyle,"header-cell-style":z(q).headerCellStyle,"max-height":z(q).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:fe,onRowDblclick:pe},{empty:T((()=>[nl])),default:T((()=>[R(le,{type:"selection",width:"55"}),R(le,{sortable:"",prop:"name",label:"命令名称",width:"auto","min-width":"150",align:"center"}),R(le,{sortable:"",prop:"label",label:"命令标签",width:"auto","min-width":"150",align:"center"}),R(le,{sortable:"",label:"功能码",width:"auto","min-width":"150",align:"center"},{default:T((e=>[U(N(z(q).funCodeNames["f"+e.row.funCode]),1)])),_:1}),R(le,{sortable:"",prop:"startRegAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),R(le,{sortable:"",prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"100",align:"center"}),R(le,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:T((e=>[R(_,{onClick:l=>pe(e.row),text:"",type:"primary"},{default:T((()=>[U("编辑")])),_:2},1032,["onClick"]),R(_,{onClick:l=>be(e.row,2),text:"",type:"success"},{default:T((()=>[U("命令参数详情")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),P("div",il,[R(ve,{"current-page":z(q).currentPage,"page-size":z(q).pagesize,"page-sizes":[20,50,200,500],total:z(W).length,onCurrentChange:$,onSizeChange:X,background:"",layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])],512)]),z(q).porpFlag?(B(),S("div",sl,[R($e,{curModelBlock:z(q).curModelBlock},null,8,["curModelBlock"])])):K("",!0)]),R(we,{modelValue:z(q).pFlag,"onUpdate:modelValue":v[14]||(v[14]=e=>z(q).pFlag=e),title:z(q).pTitle,width:"600px","before-close":me,"close-on-click-modal":!1},{footer:T((()=>[P("span",cl,[R(_,{onClick:v[12]||(v[12]=e=>ue())},{default:T((()=>[U("取消")])),_:1}),R(_,{type:"primary",onClick:v[13]||(v[13]=e=>{ce.value.validate((e=>{if(!e)return!1;{const e={token:h.token,data:{tslName:q.curDeviceModel.name,name:q.blockForm.name,label:q.blockForm.label,funCode:q.blockForm.funCode,startRegAddr:q.blockForm.startRegAddr,regCnt:q.blockForm.regCnt}};q.pTitle.includes("添加")?J(e).then((e=>{he(e,E),ue()})):Z(e).then((e=>{he(e,E),ue()}))}}))})},{default:T((()=>[U("保存")])),_:1})])])),default:T((()=>[P("div",pl,[R(Y,{model:z(q).blockForm,rules:z(q).propertyRules,ref_key:"blockFormRef",ref:ce,"status-icon":"","label-position":"right","label-width":"120px"},{default:T((()=>[R(D,{label:"块名称",prop:"name"},{default:T((()=>[R(A,{disabled:z(q).pTitle.includes("编辑"),type:"text",modelValue:z(q).blockForm.name,"onUpdate:modelValue":v[7]||(v[7]=e=>z(q).blockForm.name=e),autocomplete:"off",placeholder:"请输入块名称"},null,8,["disabled","modelValue"])])),_:1}),R(D,{label:"块标签",prop:"label"},{default:T((()=>[R(A,{type:"text",modelValue:z(q).blockForm.label,"onUpdate:modelValue":v[8]||(v[8]=e=>z(q).blockForm.label=e),autocomplete:"off",placeholder:"请输入块标签"},null,8,["modelValue"])])),_:1}),R(D,{label:"功能码",prop:"funCode"},{default:T((()=>[R(_e,{modelValue:z(q).blockForm.funCode,"onUpdate:modelValue":v[9]||(v[9]=e=>z(q).blockForm.funCode=e),style:{width:"100%"},placeholder:"请选择功能码"},{default:T((()=>[(B(!0),S(j,null,O(z(q).funCodeOptions,(e=>(B(),G(Fe,{key:"funCode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),R(D,{label:"寄存器地址",prop:"startRegAddr"},{default:T((()=>[R(A,{type:"text",modelValue:z(q).blockForm.startRegAddr,"onUpdate:modelValue":v[10]||(v[10]=e=>z(q).blockForm.startRegAddr=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器地址"},null,8,["modelValue"])])),_:1}),R(D,{label:"寄存器数量",prop:"regCnt"},{default:T((()=>[R(A,{type:"text",modelValue:z(q).blockForm.regCnt,"onUpdate:modelValue":v[11]||(v[11]=e=>z(q).blockForm.regCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器数量"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),R(we,{modelValue:z(q).psFlag,"onUpdate:modelValue":v[15]||(v[15]=e=>z(q).psFlag=e),title:"导入命令",width:"600px","before-close":se,"close-on-click-modal":!1},{footer:T((()=>[P("span",ml,[R(_,{onClick:ie},{default:T((()=>[U("取消")])),_:1}),R(_,{type:"primary",onClick:ae},{default:T((()=>[U("上传")])),_:1})])])),default:T((()=>[R(ke,{ref_key:"uploadDPSRef",ref:re,action:"","auto-upload":!1,"http-request":oe,limit:1,"on-exceed":de,"before-upload":ne},{tip:T((()=>[ul])),default:T((()=>[R(_,{type:"primary"},{default:T((()=>[U("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-207f4c91"]]);const gl={class:"main-container"},bl={key:0,class:"main"},yl={class:"search-bar"},hl={class:"tool-bar"},vl=(e=>(q("data-v-911fca10"),e=e(),E(),e))((()=>P("div",null,"无数据",-1))),Fl={class:"pagination"},_l={class:"dialog-content"},wl={class:"dialog-footer"};var kl=v({__name:"DeviceModelRtu",setup(p){const c=F(),u=V(null),m=A({typeModel:2,showFlag:0,headerCellStyle:{background:_.primaryColor,color:_.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceModelInfo:"",tableData:[],modelForm:{name:"",label:"",type:0,param:""},modelRules:{name:[{required:!0,message:"采集模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"采集模型标识不能为空",trigger:"blur"}],param:[{required:!0,message:"采集模型插件不能为空",trigger:"blur"}]},udFlag:!1,dmFlag:!1,dmTitle:"添加采集模型",pluginList:[],curDeviceModel:"",tsl:"",handleFlag:""}),f=X();m.tsl=f.query.tsl;const b=l=>{const t={token:c.token,data:{type:m.typeModel}};w.getDeviceModelList(t).then((async t=>{if(t){if("0"===t.code){if(m.tableData=t.data,m.tsl&&!m.handleFlag){const e=m.tableData.find((e=>e.name===m.tsl));q(e)}1===l&&e({type:"success",message:"刷新成功！"})}else H(t);await I((()=>{m.tableMaxHeight=u.value.clientHeight-34-36-22}))}}))};b();const y=D((()=>m.tableData.filter((e=>{var l=!m.deviceModelInfo,t=e.name.toLowerCase().includes(m.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(m.deviceModelInfo.toLowerCase());return l||t})).slice((m.currentPage-1)*m.pagesize,m.currentPage*m.pagesize))),h=D((()=>m.tableData.filter((e=>{var l=!m.deviceModelInfo,t=e.name.toLowerCase().includes(m.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(m.deviceModelInfo.toLowerCase());return l||t})))),v=e=>{m.currentPage=e},k=e=>{m.pagesize=e},x=e=>{m.dmFlag=!0,m.dmTitle="编辑采集模型",m.modelForm={name:e.name,label:e.label,type:void 0===e.type?0:e.type,param:e.param}},M=V(null),N=()=>{m.dmFlag=!1,M.value.resetFields(),O()},j=()=>{N()},O=()=>{m.modelForm={name:"",label:"",type:0}},q=e=>{m.curDeviceModel=e,m.showFlag=2},E=e=>{m.handleFlag=e,m.showFlag=0,b()},H=l=>{e({type:"error",message:l.message})},W=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(p,f)=>{const F=l,_=r,V=a,A=L("Icon"),D=t,O=o,I=d,H=n,$=i,Q=g;return B(),S("div",gl,[0===z(m).showFlag?(B(),S("div",bl,[P("div",yl,[R(O,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:T((()=>[R(V,{label:"采集模型名称"},{default:T((()=>[R(_,{style:{width:"200px"},placeholder:"请输入采集模型名称",modelValue:z(m).deviceModelInfo,"onUpdate:modelValue":f[0]||(f[0]=e=>z(m).deviceModelInfo=e)},{prefix:T((()=>[R(F,{class:"el-input__icon"},{default:T((()=>[R(z(C))])),_:1})])),_:1},8,["modelValue"])])),_:1}),R(V,null,{default:T((()=>[R(D,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:f[1]||(f[1]=e=>{b(1)})},{default:T((()=>[R(F,{class:"btn-icon"},{default:T((()=>[R(A,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),U(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),P("div",hl,[R(D,{type:"primary",bg:"",class:"right-btn",onClick:f[2]||(f[2]=e=>(m.dmFlag=!0,void(m.dmTitle="添加采集模型")))},{default:T((()=>[R(F,{class:"btn-icon"},{default:T((()=>[R(A,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),U(" 添加 ")])),_:1})]),P("div",{class:"content",ref_key:"contentRef",ref:u},[R(H,{data:z(y),"cell-style":z(m).cellStyle,"header-cell-style":z(m).headerCellStyle,"max-height":z(m).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:x},{empty:T((()=>[vl])),default:T((()=>[R(I,{sortable:"",prop:"name",label:"采集模型名称",width:"auto","min-width":"200",align:"center"}),R(I,{sortable:"",prop:"label",label:"采集模型标签",width:"auto","min-width":"200",align:"center"}),R(I,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:T((l=>[R(D,{onClick:e=>{return t=l.row,m.curDeviceModel=t,void(m.showFlag=1);var t},text:"",type:"success"},{default:T((()=>[U("变量详情")])),_:2},1032,["onClick"]),R(D,{onClick:e=>q(l.row),text:"",type:"success"},{default:T((()=>[U("命令详情")])),_:2},1032,["onClick"]),R(D,{onClick:e=>x(l.row),text:"",type:"primary"},{default:T((()=>[U("编辑")])),_:2},1032,["onClick"]),R(D,{onClick:t=>{return a=l.row,void s.confirm("确定要删除这个采集模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:c.token,data:{name:a.name,type:2}};w.deleteDeviceModel(e).then((e=>{W(e,b)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var a},text:"",type:"danger"},{default:T((()=>[U("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),P("div",Fl,[R($,{"current-page":z(m).currentPage,"page-size":z(m).pagesize,"page-sizes":[20,50,200,500],total:z(h).length,onCurrentChange:v,onSizeChange:k,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):K("",!0),1===z(m).showFlag?(B(),G(ke,{key:1,curDeviceModel:z(m).curDeviceModel,onChangeShowFlag:E,style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel"])):K("",!0),2===z(m).showFlag?(B(),G(fl,{key:2,curDeviceModel:z(m).curDeviceModel,deviceModelList:z(m).tableData,onChangeShowFlag:E,style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel","deviceModelList"])):K("",!0),R(Q,{modelValue:z(m).dmFlag,"onUpdate:modelValue":f[7]||(f[7]=e=>z(m).dmFlag=e),title:z(m).dmTitle,width:"600px","before-close":j,"close-on-click-modal":!1},{footer:T((()=>[P("span",wl,[R(D,{onClick:f[5]||(f[5]=e=>N())},{default:T((()=>[U("取消")])),_:1}),R(D,{type:"primary",onClick:f[6]||(f[6]=e=>{M.value.validate((e=>{if(!e)return!1;{m.modelForm.type=m.typeModel;const e={token:c.token,data:m.modelForm};m.dmTitle.includes("添加")?w.addDeviceModel(e).then((e=>{W(e,b),N()})):w.editDeviceModel(e).then((e=>{W(e,b),N()}))}}))})},{default:T((()=>[U("保存")])),_:1})])])),default:T((()=>[P("div",_l,[R(O,{model:z(m).modelForm,rules:z(m).modelRules,ref_key:"modelFormRef",ref:M,"status-icon":"","label-position":"right","label-width":"120px"},{default:T((()=>[R(V,{label:"采集模型名称",prop:"name"},{default:T((()=>[R(_,{type:"text",disabled:z(m).dmTitle.includes("编辑"),modelValue:z(m).modelForm.name,"onUpdate:modelValue":f[3]||(f[3]=e=>z(m).modelForm.name=e),autocomplete:"off",placeholder:"请输入采集模型名称"},null,8,["disabled","modelValue"])])),_:1}),R(V,{label:"采集模型标签",prop:"label"},{default:T((()=>[R(_,{type:"text",modelValue:z(m).modelForm.label,"onUpdate:modelValue":f[4]||(f[4]=e=>z(m).modelForm.label=e),autocomplete:"off",placeholder:"请输入采集模型标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-911fca10"]]);export{kl as default};
