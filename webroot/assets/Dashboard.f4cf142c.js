import{g as e,m as a,n as l,v as t,w as s,x as c,y as i,p as o,e as r,o as d,A as n,B as m,C as u,D as p,s as h,u as v,F as f,G as g,H as b,t as y,q as x}from"./element-plus.2c9426ce.js";import{J as _,r as w,j as F,ae as k,o as D,c as j,u as S,a as L,O as V,R as C,P as I,aj as T,S as P,V as N,W as z,n as M,av as O,aw as U,_ as R,$ as H}from"./@vue.2c474d7f.js";import{_ as q,u as A,v as E,D as G}from"./index.d5c032bc.js";import{S as W}from"./service.2af7e6b8.js";import{a as B}from"./vue-router.3b7aa6c5.js";import{t as J}from"./vue3-barcode.6ca0e488.js";import{D as K}from"./deviceModel.d8833265.js";import{I as $}from"./interface.52fdfea5.js";import{D as Q}from"./Device-property.0c09324c.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.d618444d.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./pinia.39330980.js";import"./vue-demi.b3a9cad9.js";import"./@element-plus.e895b9e1.js";import"./screenfull.7cf96174.js";import"./vue-echarts.ebbe6a42.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const X={class:"main-container"},Y={key:0,class:"main",style:{overflow:"hidden"}},Z={class:"search-bar"},ee=(e=>(O("data-v-c931545c"),e=e(),U(),e))((()=>L("div",null,"无数据",-1))),ae={class:"pagination",style:{bottom:"24px"}},le={key:1,class:"main"};var te=q({__name:"DeviceList",setup(h){const v=A(),f=_({headerCellStyle:{background:E.primaryColor,color:E.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceTableData:[],screenData:[],deviceTotal:0,deviceOnline:0,dFlag:!1,dTitle:"添加设备",deviceInfo:"",deviceModelList:[],selectedDevices:[],idFlag:!0,uFlag:!1,commStatusOptions:[{label:"全部",value:"Line"},{label:"在线",value:"onLine"},{label:"离线",value:"offLine"}],sFlag:!1,screenForm:{name:"",label:"",tsl:"",commStatus:"Line",collInterfaceName:[],addr:""},interfaceList:[],interfaces:[],checkedInterfaceList:[],collDeviceObj:{}}),g=()=>{f.idFlag=!0,y()};(()=>{const e={token:v.token,data:{}};$.getInterfaceList(e).then((e=>{e&&("0"===e.code?(f.interfaceList=e.data,f.interfaces=[],f.interfaceList.forEach((e=>{f.interfaces.push(e.collInterfaceName),f.checkedInterfaceList.push(e.collInterfaceName)})),y()):q(e))}))})();const b=w(null),y=a=>{const l={token:v.token,data:{names:f.checkedInterfaceList}};$.getAllCollDevices(l).then((async l=>{console.log("getCollDevices -> res",l),l&&("0"===l.code?(f.deviceTableData=null==l.data.node?[]:l.data.node,f.screenData=f.deviceTableData,f.deviceTotal=l.data.commTotalCnt,f.deviceOnline=l.data.commSuccessCnt,1===a&&e({type:"success",message:"刷新成功！"})):q(l),await M((()=>{f.tableMaxHeight=b.value.clientHeight-34-36-22})))}))};(()=>{const e={token:v.token,data:{}};K.getDeviceModelList(e).then((e=>{console.log("getDeviceModelList -> res",e),"0"===e.code?f.deviceModelList=e.data:q(e)}))})();const x=e=>{f.currentPage=e},O=F((()=>f.screenData.slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize))),U=F((()=>f.screenData)),R=e=>{f.pagesize=e},H=()=>{f.screenForm={name:"",tsl:"",label:"",commStatus:"Line",collInterfaceName:[],addr:""}},q=a=>{e({type:"error",message:a.message})},G=B();return(e,h)=>{const v=a,_=l,w=t,F=s,M=c,q=i,A=o,E=k("Icon"),W=r,B=d,J=n,K=m,$=u,te=p;return D(),j("div",X,[S(f).idFlag?(D(),j("div",Y,[L("div",Z,[V(B,{model:S(f).screenForm,inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:C((()=>[V(_,{label:"设备名称",prop:"name"},{default:C((()=>[V(v,{type:"text",modelValue:S(f).screenForm.name,"onUpdate:modelValue":h[0]||(h[0]=e=>S(f).screenForm.name=e),autocomplete:"off",placeholder:"请输入设备名称"},null,8,["modelValue"])])),_:1}),V(_,{label:"设备标签",prop:"label"},{default:C((()=>[V(v,{type:"text",modelValue:S(f).screenForm.label,"onUpdate:modelValue":h[1]||(h[1]=e=>S(f).screenForm.label=e),autocomplete:"off",placeholder:"请输入设备标签"},null,8,["modelValue"])])),_:1}),V(_,{label:"设备地址",prop:"addr"},{default:C((()=>[V(v,{type:"text",modelValue:S(f).screenForm.addr,"onUpdate:modelValue":h[2]||(h[2]=e=>S(f).screenForm.addr=e),autocomplete:"off",placeholder:"请输入设备地址"},null,8,["modelValue"])])),_:1}),V(_,{label:"设备模型",prop:"tsl"},{default:C((()=>[V(F,{modelValue:S(f).screenForm.tsl,"onUpdate:modelValue":h[3]||(h[3]=e=>S(f).screenForm.tsl=e),clearable:"",style:{width:"100%"},placeholder:"请选择设备模型"},{default:C((()=>[(D(!0),j(I,null,T(S(f).deviceModelList,((e,a)=>(D(),P(w,{key:"dm_"+a,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),V(_,{label:"采集接口",prop:"collInterfaceName"},{default:C((()=>[V(F,{modelValue:S(f).screenForm.collInterfaceName,"onUpdate:modelValue":h[4]||(h[4]=e=>S(f).screenForm.collInterfaceName=e),clearable:"",style:{width:"100%"},placeholder:"请选择采集接口",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:C((()=>[(D(!0),j(I,null,T(S(f).interfaceList,((e,a)=>(D(),P(w,{key:"cin_"+a,label:e.collInterfaceName,value:e.collInterfaceName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),V(_,{label:"通信状态"},{default:C((()=>[V(q,{modelValue:S(f).screenForm.commStatus,"onUpdate:modelValue":h[5]||(h[5]=e=>S(f).screenForm.commStatus=e)},{default:C((()=>[V(M,{label:"Line"},{default:C((()=>[N("全部")])),_:1}),V(M,{label:"onLine"},{default:C((()=>[N("在线")])),_:1}),V(M,{label:"offLine"},{default:C((()=>[N("离线")])),_:1})])),_:1},8,["modelValue"])])),_:1}),V(_,{style:{"margin-left":"20px"}},{default:C((()=>[V(A,{type:"primary",onClick:h[6]||(h[6]=e=>(console.log("doScreen ctxData.deviceTableData = ",f.deviceTableData),console.log("doScreen ctxData.screenForm = ",f.screenForm),f.screenData=[],f.deviceTotal=0,f.deviceOnline=0,void f.deviceTableData.forEach((e=>{var a=e.name.includes(f.screenForm.name),l=e.label.includes(f.screenForm.label),t=e.addr.includes(f.screenForm.addr),s=""===f.screenForm.tsl||e.tsl==f.screenForm.tsl,c=0===f.screenForm.collInterfaceName.length||f.screenForm.collInterfaceName.includes(e.collInterfaceName),i="Line"===f.screenForm.commStatus||e.commStatus.includes(f.screenForm.commStatus);a&&l&&t&&s&&c&&i&&(f.screenData.push(e),"onLine"==e.commStatus&&f.deviceOnline++,f.deviceTotal++)}))))},{default:C((()=>[N("搜索")])),_:1})])),_:1}),V(_,null,{default:C((()=>[V(A,{onClick:h[7]||(h[7]=e=>{H()})},{default:C((()=>[N("重置")])),_:1})])),_:1}),V(_,null,{default:C((()=>[V(A,{style:{color:"#fff"},color:"#2EA554",onClick:h[8]||(h[8]=e=>{y(1)})},{default:C((()=>[V(W,{class:"btn-icon"},{default:C((()=>[V(E,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),N(" 刷新 ")])),_:1})])),_:1})])),_:1},8,["model"])]),L("div",{class:"content",ref_key:"contentRef",ref:b},[V($,{data:S(O),"cell-style":S(f).cellStyle,"header-cell-style":S(f).headerCellStyle,style:{width:"100%"},"max-height":S(f).tableMaxHeight,stripe:""},{empty:C((()=>[ee])),default:C((()=>[V(J,{sortable:"",prop:"name",label:"设备名称",width:"auto","min-width":"160",align:"center",fixed:"left"}),V(J,{sortable:"",prop:"label",label:"设备标签",width:"auto","min-width":"160",align:"center"}),V(J,{sortable:"",prop:"tsl",label:"设备模型",width:"auto","min-width":"160",align:"center"},{default:C((e=>[V(A,{type:"primary",link:"",onClick:a=>{return l=e.row,void G.push({path:"deviceModelRtu",query:{tsl:l.tsl}});var l}},{default:C((()=>[N(z(e.row.tsl),1)])),_:2},1032,["onClick"])])),_:1}),V(J,{sortable:"",prop:"collInterfaceName",label:"采集接口",width:"auto","min-width":"160",align:"center"}),V(J,{sortable:"",prop:"addr",label:"通讯地址",width:"auto","min-width":"100",align:"center"}),V(J,{sortable:"",label:"当前通信状态",width:"auto","min-width":"150",align:"center"},{default:C((e=>["onLine"===e.row.commStatus?(D(),P(K,{key:0,type:"success"},{default:C((()=>[N("在线")])),_:1})):(D(),P(K,{key:1,type:"danger"},{default:C((()=>[N("离线")])),_:1}))])),_:1}),V(J,{sortable:"",prop:"lastCommRTC",label:"最后通信时间",width:"auto","min-width":"200",align:"center"}),V(J,{sortable:"",prop:"commTotalCnt",label:"通信总次数",width:"auto","min-width":"150",align:"center"}),V(J,{sortable:"",prop:"commSuccessCnt",label:"通信成功次数",width:"auto","min-width":"150",align:"center"}),V(J,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:C((e=>[V(A,{onClick:a=>{return l=e.row,f.idFlag=!1,void(f.curDevice=l);var l},text:"",type:"success"},{default:C((()=>[N("查看变量")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",ae,[V(te,{"current-page":S(f).currentPage,"page-size":S(f).pagesize,"page-sizes":[20,50,200,500],total:S(U).length,onCurrentChange:x,onSizeChange:R,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):(D(),j("div",le,[V(Q,{curDevice:S(f).curDevice,pageInfo:"dashboard",onChangeIdFlag:g,style:{width:"100%",height:"96%",overflow:"hidden"}},null,8,["curDevice"])]))])}}},[["__scopeId","data-v-c931545c"]]);const se=e=>(O("data-v-d209ef4c"),e=e(),U(),e),ce={class:"dashboard"},ie={class:"basic-info"},oe=se((()=>L("div",{class:"bi-title"},"基本信息",-1))),re={class:"bi-body"},de={class:"cui-content"},ne={class:"card-header"},me={class:"cui-header"},ue={style:{"font-weight":"600"}},pe={class:"card-content"},he={class:"cc-body"},ve={class:"ccb-item",style:{height:"31px","line-height":"31px"}},fe=se((()=>L("div",{class:""},"硬件版本：",-1))),ge={class:"head-name"},be={class:"ccb-item",style:{height:"31px","line-height":"31px"}},ye=se((()=>L("div",{class:""},"软件版本：",-1))),xe={class:"head-name"},_e={class:"ccb-item",style:{height:"31px","line-height":"31px"}},we=se((()=>L("div",{class:""},"系统时间：",-1))),Fe={class:"head-name"},ke={class:"ccb-item",style:{height:"31px","line-height":"31px"}},De=se((()=>L("div",{class:""},"内存总量：",-1))),je={class:"head-name"},Se={class:"ccb-item",style:{height:"31px","line-height":"31px"}},Le=se((()=>L("div",{class:""},"硬盘总量：",-1))),Ve={class:"head-name"},Ce={class:"ccb-item",style:{"margin-bottom":"15px",height:"31px","line-height":"31px"}},Ie=se((()=>L("div",{class:""},"运行时间：",-1))),Te={class:"head-name"},Pe={style:{"padding-top":"10px"}},Ne=se((()=>L("div",{class:"bi-title"},"上报信息",-1))),ze={class:"bi-body"},Me={class:"info-list"},Oe={class:"cui-content"},Ue={class:"card-header"},Re={class:"cui-header"},He={style:{"font-weight":"600"}},qe={class:"card-content"},Ae={class:"cc-body"},Ee={class:"ccb-item"},Ge=se((()=>L("div",{class:""},"协议名称：",-1))),We={class:"head-name"},Be={class:"ccb-item"},Je=se((()=>L("div",{class:""},"上报周期：",-1))),Ke={class:"head-name"},$e={class:"ccb-item"},Qe=se((()=>L("div",{class:""},"产品密钥：",-1))),Xe={class:"head-name"},Ye={class:"ccb-item"},Ze=se((()=>L("div",{class:""},"通讯地址：",-1))),ea={class:"head-name"},aa={class:"ccb-item"},la=se((()=>L("div",{class:""},"设备密钥：",-1))),ta={class:"head-name"},sa={style:{display:"flex",width:"100%","justify-content":"center","text-align":"center"}};var ca=q({__name:"Dashboard",setup(a){const l=A(),t=_({sysParams:{SN:"",deviceOnline:"",devicePacketLoss:"",diskTotal:"",diskUse:"",hardVer:"",lockStatus:0,memTotal:"",memUse:"",name:"",runTime:"",softVer:"",systemRTC:""},showFlag:!1,bFlag:!1,barcodeVale:0,gatewayTableData:[]});(()=>{const e={token:l.token,data:{}};G.getSysParams(e).then((e=>{console.log("getSysParams -> res",e),"0"===e.code&&(t.sysParams=e.data,console.log("getSysParams -> ctxData.sysParams",t.sysParams),t.showFlag=!0,t.barcodeVale=t.sysParams.SN,sessionStorage.setItem("SN",t.barcodeVale))}))})();const s=B();return(a=>{const s={token:l.token,data:{}};W.getGatewayList(s).then((async l=>{console.log("getGatewayList -> res",l),l&&("0"===l.code?(t.gatewayTableData=l.data,1===a&&e({type:"success",message:"刷新成功！"})):showOneResMsg(l))}))})(),(e,a)=>{const l=h,c=o,i=v,r=f,d=m,n=g,u=b,p=y,_=x;return D(),j("div",ce,[V(p,{style:{height:"calc(100% - 10px)"}},{default:C((()=>[V(l,{style:{height:"calc(50% - 10px)"}},{default:C((()=>[V(te,{style:{width:"100%",height:"calc(63.7% - 1px)"}})])),_:1}),V(u,{style:{height:"calc(36% - 25px)",padding:"0px"}},{default:C((()=>[V(n,{gutter:20,style:{height:"calc(100%)",padding:"0px",margin:"0px"}},{default:C((()=>[V(r,{span:8,style:{height:"calc(100%)","padding-left":"0px","padding-right":"15px"}},{default:C((()=>[L("div",ie,[oe,L("div",re,[L("div",de,[V(i,{class:"box-card",shadow:"hover"},{header:C((()=>[L("div",ne,[L("div",me,[L("span",ue,"网关名称："+z(S(t).sysParams.name),1)]),L("div",null,[L("span",null,z(S(t).sysParams.SN),1),R(V(c,{class:"head-tag",text:"",type:"primary",onClick:a[0]||(a[0]=e=>{t.bFlag=!0}),size:"small",style:{"margin-left":"8px"}},{default:C((()=>[N("查看条形码")])),_:1},512),[[H,S(t).showFlag]])])])])),default:C((()=>[L("div",pe,[L("div",he,[L("div",ve,[fe,L("div",ge,z(S(t).sysParams.hardVer),1)]),L("div",be,[ye,L("div",xe,z(S(t).sysParams.softVer),1)]),L("div",_e,[we,L("div",Fe,z(S(t).sysParams.systemRTC),1)]),L("div",ke,[De,L("div",je,z(S(t).sysParams.memTotal),1)]),L("div",Se,[Le,L("div",Ve,z(S(t).sysParams.diskTotal),1)]),L("div",Ce,[Ie,L("div",Te,z(S(t).sysParams.runTime),1)])])])])),_:1})])])])])),_:1}),V(r,{span:16,style:{height:"calc(104%)","background-color":"#f5f8fa","border-radius":"4px"}},{default:C((()=>[L("div",Pe,[Ne,L("div",ze,[L("div",Me,[(D(!0),j(I,null,T(S(t).gatewayTableData,((e,a)=>(D(),j("div",{class:"info-item",key:a},[L("div",Oe,[V(i,{class:"box-card",shadow:"hover"},{header:C((()=>[L("div",Ue,[L("div",Re,[L("span",He,z(e.serviceName),1),V(d,{size:"small",style:{"margin-left":"8px"},type:"onLine"===e.reportStatus?"success":"danger"},{default:C((()=>[N(z("onLine"===e.reportStatus?"在线":"离线"),1)])),_:2},1032,["type"])]),L("div",null,[V(c,{class:"head-tag",text:"",type:"primary",onClick:a=>{return l=e,void s.push({path:"dataService",query:{serviceName:l.serviceName}});var l},size:"small"},{default:C((()=>[N("查看详情")])),_:2},1032,["onClick"])])])])),default:C((()=>[L("div",qe,[L("div",Ae,[L("div",Ee,[Ge,L("div",We,z(e.protocol),1)]),L("div",Be,[Je,L("div",Ke,z(e.reportTime)+" 秒",1)]),L("div",$e,[Qe,L("div",Xe,z(e.param.ProductKey),1)]),L("div",Ye,[Ze,L("div",ea,z(e.param.DeviceID),1)]),L("div",aa,[la,L("div",ta,z(e.param.DeviceSecret),1)])])])])),_:2},1024)])])))),128))])])])])),_:1})])),_:1})])),_:1})])),_:1}),V(_,{modelValue:S(t).bFlag,"onUpdate:modelValue":a[1]||(a[1]=e=>S(t).bFlag=e),title:"网关SN条形码",width:"30%"},{default:C((()=>[L("div",sa,[V(S(J),{value:S(t).barcodeVale,height:60},null,8,["value"])])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-d209ef4c"]]);export{ca as default};
