import{g as e,e as l,p as a,n as t,o,m as r,A as d,C as s,D as n,L as i,v as p,w as c,K as u,q as m,M as f,u as b}from"./element-plus.2c9426ce.js";import{_ as g,u as y,v as h,s as v}from"./index.d5c032bc.js";import{D as k}from"./deviceModel.d8833265.js";import{b as _,i as F,d as x,h as w}from"./@element-plus.e895b9e1.js";import{r as M,J as C,j as X,ae as D,o as V,c as A,a as L,O as B,R as S,u as R,V as N,W as P,P as z,aj as I,n as O,av as U,aw as j,w as T,S as q,X as H,L as E}from"./@vue.2c474d7f.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.d618444d.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./vue-router.3b7aa6c5.js";import"./pinia.39330980.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.ebbe6a42.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const W={class:"main-container"},Y={class:"main"},G={class:"search-bar"},$={class:"search-bar",style:{display:"flex"}},J={class:"title",style:{position:"relative","margin-right":"40px","justify-content":"flex-start",padding:"0px 0px",height:"40px"}},K={class:"tName"},Q={class:"param-content"},Z={class:"pc-title"},ee={class:"pct-info"},le={class:"pc-content"},ae={class:"param-value"},te={class:"param-name"},oe=(e=>(U("data-v-69ca6d48"),e=e(),j(),e))((()=>L("div",null,"无数据",-1))),re={class:"pagination",style:{"z-index":"9"}};var de=g({__name:"PropertyD07",props:{curDeviceModel:{type:Object,default:{}}},emits:["changeShowFlag"],setup(i,{emit:p}){const c=i,u=y();console.log("id -> props",c);const m=M(null),f=C({headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",decimals:"小数位数",regCnt:"寄存器数量",ruleType:"解析规则",regAddr:"寄存器地址",formula:"计算公式",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"步长",stepAlarm:"步长报警",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",rulerId:"",format:"",len:0,accessMode:0,type:0,unit:"",blockAddOffset:0,rulerAddOffset:0},psFlag:!1,selectedProperties:[]}),b=l=>{const a={token:u.token,data:{name:c.curDeviceModel.name}};k.getDeviceModelProperty(a).then((async a=>{console.log("getDeviceModelProperty -> res",a),a&&("0"===a.code?(f.propertyList=a.data,1===l&&e({type:"success",message:"刷新成功！"})):j(a),await O((()=>{f.tableMaxHeight=m.value.clientHeight-34-36-132})))}))};b();const g=X((()=>(console.log("ctxData.propertyList ->",f.propertyList),f.propertyList.filter((e=>{var l=!f.deviceModelProperty,a=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||a})).slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize)))),v=X((()=>f.propertyList.filter((e=>{var l=!f.deviceModelProperty,a=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||a})))),w=e=>{f.currentPage=e},U=e=>{f.pagesize=e},j=l=>{e({type:"error",message:l.message})};return(e,i)=>{const y=l,h=a,M=t,C=o,X=r,O=D("Icon"),T=d,q=s,H=n;return V(),A("div",W,[L("div",Y,[L("div",G,[B(C,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:S((()=>[B(M,{style:{"margin-left":"20px"}},{default:S((()=>[B(h,{type:"primary",plain:"",onClick:i[0]||(i[0]=e=>(console.log("toDeviceModel"),void p("changeShowFlag")))},{default:S((()=>[B(y,{class:"el-input__icon"},{default:S((()=>[B(R(_))])),_:1}),N(" 返回设备模型 ")])),_:1})])),_:1}),B(M,null,{default:S((()=>[B(h,{type:"primary",plain:"",class:"right-btn",onClick:i[1]||(i[1]=e=>(()=>{console.log("exportDPS");const e={token:u.token,responseType:"blob",data:{name:c.curDeviceModel.name}};k.exportDeviceModelProptyAndService(e).then((e=>{if(e&&"1"===e.code)return void j(e);const l=new Blob([e.blob]),a=e.fileName,t=document.createElement("a");t.download=a,t.style.display="none",t.href=URL.createObjectURL(l),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})())},{default:S((()=>[B(y,{class:"el-input__icon"},{default:S((()=>[B(R(F))])),_:1}),N(" 导出模型属性 ")])),_:1})])),_:1})])),_:1},512)]),L("div",$,[L("div",J,[L("div",K,P(c.curDeviceModel.label)+"：属性列表",1)]),B(C,{inline:!0,ref:"searchFormRef2","status-icon":"","label-width":"90px"},{default:S((()=>[B(M,{label:""},{default:S((()=>[B(X,{style:{width:"200px"},placeholder:"请输入属性名称",modelValue:R(f).deviceModelProperty,"onUpdate:modelValue":i[2]||(i[2]=e=>R(f).deviceModelProperty=e)},{prefix:S((()=>[B(y,{class:"el-input__icon"},{default:S((()=>[B(R(x))])),_:1})])),_:1},8,["modelValue"])])),_:1}),B(M,null,{default:S((()=>[B(h,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:i[3]||(i[3]=e=>{b(1)})},{default:S((()=>[B(y,{class:"btn-icon"},{default:S((()=>[B(O,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),N(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),L("div",{class:"content",ref_key:"contentRef",ref:m},[B(q,{data:R(g),"cell-style":R(f).cellStyle,"header-cell-style":R(f).headerCellStyle,style:{width:"100%"},"max-height":R(f).tableMaxHeight,stripe:""},{empty:S((()=>[oe])),default:S((()=>[B(T,{type:"expand",width:"80"},{default:S((e=>[L("div",Q,[L("div",Z,[L("div",ee,[L("b",null,P(e.row.name),1),N(" 参数详情 ")])]),L("div",le,[(V(!0),A(z,null,I(e.row.params,((e,l,a)=>(V(),A("div",{class:"param-item",key:a},[L("div",ae,P(R(f).paramName[l])+"：",1),L("div",te,P(e||"-"),1)])))),128))])])])),_:1}),B(T,{type:"index",width:"70"},{header:S((()=>[N(" 序号 ")])),_:1}),B(T,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"rulerId",label:"数据标识",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"format",label:"数据格式",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"len",label:"数据长度",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",label:"读写属性",width:"auto","min-width":"100",align:"center"},{default:S((e=>[N(P(R(f).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),B(T,{sortable:"",prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:S((e=>[N(P(R(f).typeNames["t"+e.row.type]),1)])),_:1}),B(T,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),B(T,{sortable:"",prop:"blockAddOffset",label:"块偏移地址",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"rulerAddOffset",label:"标识偏移地址",width:"auto","min-width":"150",align:"center"})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",re,[B(H,{"current-page":R(f).currentPage,"page-size":R(f).pagesize,"page-sizes":[20,50,200,500],total:R(v).length,onCurrentChange:w,onSizeChange:U,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])])}}},[["__scopeId","data-v-69ca6d48"]]);var se=e=>v.request({url:"/tsl/dlt64507/cmd",method:"get",data:e}),ne=e=>v.request({url:"/tsl/dlt64507/cmd",method:"post",data:e}),ie=e=>v.request({url:"/tsl/dlt64507/cmd",method:"put",data:e}),pe=e=>v.request({url:"/tsl/dlt64507/cmd",method:"delete",data:e}),ce=e=>v.request({url:"/tsl/dlt64507/block/xlsx",method:"post",data:e}),ue=e=>v.request({url:"/tsl/dlt64507/block/xlsx",method:"get",data:e}),me=e=>v.request({url:"/tsl/dlt64507/cmd/params",method:"get",data:e}),fe=e=>v.request({url:"/tsl/dlt64507/cmd/param",method:"post",data:e}),be=e=>v.request({url:"/tsl/dlt64507/cmd/param",method:"put",data:e}),ge=e=>v.request({url:"/tsl/dlt64507/cmd/params",method:"delete",data:e}),ye=e=>v.request({url:"/tsl/dlt64507/cmd/param/xlsx",method:"post",data:e}),he=e=>v.request({url:"/tsl/dlt64507/cmd/param/xlsx",method:"get",data:e});const ve=e=>(U("data-v-61637a1a"),e=e(),j(),e),ke={class:"main-container"},_e={style:{display:"flex","justify-content":"space-between"}},Fe={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},xe={class:"tName"},we={class:"search-bar",style:{"text-align":"right"}},Me={class:"param-content"},Ce={class:"pc-title"},Xe={class:"pct-info"},De={class:"pc-content"},Ve={class:"param-value"},Ae={class:"param-name"},Le=ve((()=>L("div",null,"无数据",-1))),Be={class:"pagination"},Se={class:"dialog-content"},Re=ve((()=>L("div",{class:"form-title"},[L("div",{class:"tName"},"配置参数")],-1))),Ne={class:"dialog-footer"},Pe={class:"dialog-content"},ze={style:{width:"100%"}},Ie={style:{"padding-right":"10px"}},Oe={class:"dialog-footer"},Ue=ve((()=>L("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),je={class:"dialog-footer"};var Te=g({__name:"BlockPropertyD07",props:{curModelBlock:{type:Object,default:{}}},emits:["changeBShowFlag"],setup(b,{emit:g}){const v=b,k=y(),_=/^[0-9]+(.[0-9]{1,2})?$/,U=(e,l,a)=>{_.test(l)?a():a(new Error("只能输入大于等于0,最多两位小数的数字！"))},j=M(null),E=C({formulaForm:{},headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",accessModeOptions:[{label:"只读",value:0},{label:"只写",value:1},{label:"读写",value:2}],typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},formatOptions:[{label:"X.XXX",value:"X.XXX"},{label:"XX",value:"XX"},{label:"XX.XX",value:"XX.XX"},{label:"XX.XXXX",value:"XX.XXXX"},{label:"XXX.X",value:"XXX.X"},{label:"XXX.XXX",value:"XXX.XXX"},{label:"XXXXXX",value:"XXXXXX"},{label:"XXXXXX.XX",value:"XXXXXX.XX"},{label:"XXXXXXXX",value:"XXXXXXXX"},{label:"XXXXXXXXXXXX",value:"XXXXXXXXXXXX"},{label:"DDhh",value:"DDhh"},{label:"MMDDNN",value:"MMDDNN"},{label:"hhmmNN",value:"hhmmNN"},{label:"YYMMDDWW",value:"YYMMDDWW"},{label:"YYMMDDhhmm",value:"YYMMDDhhmm"},{label:"YYMMDDhhmmss",value:"YYMMDDhhmmss"},{label:"C0C1C2C3",value:"C0C1C2C3"}],lenOptions:[{label:1,value:1},{label:2,value:2},{label:3,value:3},{label:4,value:4},{label:5,value:5},{label:6,value:6}],pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,unit:"",rulerId:"",len:0,blockAddOffset:0,rulerAddOffset:0,min:0,max:0,minMaxAlarm:!1,step:0,stepAlarm:!1,dataLength:0,dataLengthAlarm:!1},ruleTypeOptions:{rt1:[{label:"Int_AB",value:"Int_AB"},{label:"Int_BA",value:"Int_BA"}],rt2:[{label:"Long_ABCD",value:"Long_ABCD"},{label:"Long_BADC",value:"Long_BADC"},{label:"Long_DCBA",value:"Long_DCBA"},{label:"Long_CDAB",value:"Long_CDAB"},{label:"Float_ABCD",value:"Float_ABCD"},{label:"Float_BADC",value:"Float_BADC"},{label:"Float_DCBA",value:"Float_DCBA"},{label:"Float_CDAB",value:"Float_CDAB"}],rt4:[{label:"Double_ABCDEFGH",value:"Double_ABCDEFGH"},{label:"Double_GHEFCDAB",value:"Double_GHEFCDAB"},{label:"Double_BADCFEHG",value:"Double_BADCFEHG"},{label:"Double_HGFEDCBA",value:"Double_HGFEDCBA"}]},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",decimals:"小数位数",regCnt:"寄存器数量",ruleType:"解析规则",regAddr:"寄存器地址",formula:"计算公式",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"步长",stepAlarm:"步长报警",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],accessMode:[{required:!0,message:"读写属性不能为空",trigger:"blur"}],type:[{required:!0,message:"属性类型不能为空",trigger:"blur"}],rulerId:[{required:!0,message:"标识数据长度不能为空",trigger:"blur"}],len:[{required:!0,type:"number",message:"数据长度只能输入数字",trigger:"blur"}],blockAddOffset:[{required:!0,type:"number",message:"块数据偏移地址只能输入数字",trigger:"blur"}],rulerAddOffset:[{required:!0,type:"number",message:"标识数据地址只能输入数字",trigger:"blur"}],step:[{required:!0,message:"步长不能为空",trigger:"blur"},{trigger:"blur",validator:U}],min:[{required:!0,message:"最小值不能为空",trigger:"blur"},{trigger:"blur",validator:U}],max:[{required:!0,message:"最大值不能为空",trigger:"blur"},{trigger:"blur",validator:U}],dataLength:[{required:!0,message:"字符串长度不能为空",trigger:"blur"},{trigger:"blur",validator:/^[0-9]*[1-9][0-9]*$/}]},psFlag:!1,selectedProperties:[],fFlag:!1,propertyInfo:[],operationList:[{name:"+",label:"+",describe:"加"},{name:"-",label:"-",describe:"减"},{name:"*",label:"*",describe:"乘"},{name:"/",label:"/",describe:"除"},{name:"%",label:"%",describe:"模"},{name:"^",label:"^",describe:"次幂"},{name:"(",label:"(",describe:"左括号"},{name:")",label:")",describe:"右括号"}],curFormula:"",selectionStart:0,pItem:""}),W=l=>{const a={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name}};me(a).then((async a=>{a&&("0"===a.code?(E.propertyList=null==a.data?[]:a.data,1===l&&e({type:"success",message:"刷新成功！"})):ce(a),await O((()=>{E.tableMaxHeight=j.value.clientHeight-34-22-82})))}))};W();const Y=X((()=>E.propertyList.filter((e=>{var l=!E.deviceModelProperty,a=e.name.toLowerCase().includes(E.deviceModelProperty.toLowerCase());return l||a})).slice((E.currentPage-1)*E.pagesize,E.currentPage*E.pagesize))),G=X((()=>E.propertyList.filter((e=>{var l=!E.deviceModelProperty,a=e.name.toLowerCase().includes(E.deviceModelProperty.toLowerCase());return l||a})))),$=e=>{E.currentPage=e},J=e=>{E.pagesize=e},K=()=>{Z.value&&Z.value.submit()},Q=e=>{},Z=M(null),ee=e=>{Z.value.clearFiles();const l=e[0];Z.value.handleStart(l)},le=l=>{let a=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(a){if(a){let a=new FormData;a.append("tslName",v.curModelBlock.tslName),a.append("cmdName",v.curModelBlock.name),a.append("fileName",l);const t={token:k.token,contentType:"multipart/form-data",data:a};ye(t).then((l=>{"0"===l.code?(e.success(l.message),E.psFlag=!1,W()):ce(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ae=()=>{E.psFlag=!1,uploadRef.value.clearFiles()},te=()=>{ae()},oe=e=>{E.pFlag=!0,E.pTitle="编辑属性",E.propertyForm.name=e.name,E.propertyForm.label=e.label,E.propertyForm.rulerId=e.rulerId,E.propertyForm.format=e.format,E.propertyForm.len=e.len,E.propertyForm.unit=e.unit,E.propertyForm.accessMode=e.accessMode,E.propertyForm.type=e.type,E.propertyForm.blockAddOffset=e.blockAddOffset,E.propertyForm.rulerAddOffset=e.rulerAddOffset,3!==e.type?(E.propertyForm.min=e.params.min,E.propertyForm.max=e.params.max,E.propertyForm.minMaxAlarm=e.params.minMaxAlarm,E.propertyForm.step=void 0===e.params.step||null===e.params.step?0:e.params.step,E.propertyForm.stepAlarm=e.params.stepAlarm):(E.propertyForm.dataLength=e.params.dataLength,E.propertyForm.dataLengthAlarm=e.params.dataLengthAlarm)},re=M(null),de=()=>{E.pFlag=!1,re.value.resetFields(),ie()},se=e=>{de()},ne=e=>{E.selectedProperties=e},ie=()=>{E.propertyForm={name:"",label:"",accessMode:0,type:0,unit:"",len:0,rulerId:"",blockAddOffset:0,rulerAddOffset:0,step:0,min:0,max:0,dataLength:0}},pe=e=>{E.selectionStart=e.srcElement.selectionStart},ce=l=>{e({type:"error",message:l.message})},ue=(l,a)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&a&&a()};return T((()=>v.curModelBlock),((e,l)=>{W()})),(b,g)=>{const y=l,h=r,_=t,M=a,C=D("Icon"),X=o,O=d,U=s,T=n,ie=p,me=c,ye=u,ve=m,Te=f;return V(),A("div",ke,[L("div",_e,[L("div",Fe,[L("div",xe,P(v.curModelBlock.label)+"：命令参数列表",1)]),L("div",we,[B(X,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:S((()=>[B(_,{style:{"margin-left":"20px"}},{default:S((()=>[B(h,{style:{width:"200px"},placeholder:"请输入命令参数名称",modelValue:R(E).deviceModelProperty,"onUpdate:modelValue":g[0]||(g[0]=e=>R(E).deviceModelProperty=e)},{prefix:S((()=>[B(y,{class:"el-input__icon"},{default:S((()=>[B(R(x))])),_:1})])),_:1},8,["modelValue"])])),_:1}),B(_,null,{default:S((()=>[B(M,{type:"primary",plain:"",class:"right-btn",onClick:g[1]||(g[1]=e=>{E.psFlag=!0})},{default:S((()=>[B(y,{class:"el-input__icon"},{default:S((()=>[B(R(w))])),_:1}),N(" 导入命令参数 ")])),_:1})])),_:1}),B(_,null,{default:S((()=>[B(M,{type:"primary",plain:"",class:"right-btn",onClick:g[2]||(g[2]=e=>(()=>{const e={token:k.token,responseType:"blob",data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name}};he(e).then((e=>{if(e&&"1"===e.code)return void ce(e);const l=new Blob([e.blob]),a=e.fileName,t=document.createElement("a");t.download=a,t.style.display="none",t.href=URL.createObjectURL(l),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})())},{default:S((()=>[B(y,{class:"el-input__icon"},{default:S((()=>[B(R(F))])),_:1}),N(" 导出命令参数 ")])),_:1})])),_:1}),B(_,null,{default:S((()=>[B(M,{type:"primary",bg:"",class:"right-btn",onClick:g[3]||(g[3]=e=>(E.pFlag=!0,void(E.pTitle="添加属性")))},{default:S((()=>[B(y,{class:"btn-icon"},{default:S((()=>[B(C,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),N(" 添加 ")])),_:1})])),_:1}),B(_,null,{default:S((()=>[B(M,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:g[4]||(g[4]=e=>{W(1)})},{default:S((()=>[B(y,{class:"btn-icon"},{default:S((()=>[B(C,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),N(" 刷新 ")])),_:1})])),_:1}),B(_,null,{default:S((()=>[B(M,{type:"danger",bg:"",class:"right-btn",onClick:g[5]||(g[5]=l=>(l=>{let a=[];0!==E.selectedProperties.length?(E.selectedProperties.forEach((e=>{a.push(e.name)})),i.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name,propertyNames:a}};ge(e).then((e=>{ue(e,W)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:S((()=>[B(y,{class:"btn-icon"},{default:S((()=>[B(C,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),N(" 删除 ")])),_:1})])),_:1})])),_:1},512)])]),L("div",{class:"content",ref_key:"contentRef",ref:j},[B(U,{data:R(Y),"cell-style":R(E).cellStyle,"header-cell-style":R(E).headerCellStyle,style:{width:"100%"},"max-height":R(E).tableMaxHeight,stripe:"",onSelectionChange:ne,onRowDblclick:oe},{empty:S((()=>[Le])),default:S((()=>[B(O,{type:"selection",width:"55"}),B(O,{type:"expand",width:"60"},{default:S((e=>[L("div",Me,[L("div",Ce,[L("div",Xe,[L("b",null,P(e.row.name),1),N(" 参数详情 ")])]),L("div",De,[(V(!0),A(z,null,I(e.row.params,((e,l,a)=>(V(),A("div",{class:"param-item",key:a},[L("div",Ve,P(R(E).paramName[l])+"：",1),L("div",Ae,P(e||"-"),1)])))),128))])])])),_:1}),B(O,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"rulerId",label:"数据标识",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"format",label:"数据格式",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"len",label:"数据长度",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",label:"读写属性",width:"auto","min-width":"100",align:"center"},{default:S((e=>[N(P(R(E).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),B(O,{sortable:"",prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:S((e=>[N(P(R(E).typeNames["t"+e.row.type]),1)])),_:1}),B(O,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),B(O,{sortable:"",prop:"blockAddOffset",label:"块偏移地址",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"rulerAddOffset",label:"标识偏移地址",width:"auto","min-width":"150",align:"center"}),B(O,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:S((e=>[B(M,{onClick:l=>oe(e.row),text:"",type:"primary"},{default:S((()=>[N("编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",Be,[B(T,{"current-page":R(E).currentPage,"page-size":R(E).pagesize,"page-sizes":[20,50,200,500],total:R(G).length,onCurrentChange:$,onSizeChange:J,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),B(ve,{modelValue:R(E).pFlag,"onUpdate:modelValue":g[27]||(g[27]=e=>R(E).pFlag=e),title:R(E).pTitle,width:"800px","before-close":se,"close-on-click-modal":!1},{footer:S((()=>[L("span",Ne,[B(M,{onClick:g[25]||(g[25]=e=>de())},{default:S((()=>[N("取消")])),_:1}),B(M,{type:"primary",onClick:g[26]||(g[26]=l=>{3!==E.propertyForm.type&&Number(E.propertyForm.min)>Number(E.propertyForm.max)?e.warning("最大值必须大于最小值"):re.value.validate((e=>{if(!e)return!1;{const e={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name,name:E.propertyForm.name,label:E.propertyForm.label,rulerId:E.propertyForm.rulerId,format:E.propertyForm.format,len:E.propertyForm.len,unit:E.propertyForm.unit,accessMode:E.propertyForm.accessMode,type:E.propertyForm.type,blockAddOffset:E.propertyForm.blockAddOffset,rulerAddOffset:E.propertyForm.rulerAddOffset}};let l={};3!==E.propertyForm.type?(l.min=E.propertyForm.min.toString(),l.max=E.propertyForm.max.toString(),l.minMaxAlarm=E.propertyForm.minMaxAlarm,l.step=E.propertyForm.step.toString(),l.stepAlarm=E.propertyForm.stepAlarm):(l.dataLength=E.propertyForm.dataLength.toString(),l.dataLengthAlarm=E.propertyForm.dataLengthAlarm),e.data.params=l,E.pTitle.includes("添加")?fe(e).then((e=>{ue(e,W),de()})):be(e).then((e=>{ue(e,W),de()}))}}))})},{default:S((()=>[N("保存")])),_:1})])])),default:S((()=>[L("div",Se,[B(X,{model:R(E).propertyForm,rules:R(E).propertyRules,ref_key:"propertyFormRef",ref:re,"status-icon":"","label-position":"right","label-width":"120px",inline:!0},{default:S((()=>[B(_,{label:"属性名称",prop:"name"},{default:S((()=>[B(h,{style:{width:"220px"},disabled:R(E).pTitle.includes("编辑"),type:"text",modelValue:R(E).propertyForm.name,"onUpdate:modelValue":g[6]||(g[6]=e=>R(E).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),B(_,{label:"属性标签",prop:"label"},{default:S((()=>[B(h,{style:{width:"220px"},type:"text",modelValue:R(E).propertyForm.label,"onUpdate:modelValue":g[7]||(g[7]=e=>R(E).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),B(_,{label:"读写属性",prop:"accessMode"},{default:S((()=>[B(me,{modelValue:R(E).propertyForm.accessMode,"onUpdate:modelValue":g[8]||(g[8]=e=>R(E).propertyForm.accessMode=e),style:{width:"220px"},placeholder:"请选择读写属性"},{default:S((()=>[(V(!0),A(z,null,I(R(E).accessModeOptions,(e=>(V(),q(ie,{key:"accessMode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),B(_,{label:"单位",prop:"unit"},{default:S((()=>[B(h,{style:{width:"220px"},type:"text",modelValue:R(E).propertyForm.unit,"onUpdate:modelValue":g[9]||(g[9]=e=>R(E).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1}),B(_,{label:"属性类型",prop:"type"},{default:S((()=>[B(me,{modelValue:R(E).propertyForm.type,"onUpdate:modelValue":g[10]||(g[10]=e=>R(E).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择属性类型"},{default:S((()=>[(V(!0),A(z,null,I(R(E).typeOptions,(e=>(V(),q(ie,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),L("div",null,[3!==R(E).propertyForm.type?(V(),q(_,{key:0,label:"范围报警",prop:"minMaxAlarm"},{default:S((()=>[B(ye,{modelValue:R(E).propertyForm.minMaxAlarm,"onUpdate:modelValue":g[11]||(g[11]=e=>R(E).propertyForm.minMaxAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0)]),L("div",null,[3!==R(E).propertyForm.type&&R(E).propertyForm.minMaxAlarm?(V(),q(_,{key:0,label:"最小值",prop:"min"},{default:S((()=>[B(h,{type:"text",modelValue:R(E).propertyForm.min,"onUpdate:modelValue":g[12]||(g[12]=e=>R(E).propertyForm.min=e),autocomplete:"off",placeholder:"请输入最小值"},null,8,["modelValue"])])),_:1})):H("",!0)]),3!==R(E).propertyForm.type&&R(E).propertyForm.minMaxAlarm?(V(),q(_,{key:0,label:"最大值",prop:"max"},{default:S((()=>[B(h,{type:"text",modelValue:R(E).propertyForm.max,"onUpdate:modelValue":g[13]||(g[13]=e=>R(E).propertyForm.max=e),autocomplete:"off",placeholder:"请输入最大值"},null,8,["modelValue"])])),_:1})):H("",!0),L("div",null,[3!==R(E).propertyForm.type?(V(),q(_,{key:0,label:"步长报警",prop:"stepAlarm"},{default:S((()=>[B(ye,{modelValue:R(E).propertyForm.stepAlarm,"onUpdate:modelValue":g[14]||(g[14]=e=>R(E).propertyForm.stepAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0)]),3!==R(E).propertyForm.type&&R(E).propertyForm.stepAlarm?(V(),q(_,{key:1,label:"步长",prop:"step"},{default:S((()=>[B(h,{type:"text",modelValue:R(E).propertyForm.step,"onUpdate:modelValue":g[15]||(g[15]=e=>R(E).propertyForm.step=e),autocomplete:"off",placeholder:"请输入步长"},null,8,["modelValue"])])),_:1})):H("",!0),L("div",null,[3===R(E).propertyForm.type?(V(),q(_,{key:0,label:"字符串长度报警",prop:"dataLengthAlarm"},{default:S((()=>[B(ye,{modelValue:R(E).propertyForm.dataLengthAlarm,"onUpdate:modelValue":g[16]||(g[16]=e=>R(E).propertyForm.dataLengthAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0)]),3===R(E).propertyForm.type&&R(E).propertyForm.dataLengthAlarm?(V(),q(_,{key:2,label:"字符串长度",prop:"dataLength"},{default:S((()=>[B(h,{type:"text",modelValue:R(E).propertyForm.dataLength,"onUpdate:modelValue":g[17]||(g[17]=e=>R(E).propertyForm.dataLength=e),autocomplete:"off",placeholder:"请输入字符串长度"},null,8,["modelValue"])])),_:1})):H("",!0),B(_,{label:"数据格式",prop:"len"},{default:S((()=>[1==v.curModelBlock.format?(V(),q(h,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:R(E).propertyForm.format,"onUpdate:modelValue":g[18]||(g[18]=e=>R(E).propertyForm.format=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据格式"},null,8,["modelValue"])):(V(),q(me,{key:1,modelValue:R(E).propertyForm.format,"onUpdate:modelValue":g[19]||(g[19]=e=>R(E).propertyForm.format=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择数据格式"},{default:S((()=>[(V(!0),A(z,null,I(R(E).formatOptions,(e=>(V(),q(ie,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),B(_,{label:"数据长度",prop:"len"},{default:S((()=>[1==v.curModelBlock.len?(V(),q(h,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:R(E).propertyForm.len,"onUpdate:modelValue":g[20]||(g[20]=e=>R(E).propertyForm.len=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据长度"},null,8,["modelValue"])):(V(),q(me,{key:1,modelValue:R(E).propertyForm.len,"onUpdate:modelValue":g[21]||(g[21]=e=>R(E).propertyForm.len=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择数据长度"},{default:S((()=>[(V(!0),A(z,null,I(R(E).lenOptions,(e=>(V(),q(ie,{key:"regCount_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),Re,B(_,{label:"数据标识",prop:"rulerId"},{default:S((()=>[B(h,{type:"text",style:{width:"220px"},modelValue:R(E).propertyForm.rulerId,"onUpdate:modelValue":g[22]||(g[22]=e=>R(E).propertyForm.rulerId=e),autocomplete:"off",placeholder:"请输入数据标识"},null,8,["modelValue"])])),_:1}),1!=v.curModelBlock.blockAddOffset?(V(),q(_,{key:3,label:"",prop:"",style:{width:"220px"}})):H("",!0),B(_,{label:"块偏移地址",prop:"blockAddOffset"},{default:S((()=>[B(h,{type:"text",style:{width:"220px"},modelValue:R(E).propertyForm.blockAddOffset,"onUpdate:modelValue":g[23]||(g[23]=e=>R(E).propertyForm.blockAddOffset=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据块偏移地址"},null,8,["modelValue"])])),_:1}),B(_,{label:"标识偏移地址",prop:"rulerAddOffset"},{default:S((()=>[B(h,{type:"text",style:{width:"220px"},modelValue:R(E).propertyForm.rulerAddOffset,"onUpdate:modelValue":g[24]||(g[24]=e=>R(E).propertyForm.rulerAddOffset=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入标识偏移地址"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),B(ve,{modelValue:R(E).fFlag,"onUpdate:modelValue":g[33]||(g[33]=e=>R(E).fFlag=e),title:"编辑计算公式",width:"600px"},{footer:S((()=>[L("span",Oe,[B(M,{onClick:g[31]||(g[31]=e=>(E.fFlag=!1,void(E.curFormula="")))},{default:S((()=>[N("取消")])),_:1}),B(M,{type:"primary",onClick:g[32]||(g[32]=e=>(E.fFlag=!1,void(E.propertyForm.formula=E.curFormula)))},{default:S((()=>[N("保存")])),_:1})])])),default:S((()=>[L("div",Pe,[B(X,{model:R(E).formulaForm,"label-position":"right","label-width":"120px"},{default:S((()=>[B(_,{label:"运算符号"},{default:S((()=>[L("div",ze,[(V(!0),A(z,null,I(R(E).operationList,((e,l)=>(V(),A("div",{class:"operation",key:l},[L("div",Ie,[B(M,{style:{width:"100%"},onClick:l=>(e=>{let l=E.curFormula.length;if(l!==E.selectionStart){let a=E.curFormula.substr(0,E.selectionStart),t=E.curFormula.substr(E.selectionStart,l-E.selectionStart);E.curFormula=a+e.name+t,E.selectionStart+=e.name.length}else E.curFormula+=e.name,E.selectionStart+=e.name.length})(e)},{default:S((()=>[N(P(e.label),1)])),_:2},1032,["onClick"])])])))),128))])])),_:1}),B(_,{label:"设备属性"},{default:S((()=>[B(me,{modelValue:R(E).pItem,"onUpdate:modelValue":g[28]||(g[28]=e=>R(E).pItem=e),filterable:"",placeholder:"请选择设备属性",onChange:g[29]||(g[29]=e=>(e=>{let l=E.curFormula.length;if(l!==E.selectionStart){let a=E.curFormula.substr(0,E.selectionStart),t=E.curFormula.substr(E.selectionStart,l-E.selectionStart);E.curFormula=a+"("+e+")"+t,E.selectionStart+=e.length+2}else E.curFormula+="("+e+")",E.selectionStart+=e.length+2})(R(E).pItem)),style:{width:"100%"}},{default:S((()=>[(V(!0),A(z,null,I(R(E).propertyInfo,(e=>(V(),q(ie,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),B(_,{label:"当前公式"},{default:S((()=>[B(h,{type:"text",clearable:"",modelValue:R(E).curFormula,"onUpdate:modelValue":g[30]||(g[30]=e=>R(E).curFormula=e),autocomplete:"off",placeholder:"请编辑计算公式",onBlur:pe},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),B(ve,{modelValue:R(E).psFlag,"onUpdate:modelValue":g[34]||(g[34]=e=>R(E).psFlag=e),title:"导入命令参数",width:"600px","before-close":te,"close-on-click-modal":!1},{footer:S((()=>[L("span",je,[B(M,{onClick:ae},{default:S((()=>[N("取消")])),_:1}),B(M,{type:"primary",onClick:K},{default:S((()=>[N("上传")])),_:1})])])),default:S((()=>[B(Te,{ref_key:"uploadDPSRef",ref:Z,action:"","auto-upload":!1,"http-request":Q,limit:1,"on-exceed":ee,"before-upload":le},{tip:S((()=>[Ue])),default:S((()=>[B(M,{type:"primary"},{default:S((()=>[N("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-61637a1a"]]);const qe=e=>(U("data-v-02a90f80"),e=e(),j(),e),He={class:"main-container"},Ee={class:"main"},We={class:"mc-left"},Ye={class:"title"},Ge={class:"mcl-content"},$e={class:"mclc-content"},Je={class:"mc-right"},Ke={class:"mcr-top"},Qe={style:{display:"flex","justify-content":"space-between"}},Ze={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},el={class:"tName"},ll={class:"search-bar",style:{"text-align":"right"}},al=qe((()=>L("div",null,"无数据",-1))),tl={class:"pagination"},ol={key:0,class:"mcr-bottom"},rl={class:"dialog-content"},dl={class:"dialog-footer"},sl=qe((()=>L("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),nl={class:"dialog-footer"};var il=g({__name:"ModelBlockD07",props:{curDeviceModel:{type:Object,default:{}},deviceModelList:{type:Array,default:[]}},emits:["changeShowFlag"],setup(u,{emit:g}){const v=u,k=y();console.log("id -> props",v);const U=/^[0-9]*[1-9][0-9]*$/,j=M(null),T=C({curDeviceModel:v.curDeviceModel,headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelBlock:"",BlockReadSw:[{label:"开",value:1},{label:"关",value:0}],SWNames:{SW0:"关",SW1:"开"},typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],funCodeOptions:[{label:"01(读线圈状态)",value:1},{label:"02(读离散输入状态)",value:2},{label:"03(读保持寄存器)",value:3},{label:"04(读输入寄存器)",value:4},{label:"05(写单个线圈)",value:5},{label:"06(写单个保持寄存器)",value:6},{label:"15(写多个线圈)",value:15},{label:"16(写多个保持寄存器)",value:16}],funCodeNames:{f1:"01(读线圈状态)",f2:"02(读离散输入状态)",f3:"03(读保持寄存器)",f4:"04(读输入寄存器)",f5:"05(写单个线圈)",f6:"06(写单个保持寄存器)",f15:"15(写多个线圈)",f16:"16(写多个保持寄存器)"},dataTypeOptions:[{label:"uint8",value:0},{label:"int8",value:1},{label:"uint16",value:2},{label:"int16",value:3},{label:"uint32",value:4},{label:"int32",value:5},{label:"float",value:6},{label:"double",value:7}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},dataTypeNames:{dt0:"uint8",dt1:"int8",dt2:"uint16",dt3:"int16",dt4:"uint32",dt5:"int32",dt6:"float",dt7:"double"},pFlag:!1,pTitle:"添加属性",blockForm:{name:"",label:"",blockRulerId:"",blockRead:0},paramName:{name:"块名称",label:"块标签",funCode:"功能码",type:"属性类型",startRegAddr:"寄存器地址",regCnt:"寄存器数量"},propertyRules:{name:[{required:!0,message:"块名称不能为空",trigger:"blur"}],label:[{required:!0,message:"块标签不能为空",trigger:"blur"}],funCode:[{required:!0,message:"功能码不能为空",trigger:"blur"}],startRegAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,a)=>{0===l||U.test(l)?a():a(new Error("只能输入自然数！"))}}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,a)=>{U.test(l)?a():a(new Error("只能输入正整数数字！"))}}]},psFlag:!1,selectedProperties:[],curModelBlock:{},porpFlag:!1}),W=l=>{const a={token:k.token,data:{tslName:T.curDeviceModel.name}};se(a).then((async a=>{a&&("0"===a.code?(T.propertyList=a.data,T.propertyList.length>0?(T.curModelBlock=T.propertyList[0],T.curModelBlock.tslName=T.curDeviceModel.name,console.log("getDeviceModelBlock -> ctxData.curModelBlock",T.curModelBlock),T.porpFlag=!0):T.porpFlag=!1,1===l&&e({type:"success",message:"刷新成功！"})):ye(a),await O((()=>{T.tableMaxHeight=j.value.clientHeight-34-22-82,2===l&&ge(T.curModelBlock)})))}))};W(2);const Y=X((()=>(console.log("ctxData.propertyList ->",T.propertyList),T.propertyList.filter((e=>{var l=!T.deviceModelBlock,a=e.name.toLowerCase().includes(T.deviceModelBlock.toLowerCase());return l||a})).slice((T.currentPage-1)*T.pagesize,T.currentPage*T.pagesize)))),G=X((()=>T.propertyList.filter((e=>{var l=!T.deviceModelBlock,a=e.name.toLowerCase().includes(T.deviceModelBlock.toLowerCase());return l||a})))),$=e=>{T.currentPage=e},J=e=>{T.pagesize=e},K=()=>{Z.value&&Z.value.submit()},Q=e=>{},Z=M(null),ee=e=>{Z.value.clearFiles();const l=e[0];Z.value.handleStart(l)},le=l=>{console.log("beforeUpload -> file",l);let a=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(a){if(a){let a=new FormData;a.append("name",T.curDeviceModel.name),a.append("fileName",l);const t={token:k.token,contentType:"multipart/form-data",data:a};ce(t).then((l=>{"0"===l.code?(e.success(l.message),T.psFlag=!1,W()):ye(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ae=()=>{T.psFlag=!1,uploadRef.value.clearFiles()},te=()=>{ae()},oe=e=>{T.pFlag=!0,T.pTitle="编辑属性",T.blockForm.name=e.name,T.blockForm.label=e.label,T.blockForm.blockRulerId=e.blockRulerId,T.blockForm.blockRead=e.blockRead},re=M(null),de=()=>{T.pFlag=!1,re.value.resetFields(),be()},me=e=>{de()},fe=e=>{T.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},be=()=>{T.blockForm={name:"",label:"",blockRulerId:"",blockRead:0}},ge=e=>{T.curModelBlock=e,T.curModelBlock.tslName=T.curDeviceModel.name},ye=l=>{e({type:"error",message:l.message})},he=(l,a)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&a&&a()};return(u,y)=>{const h=l,M=a,C=b,X=r,O=t,U=D("Icon"),se=o,ce=d,be=s,ve=n,ke=p,_e=c,Fe=m,xe=f;return V(),A("div",He,[L("div",Ee,[L("div",We,[L("div",Ye,[B(M,{type:"primary",style:{width:"100%"},plain:"",onClick:y[0]||(y[0]=e=>{g("changeShowFlag")})},{default:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(_))])),_:1}),N(" 返回设备模型 ")])),_:1})]),L("div",Ge,[(V(!0),A(z,null,I(v.deviceModelList,((e,l)=>(V(),q(C,{key:"i"+l,shadow:"hover",class:E({"mclc-card":!0,activeModel:e.name==R(T).curDeviceModel.name}),onClick:l=>(e=>{T.curDeviceModel.name!=e.name&&(T.curDeviceModel=e,W())})(e)},{default:S((()=>[L("div",$e,[L("span",null,P(e.name),1)])])),_:2},1032,["class","onClick"])))),128))])]),L("div",Je,[L("div",Ke,[L("div",Qe,[L("div",Ze,[L("div",el,P(R(T).curDeviceModel.label)+"：命令列表",1)]),L("div",ll,[B(se,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:S((()=>[B(O,{style:{"margin-left":"20px"}},{default:S((()=>[B(X,{style:{width:"200px"},placeholder:"请输入命令名称",modelValue:R(T).deviceModelBlock,"onUpdate:modelValue":y[1]||(y[1]=e=>R(T).deviceModelBlock=e)},{prefix:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(x))])),_:1})])),_:1},8,["modelValue"])])),_:1}),B(O,null,{default:S((()=>[B(M,{type:"primary",plain:"",class:"right-btn",onClick:y[2]||(y[2]=e=>(console.log("importDPS"),void(T.psFlag=!0)))},{default:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(w))])),_:1}),N(" 导入命令 ")])),_:1})])),_:1}),B(O,null,{default:S((()=>[B(M,{type:"primary",plain:"",class:"right-btn",onClick:y[3]||(y[3]=e=>(()=>{console.log("exportDPS");const e={token:k.token,responseType:"blob",data:{name:T.curDeviceModel.name}};ue(e).then((e=>{if(e&&"1"===e.code)return void ye(e);const l=new Blob([e.blob]),a=e.fileName,t=document.createElement("a");t.download=a,t.style.display="none",t.href=URL.createObjectURL(l),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})())},{default:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(F))])),_:1}),N(" 导出命令 ")])),_:1})])),_:1}),B(O,null,{default:S((()=>[B(M,{type:"primary",bg:"",class:"right-btn",onClick:y[4]||(y[4]=e=>(console.log("addDeviceModelBlock"),T.pFlag=!0,void(T.pTitle="添加属性")))},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(U,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),N(" 添加 ")])),_:1})])),_:1}),B(O,null,{default:S((()=>[B(M,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:y[5]||(y[5]=e=>{W(1)})},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(U,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),N(" 刷新 ")])),_:1})])),_:1}),B(O,null,{default:S((()=>[B(M,{type:"danger",bg:"",class:"right-btn",onClick:y[6]||(y[6]=l=>(l=>{let a=[];0!==T.selectedProperties.length?(T.selectedProperties.forEach((e=>{a.push(e.name)})),console.log("pList",a),i.confirm("确认要删除这些命令吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:k.token,data:{tslName:T.curDeviceModel.name,names:a}};pe(e).then((e=>{he(e,W)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个命令！")})())},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(U,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),N(" 删除 ")])),_:1})])),_:1})])),_:1},512)])]),L("div",{class:"content",ref_key:"contentRef",ref:j},[B(be,{data:R(Y),"cell-style":R(T).cellStyle,"header-cell-style":R(T).headerCellStyle,style:{width:"100%"},"max-height":R(T).tableMaxHeight,stripe:"",onSelectionChange:fe,onRowDblclick:oe},{empty:S((()=>[al])),default:S((()=>[B(ce,{type:"selection",width:"55"}),B(ce,{sortable:"",prop:"name",label:"命令名称",width:"auto","min-width":"150",align:"center"}),B(ce,{sortable:"",prop:"label",label:"命令标签",width:"auto","min-width":"150",align:"center"}),B(ce,{sortable:"",prop:"blockRulerId",label:"块数据标识",width:"auto","min-width":"120",align:"center"}),B(ce,{sortable:"",label:"块读取开关",width:"auto","min-width":"100",align:"center"},{default:S((e=>[N(P(R(T).SWNames["SW"+e.row.blockRead]),1)])),_:1}),B(ce,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:S((e=>[B(M,{onClick:l=>oe(e.row),text:"",type:"primary"},{default:S((()=>[N("编辑")])),_:2},1032,["onClick"]),B(M,{onClick:l=>ge(e.row,2),text:"",type:"success"},{default:S((()=>[N("命令参数详情")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",tl,[B(ve,{"current-page":R(T).currentPage,"page-size":R(T).pagesize,"page-sizes":[20,50,200,500],total:R(G).length,onCurrentChange:$,onSizeChange:J,background:"",layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])],512)]),R(T).porpFlag?(V(),A("div",ol,[B(Te,{curModelBlock:R(T).curModelBlock},null,8,["curModelBlock"])])):H("",!0)]),B(Fe,{modelValue:R(T).pFlag,"onUpdate:modelValue":y[13]||(y[13]=e=>R(T).pFlag=e),title:R(T).pTitle,width:"600px","before-close":me,"close-on-click-modal":!1},{footer:S((()=>[L("span",dl,[B(M,{onClick:y[11]||(y[11]=e=>de())},{default:S((()=>[N("取消")])),_:1}),B(M,{type:"primary",onClick:y[12]||(y[12]=e=>{re.value.validate((e=>{if(!e)return!1;{const e={token:k.token,data:{tslName:T.curDeviceModel.name,name:T.blockForm.name,label:T.blockForm.label,blockRulerId:T.blockForm.blockRulerId,blockRead:T.blockForm.blockRead}};T.pTitle.includes("添加")?ne(e).then((e=>{he(e,W),de()})):ie(e).then((l=>{console.log("----GWAI----"),console.log(e),he(l,W),de()}))}}))})},{default:S((()=>[N("保存")])),_:1})])])),default:S((()=>[L("div",rl,[B(se,{model:R(T).blockForm,rules:R(T).propertyRules,ref_key:"blockFormRef",ref:re,"status-icon":"","label-position":"right","label-width":"120px"},{default:S((()=>[B(O,{label:"块名称",prop:"name"},{default:S((()=>[B(X,{disabled:R(T).pTitle.includes("编辑"),type:"text",modelValue:R(T).blockForm.name,"onUpdate:modelValue":y[7]||(y[7]=e=>R(T).blockForm.name=e),autocomplete:"off",placeholder:"请输入块名称"},null,8,["disabled","modelValue"])])),_:1}),B(O,{label:"块标签",prop:"label"},{default:S((()=>[B(X,{type:"text",modelValue:R(T).blockForm.label,"onUpdate:modelValue":y[8]||(y[8]=e=>R(T).blockForm.label=e),autocomplete:"off",placeholder:"请输入块标签"},null,8,["modelValue"])])),_:1}),B(O,{label:"块数据标识",prop:"blockRulerId"},{default:S((()=>[B(X,{type:"text",modelValue:R(T).blockForm.blockRulerId,"onUpdate:modelValue":y[9]||(y[9]=e=>R(T).blockForm.blockRulerId=e),placeholder:"请输入块数据标识"},null,8,["modelValue"])])),_:1}),B(O,{label:"块读取开关",prop:"blockRead"},{default:S((()=>[B(_e,{modelValue:R(T).blockForm.blockRead,"onUpdate:modelValue":y[10]||(y[10]=e=>R(T).blockForm.blockRead=e),style:{width:"100%"},placeholder:"请选择是否打开块读取"},{default:S((()=>[(V(!0),A(z,null,I(R(T).BlockReadSw,(e=>(V(),q(ke,{key:"SW"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),B(Fe,{modelValue:R(T).psFlag,"onUpdate:modelValue":y[14]||(y[14]=e=>R(T).psFlag=e),title:"导入命令",width:"600px","before-close":te,"close-on-click-modal":!1},{footer:S((()=>[L("span",nl,[B(M,{onClick:ae},{default:S((()=>[N("取消")])),_:1}),B(M,{type:"primary",onClick:K},{default:S((()=>[N("上传")])),_:1})])])),default:S((()=>[B(xe,{ref_key:"uploadDPSRef",ref:Z,action:"","auto-upload":!1,"http-request":Q,limit:1,"on-exceed":ee,"before-upload":le},{tip:S((()=>[sl])),default:S((()=>[B(M,{type:"primary"},{default:S((()=>[N("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-02a90f80"]]);const pl={class:"main-container"},cl={key:0,class:"main"},ul={class:"search-bar"},ml={class:"tool-bar"},fl=(e=>(U("data-v-46170bfd"),e=e(),j(),e))((()=>L("div",null,"无数据",-1))),bl={class:"pagination"},gl={class:"dialog-content"},yl={class:"dialog-footer"};var hl=g({__name:"DeviceModelD07",setup(p){const c=y(),u=M(null),f=C({typeModel:3,showFlag:0,headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceModelInfo:"",tableData:[],modelForm:{name:"",label:"",type:0,param:""},modelRules:{name:[{required:!0,message:"采集模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"采集模型标识不能为空",trigger:"blur"}],param:[{required:!0,message:"采集模型插件不能为空",trigger:"blur"}]},udFlag:!1,dmFlag:!1,dmTitle:"添加采集模型",pluginList:[],curDeviceModel:""}),b=l=>{const a={token:c.token,data:{type:f.typeModel}};k.getDeviceModelList(a).then((async a=>{a&&("0"===a.code?(f.tableData=a.data,1===l&&e({type:"success",message:"刷新成功！"})):T(a),await O((()=>{f.tableMaxHeight=u.value.clientHeight-34-36-22})))}))};b();const g=X((()=>f.tableData.filter((e=>{var l=!f.deviceModelInfo,a=e.name.toLowerCase().includes(f.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(f.deviceModelInfo.toLowerCase());return l||a})).slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize))),v=X((()=>f.tableData.filter((e=>{var l=!f.deviceModelInfo,a=e.name.toLowerCase().includes(f.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(f.deviceModelInfo.toLowerCase());return l||a})))),_=e=>{f.currentPage=e},F=e=>{f.pagesize=e},w=e=>{f.dmFlag=!0,f.dmTitle="编辑采集模型",f.modelForm={name:e.name,label:e.label,type:void 0===e.type?0:e.type,param:e.param}},P=M(null),z=()=>{f.dmFlag=!1,P.value.resetFields(),U()},I=()=>{z()},U=()=>{f.modelForm={name:"",label:"",type:0}},j=()=>{f.showFlag=0},T=l=>{e({type:"error",message:l.message})},E=(l,a)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&a&&a()};return(p,y)=>{const h=l,M=r,C=t,X=D("Icon"),O=a,U=o,T=d,W=s,Y=n,G=m;return V(),A("div",pl,[0===R(f).showFlag?(V(),A("div",cl,[L("div",ul,[B(U,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:S((()=>[B(C,{label:"采集模型名称"},{default:S((()=>[B(M,{style:{width:"200px"},placeholder:"请输入采集模型名称",modelValue:R(f).deviceModelInfo,"onUpdate:modelValue":y[0]||(y[0]=e=>R(f).deviceModelInfo=e)},{prefix:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(x))])),_:1})])),_:1},8,["modelValue"])])),_:1}),B(C,null,{default:S((()=>[B(O,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:y[1]||(y[1]=e=>{b(1)})},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(X,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),N(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),L("div",ml,[B(O,{type:"primary",bg:"",class:"right-btn",onClick:y[2]||(y[2]=e=>(f.dmFlag=!0,void(f.dmTitle="添加采集模型")))},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(X,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),N(" 添加 ")])),_:1})]),L("div",{class:"content",ref_key:"contentRef",ref:u},[B(W,{data:R(g),"cell-style":R(f).cellStyle,"header-cell-style":R(f).headerCellStyle,"max-height":R(f).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:w},{empty:S((()=>[fl])),default:S((()=>[B(T,{sortable:"",prop:"name",label:"采集模型名称",width:"auto","min-width":"200",align:"center"}),B(T,{sortable:"",prop:"label",label:"采集模型标签",width:"auto","min-width":"200",align:"center"}),B(T,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:S((l=>[B(O,{onClick:e=>{return a=l.row,f.curDeviceModel=a,void(f.showFlag=1);var a},text:"",type:"success"},{default:S((()=>[N("变量详情")])),_:2},1032,["onClick"]),B(O,{onClick:e=>{return a=l.row,f.curDeviceModel=a,void(f.showFlag=2);var a},text:"",type:"success"},{default:S((()=>[N("命令详情")])),_:2},1032,["onClick"]),B(O,{onClick:e=>w(l.row),text:"",type:"primary"},{default:S((()=>[N("编辑")])),_:2},1032,["onClick"]),B(O,{onClick:a=>{return t=l.row,void i.confirm("确定要删除这个采集模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:c.token,data:{name:t.name,type:3}};k.deleteDeviceModel(e).then((e=>{E(e,b)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var t},text:"",type:"danger"},{default:S((()=>[N("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",bl,[B(Y,{"current-page":R(f).currentPage,"page-size":R(f).pagesize,"page-sizes":[20,50,200,500],total:R(v).length,onCurrentChange:_,onSizeChange:F,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):H("",!0),1===R(f).showFlag?(V(),q(de,{key:1,curDeviceModel:R(f).curDeviceModel,onChangeShowFlag:y[3]||(y[3]=e=>j()),style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel"])):H("",!0),2===R(f).showFlag?(V(),q(il,{key:2,curDeviceModel:R(f).curDeviceModel,deviceModelList:R(f).tableData,onChangeShowFlag:y[4]||(y[4]=e=>j()),style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel","deviceModelList"])):H("",!0),B(G,{modelValue:R(f).dmFlag,"onUpdate:modelValue":y[9]||(y[9]=e=>R(f).dmFlag=e),title:R(f).dmTitle,width:"600px","before-close":I,"close-on-click-modal":!1},{footer:S((()=>[L("span",yl,[B(O,{onClick:y[7]||(y[7]=e=>z())},{default:S((()=>[N("取消")])),_:1}),B(O,{type:"primary",onClick:y[8]||(y[8]=e=>{P.value.validate((e=>{if(!e)return!1;{f.modelForm.type=f.typeModel;const e={token:c.token,data:f.modelForm};f.dmTitle.includes("添加")?k.addDeviceModel(e).then((e=>{E(e,b),z()})):k.editDeviceModel(e).then((e=>{E(e,b),z()}))}}))})},{default:S((()=>[N("保存")])),_:1})])])),default:S((()=>[L("div",gl,[B(U,{model:R(f).modelForm,rules:R(f).modelRules,ref_key:"modelFormRef",ref:P,"status-icon":"","label-position":"right","label-width":"120px"},{default:S((()=>[B(C,{label:"采集模型名称",prop:"name"},{default:S((()=>[B(M,{type:"text",disabled:R(f).dmTitle.includes("编辑"),modelValue:R(f).modelForm.name,"onUpdate:modelValue":y[5]||(y[5]=e=>R(f).modelForm.name=e),autocomplete:"off",placeholder:"请输入采集模型名称"},null,8,["disabled","modelValue"])])),_:1}),B(C,{label:"采集模型标签",prop:"label"},{default:S((()=>[B(M,{type:"text",modelValue:R(f).modelForm.label,"onUpdate:modelValue":y[6]||(y[6]=e=>R(f).modelForm.label=e),autocomplete:"off",placeholder:"请输入采集模型标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-46170bfd"]]);export{hl as default};
