import{h as e,e as l,p as t,m as a,D as o,F as r,G as d,C as s,n,y as i,A as c,o as u,q as p,H as m,u as f}from"./element-plus.795748f2.js";import{_ as b,u as g,v as y,s as h}from"./index.3a6602e1.js";import{D as v}from"./deviceModel.eb023515.js";import{J as k,M as _,I as F,L as w}from"./@element-plus.102632fb.js";import{f as M,Y as x,p as C,X,o as D,c as V,a as B,S as L,Q as A,u as S,U as R,a0 as N,as as I,at as P,H as z,h as O,M as U,af as j,P as T,L as q,O as H}from"./@vue.8518410d.js";import"./@vueuse.c0256496.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./vue-router.ae8a7199.js";import"./pinia.4a496763.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./nprogress.aae2b787.js";const E=e=>(I("data-v-cc1ae748"),e=e(),P(),e),W={class:"main"},Y={class:"title",style:{"justify-content":"space-between"}},G=N(" 返回设备模型 "),J={style:{display:"flex","align-items":"center"}},Q=N(" 导出模型属性 "),$={class:"title",style:{top:"60px",height:"76px",padding:"20px 0","justify-content":"space-between"}},K={class:"tName"},Z={style:{display:"flex"}},ee=N(" 刷新 "),le=N(" 序号 "),te=E((()=>B("div",null,"无数据",-1))),ae={class:"pagination"};var oe=b({props:{curDeviceModel:{type:Object,default:{}}},emits:["changeShowFlag"],setup(s,{emit:n}){const i=s,c=g();console.log("id -> props",i);const u=M(null),p=x({headerCellStyle:{background:y.primaryColor,color:y.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",rulerId:"",format:"",len:0,accessMode:0,type:0,unit:"",blockAddOffset:0,rulerAddOffset:0},psFlag:!1,selectedProperties:[]}),m=l=>{const t={token:c.token,data:{name:i.curDeviceModel.name}};v.getDeviceModelProperty(t).then((async t=>{console.log("getDeviceModelProperty -> res",t),t&&("0"===t.code?(p.propertyList=t.data,1===l&&e({type:"success",message:"刷新成功！"})):I(t),await z((()=>{p.tableMaxHeight=u.value.clientHeight-34-36-22})))}))};m();const f=C((()=>(console.log("ctxData.propertyList ->",p.propertyList),p.propertyList.filter((e=>{var l=!p.deviceModelProperty,t=e.name.toLowerCase().includes(p.deviceModelProperty.toLowerCase());return l||t})).slice((p.currentPage-1)*p.pagesize,p.currentPage*p.pagesize)))),b=C((()=>p.propertyList.filter((e=>{var l=!p.deviceModelProperty,t=e.name.toLowerCase().includes(p.deviceModelProperty.toLowerCase());return l||t})))),h=e=>{p.currentPage=e},w=e=>{p.pagesize=e},I=l=>{e({type:"error",message:l.message})};return(e,s)=>{const g=l,y=t,M=a,x=X("Icon"),C=o,P=r,z=d;return D(),V("div",W,[B("div",Y,[B("div",null,[L(y,{type:"primary",plain:"",onClick:s[0]||(s[0]=e=>(console.log("toDeviceModel"),void n("changeShowFlag")))},{default:A((()=>[L(g,{class:"el-input__icon"},{default:A((()=>[L(S(k))])),_:1}),G])),_:1})]),B("div",J,[L(y,{type:"primary",plain:"",class:"right-btn",onClick:s[1]||(s[1]=e=>(()=>{console.log("exportDPS");const e={token:c.token,responseType:"blob",data:{name:i.curDeviceModel.name}};v.exportDeviceModelProptyAndService(e).then((e=>{if(e&&"1"===e.code)return void I(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:A((()=>[L(g,{class:"el-input__icon"},{default:A((()=>[L(S(_))])),_:1}),Q])),_:1})])]),B("div",$,[B("div",K,R(i.curDeviceModel.label)+"：属性列表",1),B("div",Z,[L(M,{style:{width:"200px"},placeholder:"请输入属性名称",modelValue:S(p).deviceModelProperty,"onUpdate:modelValue":s[2]||(s[2]=e=>S(p).deviceModelProperty=e)},{prefix:A((()=>[L(g,{class:"el-input__icon"},{default:A((()=>[L(S(F))])),_:1})])),_:1},8,["modelValue"]),L(y,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:s[3]||(s[3]=e=>{m(1)})},{default:A((()=>[L(g,{class:"btn-icon"},{default:A((()=>[L(x,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),ee])),_:1})])]),B("div",{class:"content",ref_key:"contentRef",ref:u,style:{top:"136px"}},[L(P,{data:S(f),"cell-style":S(p).cellStyle,"header-cell-style":S(p).headerCellStyle,"max-height":S(p).tableMaxHeight,style:{width:"100%"},stripe:""},{empty:A((()=>[te])),default:A((()=>[L(C,{type:"index",width:"60"},{header:A((()=>[le])),_:1}),L(C,{prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),L(C,{prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),L(C,{prop:"rulerId",label:"数据标识",width:"auto","min-width":"150",align:"center"}),L(C,{prop:"format",label:"数据格式",width:"auto","min-width":"150",align:"center"}),L(C,{prop:"len",label:"数据长度",width:"auto","min-width":"150",align:"center"}),L(C,{label:"读写属性",width:"auto","min-width":"80",align:"center"},{default:A((e=>[N(R(S(p).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),L(C,{prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:A((e=>[N(R(S(p).typeNames["t"+e.row.type]),1)])),_:1}),L(C,{prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),L(C,{prop:"blockAddOffset",label:"块偏移地址",width:"auto","min-width":"150",align:"center"}),L(C,{prop:"rulerAddOffset",label:"标识偏移地址",width:"auto","min-width":"150",align:"center"})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),B("div",ae,[L(z,{"current-page":S(p).currentPage,"page-size":S(p).pagesize,"page-sizes":[20,50,200,500],total:S(b).length,onCurrentChange:h,onSizeChange:w,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])}}},[["__scopeId","data-v-cc1ae748"]]);var re=e=>h.request({url:"/tsl/dlt64507/cmd",method:"get",data:e}),de=e=>h.request({url:"/tsl/dlt64507/cmd",method:"post",data:e}),se=e=>h.request({url:"/tsl/dlt64507/cmd",method:"put",data:e}),ne=e=>h.request({url:"/tsl/dlt64507/cmd",method:"delete",data:e}),ie=e=>h.request({url:"/tsl/dlt64507/block/xlsx",method:"post",data:e}),ce=e=>h.request({url:"/tsl/dlt64507/block/xlsx",method:"get",data:e}),ue=e=>h.request({url:"/tsl/dlt64507/cmd/params",method:"get",data:e}),pe=e=>h.request({url:"/tsl/dlt64507/cmd/param",method:"post",data:e}),me=e=>h.request({url:"/tsl/dlt64507/cmd/param",method:"put",data:e}),fe=e=>h.request({url:"/tsl/dlt64507/cmd/params",method:"delete",data:e}),be=e=>h.request({url:"/tsl/dlt64507/cmd/param/xlsx",method:"post",data:e}),ge=e=>h.request({url:"/tsl/dlt64507/cmd/param/xlsx",method:"get",data:e});const ye=e=>(I("data-v-32570b60"),e=e(),P(),e),he={class:"title",style:{"justify-content":"space-between"}},ve={class:"tName"},ke={style:{display:"flex"}},_e=N(" 导入命令参数 "),Fe=N(" 导出命令参数 "),we=N(" 添加 "),Me=N(" 刷新 "),xe=N(" 删除 "),Ce=N("编辑"),Xe=ye((()=>B("div",null,"无数据",-1))),De={class:"pagination"},Ve={class:"dialog-content"},Be=ye((()=>B("div",{class:"form-title"},[B("div",{class:"tName"},"配置参数")],-1))),Le={class:"dialog-footer"},Ae=N("取消"),Se=N("保存"),Re={class:"dialog-content"},Ne={style:{width:"100%"}},Ie={class:"operation"},Pe={style:{"padding-right":"10px"}},ze={class:"dialog-footer"},Oe=N("取消"),Ue=N("保存"),je=N("选择文件"),Te=ye((()=>B("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),qe={class:"dialog-footer"},He=N("取消"),Ee=N("上传");var We=b({props:{curModelBlock:{type:Object,default:{}}},emits:["changeBShowFlag"],setup(f,{emit:b}){const h=f,v=g(),k=M(null),I=x({formulaForm:{},headerCellStyle:{background:y.primaryColor,color:y.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",accessModeOptions:[{label:"只读",value:0},{label:"只写",value:1},{label:"读写",value:2}],typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},formatOptions:[{label:"X.XXX",value:"X.XXX"},{label:"XX",value:"XX"},{label:"XX.XX",value:"XX.XX"},{label:"XX.XXXX",value:"XX.XXXX"},{label:"XXX.X",value:"XXX.X"},{label:"XXX.XXX",value:"XXX.XXX"},{label:"XXXXXX",value:"XXXXXX"},{label:"XXXXXX.XX",value:"XXXXXX.XX"},{label:"XXXXXXXX",value:"XXXXXXXX"},{label:"XXXXXXXXXXXX",value:"XXXXXXXXXXXX"},{label:"DDhh",value:"DDhh"},{label:"MMDDNN",value:"MMDDNN"},{label:"hhmmNN",value:"hhmmNN"},{label:"YYMMDDWW",value:"YYMMDDWW"},{label:"YYMMDDhhmm",value:"YYMMDDhhmm"},{label:"YYMMDDhhmmss",value:"YYMMDDhhmmss"},{label:"C0C1C2C3",value:"C0C1C2C3"}],lenOptions:[{label:1,value:1},{label:2,value:2},{label:3,value:3},{label:4,value:4},{label:5,value:5},{label:6,value:6}],pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,unit:"",rulerId:"",len:0,blockAddOffset:0,rulerAddOffset:0},ruleTypeOptions:{rt1:[{label:"Int_AB",value:"Int_AB"},{label:"Int_BA",value:"Int_BA"}],rt2:[{label:"Long_ABCD",value:"Long_ABCD"},{label:"Long_BADC",value:"Long_BADC"},{label:"Long_DCBA",value:"Long_DCBA"},{label:"Long_CDAB",value:"Long_CDAB"},{label:"Float_ABCD",value:"Float_ABCD"},{label:"Float_BADC",value:"Float_BADC"},{label:"Float_DCBA",value:"Float_DCBA"},{label:"Float_CDAB",value:"Float_CDAB"}],rt4:[{label:"Double_ABCDEFGH",value:"Double_ABCDEFGH"},{label:"Double_GHEFCDAB",value:"Double_GHEFCDAB"},{label:"Double_BADCFEHG",value:"Double_BADCFEHG"},{label:"Double_HGFEDCBA",value:"Double_HGFEDCBA"}]},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",decimals:"小数位数",regCnt:"寄存器数量",ruleType:"解析规则",regAddr:"寄存器地址",formula:"计算公式"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],accessMode:[{required:!0,message:"读写属性不能为空",trigger:"blur"}],type:[{required:!0,message:"属性类型不能为空",trigger:"blur"}],rulerId:[{required:!0,message:"标识数据长度不能为空",trigger:"blur"}],len:[{required:!0,type:"number",message:"数据长度只能输入数字",trigger:"blur"}],blockAddOffset:[{required:!0,type:"number",message:"块数据偏移地址只能输入数字",trigger:"blur"}],rulerAddOffset:[{required:!0,type:"number",message:"标识数据地址只能输入数字",trigger:"blur"}]},psFlag:!1,selectedProperties:[],fFlag:!1,propertyInfo:[],operationList:[{name:"+",label:"+",describe:"加"},{name:"-",label:"-",describe:"减"},{name:"*",label:"*",describe:"乘"},{name:"/",label:"/",describe:"除"},{name:"%",label:"%",describe:"模"},{name:"^",label:"^",describe:"次幂"},{name:"(",label:"(",describe:"左括号"},{name:")",label:")",describe:"右括号"}],curFormula:"",selectionStart:0,pItem:""}),P=l=>{const t={token:v.token,data:{tslName:h.curModelBlock.tslName,cmdName:h.curModelBlock.name}};ue(t).then((async t=>{t&&("0"===t.code?(I.propertyList=null==t.data?[]:t.data,1===l&&e({type:"success",message:"刷新成功！"})):ne(t),await z((()=>{I.tableMaxHeight=k.value.clientHeight-34-22})))}))};P();const H=C((()=>I.propertyList.filter((e=>{var l=!I.deviceModelProperty,t=e.name.toLowerCase().includes(I.deviceModelProperty.toLowerCase());return l||t})).slice((I.currentPage-1)*I.pagesize,I.currentPage*I.pagesize))),E=C((()=>I.propertyList.filter((e=>{var l=!I.deviceModelProperty,t=e.name.toLowerCase().includes(I.deviceModelProperty.toLowerCase());return l||t})))),W=e=>{I.currentPage=e},Y=e=>{I.pagesize=e},G=()=>{Q.value&&Q.value.submit()},J=e=>{},Q=M(null),$=e=>{Q.value.clearFiles();const l=e[0];Q.value.handleStart(l)},K=l=>{let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("tslName",h.curModelBlock.tslName),t.append("cmdName",h.curModelBlock.name),t.append("fileName",l);const a={token:v.token,contentType:"multipart/form-data",data:t};be(a).then((l=>{"0"===l.code?(e.success(l.message),I.psFlag=!1,P()):ne(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},Z=()=>{I.psFlag=!1,uploadRef.value.clearFiles()},ee=()=>{Z()},le=e=>{I.pFlag=!0,I.pTitle="编辑属性",I.propertyForm.name=e.name,I.propertyForm.label=e.label,I.propertyForm.rulerId=e.rulerId,I.propertyForm.format=e.format,I.propertyForm.len=e.len,I.propertyForm.unit=e.unit,I.propertyForm.accessMode=e.accessMode,I.propertyForm.type=e.type,I.propertyForm.blockAddOffset=e.blockAddOffset,I.propertyForm.rulerAddOffset=e.rulerAddOffset},te=M(null),ae=()=>{I.pFlag=!1,te.value.resetFields(),de()},oe=e=>{ae()},re=e=>{I.selectedProperties=e},de=()=>{I.propertyForm={name:"",label:"",accessMode:0,type:0,unit:"",len:0,rulerId:"",blockAddOffset:0,rulerAddOffset:0}},se=e=>{I.selectionStart=e.srcElement.selectionStart},ne=l=>{e({type:"error",message:l.message})},ie=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return O((()=>h.curModelBlock),((e,l)=>{P()})),(f,b)=>{const g=l,y=a,M=t,x=X("Icon"),C=o,z=r,O=d,de=n,ce=i,ue=c,be=u,ye=p,We=m;return D(),V(U,null,[B("div",he,[B("div",ve,R(h.curModelBlock.label)+"：命令参数列表",1),B("div",ke,[L(y,{style:{width:"200px"},placeholder:"请输入命令参数名称",modelValue:S(I).deviceModelProperty,"onUpdate:modelValue":b[0]||(b[0]=e=>S(I).deviceModelProperty=e)},{prefix:A((()=>[L(g,{class:"el-input__icon"},{default:A((()=>[L(S(F))])),_:1})])),_:1},8,["modelValue"]),L(M,{type:"primary",plain:"",class:"right-btn",onClick:b[1]||(b[1]=e=>{I.psFlag=!0})},{default:A((()=>[L(g,{class:"el-input__icon"},{default:A((()=>[L(S(w))])),_:1}),_e])),_:1}),L(M,{type:"primary",plain:"",class:"right-btn",onClick:b[2]||(b[2]=e=>(()=>{const e={token:v.token,responseType:"blob",data:{tslName:h.curModelBlock.tslName,cmdName:h.curModelBlock.name}};ge(e).then((e=>{if(e&&"1"===e.code)return void ne(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:A((()=>[L(g,{class:"el-input__icon"},{default:A((()=>[L(S(_))])),_:1}),Fe])),_:1}),L(M,{type:"primary",bg:"",class:"right-btn",onClick:b[3]||(b[3]=e=>(I.pFlag=!0,void(I.pTitle="添加属性")))},{default:A((()=>[L(g,{class:"btn-icon"},{default:A((()=>[L(x,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),we])),_:1}),L(M,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:b[4]||(b[4]=e=>{P(1)})},{default:A((()=>[L(g,{class:"btn-icon"},{default:A((()=>[L(x,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),Me])),_:1}),L(M,{type:"danger",bg:"",class:"right-btn",onClick:b[5]||(b[5]=l=>(l=>{let t=[];0!==I.selectedProperties.length?(I.selectedProperties.forEach((e=>{t.push(e.name)})),s.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:v.token,data:{tslName:h.curModelBlock.tslName,cmdName:h.curModelBlock.name,propertyNames:t}};fe(e).then((e=>{ie(e,P)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:A((()=>[L(g,{class:"btn-icon"},{default:A((()=>[L(x,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),xe])),_:1})])]),B("div",{class:"content",ref_key:"contentRef",ref:k},[L(z,{data:S(H),"cell-style":S(I).cellStyle,"header-cell-style":S(I).headerCellStyle,"max-height":S(I).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:re,onRowDblclick:le},{empty:A((()=>[Xe])),default:A((()=>[L(C,{type:"selection",width:"55"}),L(C,{prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),L(C,{prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),L(C,{prop:"rulerId",label:"数据标识",width:"auto","min-width":"150",align:"center"}),L(C,{prop:"format",label:"数据格式",width:"auto","min-width":"150",align:"center"}),L(C,{prop:"len",label:"数据长度",width:"auto","min-width":"150",align:"center"}),L(C,{label:"读写属性",width:"auto","min-width":"80",align:"center"},{default:A((e=>[N(R(S(I).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),L(C,{prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:A((e=>[N(R(S(I).typeNames["t"+e.row.type]),1)])),_:1}),L(C,{prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),L(C,{prop:"blockAddOffset",label:"块偏移地址",width:"auto","min-width":"150",align:"center"}),L(C,{prop:"rulerAddOffset",label:"标识偏移地址",width:"auto","min-width":"150",align:"center"}),L(C,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:A((e=>[L(M,{onClick:l=>le(e.row),text:"",type:"primary"},{default:A((()=>[Ce])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),B("div",De,[L(O,{"current-page":S(I).currentPage,"page-size":S(I).pagesize,"page-sizes":[20,50,200,500],total:S(E).length,onCurrentChange:W,onSizeChange:Y,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),L(ye,{modelValue:S(I).pFlag,"onUpdate:modelValue":b[20]||(b[20]=e=>S(I).pFlag=e),title:S(I).pTitle,width:"800px","before-close":oe,"close-on-click-modal":!1},{footer:A((()=>[B("span",Le,[L(M,{onClick:b[18]||(b[18]=e=>ae())},{default:A((()=>[Ae])),_:1}),L(M,{type:"primary",onClick:b[19]||(b[19]=e=>{te.value.validate((e=>{if(!e)return!1;{const e={token:v.token,data:{tslName:h.curModelBlock.tslName,cmdName:h.curModelBlock.name,name:I.propertyForm.name,label:I.propertyForm.label,rulerId:I.propertyForm.rulerId,format:I.propertyForm.format,len:I.propertyForm.len,unit:I.propertyForm.unit,accessMode:I.propertyForm.accessMode,type:I.propertyForm.type,blockAddOffset:I.propertyForm.blockAddOffset,rulerAddOffset:I.propertyForm.rulerAddOffset}};I.pTitle.includes("添加")?pe(e).then((e=>{ie(e,P),ae()})):me(e).then((e=>{ie(e,P),ae()}))}}))})},{default:A((()=>[Se])),_:1})])])),default:A((()=>[B("div",Ve,[L(be,{model:S(I).propertyForm,rules:S(I).propertyRules,ref_key:"propertyFormRef",ref:te,"status-icon":"","label-position":"right","label-width":"120px",inline:!0},{default:A((()=>[L(de,{label:"属性名称",prop:"name"},{default:A((()=>[L(y,{style:{width:"220px"},disabled:S(I).pTitle.includes("编辑"),type:"text",modelValue:S(I).propertyForm.name,"onUpdate:modelValue":b[6]||(b[6]=e=>S(I).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),L(de,{label:"属性标签",prop:"label"},{default:A((()=>[L(y,{style:{width:"220px"},type:"text",modelValue:S(I).propertyForm.label,"onUpdate:modelValue":b[7]||(b[7]=e=>S(I).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),L(de,{label:"读写属性",prop:"accessMode"},{default:A((()=>[L(ue,{modelValue:S(I).propertyForm.accessMode,"onUpdate:modelValue":b[8]||(b[8]=e=>S(I).propertyForm.accessMode=e),style:{width:"220px"},placeholder:"请选择读写属性"},{default:A((()=>[(D(!0),V(U,null,j(S(I).accessModeOptions,(e=>(D(),T(ce,{key:"accessMode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),L(de,{label:"单位",prop:"unit"},{default:A((()=>[L(y,{style:{width:"220px"},type:"text",modelValue:S(I).propertyForm.unit,"onUpdate:modelValue":b[9]||(b[9]=e=>S(I).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1}),L(de,{label:"属性类型",prop:"type"},{default:A((()=>[L(ue,{modelValue:S(I).propertyForm.type,"onUpdate:modelValue":b[10]||(b[10]=e=>S(I).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择属性类型"},{default:A((()=>[(D(!0),V(U,null,j(S(I).typeOptions,(e=>(D(),T(ce,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),1!=h.curModelBlock.format?(D(),T(de,{key:0,label:"",prop:"",style:{width:"220px"}})):q("",!0),L(de,{label:"数据格式",prop:"len"},{default:A((()=>[1==h.curModelBlock.format?(D(),T(y,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:S(I).propertyForm.format,"onUpdate:modelValue":b[11]||(b[11]=e=>S(I).propertyForm.format=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据格式"},null,8,["modelValue"])):(D(),T(ue,{key:1,modelValue:S(I).propertyForm.format,"onUpdate:modelValue":b[12]||(b[12]=e=>S(I).propertyForm.format=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择数据格式"},{default:A((()=>[(D(!0),V(U,null,j(S(I).formatOptions,(e=>(D(),T(ce,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),1!=h.curModelBlock.len?(D(),T(de,{key:1,label:"",prop:"",style:{width:"220px"}})):q("",!0),L(de,{label:"数据长度",prop:"len"},{default:A((()=>[1==h.curModelBlock.len?(D(),T(y,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:S(I).propertyForm.len,"onUpdate:modelValue":b[13]||(b[13]=e=>S(I).propertyForm.len=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据长度"},null,8,["modelValue"])):(D(),T(ue,{key:1,modelValue:S(I).propertyForm.len,"onUpdate:modelValue":b[14]||(b[14]=e=>S(I).propertyForm.len=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择数据长度"},{default:A((()=>[(D(!0),V(U,null,j(S(I).lenOptions,(e=>(D(),T(ce,{key:"regCount_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),Be,L(de,{label:"数据标识",prop:"rulerId"},{default:A((()=>[L(y,{type:"text",style:{width:"220px"},modelValue:S(I).propertyForm.rulerId,"onUpdate:modelValue":b[15]||(b[15]=e=>S(I).propertyForm.rulerId=e),autocomplete:"off",placeholder:"请输入数据标识"},null,8,["modelValue"])])),_:1}),1!=h.curModelBlock.blockAddOffset?(D(),T(de,{key:2,label:"",prop:"",style:{width:"220px"}})):q("",!0),L(de,{label:"块偏移地址",prop:"blockAddOffset"},{default:A((()=>[L(y,{type:"text",style:{width:"220px"},modelValue:S(I).propertyForm.blockAddOffset,"onUpdate:modelValue":b[16]||(b[16]=e=>S(I).propertyForm.blockAddOffset=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据块偏移地址"},null,8,["modelValue"])])),_:1}),L(de,{label:"标识偏移地址",prop:"rulerAddOffset"},{default:A((()=>[L(y,{type:"text",style:{width:"220px"},modelValue:S(I).propertyForm.rulerAddOffset,"onUpdate:modelValue":b[17]||(b[17]=e=>S(I).propertyForm.rulerAddOffset=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入标识偏移地址"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),L(ye,{modelValue:S(I).fFlag,"onUpdate:modelValue":b[26]||(b[26]=e=>S(I).fFlag=e),title:"编辑计算公式",width:"600px"},{footer:A((()=>[B("span",ze,[L(M,{onClick:b[24]||(b[24]=e=>(I.fFlag=!1,void(I.curFormula="")))},{default:A((()=>[Oe])),_:1}),L(M,{type:"primary",onClick:b[25]||(b[25]=e=>(I.fFlag=!1,void(I.propertyForm.formula=I.curFormula)))},{default:A((()=>[Ue])),_:1})])])),default:A((()=>[B("div",Re,[L(be,{model:S(I).formulaForm,"label-position":"right","label-width":"120px"},{default:A((()=>[L(de,{label:"运算符号"},{default:A((()=>[B("div",Ne,[(D(!0),V(U,null,j(S(I).operationList,(e=>(D(),V("div",Ie,[B("div",Pe,[L(M,{style:{width:"100%"},onClick:l=>(e=>{let l=I.curFormula.length;if(l!==I.selectionStart){let t=I.curFormula.substr(0,I.selectionStart),a=I.curFormula.substr(I.selectionStart,l-I.selectionStart);I.curFormula=t+e.name+a,I.selectionStart+=e.name.length}else I.curFormula+=e.name,I.selectionStart+=e.name.length})(e)},{default:A((()=>[N(R(e.label),1)])),_:2},1032,["onClick"])])])))),256))])])),_:1}),L(de,{label:"设备属性"},{default:A((()=>[L(ue,{modelValue:S(I).pItem,"onUpdate:modelValue":b[21]||(b[21]=e=>S(I).pItem=e),filterable:"",placeholder:"请选择设备属性",onChange:b[22]||(b[22]=e=>(e=>{let l=I.curFormula.length;if(l!==I.selectionStart){let t=I.curFormula.substr(0,I.selectionStart),a=I.curFormula.substr(I.selectionStart,l-I.selectionStart);I.curFormula=t+"("+e+")"+a,I.selectionStart+=e.length+2}else I.curFormula+="("+e+")",I.selectionStart+=e.length+2})(S(I).pItem)),style:{width:"100%"}},{default:A((()=>[(D(!0),V(U,null,j(S(I).propertyInfo,(e=>(D(),T(ce,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),L(de,{label:"当前公式"},{default:A((()=>[L(y,{type:"text",clearable:"",modelValue:S(I).curFormula,"onUpdate:modelValue":b[23]||(b[23]=e=>S(I).curFormula=e),autocomplete:"off",placeholder:"请编辑计算公式",onBlur:se},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),L(ye,{modelValue:S(I).psFlag,"onUpdate:modelValue":b[27]||(b[27]=e=>S(I).psFlag=e),title:"导入命令参数",width:"600px","before-close":ee,"close-on-click-modal":!1},{footer:A((()=>[B("span",qe,[L(M,{onClick:Z},{default:A((()=>[He])),_:1}),L(M,{type:"primary",onClick:G},{default:A((()=>[Ee])),_:1})])])),default:A((()=>[L(We,{ref_key:"uploadDPSRef",ref:Q,action:"","auto-upload":!1,"http-request":J,limit:1,"on-exceed":$,"before-upload":K},{tip:A((()=>[Te])),default:A((()=>[L(M,{type:"primary"},{default:A((()=>[je])),_:1})])),_:1},512)])),_:1},8,["modelValue"])],64)}}},[["__scopeId","data-v-32570b60"]]);const Ye=e=>(I("data-v-0d3be54c"),e=e(),P(),e),Ge={class:"mc-left"},Je={class:"title"},Qe=N(" 返回设备模型 "),$e={class:"mcl-content"},Ke={class:"mclc-content"},Ze={class:"mc-right"},el={class:"mcr-top"},ll={class:"title",style:{"justify-content":"space-between"}},tl={class:"tName"},al={style:{display:"flex"}},ol=N(" 导入命令 "),rl=N(" 导出命令 "),dl=N(" 添加 "),sl=N(" 刷新 "),nl=N(" 删除 "),il=N("编辑"),cl=N("命令参数详情"),ul=Ye((()=>B("div",null,"无数据",-1))),pl={class:"pagination"},ml={key:0,class:"mcr-bottom"},fl={class:"dialog-content"},bl={class:"dialog-footer"},gl=N("取消"),yl=N("保存"),hl=N("选择文件"),vl=Ye((()=>B("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),kl={class:"dialog-footer"},_l=N("取消"),Fl=N("上传");var wl=b({props:{curDeviceModel:{type:Object,default:{}},deviceModelList:{type:Array,default:[]}},emits:["changeShowFlag"],setup(b,{emit:h}){const v=b,I=g();console.log("id -> props",v);const P=/^[0-9]*[1-9][0-9]*$/,O=M(null),E=x({curDeviceModel:v.curDeviceModel,headerCellStyle:{background:y.primaryColor,color:y.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelBlock:"",BlockReadSw:[{label:"开",value:1},{label:"关",value:0}],SWNames:{SW0:"关",SW1:"开"},typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],funCodeOptions:[{label:"01(读线圈状态)",value:1},{label:"02(读离散输入状态)",value:2},{label:"03(读保持寄存器)",value:3},{label:"04(读输入寄存器)",value:4},{label:"05(写单个线圈)",value:5},{label:"06(写单个保持寄存器)",value:6},{label:"15(写多个线圈)",value:15},{label:"16(写多个保持寄存器)",value:16}],funCodeNames:{f1:"01(读线圈状态)",f2:"02(读离散输入状态)",f3:"03(读保持寄存器)",f4:"04(读输入寄存器)",f5:"05(写单个线圈)",f6:"06(写单个保持寄存器)",f15:"15(写多个线圈)",f16:"16(写多个保持寄存器)"},dataTypeOptions:[{label:"uint8",value:0},{label:"int8",value:1},{label:"uint16",value:2},{label:"int16",value:3},{label:"uint32",value:4},{label:"int32",value:5},{label:"float",value:6},{label:"double",value:7}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},dataTypeNames:{dt0:"uint8",dt1:"int8",dt2:"uint16",dt3:"int16",dt4:"uint32",dt5:"int32",dt6:"float",dt7:"double"},pFlag:!1,pTitle:"添加属性",blockForm:{name:"",label:"",blockRulerId:"",blockRead:0},paramName:{name:"块名称",label:"块标签",funCode:"功能码",type:"属性类型",startRegAddr:"寄存器地址",regCnt:"寄存器数量"},propertyRules:{name:[{required:!0,message:"块名称不能为空",trigger:"blur"}],label:[{required:!0,message:"块标签不能为空",trigger:"blur"}],funCode:[{required:!0,message:"功能码不能为空",trigger:"blur"}],startRegAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{0===l||P.test(l)?t():t(new Error("只能输入自然数！"))}}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{P.test(l)?t():t(new Error("只能输入正整数数字！"))}}]},psFlag:!1,selectedProperties:[],curModelBlock:{},porpFlag:!1}),W=l=>{const t={token:I.token,data:{tslName:E.curDeviceModel.name}};re(t).then((async t=>{t&&("0"===t.code?(E.propertyList=t.data,E.propertyList.length>0?(E.curModelBlock=E.propertyList[0],E.curModelBlock.tslName=E.curDeviceModel.name,console.log("getDeviceModelBlock -> ctxData.curModelBlock",E.curModelBlock),E.porpFlag=!0):E.porpFlag=!1,1===l&&e({type:"success",message:"刷新成功！"})):ye(t),await z((()=>{E.tableMaxHeight=O.value.clientHeight-34-22,2===l&&ge(E.curModelBlock)})))}))};W(2);const Y=C((()=>(console.log("ctxData.propertyList ->",E.propertyList),E.propertyList.filter((e=>{var l=!E.deviceModelBlock,t=e.name.toLowerCase().includes(E.deviceModelBlock.toLowerCase());return l||t})).slice((E.currentPage-1)*E.pagesize,E.currentPage*E.pagesize)))),G=C((()=>E.propertyList.filter((e=>{var l=!E.deviceModelBlock,t=e.name.toLowerCase().includes(E.deviceModelBlock.toLowerCase());return l||t})))),J=e=>{E.currentPage=e},Q=e=>{E.pagesize=e},$=()=>{Z.value&&Z.value.submit()},K=e=>{},Z=M(null),ee=e=>{Z.value.clearFiles();const l=e[0];Z.value.handleStart(l)},le=l=>{console.log("beforeUpload -> file",l);let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("name",E.curDeviceModel.name),t.append("fileName",l);const a={token:I.token,contentType:"multipart/form-data",data:t};ie(a).then((l=>{"0"===l.code?(e.success(l.message),E.psFlag=!1,W()):ye(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},te=()=>{E.psFlag=!1,uploadRef.value.clearFiles()},ae=()=>{te()},oe=e=>{E.pFlag=!0,E.pTitle="编辑属性",E.blockForm.name=e.name,E.blockForm.label=e.label,E.blockForm.blockRulerId=e.blockRulerId,E.blockForm.blockRead=e.blockRead},ue=M(null),pe=()=>{E.pFlag=!1,ue.value.resetFields(),be()},me=e=>{pe()},fe=e=>{E.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},be=()=>{E.blockForm={name:"",label:"",blockRulerId:"",blockRead:0}},ge=e=>{E.curModelBlock=e,E.curModelBlock.tslName=E.curDeviceModel.name},ye=l=>{e({type:"error",message:l.message})},he=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(b,g)=>{const y=l,M=t,x=f,C=a,P=X("Icon"),z=o,re=r,ie=d,be=n,ve=i,ke=c,_e=u,Fe=p,we=m;return D(),V(U,null,[B("div",Ge,[B("div",Je,[L(M,{type:"primary",style:{width:"100%"},plain:"",onClick:g[0]||(g[0]=e=>{h("changeShowFlag")})},{default:A((()=>[L(y,{class:"el-input__icon"},{default:A((()=>[L(S(k))])),_:1}),Qe])),_:1})]),B("div",$e,[(D(!0),V(U,null,j(v.deviceModelList,((e,l)=>(D(),T(x,{key:"i"+l,shadow:"hover",class:H({"mclc-card":!0,activeModel:e.name==S(E).curDeviceModel.name}),onClick:l=>(e=>{E.curDeviceModel.name!=e.name&&(E.curDeviceModel=e,W())})(e)},{default:A((()=>[B("div",Ke,[B("span",null,R(e.name),1)])])),_:2},1032,["class","onClick"])))),128))])]),B("div",Ze,[B("div",el,[B("div",ll,[B("div",tl,R(S(E).curDeviceModel.label)+"：命令列表",1),B("div",al,[L(C,{style:{width:"200px"},placeholder:"请输入命令名称",modelValue:S(E).deviceModelBlock,"onUpdate:modelValue":g[1]||(g[1]=e=>S(E).deviceModelBlock=e)},{prefix:A((()=>[L(y,{class:"el-input__icon"},{default:A((()=>[L(S(F))])),_:1})])),_:1},8,["modelValue"]),L(M,{type:"primary",plain:"",class:"right-btn",onClick:g[2]||(g[2]=e=>(console.log("importDPS"),void(E.psFlag=!0)))},{default:A((()=>[L(y,{class:"el-input__icon"},{default:A((()=>[L(S(w))])),_:1}),ol])),_:1}),L(M,{type:"primary",plain:"",class:"right-btn",onClick:g[3]||(g[3]=e=>(()=>{console.log("exportDPS");const e={token:I.token,responseType:"blob",data:{name:E.curDeviceModel.name}};ce(e).then((e=>{if(e&&"1"===e.code)return void ye(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:A((()=>[L(y,{class:"el-input__icon"},{default:A((()=>[L(S(_))])),_:1}),rl])),_:1}),L(M,{type:"primary",bg:"",class:"right-btn",onClick:g[4]||(g[4]=e=>(console.log("addDeviceModelBlock"),E.pFlag=!0,void(E.pTitle="添加属性")))},{default:A((()=>[L(y,{class:"btn-icon"},{default:A((()=>[L(P,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),dl])),_:1}),L(M,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:g[5]||(g[5]=e=>{W(1)})},{default:A((()=>[L(y,{class:"btn-icon"},{default:A((()=>[L(P,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),sl])),_:1}),L(M,{type:"danger",bg:"",class:"right-btn",onClick:g[6]||(g[6]=l=>(l=>{let t=[];0!==E.selectedProperties.length?(E.selectedProperties.forEach((e=>{t.push(e.name)})),console.log("pList",t),s.confirm("确认要删除这些命令吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:I.token,data:{tslName:E.curDeviceModel.name,names:t}};ne(e).then((e=>{he(e,W)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个命令！")})())},{default:A((()=>[L(y,{class:"btn-icon"},{default:A((()=>[L(P,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),nl])),_:1})])]),B("div",{class:"content",ref_key:"contentRef",ref:O},[L(re,{data:S(Y),"cell-style":S(E).cellStyle,"header-cell-style":S(E).headerCellStyle,"max-height":S(E).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:fe,onRowDblclick:oe},{empty:A((()=>[ul])),default:A((()=>[L(z,{type:"selection",width:"55"}),L(z,{prop:"name",label:"命令名称",width:"auto","min-width":"150",align:"center"}),L(z,{prop:"label",label:"命令标签",width:"auto","min-width":"150",align:"center"}),L(z,{prop:"blockRulerId",label:"块数据标识",width:"auto","min-width":"120",align:"center"}),L(z,{label:"块读取开关",width:"auto","min-width":"100",align:"center"},{default:A((e=>[N(R(S(E).SWNames["SW"+e.row.blockRead]),1)])),_:1}),L(z,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:A((e=>[L(M,{onClick:l=>oe(e.row),text:"",type:"primary"},{default:A((()=>[il])),_:2},1032,["onClick"]),L(M,{onClick:l=>ge(e.row),text:"",type:"success"},{default:A((()=>[cl])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),B("div",pl,[L(ie,{"current-page":S(E).currentPage,"page-size":S(E).pagesize,"page-sizes":[20,50,200,500],total:S(G).length,onCurrentChange:J,onSizeChange:Q,background:"",layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])],512)]),S(E).porpFlag?(D(),V("div",ml,[L(We,{curModelBlock:S(E).curModelBlock},null,8,["curModelBlock"])])):q("",!0)]),L(Fe,{modelValue:S(E).pFlag,"onUpdate:modelValue":g[13]||(g[13]=e=>S(E).pFlag=e),title:S(E).pTitle,width:"600px","before-close":me,"close-on-click-modal":!1},{footer:A((()=>[B("span",bl,[L(M,{onClick:g[11]||(g[11]=e=>pe())},{default:A((()=>[gl])),_:1}),L(M,{type:"primary",onClick:g[12]||(g[12]=e=>{ue.value.validate((e=>{if(!e)return!1;{const e={token:I.token,data:{tslName:E.curDeviceModel.name,name:E.blockForm.name,label:E.blockForm.label,blockRulerId:E.blockForm.blockRulerId,blockRead:E.blockForm.blockRead}};E.pTitle.includes("添加")?de(e).then((e=>{he(e,W),pe()})):se(e).then((l=>{console.log("----GWAI----"),console.log(e),he(l,W),pe()}))}}))})},{default:A((()=>[yl])),_:1})])])),default:A((()=>[B("div",fl,[L(_e,{model:S(E).blockForm,rules:S(E).propertyRules,ref_key:"blockFormRef",ref:ue,"status-icon":"","label-position":"right","label-width":"120px"},{default:A((()=>[L(be,{label:"块名称",prop:"name"},{default:A((()=>[L(C,{disabled:S(E).pTitle.includes("编辑"),type:"text",modelValue:S(E).blockForm.name,"onUpdate:modelValue":g[7]||(g[7]=e=>S(E).blockForm.name=e),autocomplete:"off",placeholder:"请输入块名称"},null,8,["disabled","modelValue"])])),_:1}),L(be,{label:"块标签",prop:"label"},{default:A((()=>[L(C,{type:"text",modelValue:S(E).blockForm.label,"onUpdate:modelValue":g[8]||(g[8]=e=>S(E).blockForm.label=e),autocomplete:"off",placeholder:"请输入块标签"},null,8,["modelValue"])])),_:1}),L(be,{label:"块数据标识",prop:"blockRulerId"},{default:A((()=>[L(C,{type:"text",modelValue:S(E).blockForm.blockRulerId,"onUpdate:modelValue":g[9]||(g[9]=e=>S(E).blockForm.blockRulerId=e),placeholder:"请输入块数据标识"},null,8,["modelValue"])])),_:1}),L(be,{label:"块读取开关",prop:"blockRead"},{default:A((()=>[L(ke,{modelValue:S(E).blockForm.blockRead,"onUpdate:modelValue":g[10]||(g[10]=e=>S(E).blockForm.blockRead=e),style:{width:"100%"},placeholder:"请选择是否打开块读取"},{default:A((()=>[(D(!0),V(U,null,j(S(E).BlockReadSw,(e=>(D(),T(ve,{key:"SW"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),L(Fe,{modelValue:S(E).psFlag,"onUpdate:modelValue":g[14]||(g[14]=e=>S(E).psFlag=e),title:"导入命令",width:"600px","before-close":ae,"close-on-click-modal":!1},{footer:A((()=>[B("span",kl,[L(M,{onClick:te},{default:A((()=>[_l])),_:1}),L(M,{type:"primary",onClick:$},{default:A((()=>[Fl])),_:1})])])),default:A((()=>[L(we,{ref_key:"uploadDPSRef",ref:Z,action:"","auto-upload":!1,"http-request":K,limit:1,"on-exceed":ee,"before-upload":le},{tip:A((()=>[vl])),default:A((()=>[L(M,{type:"primary"},{default:A((()=>[hl])),_:1})])),_:1},512)])),_:1},8,["modelValue"])],64)}}},[["__scopeId","data-v-0d3be54c"]]);const Ml=e=>(I("data-v-50c8e8b8"),e=e(),P(),e),xl={class:"main-container"},Cl={key:0,class:"main"},Xl={class:"title",style:{"justify-content":"space-between"}},Dl=N(" 添加 "),Vl=N(" 刷新 "),Bl=N("变量详情"),Ll=N("命令详情"),Al=N("编辑"),Sl=N("删除"),Rl=Ml((()=>B("div",null,"无数据",-1))),Nl={class:"pagination"},Il={class:"dialog-content"},Pl={class:"dialog-footer"},zl=N("取消"),Ol=N("保存");var Ul=b({setup(i){const c=g(),m=M(null),f=x({typeModel:3,showFlag:0,headerCellStyle:{background:y.primaryColor,color:y.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceModelInfo:"",tableData:[],modelForm:{name:"",label:"",type:0,param:""},modelRules:{name:[{required:!0,message:"采集模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"采集模型标识不能为空",trigger:"blur"}],param:[{required:!0,message:"采集模型插件不能为空",trigger:"blur"}]},udFlag:!1,dmFlag:!1,dmTitle:"添加采集模型",pluginList:[],curDeviceModel:""}),b=l=>{const t={token:c.token,data:{type:f.typeModel}};v.getDeviceModelList(t).then((async t=>{t&&("0"===t.code?(f.tableData=t.data,1===l&&e({type:"success",message:"刷新成功！"})):j(t),await z((()=>{f.tableMaxHeight=m.value.clientHeight-34-36-22})))}))};b();const h=C((()=>f.tableData.filter((e=>{var l=!f.deviceModelInfo,t=e.name.toLowerCase().includes(f.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(f.deviceModelInfo.toLowerCase());return l||t})).slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize))),k=C((()=>f.tableData.filter((e=>{var l=!f.deviceModelInfo,t=e.name.toLowerCase().includes(f.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(f.deviceModelInfo.toLowerCase());return l||t})))),_=e=>{f.currentPage=e},w=e=>{f.pagesize=e},R=e=>{f.dmFlag=!0,f.dmTitle="编辑采集模型",f.modelForm={name:e.name,label:e.label,type:void 0===e.type?0:e.type,param:e.param}},N=M(null),I=()=>{f.dmFlag=!1,N.value.resetFields(),O()},P=()=>{I()},O=()=>{f.modelForm={name:"",label:"",type:0}},U=()=>{f.showFlag=0},j=l=>{e({type:"error",message:l.message})},H=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(i,g)=>{const y=l,M=a,x=X("Icon"),C=t,z=o,O=r,j=d,E=n,W=u,Y=p;return D(),V("div",xl,[0===S(f).showFlag?(D(),V("div",Cl,[B("div",Xl,[L(M,{style:{width:"200px"},placeholder:"请输入采集模型名称",modelValue:S(f).deviceModelInfo,"onUpdate:modelValue":g[0]||(g[0]=e=>S(f).deviceModelInfo=e)},{prefix:A((()=>[L(y,{class:"el-input__icon"},{default:A((()=>[L(S(F))])),_:1})])),_:1},8,["modelValue"]),B("div",null,[L(C,{type:"primary",bg:"",class:"right-btn",onClick:g[1]||(g[1]=e=>(f.dmFlag=!0,void(f.dmTitle="添加采集模型")))},{default:A((()=>[L(y,{class:"btn-icon"},{default:A((()=>[L(x,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),Dl])),_:1}),L(C,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:g[2]||(g[2]=e=>{b(1)})},{default:A((()=>[L(y,{class:"btn-icon"},{default:A((()=>[L(x,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),Vl])),_:1})])]),B("div",{class:"content",ref_key:"contentRef",ref:m},[L(O,{data:S(h),"cell-style":S(f).cellStyle,"header-cell-style":S(f).headerCellStyle,"max-height":S(f).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:R},{empty:A((()=>[Rl])),default:A((()=>[L(z,{prop:"name",label:"采集模型名称",width:"auto","min-width":"200",align:"center"}),L(z,{prop:"label",label:"采集模型标签",width:"auto","min-width":"200",align:"center"}),L(z,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:A((l=>[L(C,{onClick:e=>{return t=l.row,f.curDeviceModel=t,void(f.showFlag=1);var t},text:"",type:"success"},{default:A((()=>[Bl])),_:2},1032,["onClick"]),L(C,{onClick:e=>{return t=l.row,f.curDeviceModel=t,void(f.showFlag=2);var t},text:"",type:"success"},{default:A((()=>[Ll])),_:2},1032,["onClick"]),L(C,{onClick:e=>R(l.row),text:"",type:"primary"},{default:A((()=>[Al])),_:2},1032,["onClick"]),L(C,{onClick:t=>{return a=l.row,void s.confirm("确定要删除这个采集模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:c.token,data:{name:a.name,type:3}};v.deleteDeviceModel(e).then((e=>{H(e,b)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var a},text:"",type:"danger"},{default:A((()=>[Sl])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),B("div",Nl,[L(j,{"current-page":S(f).currentPage,"page-size":S(f).pagesize,"page-sizes":[20,50,200,500],total:S(k).length,onCurrentChange:_,onSizeChange:w,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):q("",!0),1===S(f).showFlag?(D(),T(oe,{key:1,curDeviceModel:S(f).curDeviceModel,onChangeShowFlag:g[3]||(g[3]=e=>U())},null,8,["curDeviceModel"])):q("",!0),2===S(f).showFlag?(D(),T(wl,{key:2,curDeviceModel:S(f).curDeviceModel,deviceModelList:S(f).tableData,onChangeShowFlag:g[4]||(g[4]=e=>U())},null,8,["curDeviceModel","deviceModelList"])):q("",!0),L(Y,{modelValue:S(f).dmFlag,"onUpdate:modelValue":g[9]||(g[9]=e=>S(f).dmFlag=e),title:S(f).dmTitle,width:"600px","before-close":P,"close-on-click-modal":!1},{footer:A((()=>[B("span",Pl,[L(C,{onClick:g[7]||(g[7]=e=>I())},{default:A((()=>[zl])),_:1}),L(C,{type:"primary",onClick:g[8]||(g[8]=e=>{N.value.validate((e=>{if(!e)return!1;{f.modelForm.type=f.typeModel;const e={token:c.token,data:f.modelForm};f.dmTitle.includes("添加")?v.addDeviceModel(e).then((e=>{H(e,b),I()})):v.editDeviceModel(e).then((e=>{H(e,b),I()}))}}))})},{default:A((()=>[Ol])),_:1})])])),default:A((()=>[B("div",Il,[L(W,{model:S(f).modelForm,rules:S(f).modelRules,ref_key:"modelFormRef",ref:N,"status-icon":"","label-position":"right","label-width":"120px"},{default:A((()=>[L(E,{label:"采集模型名称",prop:"name"},{default:A((()=>[L(M,{type:"text",disabled:S(f).dmTitle.includes("编辑"),modelValue:S(f).modelForm.name,"onUpdate:modelValue":g[5]||(g[5]=e=>S(f).modelForm.name=e),autocomplete:"off",placeholder:"请输入采集模型名称"},null,8,["disabled","modelValue"])])),_:1}),L(E,{label:"采集模型标签",prop:"label"},{default:A((()=>[L(M,{type:"text",modelValue:S(f).modelForm.label,"onUpdate:modelValue":g[6]||(g[6]=e=>S(f).modelForm.label=e),autocomplete:"off",placeholder:"请输入采集模型标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-50c8e8b8"]]);export{Ul as default};
