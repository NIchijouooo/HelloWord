import{g as e,e as l,p as t,n as a,o,m as r,A as d,C as n,D as i,L as s,v as p,w as u,K as c,l as m,G as f,q as g,M as b,u as y}from"./element-plus.2c9426ce.js";import{s as h,_ as v,u as F,v as _}from"./index.9c81e799.js";import{D as w}from"./deviceModel.d6fadd82.js";import{b as k,i as x,d as C,h as M}from"./@element-plus.e895b9e1.js";import{r as V,J as A,j as D,ae as L,o as B,c as S,a as O,O as P,R,u as z,V as T,W as U,P as N,aj as j,n as q,av as I,aw as E,w as H,S as G,_ as W,$,X as J,L as K}from"./@vue.2c474d7f.js";import{u as X}from"./vue-router.3b7aa6c5.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.d618444d.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./pinia.39330980.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.ebbe6a42.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";var Q=e=>h.request({url:"/tsl/modbus/cmd",method:"get",data:e}),Y=e=>h.request({url:"/tsl/modbus/cmd",method:"post",data:e}),Z=e=>h.request({url:"/tsl/modbus/cmd",method:"put",data:e}),ee=e=>h.request({url:"/tsl/modbus/cmd",method:"delete",data:e}),le=e=>h.request({url:"/tsl/modbus/block/xlsx",method:"post",data:e}),te=e=>h.request({url:"/tsl/modbus/block/xlsx",method:"get",data:e}),ae=e=>h.request({url:"/tsl/modbus/cmd/params",method:"get",data:e}),oe=e=>h.request({url:"/tsl/modbus/cmd/param",method:"post",data:e}),re=e=>h.request({url:"/tsl/modbus/cmd/param",method:"put",data:e}),de=e=>h.request({url:"/tsl/modbus/cmd/params",method:"delete",data:e}),ne=e=>h.request({url:"/tsl/modbus/cmd/param/xlsx",method:"post",data:e}),ie=e=>h.request({url:"/tsl/modbus/cmd/param/xlsx",method:"get",data:e});const se={class:"main-container"},pe={class:"main"},ue={class:"search-bar"},ce={class:"search-bar",style:{display:"flex"}},me={class:"title",style:{position:"relative","margin-right":"40px",height:"40px",padding:"0px 0","justify-content":"flex-start"}},fe={class:"tName"},ge={class:"param-content"},be={class:"pc-title"},ye={class:"pct-info"},he={class:"pc-content"},ve={class:"param-value"},Fe={class:"param-name"},_e=(e=>(I("data-v-097e4e7e"),e=e(),E(),e))((()=>O("div",null,"无数据",-1))),we={class:"pagination"};var ke=v({__name:"PropertyRtu",props:{curDeviceModel:{type:Object,default:{}}},emits:["changeShowFlag"],setup(s,{emit:p}){const u=s,c=F();console.log("id -> props",u);const m=V(null),f=A({headerCellStyle:{background:_.primaryColor,color:_.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",decimals:"小数位数",regCnt:"寄存器数量",ruleType:"解析规则",regAddr:"寄存器地址",formula:"计算公式",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"步长",stepAlarm:"步长报警",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,dbNumber:"",startAddr:"",dataType:0,unit:"",decimals:0},psFlag:!1,selectedProperties:[]}),g=l=>{const t={token:c.token,data:{name:u.curDeviceModel.name}};w.getDeviceModelProperty(t).then((async t=>{console.log("getDeviceModelProperty -> res",t),t&&("0"===t.code?(f.propertyList=t.data,1===l&&e({type:"success",message:"刷新成功！"})):M(t),await q((()=>{f.tableMaxHeight=m.value.clientHeight-34-36-132})))}))};g();const b=D((()=>(console.log("ctxData.propertyList ->",f.propertyList),f.propertyList.filter((e=>{var l=!f.deviceModelProperty,t=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||t})).slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize)))),y=D((()=>f.propertyList.filter((e=>{var l=!f.deviceModelProperty,t=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||t})))),h=e=>{f.currentPage=e},v=e=>{f.pagesize=e},M=l=>{e({type:"error",message:l.message})};return(e,s)=>{const F=l,_=t,V=a,A=o,D=r,q=L("Icon"),I=d,E=n,H=i;return B(),S("div",se,[O("div",pe,[O("div",ue,[P(A,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:R((()=>[P(V,{style:{"margin-left":"20px"}},{default:R((()=>[P(_,{type:"primary",plain:"",onClick:s[0]||(s[0]=e=>{p("changeShowFlag","goBack")})},{default:R((()=>[P(F,{class:"el-input__icon"},{default:R((()=>[P(z(k))])),_:1}),T(" 返回设备模型 ")])),_:1})])),_:1}),P(V,null,{default:R((()=>[P(_,{type:"primary",plain:"",class:"right-btn",onClick:s[1]||(s[1]=e=>(()=>{console.log("exportDPS");const e={token:c.token,responseType:"blob",data:{name:u.curDeviceModel.name}};w.exportDeviceModelProptyAndService(e).then((e=>{if(e&&"1"===e.code)return void M(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:R((()=>[P(F,{class:"el-input__icon"},{default:R((()=>[P(z(x))])),_:1}),T(" 导出模型属性 ")])),_:1})])),_:1})])),_:1},512)]),O("div",ce,[O("div",me,[O("div",fe,U(u.curDeviceModel.label)+"：属性列表",1)]),P(A,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:R((()=>[P(V,{label:""},{default:R((()=>[P(D,{style:{width:"200px"},placeholder:"请输入属性名称",modelValue:z(f).deviceModelProperty,"onUpdate:modelValue":s[2]||(s[2]=e=>z(f).deviceModelProperty=e)},{prefix:R((()=>[P(F,{class:"el-input__icon"},{default:R((()=>[P(z(C))])),_:1})])),_:1},8,["modelValue"])])),_:1}),P(V,null,{default:R((()=>[P(_,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:s[3]||(s[3]=e=>{g(1)})},{default:R((()=>[P(F,{class:"btn-icon"},{default:R((()=>[P(q,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),T(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),O("div",{class:"content",ref_key:"contentRef",ref:m},[P(E,{data:z(b),"cell-style":z(f).cellStyle,"header-cell-style":z(f).headerCellStyle,style:{width:"100%"},"max-height":z(f).tableMaxHeight,stripe:""},{empty:R((()=>[_e])),default:R((()=>[P(I,{type:"expand",width:"80"},{default:R((e=>[O("div",ge,[O("div",be,[O("div",ye,[O("b",null,U(e.row.name),1),T(" 参数详情 ")])]),O("div",he,[(B(!0),S(N,null,j(e.row.params,((e,l,t)=>(B(),S("div",{class:"param-item",key:t},[O("div",ve,U(z(f).paramName[l])+"：",1),O("div",Fe,U(e||"-"),1)])))),128))])])])),_:1}),P(I,{type:"index",width:"70"},{header:R((()=>[T(" 序号 ")])),_:1}),P(I,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),P(I,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),P(I,{sortable:"",label:"读写属性",width:"auto","min-width":"100",align:"center"},{default:R((e=>[T(U(z(f).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),P(I,{sortable:"",prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:R((e=>[T(U(z(f).typeNames["t"+e.row.type]),1)])),_:1}),P(I,{sortable:"",label:"小数位数",width:"auto","min-width":"100",align:"center"},{default:R((e=>[T(U(""===e.row.decimals?0:e.row.decimals),1)])),_:1}),P(I,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),P(I,{sortable:"",prop:"regAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),P(I,{sortable:"",prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"120",align:"center"}),P(I,{sortable:"",prop:"ruleType",label:"解析规则",width:"auto","min-width":"120",align:"center"}),P(I,{sortable:"",prop:"formula",label:"计算公式",width:"auto","min-width":"200",align:"center"}),P(I,{sortable:"",label:"按位解析",width:"auto","min-width":"100",align:"center"},{default:R((e=>[T(U(!1===e.row.bitOffsetSw?"否":"是"),1)])),_:1}),P(I,{sortable:"",prop:"bitOffset",label:"位偏移",width:"auto","min-width":"120",align:"center"},{default:R((e=>[T(U(!1===e.row.bitOffsetSw?"-":e.row.bitOffset),1)])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),O("div",we,[P(H,{"current-page":z(f).currentPage,"page-size":z(f).pagesize,"page-sizes":[20,50,200,500],total:z(y).length,onCurrentChange:h,onSizeChange:v,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])])}}},[["__scopeId","data-v-097e4e7e"]]);const xe=e=>(I("data-v-5f572e24"),e=e(),E(),e),Ce={class:"main-container"},Me={style:{display:"flex","justify-content":"space-between"}},Ve={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},Ae={class:"tName"},De={class:"search-bar",style:{"text-align":"right"}},Le={class:"param-content"},Be={class:"pc-title"},Se={class:"pct-info"},Oe={class:"pc-content"},Pe={class:"param-value"},Re={class:"param-name"},ze=xe((()=>O("div",null,"无数据",-1))),Te={class:"pagination"},Ue={class:"dialog-content"},Ne=xe((()=>O("div",{class:"form-title"},[O("div",{class:"tName"},"配置参数")],-1))),je={class:"dialog-footer"},qe={class:"dialog-content"},Ie={style:{width:"100%"}},Ee={style:{"padding-right":"10px"}},He={class:"dialog-footer"},Ge=xe((()=>O("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),We={class:"dialog-footer"};var $e=v({__name:"BlockPropertyRtu",props:{curModelBlock:{type:Object,default:{}}},emits:["changeBShowFlag"],setup(y,{emit:h}){const v=y,k=F(),I=/^[0-9]*[1-9][0-9]*$/,E=/^[0-9]\d*$/,K=/^[0-9]+(.[0-9]{1,2})?$/,X=(e,l,t)=>{K.test(l)?t():t(new Error("只能输入大于等于0,最多两位小数的数字！"))},Q=V(null),Y=A({formulaForm:{},headerCellStyle:{background:_.primaryColor,color:_.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",accessModeOptions:[{label:"只读",value:0},{label:"只写",value:1},{label:"读写",value:2}],typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},regCntOptions:[{label:1,value:1},{label:2,value:2},{label:4,value:4}],pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,regCnt:1,regAddr:null,ruleType:"Int_AB",unit:"",decimals:0,formula:"",bitOffsetSw:!1,bitOffset:0,min:0,max:0,minMaxAlarm:!1,step:0,stepAlarm:!1,dataLength:0,dataLengthAlarm:!1},ruleTypeOptions:{rt1:[{label:"Int_AB",value:"Int_AB"},{label:"Int_BA",value:"Int_BA"}],rt2:[{label:"Long_ABCD",value:"Long_ABCD"},{label:"Long_BADC",value:"Long_BADC"},{label:"Long_DCBA",value:"Long_DCBA"},{label:"Long_CDAB",value:"Long_CDAB"},{label:"Float_ABCD",value:"Float_ABCD"},{label:"Float_BADC",value:"Float_BADC"},{label:"Float_DCBA",value:"Float_DCBA"},{label:"Float_CDAB",value:"Float_CDAB"}],rt4:[{label:"Double_ABCDEFGH",value:"Double_ABCDEFGH"},{label:"Double_GHEFCDAB",value:"Double_GHEFCDAB"},{label:"Double_BADCFEHG",value:"Double_BADCFEHG"},{label:"Double_HGFEDCBA",value:"Double_HGFEDCBA"}]},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",decimals:"小数位数",regCnt:"寄存器数量",ruleType:"解析规则",regAddr:"寄存器地址",formula:"计算公式",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"步长",stepAlarm:"步长报警",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],accessMode:[{required:!0,message:"读写属性不能为空",trigger:"blur"}],type:[{required:!0,message:"属性类型不能为空",trigger:"blur"}],ruleType:[{required:!0,message:"解析规则不能为空",trigger:"blur"}],decimals:[{type:"number",message:"小数位数只能输入数字"}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{I.test(l)?t():t(new Error("只能输入正整数数字！"))}}],regAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{0===l||I.test(l)?t():t(new Error("只能输入自然数！"))}}],bitOffset:[{required:!0,message:"位偏移不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{!E.test(l)||l>65?t(new Error("只能输入0-64的整数数字！")):t()}}],step:[{required:!0,message:"步长不能为空",trigger:"blur"},{trigger:"blur",validator:X}],min:[{required:!0,message:"最小值不能为空",trigger:"blur"},{trigger:"blur",validator:X}],max:[{required:!0,message:"最大值不能为空",trigger:"blur"},{trigger:"blur",validator:X}],dataLength:[{required:!0,message:"字符串长度不能为空",trigger:"blur"},{trigger:"blur",validator:I}]},psFlag:!1,selectedProperties:[],fFlag:!1,propertyInfo:[],operationList:[{name:"+",label:"+",describe:"加"},{name:"-",label:"-",describe:"减"},{name:"*",label:"*",describe:"乘"},{name:"/",label:"/",describe:"除"},{name:"%",label:"%",describe:"模"},{name:"^",label:"^",describe:"次幂"},{name:"(",label:"(",describe:"左括号"},{name:")",label:")",describe:"右括号"}],curFormula:"",selectionStart:0,pItem:""}),Z=l=>{const t={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name}};ae(t).then((async t=>{t&&("0"===t.code?(Y.propertyList=null==t.data?[]:t.data,1===l&&e({type:"success",message:"刷新成功！"})):$e(t),await q((()=>{Y.tableMaxHeight=Q.value.clientHeight-34-22-82})))}))};Z();const ee=D((()=>Y.propertyList.filter((e=>{var l=!Y.deviceModelProperty,t=e.name.toLowerCase().includes(Y.deviceModelProperty.toLowerCase());return l||t})).slice((Y.currentPage-1)*Y.pagesize,Y.currentPage*Y.pagesize))),le=D((()=>Y.propertyList.filter((e=>{var l=!Y.deviceModelProperty,t=e.name.toLowerCase().includes(Y.deviceModelProperty.toLowerCase());return l||t})))),te=e=>{Y.currentPage=e},se=e=>{Y.pagesize=e},pe=()=>{ce.value&&ce.value.submit()},ue=e=>{},ce=V(null),me=e=>{ce.value.clearFiles();const l=e[0];ce.value.handleStart(l)},fe=l=>{let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("tslName",v.curModelBlock.tslName),t.append("cmdName",v.curModelBlock.name),t.append("fileName",l);const a={token:k.token,contentType:"multipart/form-data",data:t};ne(a).then((l=>{"0"===l.code?(e.success(l.message),Y.psFlag=!1,Z()):$e(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ge=()=>{Y.psFlag=!1,uploadRef.value.clearFiles()},be=()=>{ge()},ye=e=>{Y.pFlag=!0,Y.pTitle="编辑属性",Y.propertyForm.name=e.name,Y.propertyForm.label=e.label,Y.propertyForm.accessMode=e.accessMode,Y.propertyForm.type=e.type,Y.propertyForm.decimals=e.decimals,Y.propertyForm.unit=e.unit,Y.propertyForm.regCnt=e.regCnt,Y.propertyForm.regAddr=e.regAddr,Y.propertyForm.ruleType=e.ruleType,Y.propertyForm.formula=void 0===e.formula||null===e.formula?"":e.formula,Y.propertyForm.bitOffsetSw=void 0!==e.bitOffsetSw&&null!==e.bitOffsetSw&&e.bitOffsetSw,Y.propertyForm.bitOffset=void 0===e.bitOffset||null===e.bitOffset?0:e.bitOffset,3!==e.type?(Y.propertyForm.min=e.params.min,Y.propertyForm.max=e.params.max,Y.propertyForm.minMaxAlarm=e.params.minMaxAlarm,Y.propertyForm.step=void 0===e.params.step||null===e.params.step?0:e.params.step,Y.propertyForm.stepAlarm=e.params.stepAlarm):(Y.propertyForm.dataLength=e.params.dataLength,Y.propertyForm.dataLengthAlarm=e.params.dataLengthAlarm)},he=V(null),ve=()=>{Y.pFlag=!1,he.value.resetFields(),we()},Fe=e=>{ve()},_e=e=>{Y.selectedProperties=e},we=()=>{Y.propertyForm={name:"",label:"",accessMode:0,type:0,decimals:0,unit:"",regCnt:1,regAddr:null,ruleType:"Int_AB",formula:"",bitOffsetSw:!1,bitOffset:0,step:0,min:0,max:0,dataLength:0}},ke=()=>{Y.fFlag=!0,Y.curFormula=Y.propertyForm.formula,(()=>{const e={token:k.token,data:{name:v.curModelBlock.tslName}};w.getDeviceModelProperty(e).then((e=>{e&&("0"===e.code?(Y.propertyInfo=[{name:"t",label:"当前属性"}],e.data.forEach((e=>{Y.propertyInfo.push({name:e.name,label:e.label})}))):$e(e))}))})()},xe=e=>{Y.selectionStart=e.srcElement.selectionStart},$e=l=>{e({type:"error",message:l.message})},Je=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return H((()=>v.curModelBlock),((e,l)=>{Z()})),(y,h)=>{const F=l,_=r,w=a,V=t,A=L("Icon"),D=o,q=d,I=n,E=i,H=p,K=u,X=c,ae=m,ne=f,we=g,Ke=b;return B(),S("div",Ce,[O("div",Me,[O("div",Ve,[O("div",Ae,U(v.curModelBlock.label)+"：命令参数列表",1)]),O("div",De,[P(D,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:R((()=>[P(w,{style:{"margin-left":"20px"}},{default:R((()=>[P(_,{style:{width:"200px"},placeholder:"请输入命令参数名称",modelValue:z(Y).deviceModelProperty,"onUpdate:modelValue":h[0]||(h[0]=e=>z(Y).deviceModelProperty=e)},{prefix:R((()=>[P(F,{class:"el-input__icon"},{default:R((()=>[P(z(C))])),_:1})])),_:1},8,["modelValue"])])),_:1}),P(w,null,{default:R((()=>[P(V,{type:"primary",plain:"",class:"right-btn",onClick:h[1]||(h[1]=e=>{Y.psFlag=!0})},{default:R((()=>[P(F,{class:"el-input__icon"},{default:R((()=>[P(z(M))])),_:1}),T(" 导入命令参数 ")])),_:1})])),_:1}),P(w,null,{default:R((()=>[P(V,{type:"primary",plain:"",class:"right-btn",onClick:h[2]||(h[2]=e=>(()=>{const e={token:k.token,responseType:"blob",data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name}};ie(e).then((e=>{if(e&&"1"===e.code)return void $e(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:R((()=>[P(F,{class:"el-input__icon"},{default:R((()=>[P(z(x))])),_:1}),T(" 导出命令参数 ")])),_:1})])),_:1}),P(w,null,{default:R((()=>[P(V,{type:"primary",bg:"",class:"right-btn",onClick:h[3]||(h[3]=e=>(Y.pFlag=!0,void(Y.pTitle="添加属性")))},{default:R((()=>[P(F,{class:"btn-icon"},{default:R((()=>[P(A,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),T(" 添加 ")])),_:1})])),_:1}),P(w,null,{default:R((()=>[P(V,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:h[4]||(h[4]=e=>{Z(1)})},{default:R((()=>[P(F,{class:"btn-icon"},{default:R((()=>[P(A,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),T(" 刷新 ")])),_:1})])),_:1}),P(w,null,{default:R((()=>[P(V,{type:"danger",bg:"",class:"right-btn",onClick:h[5]||(h[5]=l=>(l=>{let t=[];0!==Y.selectedProperties.length?(Y.selectedProperties.forEach((e=>{t.push(e.name)})),s.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name,propertyNames:t}};de(e).then((e=>{Je(e,Z)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:R((()=>[P(F,{class:"btn-icon"},{default:R((()=>[P(A,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),T(" 删除 ")])),_:1})])),_:1})])),_:1},512)])]),O("div",{class:"content",ref_key:"contentRef",ref:Q},[P(I,{data:z(ee),"cell-style":z(Y).cellStyle,"header-cell-style":z(Y).headerCellStyle,style:{width:"100%"},stripe:"","max-height":z(Y).tableMaxHeight,onSelectionChange:_e,onRowDblclick:ye},{empty:R((()=>[ze])),default:R((()=>[P(q,{type:"selection",width:"55"}),P(q,{type:"expand",width:"60"},{default:R((e=>[O("div",Le,[O("div",Be,[O("div",Se,[O("b",null,U(e.row.name),1),T(" 参数详情 ")])]),O("div",Oe,[(B(!0),S(N,null,j(e.row.params,((e,l,t)=>(B(),S("div",{class:"param-item",key:t},[O("div",Pe,U(z(Y).paramName[l])+"：",1),O("div",Re,U(e||"-"),1)])))),128))])])])),_:1}),P(q,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),P(q,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),P(q,{sortable:"",label:"读写属性",width:"auto","min-width":"100",align:"center"},{default:R((e=>[T(U(z(Y).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),P(q,{sortable:"",prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:R((e=>[T(U(z(Y).typeNames["t"+e.row.type]),1)])),_:1}),P(q,{sortable:"",label:"小数位数",width:"auto","min-width":"100",align:"center"},{default:R((e=>[T(U(""===e.row.decimals?0:e.row.decimals),1)])),_:1}),P(q,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),P(q,{sortable:"",prop:"regAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),P(q,{sortable:"",prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"120",align:"center"}),P(q,{sortable:"",prop:"ruleType",label:"解析规则",width:"auto","min-width":"120",align:"center"}),P(q,{sortable:"",prop:"formula",label:"计算公式",width:"auto","min-width":"200",align:"center"}),P(q,{sortable:"",label:"按位解析",width:"auto","min-width":"100",align:"center"},{default:R((e=>[T(U(!1===e.row.bitOffsetSw?"否":"是"),1)])),_:1}),P(q,{sortable:"",prop:"bitOffset",label:"位偏移",width:"auto","min-width":"120",align:"center"},{default:R((e=>[T(U(!1===e.row.bitOffsetSw?"-":e.row.bitOffset),1)])),_:1}),P(q,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:R((e=>[P(V,{onClick:l=>ye(e.row),text:"",type:"primary"},{default:R((()=>[T("编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),O("div",Te,[P(E,{"current-page":z(Y).currentPage,"page-size":z(Y).pagesize,"page-sizes":[20,50,200,500],total:z(le).length,onCurrentChange:te,onSizeChange:se,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),P(we,{modelValue:z(Y).pFlag,"onUpdate:modelValue":h[30]||(h[30]=e=>z(Y).pFlag=e),title:z(Y).pTitle,width:"800px","before-close":Fe,"close-on-click-modal":!1},{footer:R((()=>[O("span",je,[P(V,{onClick:h[28]||(h[28]=e=>ve())},{default:R((()=>[T("取消")])),_:1}),P(V,{type:"primary",onClick:h[29]||(h[29]=l=>{3!==Y.propertyForm.type&&Number(Y.propertyForm.min)>Number(Y.propertyForm.max)?e.warning("最大值必须大于最小值"):he.value.validate((e=>{if(!e)return!1;{const e={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name,name:Y.propertyForm.name,label:Y.propertyForm.label,accessMode:Y.propertyForm.accessMode,type:Y.propertyForm.type,decimals:Y.propertyForm.decimals,unit:Y.propertyForm.unit,regCnt:Y.propertyForm.regCnt,regAddr:Y.propertyForm.regAddr,ruleType:Y.propertyForm.ruleType,formula:Y.propertyForm.formula,bitOffsetSw:Y.propertyForm.bitOffsetSw,bitOffset:Y.propertyForm.bitOffsetSw?Y.propertyForm.bitOffset.toString():"0"}};let l={};3!==Y.propertyForm.type?(l.min=Y.propertyForm.min.toString(),l.max=Y.propertyForm.max.toString(),l.minMaxAlarm=Y.propertyForm.minMaxAlarm,l.step=Y.propertyForm.step.toString(),l.stepAlarm=Y.propertyForm.stepAlarm):(l.dataLength=Y.propertyForm.dataLength.toString(),l.dataLengthAlarm=Y.propertyForm.dataLengthAlarm),e.data.params=l,Y.pTitle.includes("添加")?oe(e).then((e=>{Je(e,Z),ve()})):re(e).then((e=>{Je(e,Z),ve()}))}}))})},{default:R((()=>[T("保存")])),_:1})])])),default:R((()=>[O("div",Ue,[P(D,{model:z(Y).propertyForm,rules:z(Y).propertyRules,ref_key:"propertyFormRef",ref:he,"status-icon":"","label-position":"right","label-width":"120px",inline:!0},{default:R((()=>[P(w,{label:"属性名称",prop:"name"},{default:R((()=>[P(_,{style:{width:"220px"},disabled:z(Y).pTitle.includes("编辑"),type:"text",modelValue:z(Y).propertyForm.name,"onUpdate:modelValue":h[6]||(h[6]=e=>z(Y).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),P(w,{label:"属性标签",prop:"label"},{default:R((()=>[P(_,{style:{width:"220px"},type:"text",modelValue:z(Y).propertyForm.label,"onUpdate:modelValue":h[7]||(h[7]=e=>z(Y).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),P(w,{label:"读写属性",prop:"accessMode"},{default:R((()=>[P(K,{modelValue:z(Y).propertyForm.accessMode,"onUpdate:modelValue":h[8]||(h[8]=e=>z(Y).propertyForm.accessMode=e),style:{width:"220px"},placeholder:"请选择读写属性"},{default:R((()=>[(B(!0),S(N,null,j(z(Y).accessModeOptions,(e=>(B(),G(H,{key:"accessMode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),P(w,{label:"单位",prop:"unit"},{default:R((()=>[P(_,{style:{width:"220px"},type:"text",modelValue:z(Y).propertyForm.unit,"onUpdate:modelValue":h[9]||(h[9]=e=>z(Y).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1}),P(w,{label:"属性类型",prop:"type"},{default:R((()=>[P(K,{modelValue:z(Y).propertyForm.type,"onUpdate:modelValue":h[10]||(h[10]=e=>z(Y).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择属性类型"},{default:R((()=>[(B(!0),S(N,null,j(z(Y).typeOptions,(e=>(B(),G(H,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),P(w,{label:"计算公式",prop:"formula"},{default:R((()=>[P(_,{style:{width:"220px"},type:"text",readonly:"",modelValue:z(Y).propertyForm.formula,"onUpdate:modelValue":h[12]||(h[12]=e=>z(Y).propertyForm.formula=e),autocomplete:"off",placeholder:"请编辑计算公式"},{append:R((()=>[P(V,{onClick:h[11]||(h[11]=e=>ke())},{default:R((()=>[T("编辑")])),_:1})])),_:1},8,["modelValue"])])),_:1}),W(P(w,{label:"小数位数",prop:"decimals"},{default:R((()=>[P(_,{style:{width:"220px"},type:"text",modelValue:z(Y).propertyForm.decimals,"onUpdate:modelValue":h[13]||(h[13]=e=>z(Y).propertyForm.decimals=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入小数位数"},null,8,["modelValue"])])),_:1},512),[[$,2===z(Y).propertyForm.type]]),O("div",null,[3!==z(Y).propertyForm.type?(B(),G(w,{key:0,label:"范围报警",prop:"minMaxAlarm"},{default:R((()=>[P(X,{modelValue:z(Y).propertyForm.minMaxAlarm,"onUpdate:modelValue":h[14]||(h[14]=e=>z(Y).propertyForm.minMaxAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):J("",!0)]),O("div",null,[3!==z(Y).propertyForm.type&&z(Y).propertyForm.minMaxAlarm?(B(),G(w,{key:0,label:"最小值",prop:"min"},{default:R((()=>[P(_,{type:"text",modelValue:z(Y).propertyForm.min,"onUpdate:modelValue":h[15]||(h[15]=e=>z(Y).propertyForm.min=e),autocomplete:"off",placeholder:"请输入最小值"},null,8,["modelValue"])])),_:1})):J("",!0)]),3!==z(Y).propertyForm.type&&z(Y).propertyForm.minMaxAlarm?(B(),G(w,{key:0,label:"最大值",prop:"max"},{default:R((()=>[P(_,{type:"text",modelValue:z(Y).propertyForm.max,"onUpdate:modelValue":h[16]||(h[16]=e=>z(Y).propertyForm.max=e),autocomplete:"off",placeholder:"请输入最大值"},null,8,["modelValue"])])),_:1})):J("",!0),O("div",null,[3!==z(Y).propertyForm.type?(B(),G(w,{key:0,label:"步长报警",prop:"stepAlarm"},{default:R((()=>[P(X,{modelValue:z(Y).propertyForm.stepAlarm,"onUpdate:modelValue":h[17]||(h[17]=e=>z(Y).propertyForm.stepAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):J("",!0)]),3!==z(Y).propertyForm.type&&z(Y).propertyForm.stepAlarm?(B(),G(w,{key:1,label:"步长",prop:"step"},{default:R((()=>[P(_,{type:"text",modelValue:z(Y).propertyForm.step,"onUpdate:modelValue":h[18]||(h[18]=e=>z(Y).propertyForm.step=e),autocomplete:"off",placeholder:"请输入步长"},null,8,["modelValue"])])),_:1})):J("",!0),O("div",null,[3===z(Y).propertyForm.type?(B(),G(w,{key:0,label:"字符串长度报警",prop:"dataLengthAlarm"},{default:R((()=>[P(X,{modelValue:z(Y).propertyForm.dataLengthAlarm,"onUpdate:modelValue":h[19]||(h[19]=e=>z(Y).propertyForm.dataLengthAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):J("",!0)]),3===z(Y).propertyForm.type&&z(Y).propertyForm.dataLengthAlarm?(B(),G(w,{key:2,label:"字符串长度",prop:"dataLength"},{default:R((()=>[P(_,{type:"text",modelValue:z(Y).propertyForm.dataLength,"onUpdate:modelValue":h[20]||(h[20]=e=>z(Y).propertyForm.dataLength=e),autocomplete:"off",placeholder:"请输入字符串长度"},null,8,["modelValue"])])),_:1})):J("",!0),Ne,P(w,{label:"寄存器地址",prop:"regAddr"},{default:R((()=>[P(_,{type:"text",style:{width:"220px"},modelValue:z(Y).propertyForm.regAddr,"onUpdate:modelValue":h[21]||(h[21]=e=>z(Y).propertyForm.regAddr=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器地址"},null,8,["modelValue"])])),_:1}),1!=v.curModelBlock.funCode?(B(),G(w,{key:3,label:"",prop:"",style:{width:"220px"}})):J("",!0),P(w,{label:"寄存器数量",prop:"regCnt"},{default:R((()=>[1==v.curModelBlock.funCode?(B(),G(_,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:z(Y).propertyForm.regCnt,"onUpdate:modelValue":h[22]||(h[22]=e=>z(Y).propertyForm.regCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器数量"},null,8,["modelValue"])):(B(),G(K,{key:1,modelValue:z(Y).propertyForm.regCnt,"onUpdate:modelValue":h[23]||(h[23]=e=>z(Y).propertyForm.regCnt=e),modelModifiers:{number:!0},style:{width:"220px"},onChange:h[24]||(h[24]=e=>(()=>{const e=Y.propertyForm.regCnt;1===e&&(Y.propertyForm.ruleType="Int_AB"),2===e&&(Y.propertyForm.ruleType="Long_ABCD"),4===e&&(Y.propertyForm.ruleType="Double_ABCDEFGH")})()),placeholder:"请选择寄存器数量"},{default:R((()=>[(B(!0),S(N,null,j(z(Y).regCntOptions,(e=>(B(),G(H,{key:"regCount_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),1!=v.curModelBlock.funCode?(B(),G(w,{key:4,label:"解析规则",prop:"ruleType"},{default:R((()=>[P(K,{modelValue:z(Y).propertyForm.ruleType,"onUpdate:modelValue":h[25]||(h[25]=e=>z(Y).propertyForm.ruleType=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择解析规则"},{default:R((()=>[(B(!0),S(N,null,j(z(Y).ruleTypeOptions["rt"+z(Y).propertyForm.regCnt],(e=>(B(),G(H,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):J("",!0),P(ne,null,{default:R((()=>[3==v.curModelBlock.funCode||4==v.curModelBlock.funCode?(B(),G(w,{key:0,label:"按位解析"},{default:R((()=>[P(ae,{class:"item",effect:"dark",content:"开启后按字节位解析数据,位偏移从0开始",placement:"top"},{default:R((()=>[P(X,{style:{width:"220px"},modelValue:z(Y).propertyForm.bitOffsetSw,"onUpdate:modelValue":h[26]||(h[26]=e=>z(Y).propertyForm.bitOffsetSw=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})])),_:1})):J("",!0),z(Y).propertyForm.bitOffsetSw?(B(),G(w,{key:1,label:"位偏移",prop:"bitOffset"},{default:R((()=>[P(_,{type:"text",style:{width:"220px"},modelValue:z(Y).propertyForm.bitOffset,"onUpdate:modelValue":h[27]||(h[27]=e=>z(Y).propertyForm.bitOffset=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入位偏移"},null,8,["modelValue"])])),_:1})):J("",!0)])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),P(we,{modelValue:z(Y).fFlag,"onUpdate:modelValue":h[36]||(h[36]=e=>z(Y).fFlag=e),title:"编辑计算公式",width:"600px"},{footer:R((()=>[O("span",He,[P(V,{onClick:h[34]||(h[34]=e=>(Y.fFlag=!1,void(Y.curFormula="")))},{default:R((()=>[T("取消")])),_:1}),P(V,{type:"primary",onClick:h[35]||(h[35]=e=>(Y.fFlag=!1,void(Y.propertyForm.formula=Y.curFormula)))},{default:R((()=>[T("保存")])),_:1})])])),default:R((()=>[O("div",qe,[P(D,{model:z(Y).formulaForm,"label-position":"right","label-width":"120px"},{default:R((()=>[P(w,{label:"运算符号"},{default:R((()=>[O("div",Ie,[(B(!0),S(N,null,j(z(Y).operationList,((e,l)=>(B(),S("div",{key:l,class:"operation"},[O("div",Ee,[P(V,{style:{width:"100%"},onClick:l=>(e=>{let l=Y.curFormula.length;if(l!==Y.selectionStart){let t=Y.curFormula.substr(0,Y.selectionStart),a=Y.curFormula.substr(Y.selectionStart,l-Y.selectionStart);Y.curFormula=t+e.name+a,Y.selectionStart+=e.name.length}else Y.curFormula+=e.name,Y.selectionStart+=e.name.length})(e)},{default:R((()=>[T(U(e.label),1)])),_:2},1032,["onClick"])])])))),128))])])),_:1}),P(w,{label:"设备属性"},{default:R((()=>[P(K,{modelValue:z(Y).pItem,"onUpdate:modelValue":h[31]||(h[31]=e=>z(Y).pItem=e),filterable:"",placeholder:"请选择设备属性",onChange:h[32]||(h[32]=e=>(e=>{let l=Y.curFormula.length;if(l!==Y.selectionStart){let t=Y.curFormula.substr(0,Y.selectionStart),a=Y.curFormula.substr(Y.selectionStart,l-Y.selectionStart);Y.curFormula=t+"("+e+")"+a,Y.selectionStart+=e.length+2}else Y.curFormula+="("+e+")",Y.selectionStart+=e.length+2})(z(Y).pItem)),style:{width:"100%"}},{default:R((()=>[(B(!0),S(N,null,j(z(Y).propertyInfo,(e=>(B(),G(H,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),P(w,{label:"当前公式"},{default:R((()=>[P(_,{type:"text",clearable:"",modelValue:z(Y).curFormula,"onUpdate:modelValue":h[33]||(h[33]=e=>z(Y).curFormula=e),autocomplete:"off",placeholder:"请编辑计算公式",onBlur:xe},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),P(we,{modelValue:z(Y).psFlag,"onUpdate:modelValue":h[37]||(h[37]=e=>z(Y).psFlag=e),title:"导入命令参数",width:"600px","before-close":be,"close-on-click-modal":!1},{footer:R((()=>[O("span",We,[P(V,{onClick:ge},{default:R((()=>[T("取消")])),_:1}),P(V,{type:"primary",onClick:pe},{default:R((()=>[T("上传")])),_:1})])])),default:R((()=>[P(Ke,{ref_key:"uploadDPSRef",ref:ce,action:"","auto-upload":!1,"http-request":ue,limit:1,"on-exceed":me,"before-upload":fe},{tip:R((()=>[Ge])),default:R((()=>[P(V,{type:"primary"},{default:R((()=>[T("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-5f572e24"]]);const Je=e=>(I("data-v-1b0295b1"),e=e(),E(),e),Ke={class:"main-container"},Xe={class:"main"},Qe={class:"mc-left"},Ye={class:"title"},Ze={class:"mcl-content"},el={class:"mclc-content"},ll={class:"mc-right"},tl={class:"mcr-top"},al={style:{display:"flex","justify-content":"space-between"}},ol={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},rl={class:"tName"},dl={class:"search-bar",style:{"text-align":"right"}},nl=Je((()=>O("div",null,"无数据",-1))),il={class:"pagination"},sl={key:0,class:"mcr-bottom"},pl={class:"dialog-content"},ul={class:"dialog-footer"},cl=Je((()=>O("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),ml={class:"dialog-footer"};var fl=v({__name:"ModelBlockRtu",props:{curDeviceModel:{type:Object,default:{}},deviceModelList:{type:Array,default:[]}},emits:["changeShowFlag"],setup(c,{emit:m}){const f=c,h=F();console.log("id -> props",f);const v=/^[0-9]*[1-9][0-9]*$/,w=V(null),I=A({curDeviceModel:f.curDeviceModel,headerCellStyle:{background:_.primaryColor,color:_.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelBlock:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],funCodeOptions:[{label:"01(读线圈状态)",value:1},{label:"02(读离散输入状态)",value:2},{label:"03(读保持寄存器)",value:3},{label:"04(读输入寄存器)",value:4},{label:"05(写单个线圈)",value:5},{label:"06(写单个保持寄存器)",value:6},{label:"15(写多个线圈)",value:15},{label:"16(写多个保持寄存器)",value:16}],funCodeNames:{f1:"01(读线圈状态)",f2:"02(读离散输入状态)",f3:"03(读保持寄存器)",f4:"04(读输入寄存器)",f5:"05(写单个线圈)",f6:"06(写单个保持寄存器)",f15:"15(写多个线圈)",f16:"16(写多个保持寄存器)"},dataTypeOptions:[{label:"uint8",value:0},{label:"int8",value:1},{label:"uint16",value:2},{label:"int16",value:3},{label:"uint32",value:4},{label:"int32",value:5},{label:"float",value:6},{label:"double",value:7}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},dataTypeNames:{dt0:"uint8",dt1:"int8",dt2:"uint16",dt3:"int16",dt4:"uint32",dt5:"int32",dt6:"float",dt7:"double"},pFlag:!1,pTitle:"添加属性",blockForm:{name:"",label:"",funCode:null,startRegAddr:0,regCnt:0},paramName:{name:"块名称",label:"块标签",funCode:"功能码",type:"属性类型",startRegAddr:"寄存器地址",regCnt:"寄存器数量"},propertyRules:{name:[{required:!0,message:"块名称不能为空",trigger:"blur"}],label:[{required:!0,message:"块标签不能为空",trigger:"blur"}],funCode:[{required:!0,message:"功能码不能为空",trigger:"blur"}],startRegAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{0===l||v.test(l)?t():t(new Error("只能输入自然数！"))}}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{v.test(l)?t():t(new Error("只能输入正整数数字！"))}}]},psFlag:!1,selectedProperties:[],curModelBlock:{},porpFlag:!1}),E=l=>{const t={token:h.token,data:{tslName:I.curDeviceModel.name}};Q(t).then((async t=>{t&&("0"===t.code?(I.propertyList=t.data,I.propertyList.length>0?(I.curModelBlock=I.propertyList[0],I.curModelBlock.tslName=I.curDeviceModel.name,console.log("getDeviceModelBlock -> ctxData.curModelBlock",I.curModelBlock),I.porpFlag=!0):I.porpFlag=!1,1===l&&e({type:"success",message:"刷新成功！"})):ye(t),await q((()=>{I.tableMaxHeight=w.value.clientHeight-34-22-82,2===l&&be(I.curModelBlock)})))}))};E(2);const H=D((()=>(console.log("ctxData.propertyList ->",I.propertyList),I.propertyList.filter((e=>{var l=!I.deviceModelBlock,t=e.name.toLowerCase().includes(I.deviceModelBlock.toLowerCase());return l||t})).slice((I.currentPage-1)*I.pagesize,I.currentPage*I.pagesize)))),W=D((()=>I.propertyList.filter((e=>{var l=!I.deviceModelBlock,t=e.name.toLowerCase().includes(I.deviceModelBlock.toLowerCase());return l||t})))),$=e=>{I.currentPage=e},X=e=>{I.pagesize=e},ae=()=>{re.value&&re.value.submit()},oe=e=>{},re=V(null),de=e=>{re.value.clearFiles();const l=e[0];re.value.handleStart(l)},ne=l=>{console.log("beforeUpload -> file",l);let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("name",I.curDeviceModel.name),t.append("fileName",l);const a={token:h.token,contentType:"multipart/form-data",data:t};le(a).then((l=>{"0"===l.code?(e.success(l.message),I.psFlag=!1,E()):ye(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ie=()=>{I.psFlag=!1,uploadRef.value.clearFiles()},se=()=>{ie()},pe=e=>{I.pFlag=!0,I.pTitle="编辑属性",I.blockForm.name=e.name,I.blockForm.label=e.label,I.blockForm.funCode=e.funCode,I.blockForm.startRegAddr=e.startRegAddr,I.blockForm.regCnt=e.regCnt},ue=V(null),ce=()=>{I.pFlag=!1,ue.value.resetFields(),ge()},me=e=>{ce()},fe=e=>{I.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},ge=()=>{I.blockForm={name:"",label:"",funCode:null,startRegAddr:0,regCnt:0}},be=e=>{I.curModelBlock=e,I.curModelBlock.tslName=I.curDeviceModel.name},ye=l=>{e({type:"error",message:l.message})},he=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(c,v)=>{const F=l,_=t,V=y,A=r,D=a,q=L("Icon"),Q=o,le=d,ge=n,ve=i,Fe=p,_e=u,we=g,ke=b;return B(),S("div",Ke,[O("div",Xe,[O("div",Qe,[O("div",Ye,[P(_,{type:"primary",style:{width:"100%"},plain:"",onClick:v[0]||(v[0]=e=>{m("changeShowFlag","goBack")})},{default:R((()=>[P(F,{class:"el-input__icon"},{default:R((()=>[P(z(k))])),_:1}),T(" 返回设备模型 ")])),_:1})]),O("div",Ze,[(B(!0),S(N,null,j(f.deviceModelList,((e,l)=>(B(),G(V,{key:"i"+l,shadow:"hover",class:K({"mclc-card":!0,activeModel:e.name==z(I).curDeviceModel.name}),onClick:l=>(e=>{I.curDeviceModel.name!=e.name&&(I.curDeviceModel=e,E())})(e)},{default:R((()=>[O("div",el,[O("span",null,U(e.name),1)])])),_:2},1032,["class","onClick"])))),128))])]),O("div",ll,[O("div",tl,[O("div",al,[O("div",ol,[O("div",rl,U(z(I).curDeviceModel.label)+"：命令列表",1)]),O("div",dl,[P(Q,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:R((()=>[P(D,{style:{"margin-left":"20px"}},{default:R((()=>[P(A,{style:{width:"200px"},placeholder:"请输入命令名称",modelValue:z(I).deviceModelBlock,"onUpdate:modelValue":v[1]||(v[1]=e=>z(I).deviceModelBlock=e)},{prefix:R((()=>[P(F,{class:"el-input__icon"},{default:R((()=>[P(z(C))])),_:1})])),_:1},8,["modelValue"])])),_:1}),P(D,null,{default:R((()=>[P(_,{type:"primary",plain:"",class:"right-btn",onClick:v[2]||(v[2]=e=>(console.log("importDPS"),void(I.psFlag=!0)))},{default:R((()=>[P(F,{class:"el-input__icon"},{default:R((()=>[P(z(M))])),_:1}),T(" 导入命令 ")])),_:1})])),_:1}),P(D,null,{default:R((()=>[P(_,{type:"primary",plain:"",class:"right-btn",onClick:v[3]||(v[3]=e=>(()=>{console.log("exportDPS");const e={token:h.token,responseType:"blob",data:{name:I.curDeviceModel.name}};te(e).then((e=>{if(e&&"1"===e.code)return void ye(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:R((()=>[P(F,{class:"el-input__icon"},{default:R((()=>[P(z(x))])),_:1}),T(" 导出命令 ")])),_:1})])),_:1}),P(D,null,{default:R((()=>[P(_,{type:"primary",bg:"",class:"right-btn",onClick:v[4]||(v[4]=e=>(console.log("addDeviceModelBlock"),I.pFlag=!0,void(I.pTitle="添加属性")))},{default:R((()=>[P(F,{class:"btn-icon"},{default:R((()=>[P(q,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),T(" 添加 ")])),_:1})])),_:1}),P(D,null,{default:R((()=>[P(_,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:v[5]||(v[5]=e=>{E(1)})},{default:R((()=>[P(F,{class:"btn-icon"},{default:R((()=>[P(q,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),T(" 刷新 ")])),_:1})])),_:1}),P(D,null,{default:R((()=>[P(_,{type:"danger",bg:"",class:"right-btn",onClick:v[6]||(v[6]=l=>(l=>{let t=[];0!==I.selectedProperties.length?(I.selectedProperties.forEach((e=>{t.push(e.name)})),console.log("pList",t),s.confirm("确认要删除这些命令吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:h.token,data:{tslName:I.curDeviceModel.name,names:t}};ee(e).then((e=>{he(e,E)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个命令！")})())},{default:R((()=>[P(F,{class:"btn-icon"},{default:R((()=>[P(q,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),T(" 删除 ")])),_:1})])),_:1})])),_:1},512)])]),O("div",{class:"content",ref_key:"contentRef",ref:w},[P(ge,{data:z(H),"cell-style":z(I).cellStyle,"header-cell-style":z(I).headerCellStyle,"max-height":z(I).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:fe,onRowDblclick:pe},{empty:R((()=>[nl])),default:R((()=>[P(le,{type:"selection",width:"55"}),P(le,{sortable:"",prop:"name",label:"命令名称",width:"auto","min-width":"150",align:"center"}),P(le,{sortable:"",prop:"label",label:"命令标签",width:"auto","min-width":"150",align:"center"}),P(le,{sortable:"",label:"功能码",width:"auto","min-width":"150",align:"center"},{default:R((e=>[T(U(z(I).funCodeNames["f"+e.row.funCode]),1)])),_:1}),P(le,{sortable:"",prop:"startRegAddr",label:"寄存器地址",width:"auto","min-width":"120",align:"center"}),P(le,{sortable:"",prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"100",align:"center"}),P(le,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:R((e=>[P(_,{onClick:l=>pe(e.row),text:"",type:"primary"},{default:R((()=>[T("编辑")])),_:2},1032,["onClick"]),P(_,{onClick:l=>be(e.row,2),text:"",type:"success"},{default:R((()=>[T("命令参数详情")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),O("div",il,[P(ve,{"current-page":z(I).currentPage,"page-size":z(I).pagesize,"page-sizes":[20,50,200,500],total:z(W).length,onCurrentChange:$,onSizeChange:X,background:"",layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])],512)]),z(I).porpFlag?(B(),S("div",sl,[P($e,{curModelBlock:z(I).curModelBlock},null,8,["curModelBlock"])])):J("",!0)]),P(we,{modelValue:z(I).pFlag,"onUpdate:modelValue":v[14]||(v[14]=e=>z(I).pFlag=e),title:z(I).pTitle,width:"600px","before-close":me,"close-on-click-modal":!1},{footer:R((()=>[O("span",ul,[P(_,{onClick:v[12]||(v[12]=e=>ce())},{default:R((()=>[T("取消")])),_:1}),P(_,{type:"primary",onClick:v[13]||(v[13]=e=>{ue.value.validate((e=>{if(!e)return!1;{const e={token:h.token,data:{tslName:I.curDeviceModel.name,name:I.blockForm.name,label:I.blockForm.label,funCode:I.blockForm.funCode,startRegAddr:I.blockForm.startRegAddr,regCnt:I.blockForm.regCnt}};I.pTitle.includes("添加")?Y(e).then((e=>{he(e,E),ce()})):Z(e).then((e=>{he(e,E),ce()}))}}))})},{default:R((()=>[T("保存")])),_:1})])])),default:R((()=>[O("div",pl,[P(Q,{model:z(I).blockForm,rules:z(I).propertyRules,ref_key:"blockFormRef",ref:ue,"status-icon":"","label-position":"right","label-width":"120px"},{default:R((()=>[P(D,{label:"块名称",prop:"name"},{default:R((()=>[P(A,{disabled:z(I).pTitle.includes("编辑"),type:"text",modelValue:z(I).blockForm.name,"onUpdate:modelValue":v[7]||(v[7]=e=>z(I).blockForm.name=e),autocomplete:"off",placeholder:"请输入块名称"},null,8,["disabled","modelValue"])])),_:1}),P(D,{label:"块标签",prop:"label"},{default:R((()=>[P(A,{type:"text",modelValue:z(I).blockForm.label,"onUpdate:modelValue":v[8]||(v[8]=e=>z(I).blockForm.label=e),autocomplete:"off",placeholder:"请输入块标签"},null,8,["modelValue"])])),_:1}),P(D,{label:"功能码",prop:"funCode"},{default:R((()=>[P(_e,{modelValue:z(I).blockForm.funCode,"onUpdate:modelValue":v[9]||(v[9]=e=>z(I).blockForm.funCode=e),style:{width:"100%"},placeholder:"请选择功能码"},{default:R((()=>[(B(!0),S(N,null,j(z(I).funCodeOptions,(e=>(B(),G(Fe,{key:"funCode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),P(D,{label:"寄存器地址",prop:"startRegAddr"},{default:R((()=>[P(A,{type:"text",modelValue:z(I).blockForm.startRegAddr,"onUpdate:modelValue":v[10]||(v[10]=e=>z(I).blockForm.startRegAddr=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器地址"},null,8,["modelValue"])])),_:1}),P(D,{label:"寄存器数量",prop:"regCnt"},{default:R((()=>[P(A,{type:"text",modelValue:z(I).blockForm.regCnt,"onUpdate:modelValue":v[11]||(v[11]=e=>z(I).blockForm.regCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器数量"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),P(we,{modelValue:z(I).psFlag,"onUpdate:modelValue":v[15]||(v[15]=e=>z(I).psFlag=e),title:"导入命令",width:"600px","before-close":se,"close-on-click-modal":!1},{footer:R((()=>[O("span",ml,[P(_,{onClick:ie},{default:R((()=>[T("取消")])),_:1}),P(_,{type:"primary",onClick:ae},{default:R((()=>[T("上传")])),_:1})])])),default:R((()=>[P(ke,{ref_key:"uploadDPSRef",ref:re,action:"","auto-upload":!1,"http-request":oe,limit:1,"on-exceed":de,"before-upload":ne},{tip:R((()=>[cl])),default:R((()=>[P(_,{type:"primary"},{default:R((()=>[T("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-1b0295b1"]]);const gl={class:"main-container"},bl={key:0,class:"main"},yl={class:"search-bar"},hl={class:"tool-bar"},vl=(e=>(I("data-v-911fca10"),e=e(),E(),e))((()=>O("div",null,"无数据",-1))),Fl={class:"pagination"},_l={class:"dialog-content"},wl={class:"dialog-footer"};var kl=v({__name:"DeviceModelRtu",setup(p){const u=F(),c=V(null),m=A({typeModel:2,showFlag:0,headerCellStyle:{background:_.primaryColor,color:_.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceModelInfo:"",tableData:[],modelForm:{name:"",label:"",type:0,param:""},modelRules:{name:[{required:!0,message:"采集模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"采集模型标识不能为空",trigger:"blur"}],param:[{required:!0,message:"采集模型插件不能为空",trigger:"blur"}]},udFlag:!1,dmFlag:!1,dmTitle:"添加采集模型",pluginList:[],curDeviceModel:"",tsl:"",handleFlag:""}),f=X();m.tsl=f.query.tsl;const b=l=>{const t={token:u.token,data:{type:m.typeModel}};w.getDeviceModelList(t).then((async t=>{if(t){if("0"===t.code){if(m.tableData=t.data,m.tsl&&!m.handleFlag){const e=m.tableData.find((e=>e.name===m.tsl));I(e)}1===l&&e({type:"success",message:"刷新成功！"})}else H(t);await q((()=>{m.tableMaxHeight=c.value.clientHeight-34-36-22}))}}))};b();const y=D((()=>m.tableData.filter((e=>{var l=!m.deviceModelInfo,t=e.name.toLowerCase().includes(m.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(m.deviceModelInfo.toLowerCase());return l||t})).slice((m.currentPage-1)*m.pagesize,m.currentPage*m.pagesize))),h=D((()=>m.tableData.filter((e=>{var l=!m.deviceModelInfo,t=e.name.toLowerCase().includes(m.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(m.deviceModelInfo.toLowerCase());return l||t})))),v=e=>{m.currentPage=e},k=e=>{m.pagesize=e},x=e=>{m.dmFlag=!0,m.dmTitle="编辑采集模型",m.modelForm={name:e.name,label:e.label,type:void 0===e.type?0:e.type,param:e.param}},M=V(null),U=()=>{m.dmFlag=!1,M.value.resetFields(),j()},N=()=>{U()},j=()=>{m.modelForm={name:"",label:"",type:0}},I=e=>{m.curDeviceModel=e,m.showFlag=2},E=e=>{m.handleFlag=e,m.showFlag=0,b()},H=l=>{e({type:"error",message:l.message})},W=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(p,f)=>{const F=l,_=r,V=a,A=L("Icon"),D=t,j=o,q=d,H=n,$=i,K=g;return B(),S("div",gl,[0===z(m).showFlag?(B(),S("div",bl,[O("div",yl,[P(j,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:R((()=>[P(V,{label:"采集模型名称"},{default:R((()=>[P(_,{style:{width:"200px"},placeholder:"请输入采集模型名称",modelValue:z(m).deviceModelInfo,"onUpdate:modelValue":f[0]||(f[0]=e=>z(m).deviceModelInfo=e)},{prefix:R((()=>[P(F,{class:"el-input__icon"},{default:R((()=>[P(z(C))])),_:1})])),_:1},8,["modelValue"])])),_:1}),P(V,null,{default:R((()=>[P(D,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:f[1]||(f[1]=e=>{b(1)})},{default:R((()=>[P(F,{class:"btn-icon"},{default:R((()=>[P(A,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),T(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),O("div",hl,[P(D,{type:"primary",bg:"",class:"right-btn",onClick:f[2]||(f[2]=e=>(m.dmFlag=!0,void(m.dmTitle="添加采集模型")))},{default:R((()=>[P(F,{class:"btn-icon"},{default:R((()=>[P(A,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),T(" 添加 ")])),_:1})]),O("div",{class:"content",ref_key:"contentRef",ref:c},[P(H,{data:z(y),"cell-style":z(m).cellStyle,"header-cell-style":z(m).headerCellStyle,"max-height":z(m).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:x},{empty:R((()=>[vl])),default:R((()=>[P(q,{sortable:"",prop:"name",label:"采集模型名称",width:"auto","min-width":"200",align:"center"}),P(q,{sortable:"",prop:"label",label:"采集模型标签",width:"auto","min-width":"200",align:"center"}),P(q,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:R((l=>[P(D,{onClick:e=>{return t=l.row,m.curDeviceModel=t,void(m.showFlag=1);var t},text:"",type:"success"},{default:R((()=>[T("变量详情")])),_:2},1032,["onClick"]),P(D,{onClick:e=>I(l.row),text:"",type:"success"},{default:R((()=>[T("命令详情")])),_:2},1032,["onClick"]),P(D,{onClick:e=>x(l.row),text:"",type:"primary"},{default:R((()=>[T("编辑")])),_:2},1032,["onClick"]),P(D,{onClick:t=>{return a=l.row,void s.confirm("确定要删除这个采集模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:u.token,data:{name:a.name,type:2}};w.deleteDeviceModel(e).then((e=>{W(e,b)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var a},text:"",type:"danger"},{default:R((()=>[T("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),O("div",Fl,[P($,{"current-page":z(m).currentPage,"page-size":z(m).pagesize,"page-sizes":[20,50,200,500],total:z(h).length,onCurrentChange:v,onSizeChange:k,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):J("",!0),1===z(m).showFlag?(B(),G(ke,{key:1,curDeviceModel:z(m).curDeviceModel,onChangeShowFlag:E,style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel"])):J("",!0),2===z(m).showFlag?(B(),G(fl,{key:2,curDeviceModel:z(m).curDeviceModel,deviceModelList:z(m).tableData,onChangeShowFlag:E,style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel","deviceModelList"])):J("",!0),P(K,{modelValue:z(m).dmFlag,"onUpdate:modelValue":f[7]||(f[7]=e=>z(m).dmFlag=e),title:z(m).dmTitle,width:"600px","before-close":N,"close-on-click-modal":!1},{footer:R((()=>[O("span",wl,[P(D,{onClick:f[5]||(f[5]=e=>U())},{default:R((()=>[T("取消")])),_:1}),P(D,{type:"primary",onClick:f[6]||(f[6]=e=>{M.value.validate((e=>{if(!e)return!1;{m.modelForm.type=m.typeModel;const e={token:u.token,data:m.modelForm};m.dmTitle.includes("添加")?w.addDeviceModel(e).then((e=>{W(e,b),U()})):w.editDeviceModel(e).then((e=>{W(e,b),U()}))}}))})},{default:R((()=>[T("保存")])),_:1})])])),default:R((()=>[O("div",_l,[P(j,{model:z(m).modelForm,rules:z(m).modelRules,ref_key:"modelFormRef",ref:M,"status-icon":"","label-position":"right","label-width":"120px"},{default:R((()=>[P(V,{label:"采集模型名称",prop:"name"},{default:R((()=>[P(_,{type:"text",disabled:z(m).dmTitle.includes("编辑"),modelValue:z(m).modelForm.name,"onUpdate:modelValue":f[3]||(f[3]=e=>z(m).modelForm.name=e),autocomplete:"off",placeholder:"请输入采集模型名称"},null,8,["disabled","modelValue"])])),_:1}),P(V,{label:"采集模型标签",prop:"label"},{default:R((()=>[P(_,{type:"text",modelValue:z(m).modelForm.label,"onUpdate:modelValue":f[4]||(f[4]=e=>z(m).modelForm.label=e),autocomplete:"off",placeholder:"请输入采集模型标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-911fca10"]]);export{kl as default};
