import{g as e,m as a,n as l,v as t,w as s,x as c,y as i,p as o,e as d,o as r,A as n,B as m,C as u,D as p,s as h,u as f,F as v,G as g,H as y,t as b,q as x}from"./element-plus.64650d13.js";import{Y as w,f as _,p as F,X as k,o as D,c as S,u as j,a as C,S as L,Q as V,M as I,af as T,P,a0 as N,U as z,at as M,au as U,H as O,J as R,K as H}from"./@vue.5db09832.js";import{_ as q,u as A,v as E,D as G}from"./index.98f42e56.js";import{S as K}from"./service.19c72ecc.js";import{a as B}from"./vue-router.d969f71f.js";import{t as J}from"./vue3-barcode.ec0ee5c1.js";import{D as Q}from"./deviceModel.a85a7758.js";import{I as W}from"./interface.c4e57716.js";import{D as X}from"./Device-property.0d5757d6.js";import"./@vueuse.af8df401.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./@element-plus.aa3ef65f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./pinia.69c74452.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./vue-echarts.8f00425b.js";import"./resize-detector.4e96b72b.js";import"./echarts.62a08783.js";import"./zrender.56caf4f2.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const Y=e=>(M("data-v-dfe905e8"),e=e(),U(),e),Z={class:"main-container"},$={key:0,class:"main",style:{overflow:"hidden"}},ee={class:"search-bar"},ae=N("全部"),le=N("在线"),te=N("离线"),se=N("搜索"),ce=N("重置"),ie=N(" 刷新 "),oe=N("在线"),de=N("离线"),re=N("查看变量"),ne=Y((()=>C("div",null,"无数据",-1))),me={class:"pagination",style:{bottom:"24px"}},ue={key:1,class:"main"};var pe=q({setup(h){const f=A(),v=w({headerCellStyle:{background:E.primaryColor,color:E.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceTableData:[],screenData:[],deviceTotal:0,deviceOnline:0,dFlag:!1,dTitle:"添加设备",deviceInfo:"",deviceModelList:[],selectedDevices:[],idFlag:!0,uFlag:!1,commStatusOptions:[{label:"全部",value:"Line"},{label:"在线",value:"onLine"},{label:"离线",value:"offLine"}],sFlag:!1,screenForm:{name:"",label:"",tsl:"",commStatus:"Line",collInterfaceName:[],addr:""},interfaceList:[],interfaces:[],checkedInterfaceList:[],collDeviceObj:{}}),g=()=>{v.idFlag=!0,b()};(()=>{const e={token:f.token,data:{}};W.getInterfaceList(e).then((e=>{e&&("0"===e.code?(v.interfaceList=e.data,v.interfaces=[],v.interfaceList.forEach((e=>{v.interfaces.push(e.collInterfaceName),v.checkedInterfaceList.push(e.collInterfaceName)})),b()):q(e))}))})();const y=_(null),b=a=>{const l={token:f.token,data:{names:v.checkedInterfaceList}};W.getAllCollDevices(l).then((async l=>{console.log("getCollDevices -> res",l),l&&("0"===l.code?(v.deviceTableData=null==l.data.node?[]:l.data.node,v.screenData=v.deviceTableData,v.deviceTotal=l.data.commTotalCnt,v.deviceOnline=l.data.commSuccessCnt,1===a&&e({type:"success",message:"刷新成功！"})):q(l),await O((()=>{v.tableMaxHeight=y.value.clientHeight-34-36-22})))}))};(()=>{const e={token:f.token,data:{}};Q.getDeviceModelList(e).then((e=>{console.log("getDeviceModelList -> res",e),"0"===e.code?v.deviceModelList=e.data:q(e)}))})();const x=e=>{v.currentPage=e},M=F((()=>v.screenData.slice((v.currentPage-1)*v.pagesize,v.currentPage*v.pagesize))),U=F((()=>v.screenData)),R=e=>{v.pagesize=e},H=()=>{v.screenForm={name:"",tsl:"",label:"",commStatus:"Line",collInterfaceName:[],addr:""}},q=a=>{e({type:"error",message:a.message})},G=B();return(e,h)=>{const f=a,w=l,_=t,F=s,O=c,q=i,A=o,E=k("Icon"),K=d,B=r,J=n,Q=m,W=u,Y=p;return D(),S("div",Z,[j(v).idFlag?(D(),S("div",$,[C("div",ee,[L(B,{model:j(v).screenForm,inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:V((()=>[L(w,{label:"设备名称",prop:"name"},{default:V((()=>[L(f,{type:"text",modelValue:j(v).screenForm.name,"onUpdate:modelValue":h[0]||(h[0]=e=>j(v).screenForm.name=e),autocomplete:"off",placeholder:"请输入设备名称"},null,8,["modelValue"])])),_:1}),L(w,{label:"设备标签",prop:"label"},{default:V((()=>[L(f,{type:"text",modelValue:j(v).screenForm.label,"onUpdate:modelValue":h[1]||(h[1]=e=>j(v).screenForm.label=e),autocomplete:"off",placeholder:"请输入设备标签"},null,8,["modelValue"])])),_:1}),L(w,{label:"设备地址",prop:"addr"},{default:V((()=>[L(f,{type:"text",modelValue:j(v).screenForm.addr,"onUpdate:modelValue":h[2]||(h[2]=e=>j(v).screenForm.addr=e),autocomplete:"off",placeholder:"请输入设备地址"},null,8,["modelValue"])])),_:1}),L(w,{label:"设备模型",prop:"tsl"},{default:V((()=>[L(F,{modelValue:j(v).screenForm.tsl,"onUpdate:modelValue":h[3]||(h[3]=e=>j(v).screenForm.tsl=e),clearable:"",style:{width:"100%"},placeholder:"请选择设备模型"},{default:V((()=>[(D(!0),S(I,null,T(j(v).deviceModelList,((e,a)=>(D(),P(_,{key:"dm_"+a,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),L(w,{label:"采集接口",prop:"collInterfaceName"},{default:V((()=>[L(F,{modelValue:j(v).screenForm.collInterfaceName,"onUpdate:modelValue":h[4]||(h[4]=e=>j(v).screenForm.collInterfaceName=e),clearable:"",style:{width:"100%"},placeholder:"请选择采集接口",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:V((()=>[(D(!0),S(I,null,T(j(v).interfaceList,((e,a)=>(D(),P(_,{key:"cin_"+a,label:e.collInterfaceName,value:e.collInterfaceName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),L(w,{label:"通信状态"},{default:V((()=>[L(q,{modelValue:j(v).screenForm.commStatus,"onUpdate:modelValue":h[5]||(h[5]=e=>j(v).screenForm.commStatus=e)},{default:V((()=>[L(O,{label:"Line"},{default:V((()=>[ae])),_:1}),L(O,{label:"onLine"},{default:V((()=>[le])),_:1}),L(O,{label:"offLine"},{default:V((()=>[te])),_:1})])),_:1},8,["modelValue"])])),_:1}),L(w,{style:{"margin-left":"20px"}},{default:V((()=>[L(A,{type:"primary",onClick:h[6]||(h[6]=e=>(console.log("doScreen ctxData.deviceTableData = ",v.deviceTableData),console.log("doScreen ctxData.screenForm = ",v.screenForm),v.screenData=[],v.deviceTotal=0,v.deviceOnline=0,void v.deviceTableData.forEach((e=>{var a=e.name.includes(v.screenForm.name),l=e.label.includes(v.screenForm.label),t=e.addr.includes(v.screenForm.addr),s=""===v.screenForm.tsl||e.tsl==v.screenForm.tsl,c=0===v.screenForm.collInterfaceName.length||v.screenForm.collInterfaceName.includes(e.collInterfaceName),i="Line"===v.screenForm.commStatus||e.commStatus.includes(v.screenForm.commStatus);a&&l&&t&&s&&c&&i&&(v.screenData.push(e),"onLine"==e.commStatus&&v.deviceOnline++,v.deviceTotal++)}))))},{default:V((()=>[se])),_:1})])),_:1}),L(w,null,{default:V((()=>[L(A,{onClick:h[7]||(h[7]=e=>{H()})},{default:V((()=>[ce])),_:1})])),_:1}),L(w,null,{default:V((()=>[L(A,{style:{color:"#fff"},color:"#2EA554",onClick:h[8]||(h[8]=e=>{b(1)})},{default:V((()=>[L(K,{class:"btn-icon"},{default:V((()=>[L(E,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),ie])),_:1})])),_:1})])),_:1},8,["model"])]),C("div",{class:"content",ref_key:"contentRef",ref:y},[L(W,{data:j(M),"cell-style":j(v).cellStyle,"header-cell-style":j(v).headerCellStyle,style:{width:"100%"},"max-height":j(v).tableMaxHeight,stripe:""},{empty:V((()=>[ne])),default:V((()=>[L(J,{prop:"name",label:"设备名称",width:"auto","min-width":"160",align:"center",fixed:"left"}),L(J,{prop:"label",label:"设备标签",width:"auto","min-width":"160",align:"center"}),L(J,{prop:"tsl",label:"设备模型",width:"auto","min-width":"160",align:"center"},{default:V((e=>[L(A,{type:"primary",link:"",onClick:a=>{return l=e.row,void G.push({path:"deviceModelRtu",query:{tsl:l.tsl}});var l}},{default:V((()=>[N(z(e.row.tsl),1)])),_:2},1032,["onClick"])])),_:1}),L(J,{prop:"collInterfaceName",label:"采集接口",width:"auto","min-width":"160",align:"center"}),L(J,{prop:"addr",label:"通讯地址",width:"auto","min-width":"100",align:"center"}),L(J,{label:"当前通信状态",width:"auto","min-width":"150",align:"center"},{default:V((e=>["onLine"===e.row.commStatus?(D(),P(Q,{key:0,type:"success"},{default:V((()=>[oe])),_:1})):(D(),P(Q,{key:1,type:"danger"},{default:V((()=>[de])),_:1}))])),_:1}),L(J,{prop:"lastCommRTC",label:"最后通信时间",width:"auto","min-width":"200",align:"center"}),L(J,{prop:"commTotalCnt",label:"通信总次数",width:"auto","min-width":"150",align:"center"}),L(J,{prop:"commSuccessCnt",label:"通信成功次数",width:"auto","min-width":"150",align:"center"}),L(J,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:V((e=>[L(A,{onClick:a=>{return l=e.row,v.idFlag=!1,void(v.curDevice=l);var l},text:"",type:"success"},{default:V((()=>[re])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),C("div",me,[L(Y,{"current-page":j(v).currentPage,"page-size":j(v).pagesize,"page-sizes":[20,50,200,500],total:j(U).length,onCurrentChange:x,onSizeChange:R,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):(D(),S("div",ue,[L(X,{curDevice:j(v).curDevice,pageInfo:"dashboard",onChangeIdFlag:g,style:{width:"100%",height:"96%",overflow:"hidden"}},null,8,["curDevice"])]))])}}},[["__scopeId","data-v-dfe905e8"]]);const he=e=>(M("data-v-aec72054"),e=e(),U(),e),fe={class:"dashboard"},ve={class:"basic-info"},ge=he((()=>C("div",{class:"bi-title"},"基本信息",-1))),ye={class:"bi-body"},be={class:"cui-content"},xe={class:"card-header"},we={class:"cui-header"},_e={style:{"font-weight":"600"}},Fe=N("查看条形码"),ke={class:"card-content"},De={class:"cc-body"},Se={class:"ccb-item",style:{height:"31px","line-height":"31px"}},je=he((()=>C("div",{class:""},"硬件版本：",-1))),Ce={class:"head-name"},Le={class:"ccb-item",style:{height:"31px","line-height":"31px"}},Ve=he((()=>C("div",{class:""},"软件版本：",-1))),Ie={class:"head-name"},Te={class:"ccb-item",style:{height:"31px","line-height":"31px"}},Pe=he((()=>C("div",{class:""},"系统时间：",-1))),Ne={class:"head-name"},ze={class:"ccb-item",style:{height:"31px","line-height":"31px"}},Me=he((()=>C("div",{class:""},"内存总量：",-1))),Ue={class:"head-name"},Oe={class:"ccb-item",style:{height:"31px","line-height":"31px"}},Re=he((()=>C("div",{class:""},"硬盘总量：",-1))),He={class:"head-name"},qe={class:"ccb-item",style:{"margin-bottom":"15px",height:"31px","line-height":"31px"}},Ae=he((()=>C("div",{class:""},"运行时间：",-1))),Ee={class:"head-name"},Ge={style:{"padding-top":"10px"}},Ke=he((()=>C("div",{class:"bi-title"},"上报信息",-1))),Be={class:"bi-body"},Je={class:"info-list"},Qe={class:"cui-content"},We={class:"card-header"},Xe={class:"cui-header"},Ye={style:{"font-weight":"600"}},Ze=N("查看详情"),$e={class:"card-content"},ea={class:"cc-body"},aa={class:"ccb-item"},la=he((()=>C("div",{class:""},"协议名称：",-1))),ta={class:"head-name"},sa={class:"ccb-item"},ca=he((()=>C("div",{class:""},"上报周期：",-1))),ia={class:"head-name"},oa={class:"ccb-item"},da=he((()=>C("div",{class:""},"产品密钥：",-1))),ra={class:"head-name"},na={class:"ccb-item"},ma=he((()=>C("div",{class:""},"通讯地址：",-1))),ua={class:"head-name"},pa={class:"ccb-item"},ha=he((()=>C("div",{class:""},"设备密钥：",-1))),fa={class:"head-name"},va={style:{display:"flex",width:"100%","justify-content":"center","text-align":"center"}};var ga=q({setup(a){const l=A(),t=w({sysParams:{SN:"",deviceOnline:"",devicePacketLoss:"",diskTotal:"",diskUse:"",hardVer:"",lockStatus:0,memTotal:"",memUse:"",name:"",runTime:"",softVer:"",systemRTC:""},showFlag:!1,bFlag:!1,barcodeVale:0,gatewayTableData:[]});(()=>{const e={token:l.token,data:{}};G.getSysParams(e).then((e=>{console.log("getSysParams -> res",e),"0"===e.code&&(t.sysParams=e.data,console.log("getSysParams -> ctxData.sysParams",t.sysParams),t.showFlag=!0,t.barcodeVale=t.sysParams.SN,sessionStorage.setItem("SN",t.barcodeVale))}))})();const s=B();return(a=>{const s={token:l.token,data:{}};K.getGatewayList(s).then((async l=>{console.log("getGatewayList -> res",l),l&&("0"===l.code?(t.gatewayTableData=l.data,1===a&&e({type:"success",message:"刷新成功！"})):showOneResMsg(l))}))})(),(e,a)=>{const l=h,c=o,i=f,d=v,r=m,n=g,u=y,p=b,w=x;return D(),S("div",fe,[L(p,{style:{height:"calc(100% - 10px)"}},{default:V((()=>[L(l,{style:{height:"calc(50% - 10px)"}},{default:V((()=>[L(pe,{style:{width:"100%",height:"calc(63.7% - 1px)"}})])),_:1}),L(u,{style:{height:"calc(36% - 25px)",padding:"0px"}},{default:V((()=>[L(n,{gutter:20,style:{height:"calc(100%)",padding:"0px",margin:"0px"}},{default:V((()=>[L(d,{span:8,style:{height:"calc(100%)","padding-left":"0px","padding-right":"15px"}},{default:V((()=>[C("div",ve,[ge,C("div",ye,[C("div",be,[L(i,{class:"box-card",shadow:"hover"},{header:V((()=>[C("div",xe,[C("div",we,[C("span",_e,"网关名称："+z(j(t).sysParams.name),1)]),C("div",null,[C("span",null,z(j(t).sysParams.SN),1),R(L(c,{class:"head-tag",text:"",type:"primary",onClick:a[0]||(a[0]=e=>{t.bFlag=!0}),size:"small",style:{"margin-left":"8px"}},{default:V((()=>[Fe])),_:1},512),[[H,j(t).showFlag]])])])])),default:V((()=>[C("div",ke,[C("div",De,[C("div",Se,[je,C("div",Ce,z(j(t).sysParams.hardVer),1)]),C("div",Le,[Ve,C("div",Ie,z(j(t).sysParams.softVer),1)]),C("div",Te,[Pe,C("div",Ne,z(j(t).sysParams.systemRTC),1)]),C("div",ze,[Me,C("div",Ue,z(j(t).sysParams.memTotal),1)]),C("div",Oe,[Re,C("div",He,z(j(t).sysParams.diskTotal),1)]),C("div",qe,[Ae,C("div",Ee,z(j(t).sysParams.runTime),1)])])])])),_:1})])])])])),_:1}),L(d,{span:16,style:{height:"calc(104%)","background-color":"#fff","border-radius":"4px"}},{default:V((()=>[C("div",Ge,[Ke,C("div",Be,[C("div",Je,[(D(!0),S(I,null,T(j(t).gatewayTableData,((e,a)=>(D(),S("div",{class:"info-item",key:a},[C("div",Qe,[L(i,{class:"box-card",shadow:"hover"},{header:V((()=>[C("div",We,[C("div",Xe,[C("span",Ye,z(e.serviceName),1),L(r,{size:"small",style:{"margin-left":"8px"},type:"onLine"===e.reportStatus?"success":"danger"},{default:V((()=>[N(z("onLine"===e.reportStatus?"在线":"离线"),1)])),_:2},1032,["type"])]),C("div",null,[L(c,{class:"head-tag",text:"",type:"primary",onClick:a=>{return l=e,void s.push({path:"dataService",query:{serviceName:l.serviceName}});var l},size:"small"},{default:V((()=>[Ze])),_:2},1032,["onClick"])])])])),default:V((()=>[C("div",$e,[C("div",ea,[C("div",aa,[la,C("div",ta,z(e.protocol),1)]),C("div",sa,[ca,C("div",ia,z(e.reportTime)+" 秒",1)]),C("div",oa,[da,C("div",ra,z(e.param.ProductKey),1)]),C("div",na,[ma,C("div",ua,z(e.param.DeviceID),1)]),C("div",pa,[ha,C("div",fa,z(e.param.DeviceSecret),1)])])])])),_:2},1024)])])))),128))])])])])),_:1})])),_:1})])),_:1})])),_:1}),L(w,{modelValue:j(t).bFlag,"onUpdate:modelValue":a[1]||(a[1]=e=>j(t).bFlag=e),title:"网关SN条形码",width:"30%"},{default:V((()=>[C("div",va,[L(j(J),{value:j(t).barcodeVale,height:60},null,8,["value"])])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-aec72054"]]);export{ga as default};
