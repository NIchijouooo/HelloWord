import{g as e,e as a,p as l,n as t,o,m as r,A as n,C as s,D as i,B as c,q as p}from"./element-plus.2c9426ce.js";import{J as d,r as u,j as g,ae as h,o as f,c as m,a as b,O as y,R as C,u as v,V as w,W as D,_,$ as x,n as P,av as T,aw as z}from"./@vue.2c474d7f.js";import{_ as I,u as k,v as V}from"./index.d5c032bc.js";import{I as S}from"./interface.52fdfea5.js";import{D as j}from"./deviceModel.d8833265.js";import{b as L,d as F,g as N}from"./@element-plus.e895b9e1.js";const M={class:"main-container"},R={class:"main"},H={class:"search-bar"},E={class:"search-bar",style:{display:"flex"}},U={class:"title",style:{position:"relative","margin-right":"40px","justify-content":"flex-start",padding:"0px 0px",height:"40px"}},W={class:"tName"},A=(e=>(T("data-v-1d6cb511"),e=e(),z(),e))((()=>b("div",null,"无数据",-1))),O={class:"pagination"},q={class:"dialog-content",style:{"min-height":"408px",overflow:"unset",padding:"0"}},B={class:"dialog-content-head"},J={class:"dialog-content-content"},$={class:"pagination dialog-pagination"},G={class:"dialog-footer"};var K=I({__name:"Device-property",props:{curDevice:{type:Object,default:{}},collInterfaceName:{type:String,default:""},pageInfo:{type:String,default:""}},emits:["changeIdFlag"],setup(T,{emit:z}){const I=T,K=k();console.log("id -> props",I);const Q=d({headerCellStyle:{background:V.primaryColor,color:V.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyTableData:[],propertyInfo:"",pFlag:!1,pInfo:"",pCurrentPage:1,pPagesize:5,userHeadStyle:{color:V.headerTextColor,borderColor:"#C0C4CC",height:"48px"},userCellStyle:{borderColor:"#C0C4CC",height:"48px"},pTableData:[],pTableData1:[],selectPorperties:[],isLoading:!1}),X=u(null),Y=a=>{const l={token:K.token,data:{collInterfaceName:I.curDevice.collInterfaceName,deviceName:I.curDevice.name}};Q.isLoading=!0,S.getDeviceDataReal(l).then((async l=>{console.log("getDeviceDataReal -> res",l),l&&("0"===l.code?(Q.propertyTableData=l.data,1===a&&e.success("刷新成功！")):ie(l),Q.isLoading=!1,console.log("getDeviceDataReal -> ctxData.propertyTableData",Q.propertyTableData),await P((()=>{let e=X.value.clientHeight-34-36-42;I.pageInfo&&(e=X.value.clientHeight-34-36-132),Q.tableMaxHeight=e})))}))};Y();const Z=g((()=>{let e=Q.propertyInfo;return Q.propertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase()))).slice((Q.currentPage-1)*Q.pagesize,Q.currentPage*Q.pagesize)})),ee=g((()=>{let e=Q.propertyInfo;return Q.propertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase())))})),ae=e=>{Q.currentPage=e},le=e=>{Q.pagesize=e},te=()=>{Q.pFlag=!1},oe=e=>{te()},re=e=>{Q.pCurrentPage=e,Q.pTableData=Q.pTableData1.slice((Q.pCurrentPage-1)*Q.pPagesize,Q.pCurrentPage*Q.pPagesize)},ne=e=>{Q.pPagesize=e,Q.pTableData=Q.pTableData1.slice((Q.pCurrentPage-1)*Q.pPagesize,Q.pCurrentPage*Q.pPagesize)},se=e=>{console.log("handleSelectionChange val = ",e),console.log("handleSelectionChange pTableData = ",Q.pTableData),Q.selectPorperties=e},ie=a=>{e({type:"error",message:a.message})};return(d,u)=>{const g=a,P=l,T=t,k=o,V=r,ce=h("Icon"),pe=n,de=s,ue=i,ge=c,he=p;return f(),m("div",M,[b("div",R,[b("div",H,[y(k,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:C((()=>[y(T,{style:{"margin-right":"20px","margin-left":"20px"}},{default:C((()=>[y(P,{type:"primary",plain:"",onClick:u[0]||(u[0]=e=>{z("changeIdFlag")})},{default:C((()=>[y(g,{class:"el-input__icon"},{default:C((()=>[y(v(L))])),_:1}),w(" 返回采集设备 ")])),_:1})])),_:1})])),_:1},512)]),b("div",E,[b("div",U,[b("div",W,D(I.curDevice.name)+"("+D(I.curDevice.label)+")",1)]),y(k,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:C((()=>[y(T,null,{default:C((()=>[y(V,{style:{width:"200px"},placeholder:"请输入 名称/标签 过滤",clearable:"",modelValue:v(Q).propertyInfo,"onUpdate:modelValue":u[1]||(u[1]=e=>v(Q).propertyInfo=e)},{prefix:C((()=>[y(g,{class:"el-input__icon"},{default:C((()=>[y(v(F))])),_:1})])),_:1},8,["modelValue"])])),_:1}),y(T,null,{default:C((()=>[y(P,{type:"primary",plain:"",class:"right-btn",onClick:u[2]||(u[2]=e=>(()=>{const e={token:K.token,data:{name:I.curDevice.tsl}};j.getDeviceModelProperty(e).then((e=>{"0"===e.code?(Q.pTableData=[],Q.pTableData1=[],e.data.filter((e=>0!==e.accessMode)).forEach((e=>{const a={name:e.name,label:e.label,sendValue:"",result:{Code:"",Message:""}};Q.pTableData.push(a),Q.pTableData1.push(a)})),console.log("ctxData.pTableData -> ",Q.pTableData),Q.pFlag=!0):ie(e)}))})())},{default:C((()=>[y(g,{class:"el-input__icon"},{default:C((()=>[y(v(N))])),_:1}),w(" 写属性 ")])),_:1})])),_:1}),y(T,null,{default:C((()=>[y(P,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:u[3]||(u[3]=e=>{Y(1)})},{default:C((()=>[y(g,{class:"btn-icon"},{default:C((()=>[y(ce,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),w(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),b("div",{class:"content",ref_key:"contentRef",ref:X},[y(de,{data:v(Z),"cell-style":v(Q).cellStyle,"header-cell-style":v(Q).headerCellStyle,style:{width:"100%"},"max-height":v(Q).tableMaxHeight,stripe:""},{empty:C((()=>[A])),default:C((()=>[y(pe,{type:"index",width:"60"},{header:C((()=>[w(" 序号 ")])),_:1}),y(pe,{sortable:"",prop:"name",label:"变量名称",width:"auto","min-width":"180",align:"center"}),y(pe,{sortable:"",prop:"label",label:"变量标签",width:"auto","min-width":"180",align:"center"}),y(pe,{sortable:"",prop:"type",label:"变量类型",width:"auto","min-width":"120",align:"center"}),y(pe,{sortable:"",prop:"value",label:"变量值",width:"auto","min-width":"200",align:"center"}),y(pe,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"200",align:"center"}),y(pe,{sortable:"",prop:"explain",label:"说明",width:"auto","min-width":"200",align:"center"}),y(pe,{sortable:"",prop:"timestamp",label:"实测时间",width:"auto","min-width":"220",align:"center"}),y(pe,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:C((a=>[y(P,{onClick:l=>(a.row,void e.info("功能完善中...")),text:"",type:"success"},{default:C((()=>[w("查看历史数据")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),b("div",O,[y(ue,{"current-page":v(Q).currentPage,"page-size":v(Q).pagesize,"page-sizes":[20,50,200,500],total:v(ee).length,onCurrentChange:ae,onSizeChange:le,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),y(he,{modelValue:v(Q).pFlag,"onUpdate:modelValue":u[8]||(u[8]=e=>v(Q).pFlag=e),title:"写属性",width:"1000px","before-close":oe,"close-on-click-modal":!1},{footer:C((()=>[b("span",G,[y(P,{onClick:u[7]||(u[7]=e=>te())},{default:C((()=>[w("关闭")])),_:1})])])),default:C((()=>[b("div",q,[b("div",B,[y(V,{placeholder:"请输入属性名称或标签",style:{width:"200px"},modelValue:v(Q).pInfo,"onUpdate:modelValue":u[4]||(u[4]=e=>v(Q).pInfo=e),onChange:u[5]||(u[5]=e=>{Q.pTableData=Q.pTableData1.filter((e=>!Q.pInfo||e.name.includes(Q.pInfo)||e.label.includes(Q.pInfo)))})},{prefix:C((()=>[y(g,{class:"el-input__icon"},{default:C((()=>[y(v(F))])),_:1})])),_:1},8,["modelValue"]),y(P,{type:"primary",class:"right-btn",onClick:u[6]||(u[6]=a=>(a=>{if(console.log("sendCmd",Q.selectPorperties),Q.selectPorperties.length<1)return void e.warning("请至少选择一个属性操作");const l={};Q.selectPorperties.forEach((e=>{l[e.name]=e.sendValue})),console.log(l);const t={token:K.token,data:{collInterfaceName:I.curDevice.collInterfaceName,deviceName:I.curDevice.name,serviceName:"SetVariables",serviceParam:l}};"Read"===a||S.invokeDeviceService(t).then((a=>{e.success("写属性命令下发成功！"),Q.pTableData.forEach((e=>{Q.selectPorperties.forEach((l=>{e.name===l.name&&(e.result=a)}))}))}))})("Write"))},{default:C((()=>[y(g,{class:"el-input__icon"},{default:C((()=>[y(v(N))])),_:1}),w(" 写属性 ")])),_:1})]),b("div",J,[y(de,{data:v(Q).pTableData,onSelectionChange:se,"header-cell-style":v(Q).userHeadStyle,"cell-style":v(Q).userCellStyle,style:{border:"1px solid #c0c4cc"},"max-height":"290",stripe:""},{default:C((()=>[y(pe,{type:"selection",width:"55"}),y(pe,{sortable:"",prop:"name",label:"属性名称","min-width":"120",align:"center"}),y(pe,{sortable:"",prop:"label",label:"属性标签","min-width":"140",align:"center"}),y(pe,{sortable:"",label:"写入值","min-width":"100",align:"center"},{default:C((e=>[y(V,{placeholder:"请输入写入值",modelValue:e.row.sendValue,"onUpdate:modelValue":a=>e.row.sendValue=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),y(pe,{sortable:"",label:"返回结果","min-width":"250",align:"center"},{default:C((e=>[_(y(ge,{type:"success"},{default:C((()=>[w(" 操作成功 ")])),_:2},1536),[[x,"0"===e.row.result.Code]]),_(y(ge,{type:"danger"},{default:C((()=>[w(" 操作失败 ")])),_:2},1536),[[x,"1"===e.row.result.Code]]),_(b("span",null,"-",512),[[x,""===e.row.result.Code]]),_(b("span",null,D(e.row.result.Message),513),[[x,"1"===e.row.result.Code]])])),_:1})])),_:1},8,["data","header-cell-style","cell-style"]),b("div",$,[y(ue,{"current-page":v(Q).pCurrentPage,"page-size":v(Q).pPagesize,"page-sizes":[5,10,20,50],total:v(Q).pTableData1.length,onCurrentChange:re,onSizeChange:ne,background:"",layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])])])])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-1d6cb511"]]);export{K as D};
