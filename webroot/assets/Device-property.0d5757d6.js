import{g as e,e as a,p as l,n as t,o,m as n,A as r,C as s,D as i,B as c,q as p}from"./element-plus.64650d13.js";import{Y as d,f as u,p as g,X as f,o as h,c as m,a as b,S as y,Q as C,u as v,U as w,J as D,K as _,a0 as x,at as P,au as T,H as I}from"./@vue.5db09832.js";import{_ as z,u as k,v as S}from"./index.98f42e56.js";import{I as V}from"./interface.c4e57716.js";import{D as L}from"./deviceModel.a85a7758.js";import{I as j,J as F,K as N}from"./@element-plus.aa3ef65f.js";const H=e=>(P("data-v-7c015b3b"),e=e(),T(),e),M={class:"main-container"},R={class:"main"},U={class:"search-bar"},E=x(" 返回采集设备 "),A={class:"search-bar",style:{display:"flex"}},J={class:"title",style:{position:"relative","margin-right":"40px","justify-content":"flex-start",padding:"0px 0px",height:"40px"}},K={class:"tName"},W=x(" 写属性 "),q=x(" 刷新 "),B=x("查看历史数据"),O=H((()=>b("div",null,"无数据",-1))),Q={class:"pagination"},X={class:"dialog-content",style:{"min-height":"408px",overflow:"unset",padding:"0"}},Y={class:"dialog-content-head"},G=x(" 写属性 "),Z={class:"dialog-content-content"},$=x(" 操作成功 "),ee=x(" 操作失败 "),ae={class:"pagination dialog-pagination"},le={class:"dialog-footer"},te=x("关闭");var oe=z({props:{curDevice:{type:Object,default:{}},collInterfaceName:{type:String,default:""},pageInfo:{type:String,default:""}},emits:["changeIdFlag"],setup(x,{emit:P}){const T=x,z=k();console.log("id -> props",T);const H=d({headerCellStyle:{background:S.primaryColor,color:S.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyTableData:[],propertyInfo:"",pFlag:!1,pInfo:"",pCurrentPage:1,pPagesize:5,userHeadStyle:{color:S.headerTextColor,borderColor:"#C0C4CC",height:"48px"},userCellStyle:{borderColor:"#C0C4CC",height:"48px"},pTableData:[],pTableData1:[],selectPorperties:[],isLoading:!1}),oe=u(null),ne=a=>{const l={token:z.token,data:{collInterfaceName:T.curDevice.collInterfaceName,deviceName:T.curDevice.name}};H.isLoading=!0,V.getDeviceDataReal(l).then((async l=>{console.log("getDeviceDataReal -> res",l),l&&("0"===l.code?(H.propertyTableData=l.data,1===a&&e.success("刷新成功！")):he(l),H.isLoading=!1,console.log("getDeviceDataReal -> ctxData.propertyTableData",H.propertyTableData),await I((()=>{let e=oe.value.clientHeight-34-36-42;T.pageInfo&&(e=oe.value.clientHeight-34-36-132),H.tableMaxHeight=e})))}))};ne();const re=g((()=>{let e=H.propertyInfo;return H.propertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase()))).slice((H.currentPage-1)*H.pagesize,H.currentPage*H.pagesize)})),se=g((()=>{let e=H.propertyInfo;return H.propertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase())))})),ie=e=>{H.currentPage=e},ce=e=>{H.pagesize=e},pe=()=>{H.pFlag=!1},de=e=>{pe()},ue=e=>{H.pCurrentPage=e,H.pTableData=H.pTableData1.slice((H.pCurrentPage-1)*H.pPagesize,H.pCurrentPage*H.pPagesize)},ge=e=>{H.pPagesize=e,H.pTableData=H.pTableData1.slice((H.pCurrentPage-1)*H.pPagesize,H.pCurrentPage*H.pPagesize)},fe=e=>{console.log("handleSelectionChange val = ",e),console.log("handleSelectionChange pTableData = ",H.pTableData),H.selectPorperties=e},he=a=>{e({type:"error",message:a.message})};return(d,u)=>{const g=a,x=l,I=t,k=o,S=n,me=f("Icon"),be=r,ye=s,Ce=i,ve=c,we=p;return h(),m("div",M,[b("div",R,[b("div",U,[y(k,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:C((()=>[y(I,{style:{"margin-right":"20px","margin-left":"20px"}},{default:C((()=>[y(x,{type:"primary",plain:"",onClick:u[0]||(u[0]=e=>{P("changeIdFlag")})},{default:C((()=>[y(g,{class:"el-input__icon"},{default:C((()=>[y(v(j))])),_:1}),E])),_:1})])),_:1})])),_:1},512)]),b("div",A,[b("div",J,[b("div",K,w(T.curDevice.name)+"("+w(T.curDevice.label)+")",1)]),y(k,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:C((()=>[y(I,null,{default:C((()=>[y(S,{style:{width:"200px"},placeholder:"请输入 名称/标签 过滤",clearable:"",modelValue:v(H).propertyInfo,"onUpdate:modelValue":u[1]||(u[1]=e=>v(H).propertyInfo=e)},{prefix:C((()=>[y(g,{class:"el-input__icon"},{default:C((()=>[y(v(F))])),_:1})])),_:1},8,["modelValue"])])),_:1}),y(I,null,{default:C((()=>[y(x,{type:"primary",plain:"",class:"right-btn",onClick:u[2]||(u[2]=e=>(()=>{const e={token:z.token,data:{name:T.curDevice.tsl}};L.getDeviceModelProperty(e).then((e=>{"0"===e.code?(H.pTableData=[],H.pTableData1=[],e.data.filter((e=>0!==e.accessMode)).forEach((e=>{const a={name:e.name,label:e.label,sendValue:"",result:{Code:"",Message:""}};H.pTableData.push(a),H.pTableData1.push(a)})),console.log("ctxData.pTableData -> ",H.pTableData),H.pFlag=!0):he(e)}))})())},{default:C((()=>[y(g,{class:"el-input__icon"},{default:C((()=>[y(v(N))])),_:1}),W])),_:1})])),_:1}),y(I,null,{default:C((()=>[y(x,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:u[3]||(u[3]=e=>{ne(1)})},{default:C((()=>[y(g,{class:"btn-icon"},{default:C((()=>[y(me,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),q])),_:1})])),_:1})])),_:1},512)]),b("div",{class:"content",ref_key:"contentRef",ref:oe},[y(ye,{data:v(re),"cell-style":v(H).cellStyle,"header-cell-style":v(H).headerCellStyle,style:{width:"100%"},"max-height":v(H).tableMaxHeight,stripe:""},{empty:C((()=>[O])),default:C((()=>[y(be,{prop:"index",label:"序号",width:"55"}),y(be,{prop:"name",label:"变量名称",width:"auto","min-width":"180",align:"center"}),y(be,{prop:"label",label:"变量标签",width:"auto","min-width":"180",align:"center"}),y(be,{prop:"type",label:"变量类型",width:"auto","min-width":"120",align:"center"}),y(be,{prop:"value",label:"变量值",width:"auto","min-width":"200",align:"center"}),y(be,{prop:"unit",label:"单位",width:"auto","min-width":"200",align:"center"}),y(be,{prop:"explain",label:"说明",width:"auto","min-width":"200",align:"center"}),y(be,{prop:"timestamp",label:"实测时间",width:"auto","min-width":"220",align:"center"}),y(be,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:C((a=>[y(x,{onClick:l=>(a.row,void e.info("功能完善中...")),text:"",type:"success"},{default:C((()=>[B])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),b("div",Q,[y(Ce,{"current-page":v(H).currentPage,"page-size":v(H).pagesize,"page-sizes":[20,50,200,500],total:v(se).length,onCurrentChange:ie,onSizeChange:ce,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),y(we,{modelValue:v(H).pFlag,"onUpdate:modelValue":u[8]||(u[8]=e=>v(H).pFlag=e),title:"写属性",width:"1000px","before-close":de,"close-on-click-modal":!1},{footer:C((()=>[b("span",le,[y(x,{onClick:u[7]||(u[7]=e=>pe())},{default:C((()=>[te])),_:1})])])),default:C((()=>[b("div",X,[b("div",Y,[y(S,{placeholder:"请输入属性名称或标签",style:{width:"200px"},modelValue:v(H).pInfo,"onUpdate:modelValue":u[4]||(u[4]=e=>v(H).pInfo=e),onChange:u[5]||(u[5]=e=>{H.pTableData=H.pTableData1.filter((e=>!H.pInfo||e.name.includes(H.pInfo)||e.label.includes(H.pInfo)))})},{prefix:C((()=>[y(g,{class:"el-input__icon"},{default:C((()=>[y(v(F))])),_:1})])),_:1},8,["modelValue"]),y(x,{type:"primary",class:"right-btn",onClick:u[6]||(u[6]=a=>(a=>{if(console.log("sendCmd",H.selectPorperties),H.selectPorperties.length<1)return void e.warning("请至少选择一个属性操作");const l={};H.selectPorperties.forEach((e=>{l[e.name]=e.sendValue})),console.log(l);const t={token:z.token,data:{collInterfaceName:T.curDevice.collInterfaceName,deviceName:T.curDevice.name,serviceName:"SetVariables",serviceParam:l}};"Read"===a||V.invokeDeviceService(t).then((a=>{e.success("写属性命令下发成功！"),H.pTableData.forEach((e=>{H.selectPorperties.forEach((l=>{e.name===l.name&&(e.result=a)}))}))}))})("Write"))},{default:C((()=>[y(g,{class:"el-input__icon"},{default:C((()=>[y(v(N))])),_:1}),G])),_:1})]),b("div",Z,[y(ye,{data:v(H).pTableData,onSelectionChange:fe,"header-cell-style":v(H).userHeadStyle,"cell-style":v(H).userCellStyle,style:{border:"1px solid #c0c4cc"},"max-height":"290",stripe:""},{default:C((()=>[y(be,{type:"selection",width:"55"}),y(be,{prop:"name",label:"属性名称","min-width":"120",align:"center"}),y(be,{prop:"label",label:"属性标签","min-width":"140",align:"center"}),y(be,{label:"写入值","min-width":"100",align:"center"},{default:C((e=>[y(S,{placeholder:"请输入写入值",modelValue:e.row.sendValue,"onUpdate:modelValue":a=>e.row.sendValue=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),y(be,{label:"返回结果","min-width":"250",align:"center"},{default:C((e=>[D(y(ve,{type:"success"},{default:C((()=>[$])),_:2},1536),[[_,"0"===e.row.result.Code]]),D(y(ve,{type:"danger"},{default:C((()=>[ee])),_:2},1536),[[_,"1"===e.row.result.Code]]),D(b("span",null,"-",512),[[_,""===e.row.result.Code]]),D(b("span",null,w(e.row.result.Message),513),[[_,"1"===e.row.result.Code]])])),_:1})])),_:1},8,["data","header-cell-style","cell-style"]),b("div",ae,[y(Ce,{"current-page":v(H).pCurrentPage,"page-size":v(H).pPagesize,"page-sizes":[5,10,20,50],total:v(H).pTableData1.length,onCurrentChange:ue,onSizeChange:ge,background:"",layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])])])])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-7c015b3b"]]);export{oe as D};
