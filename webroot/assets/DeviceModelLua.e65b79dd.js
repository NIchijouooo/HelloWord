import{g as e,L as l,e as a,p as t,n as o,x as r,y as s,N as i,o as d,m as n,A as p,C as c,D as m,v as u,w as f,q as g,M as y}from"./element-plus.64650d13.js";import{f as h,Y as v,p as b,X as _,o as F,c as x,a as M,S as k,Q as w,u as C,U as L,a0 as D,L as P,M as V,af as z,P as j,at as A,au as U,H as T,J as R,K as S}from"./@vue.5db09832.js";import{_ as I,u as N,v as q,s as O}from"./index.98f42e56.js";import{D as H}from"./deviceModel.a85a7758.js";import{I as B,L as E,M as J,J as W}from"./@element-plus.aa3ef65f.js";import"./@vueuse.af8df401.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./vue-router.d969f71f.js";import"./pinia.69c74452.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./vue-echarts.8f00425b.js";import"./resize-detector.4e96b72b.js";import"./echarts.62a08783.js";import"./zrender.56caf4f2.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const K=e=>(A("data-v-3718c5ac"),e=e(),U(),e),Q={class:"main-container"},X={class:"main"},Y={class:"search-bar"},G=D(" 返回设备模型 "),Z=D("属性"),$=D(" 导入属性 "),ee=D(" 导出属性 "),le={key:0,style:{height:"calc(100% - 20px)"}},ae={class:"search-bar",style:{display:"flex"}},te={class:"title",style:{position:"relative","margin-right":"40px","justify-content":"flex-start",padding:"0px 0px",height:"40px"}},oe={class:"tName"},re=D(" 同步 "),se=D(" 添加 "),ie=D(" 删除 "),de=D(" 刷新 "),ne=D("编辑"),pe=K((()=>M("div",null,"无数据",-1))),ce={class:"pagination"},me=K((()=>M("div",{"e-else":""},null,-1))),ue={class:"dialog-content"},fe={class:"dialog-footer"},ge=D("取消"),ye=D("保存"),he=D("选择文件"),ve=K((()=>M("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),be={class:"dialog-footer"},_e=D("取消"),Fe=D("上传");var xe=I({props:{curDeviceModel:{type:Object,default:{}}},emits:["changeDpFlag"],setup(A,{emit:U}){const R=A,S=N();console.log("id -> props",R);const I=h(null),O=v({headerCellStyle:{background:q.primaryColor,color:q.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,varParamType:"Properties",propertyList:[],serviceList:[],deviceModelProperty:"",deviceModelService:"",accessModeOptions:[{label:"只读",value:0},{label:"只写",value:1},{label:"读写",value:2}],typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,unit:"",decimals:0,min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,dataLength:"",dataLengthAlarm:!1},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"布长",stepAlarm:"布长报警",unit:"单位",decimals:"小数位数",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],accessMode:[{required:!0,message:"读写属性不能为空",trigger:"blur"}],type:[{required:!0,message:"数据类型不能为空",trigger:"blur"}],decimals:[{type:"number",message:"小数位数只能输入数字",trigger:"blur"}]},psFlag:!1,selectedProperties:[]}),K=l=>{const a={token:S.token,data:{name:R.curDeviceModel.name}};H.getDeviceModelProperty(a).then((async a=>{console.log("getDeviceModelProperty -> res",a),a&&("0"===a.code?(O.propertyList=a.data,1===l&&e({type:"success",message:"刷新成功！"})):Ne(a),await T((()=>{O.tableMaxHeight=I.value.clientHeight-34-36-22})))}))};K();const xe=b((()=>(console.log("ctxData.propertyList ->",O.propertyList),O.propertyList.filter((e=>{var l=!O.deviceModelProperty,a=e.name.toLowerCase().includes(O.deviceModelProperty.toLowerCase());return l||a})).slice((O.currentPage-1)*O.pagesize,O.currentPage*O.pagesize)))),Me=b((()=>O.propertyList.filter((e=>{var l=!O.deviceModelProperty,a=e.name.toLowerCase().includes(O.deviceModelProperty.toLowerCase());return l||a}))));b((()=>(console.log("ctxData.serviceList ->",O.serviceList),O.serviceList.filter((e=>{var l=!O.deviceModelService,a=e.name.toLowerCase().includes(O.deviceModelService.toLowerCase());return l||a})).slice((O.currentPage-1)*O.pagesize,O.currentPage*O.pagesize))));const ke=e=>{O.currentPage=e},we=e=>{O.pagesize=e},Ce=()=>{De.value&&De.value.submit()},Le=e=>{},De=h(null),Pe=e=>{De.value.clearFiles();const l=e[0];De.value.handleStart(l)},Ve=l=>{console.log("beforeUpload -> file",l);let a=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(a){if(a){let a=new FormData;a.append("name",R.curDeviceModel.name),a.append("fileName",l);const t={token:S.token,contentType:"multipart/form-data",data:a};H.importDeviceModelProptyAndService(t).then((l=>{"0"===l.code?(e.success(l.message),O.psFlag=!1,K()):Ne(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ze=()=>{O.psFlag=!1,uploadRef.value.clearFiles()},je=()=>{ze()},Ae=e=>{O.pFlag=!0,O.pTitle="编辑属性",O.propertyForm.name=e.name,O.propertyForm.label=e.label,O.propertyForm.accessMode=e.accessMode,O.propertyForm.type=e.type,O.propertyForm.unit=e.unit,2===e.type&&(O.propertyForm.decimals=e.decimals),3!==e.type?(O.propertyForm.min=e.params.min,O.propertyForm.max=e.params.max,O.propertyForm.minMaxAlarm=e.params.minMaxAlarm,O.propertyForm.step=e.params.step,O.propertyForm.stepAlarm=e.params.stepAlarm):(O.propertyForm.dataLength=e.params.dataLength,O.propertyForm.dataLengthAlarm=e.params.dataLengthAlarm)},Ue=h(null),Te=()=>{O.pFlag=!1,Ue.value.resetFields(),Ie()},Re=e=>{Te()},Se=e=>{O.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},Ie=()=>{O.propertyForm={name:"",label:"",accessMode:0,type:0,min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,unit:"",decimals:0,dataLength:"",dataLengthAlarm:!1}},Ne=l=>{e({type:"error",message:l.message})},qe=(l,a)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&a&&a()};return(h,v)=>{const b=a,A=t,T=o,N=r,q=s,Ie=i,Oe=d,He=n,Be=_("Icon"),Ee=p,Je=c,We=m,Ke=u,Qe=f,Xe=g,Ye=y;return F(),x("div",Q,[M("div",X,[M("div",Y,[k(Oe,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:w((()=>[k(T,{style:{"margin-right":"20px","margin-left":"20px"}},{default:w((()=>[k(A,{type:"primary",plain:"",onClick:v[0]||(v[0]=e=>(console.log("toDeviceModel"),void U("changeDpFlag")))},{default:w((()=>[k(b,{class:"el-input__icon"},{default:w((()=>[k(C(B))])),_:1}),G])),_:1})])),_:1}),k(T,null,{default:w((()=>[k(q,{modelValue:C(O).varParamType,"onUpdate:modelValue":v[1]||(v[1]=e=>C(O).varParamType=e),style:{"margin-right":"20px"}},{default:w((()=>[k(N,{label:"Properties",border:""},{default:w((()=>[Z])),_:1})])),_:1},8,["modelValue"]),k(Ie,{direction:"vertical",style:{height:"2em"}})])),_:1}),k(T,null,{default:w((()=>[k(A,{type:"primary",plain:"",class:"right-btn",onClick:v[2]||(v[2]=e=>(console.log("importDPS"),void(O.psFlag=!0)))},{default:w((()=>[k(b,{class:"el-input__icon"},{default:w((()=>[k(C(E))])),_:1}),$])),_:1})])),_:1}),k(T,null,{default:w((()=>[k(A,{type:"primary",plain:"",class:"right-btn",onClick:v[3]||(v[3]=e=>(()=>{console.log("exportDPS");const e={token:S.token,responseType:"blob",data:{name:R.curDeviceModel.name}};H.exportDeviceModelProptyAndService(e).then((e=>{if(e&&"1"===e.code)return void Ne(e);const l=new Blob([e.blob]),a=e.fileName,t=document.createElement("a");t.download=a,t.style.display="none",t.href=URL.createObjectURL(l),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})())},{default:w((()=>[k(b,{class:"el-input__icon"},{default:w((()=>[k(C(J))])),_:1}),ee])),_:1})])),_:1})])),_:1},512)]),"Properties"===C(O).varParamType?(F(),x("div",le,[M("div",ae,[M("div",te,[M("div",oe,L(R.curDeviceModel.label)+"："+L("Properties"===C(O).varParamType?"属性列表":"服务列表"),1)]),k(Oe,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:w((()=>[k(T,{label:""},{default:w((()=>[k(He,{style:{width:"200px"},placeholder:"请输入属性名称",modelValue:C(O).deviceModelProperty,"onUpdate:modelValue":v[4]||(v[4]=e=>C(O).deviceModelProperty=e)},{prefix:w((()=>[k(b,{class:"el-input__icon"},{default:w((()=>[k(C(W))])),_:1})])),_:1},8,["modelValue"])])),_:1}),k(T,null,{default:w((()=>[k(A,{type:"primary",bg:"",class:"right-btn",onClick:v[5]||(v[5]=e=>(()=>{const e={token:S.token,data:{name:R.curDeviceModel.name}};H.syncDeviceModelProperty(e).then((e=>{console.log(e),qe(e,K)}))})())},{default:w((()=>[k(b,{class:"btn-icon"},{default:w((()=>[k(Be,{name:"local-tongbu",size:"14px",color:"#ffffff"})])),_:1}),re])),_:1})])),_:1}),k(T,null,{default:w((()=>[k(A,{type:"primary",bg:"",class:"right-btn",onClick:v[6]||(v[6]=e=>(console.log("addDeviceModelProperty"),O.pFlag=!0,void(O.pTitle="添加属性")))},{default:w((()=>[k(b,{class:"btn-icon"},{default:w((()=>[k(Be,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),se])),_:1})])),_:1}),k(T,null,{default:w((()=>[k(A,{type:"danger",bg:"",class:"right-btn",onClick:v[7]||(v[7]=a=>(a=>{let t=[];0!==O.selectedProperties.length?(O.selectedProperties.forEach((e=>{t.push(e.name)})),console.log("pList",t),l.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:S.token,data:{name:R.curDeviceModel.name,properties:t}};H.deleteDeviceModelProperty(e).then((e=>{qe(e,K)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:w((()=>[k(b,{class:"btn-icon"},{default:w((()=>[k(Be,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),ie])),_:1})])),_:1}),k(T,null,{default:w((()=>[k(A,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:v[8]||(v[8]=e=>{K(1)})},{default:w((()=>[k(b,{class:"btn-icon"},{default:w((()=>[k(Be,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),de])),_:1})])),_:1})])),_:1},512)]),M("div",{class:"content",ref_key:"contentRef",ref:I},[k(Je,{data:C(xe),"cell-style":C(O).cellStyle,"header-cell-style":C(O).headerCellStyle,"max-height":C(O).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:Se,onRowDblclick:Ae},{empty:w((()=>[pe])),default:w((()=>[k(Ee,{type:"selection",width:"55"}),k(Ee,{prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),k(Ee,{prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),k(Ee,{label:"读写属性",width:"auto","min-width":"80",align:"center"},{default:w((e=>[D(L(C(O).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),k(Ee,{label:"属性类型",width:"auto","min-width":"80",align:"center"},{default:w((e=>[D(L(C(O).typeNames["t"+e.row.type]),1)])),_:1}),k(Ee,{label:"小数位数",width:"auto","min-width":"80",align:"center"},{default:w((e=>[D(L(void 0===e.row.decimals||""===e.row.decimals?0:e.row.decimals),1)])),_:1}),k(Ee,{prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),k(Ee,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:w((e=>[k(A,{onClick:l=>Ae(e.row),text:"",type:"primary"},{default:w((()=>[ne])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),M("div",ce,[k(We,{"current-page":C(O).currentPage,"page-size":C(O).pagesize,"page-sizes":[20,50,200,500],total:C(Me).length,onCurrentChange:ke,onSizeChange:we,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):P("",!0),me,k(Xe,{modelValue:C(O).pFlag,"onUpdate:modelValue":v[17]||(v[17]=e=>C(O).pFlag=e),title:C(O).pTitle,width:"600px","before-close":Re,"close-on-click-modal":!1},{footer:w((()=>[M("span",fe,[k(A,{onClick:v[15]||(v[15]=e=>Te())},{default:w((()=>[ge])),_:1}),k(A,{type:"primary",onClick:v[16]||(v[16]=e=>{Ue.value.validate((e=>{if(console.log("valid",e),!e)return!1;{let e={};e.name=O.propertyForm.name,e.label=O.propertyForm.label,e.accessMode=O.propertyForm.accessMode,e.type=O.propertyForm.type,e.unit=O.propertyForm.unit,2===O.propertyForm.type&&(e.decimals=O.propertyForm.decimals);let l={};3!==O.propertyForm.type?(l.min=O.propertyForm.min,l.max=O.propertyForm.max,l.minMaxAlarm=O.propertyForm.minMaxAlarm,l.step=O.propertyForm.step,l.stepAlarm=O.propertyForm.stepAlarm):(l.dataLength=O.propertyForm.dataLength,l.dataLengthAlarm=O.propertyForm.dataLengthAlarm),e.params=l,console.log("submitPorpertyForm -> property",e);const a={token:S.token,data:{name:R.curDeviceModel.name,property:e}};O.pTitle.includes("添加")?(console.log("添加属性"),H.addDeviceModelProperty(a).then((e=>{qe(e,K),Te()}))):(console.log("编辑属性"),H.editDeviceModelProperty(a).then((e=>{qe(e,K),Te()})))}}))})},{default:w((()=>[ye])),_:1})])])),default:w((()=>[M("div",ue,[k(Oe,{model:C(O).propertyForm,rules:C(O).propertyRules,ref_key:"propertyFormRef",ref:Ue,"status-icon":"","label-position":"right","label-width":"120px"},{default:w((()=>[k(T,{label:"属性名称",prop:"name"},{default:w((()=>[k(He,{disabled:C(O).pTitle.includes("编辑"),type:"text",modelValue:C(O).propertyForm.name,"onUpdate:modelValue":v[9]||(v[9]=e=>C(O).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),k(T,{label:"属性标签",prop:"label"},{default:w((()=>[k(He,{type:"text",modelValue:C(O).propertyForm.label,"onUpdate:modelValue":v[10]||(v[10]=e=>C(O).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),k(T,{label:"读写属性",prop:"accessMode"},{default:w((()=>[k(Qe,{modelValue:C(O).propertyForm.accessMode,"onUpdate:modelValue":v[11]||(v[11]=e=>C(O).propertyForm.accessMode=e),style:{width:"100%"},placeholder:"请选择读写属性"},{default:w((()=>[(F(!0),x(V,null,z(C(O).accessModeOptions,(e=>(F(),j(Ke,{key:"accessMode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(T,{label:"属性类型",prop:"type"},{default:w((()=>[k(Qe,{modelValue:C(O).propertyForm.type,"onUpdate:modelValue":v[12]||(v[12]=e=>C(O).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"100%"},placeholder:"请选择属性类型"},{default:w((()=>[(F(!0),x(V,null,z(C(O).typeOptions,(e=>(F(),j(Ke,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),2===C(O).propertyForm.type?(F(),j(T,{key:0,label:"小数位数",prop:"decimals"},{default:w((()=>[k(He,{type:"text",modelValue:C(O).propertyForm.decimals,"onUpdate:modelValue":v[13]||(v[13]=e=>C(O).propertyForm.decimals=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入小数位数"},null,8,["modelValue"])])),_:1})):P("",!0),3!==C(O).propertyForm.type?(F(),j(T,{key:1,label:"单位",prop:"unit"},{default:w((()=>[k(He,{type:"text",modelValue:C(O).propertyForm.unit,"onUpdate:modelValue":v[14]||(v[14]=e=>C(O).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1})):P("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),k(Xe,{modelValue:C(O).psFlag,"onUpdate:modelValue":v[18]||(v[18]=e=>C(O).psFlag=e),title:"导入设备属性",width:"600px","before-close":je,"close-on-click-modal":!1},{footer:w((()=>[M("span",be,[k(A,{onClick:ze},{default:w((()=>[_e])),_:1}),k(A,{type:"primary",onClick:Ce},{default:w((()=>[Fe])),_:1})])])),default:w((()=>[k(Ye,{ref_key:"uploadDPSRef",ref:De,action:"","auto-upload":!1,"http-request":Le,limit:1,"on-exceed":Pe,"before-upload":Ve},{tip:w((()=>[ve])),default:w((()=>[k(A,{type:"primary"},{default:w((()=>[he])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-3718c5ac"]]);var Me=e=>O.request({url:"/tsl/plugin/file",method:"post",data:e}),ke=e=>O.request({url:"/tsl/plugin/file",method:"get",data:e}),we=e=>O.request({url:"/tsl/plugin/param",method:"get",data:e});const Ce=e=>(A("data-v-2584b992"),e=e(),U(),e),Le={class:"main-container"},De={key:0,class:"main"},Pe={class:"search-bar"},Ve=D(" 刷新 "),ze={class:"tool-bar"},je=D(" 添加 "),Ae={class:"param-content"},Ue={class:"pc-title"},Te={class:"pct-info"},Re=D(" 参数详情 "),Se={class:"pc-content"},Ie={class:"param-value"},Ne={class:"param-name"},qe=D("导入插件"),Oe=D("导出插件"),He=D("变量详情"),Be=D("编辑"),Ee=D("删除"),Je=Ce((()=>M("div",null,"无数据",-1))),We={class:"pagination"},Ke={class:"dialog-content"},Qe={class:"dialog-footer"},Xe=D("取消"),Ye=D("保存"),Ge=D("选择文件"),Ze=Ce((()=>M("div",{class:"el-upload__tip"},"只能上传一个文件，只支持zip格式文件，且文件尺寸不大于1MB！",-1))),$e={class:"dialog-footer"},el=D("取消"),ll=D("上传");var al=I({setup(r){const s=N(),i=h(null),u=v({typeModel:0,dpFlag:!0,headerCellStyle:{background:q.primaryColor,color:q.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceModelInfo:"",tableData:[],modelForm:{name:"",label:"",type:0,param:""},modelRules:{name:[{required:!0,message:"采集模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"采集模型标识不能为空",trigger:"blur"}],param:[{required:!0,message:"采集模型插件不能为空",trigger:"blur"}]},udFlag:!1,dmFlag:!1,dmTitle:"添加采集模型",pluginList:[],curDeviceModel:"",paramName:{name:"插件名称",label:"插件标签",version:"插件版本",message:"插件描述",date:"上传日期",author:"插件作者"}}),f=l=>{const a={token:s.token,data:{type:u.typeModel}};H.getDeviceModelList(a).then((async a=>{console.log("getDeviceModelList -> res = ",a),a&&("0"===a.code?(u.tableData=a.data,1===l&&e({type:"success",message:"刷新成功！"})):le(a),await T((()=>{u.tableMaxHeight=i.value.clientHeight-34-36-22})))}))};f();const D=b((()=>u.tableData.filter((e=>{var l=!u.deviceModelInfo,a=e.name.toLowerCase().includes(u.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(u.deviceModelInfo.toLowerCase());return l||a})).slice((u.currentPage-1)*u.pagesize,u.currentPage*u.pagesize))),P=b((()=>u.tableData.filter((e=>{var l=!u.deviceModelInfo,a=e.name.toLowerCase().includes(u.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(u.deviceModelInfo.toLowerCase());return l||a})))),A=e=>{u.currentPage=e},U=e=>{u.pagesize=e},I=e=>{u.dmFlag=!0,u.dmTitle="编辑采集模型",u.modelForm={name:e.name,label:e.label,type:void 0===e.type?0:e.type,param:e.param}},O=h(null),B=()=>{u.dmFlag=!1,O.value.resetFields(),J()},E=()=>{B()},J=()=>{u.modelForm={name:"",label:"",type:0}},K=()=>{X.value&&X.value.submit()},Q=e=>{},X=h(null),Y=e=>{X.value.clearFiles(),console.log("handleExceed -> files",e);const l=e[0];X.value.handleStart(l)},G=l=>{console.log("beforeUpload -> file",l);const a=["application/x-zip-compressed","application/zip"].includes(l.type),t=l.size/1024<=1024;if(a)if(t){if(a&&t){let a=new FormData;a.append("fileName",l),console.log("formData",a.get("file"));const t={token:s.token,contentType:"multipart/form-data",data:a};Me(t).then((a=>{if("0"===a.code){e.success("导入成功！"),X.value.clearFiles();const a=l.name.substring(0,l.name.lastIndexOf("."));ee(a)}else le(a);console.log("importOnePlugin -> res = ",a)}))}}else e({type:"error",message:"文件大小不正确,不能超过1MB！"});else e({type:"error",message:"文件格式不正确,必须是zip文件！"})},Z=()=>{u.udFlag=!1,X.value.clearFiles()},$=()=>{Z()},ee=e=>{const l={token:s.token,data:{name:e}};we(l).then((e=>{if("0"===e.code){u.curDeviceModel.param=e.data;const l={token:s.token,data:u.curDeviceModel};H.editDeviceModel(l).then((e=>{ae(e,f),u.udFlag=!1}))}else le(e)}))},le=l=>{e({type:"error",message:l.message})},ae=(l,a)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&a&&a()};return(r,h)=>{const v=a,b=n,T=o,N=_("Icon"),q=t,J=d,ee=p,te=c,oe=m,re=g,se=y;return F(),x("div",Le,[C(u).dpFlag?(F(),x("div",De,[M("div",Pe,[k(J,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:w((()=>[k(T,{label:"模型名称/标签"},{default:w((()=>[k(b,{style:{width:"200px"},placeholder:"请输入采集模型名称/标签",modelValue:C(u).deviceModelInfo,"onUpdate:modelValue":h[0]||(h[0]=e=>C(u).deviceModelInfo=e)},{prefix:w((()=>[k(v,{class:"el-input__icon"},{default:w((()=>[k(C(W))])),_:1})])),_:1},8,["modelValue"])])),_:1}),k(T,null,{default:w((()=>[k(q,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:h[1]||(h[1]=e=>{f(1)})},{default:w((()=>[k(v,{class:"btn-icon"},{default:w((()=>[k(N,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),Ve])),_:1})])),_:1})])),_:1},512)]),M("div",ze,[k(q,{type:"primary",bg:"",class:"right-btn",onClick:h[2]||(h[2]=e=>(u.dmFlag=!0,void(u.dmTitle="添加采集模型")))},{default:w((()=>[k(v,{class:"btn-icon"},{default:w((()=>[k(N,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),je])),_:1})]),M("div",{class:"content",ref_key:"contentRef",ref:i},[k(te,{data:C(D),"cell-style":C(u).cellStyle,"header-cell-style":C(u).headerCellStyle,"max-height":C(u).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:I},{empty:w((()=>[Je])),default:w((()=>[k(ee,{type:"expand"},{default:w((e=>[M("div",Ae,[M("div",Ue,[M("div",Te,[M("b",null,L(e.row.serviceName),1),Re])]),M("div",Se,[(F(!0),x(V,null,z(e.row.param,((e,l,a)=>(F(),x("div",{class:"param-item",key:a},[M("div",Ie,L(C(u).paramName[l])+"：",1),M("div",Ne,L(e||"-"),1)])))),128))])])])),_:1}),k(ee,{prop:"name",label:"采集模型名称",width:"auto","min-width":"150",align:"center"}),k(ee,{prop:"label",label:"采集模型标签",width:"auto","min-width":"150",align:"center"}),k(ee,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:w((a=>[k(q,{onClick:e=>{return l=a.row,u.udFlag=!0,u.curDeviceModel=l,void(X.value&&X.value.clearFiles());var l},text:"",type:"info"},{default:w((()=>[qe])),_:2},1032,["onClick"]),R(k(q,{onClick:e=>(e=>{const l={token:s.token,responseType:"blob",data:{name:e.param.name}};ke(l).then((e=>{if(console.log("exportOnePlugin -> res",e),e&&"1"===e.code)return void le(e);const l=new Blob([e.blob]),a=e.fileName,t=document.createElement("a");t.download=a,t.style.display="none",t.href=URL.createObjectURL(l),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})(a.row),text:"",type:"info"},{default:w((()=>[Oe])),_:2},1032,["onClick"]),[[S,""!==a.row.param.name]]),k(q,{onClick:e=>{return l=a.row,u.curDeviceModel=l,void(u.dpFlag=!1);var l},text:"",type:"success"},{default:w((()=>[He])),_:2},1032,["onClick"]),k(q,{onClick:e=>I(a.row),text:"",type:"primary"},{default:w((()=>[Be])),_:2},1032,["onClick"]),k(q,{onClick:t=>{return o=a.row,void l.confirm("确定要删除这个采集模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:s.token,data:{name:o.name,type:0}};H.deleteDeviceModel(e).then((e=>{ae(e,f)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var o},text:"",type:"danger"},{default:w((()=>[Ee])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),M("div",We,[k(oe,{"current-page":C(u).currentPage,"page-size":C(u).pagesize,"page-sizes":[20,50,200,500],total:C(P).length,onCurrentChange:A,onSizeChange:U,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):(F(),j(xe,{key:1,curDeviceModel:C(u).curDeviceModel,onChangeDpFlag:h[3]||(h[3]=e=>{u.dpFlag=!0}),style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel"])),k(re,{modelValue:C(u).dmFlag,"onUpdate:modelValue":h[8]||(h[8]=e=>C(u).dmFlag=e),title:C(u).dmTitle,width:"600px","before-close":E,"close-on-click-modal":!1},{footer:w((()=>[M("span",Qe,[k(q,{onClick:h[6]||(h[6]=e=>B())},{default:w((()=>[Xe])),_:1}),k(q,{type:"primary",onClick:h[7]||(h[7]=e=>{O.value.validate((e=>{if(!e)return!1;{u.modelForm.type=u.typeModel;const e={token:s.token,data:u.modelForm};u.dmTitle.includes("添加")?H.addDeviceModel(e).then((e=>{ae(e,f),B()})):H.editDeviceModel(e).then((e=>{ae(e,f),B()}))}}))})},{default:w((()=>[Ye])),_:1})])])),default:w((()=>[M("div",Ke,[k(J,{model:C(u).modelForm,rules:C(u).modelRules,ref_key:"modelFormRef",ref:O,"status-icon":"","label-position":"right","label-width":"120px"},{default:w((()=>[k(T,{label:"采集模型名称",prop:"name"},{default:w((()=>[k(b,{type:"text",disabled:C(u).dmTitle.includes("编辑"),modelValue:C(u).modelForm.name,"onUpdate:modelValue":h[4]||(h[4]=e=>C(u).modelForm.name=e),autocomplete:"off",placeholder:"请输入采集模型名称，必须和插件名称一致！"},null,8,["disabled","modelValue"])])),_:1}),k(T,{label:"采集模型标签",prop:"label"},{default:w((()=>[k(b,{type:"text",modelValue:C(u).modelForm.label,"onUpdate:modelValue":h[5]||(h[5]=e=>C(u).modelForm.label=e),autocomplete:"off",placeholder:"请输入采集模型标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),k(re,{modelValue:C(u).udFlag,"onUpdate:modelValue":h[9]||(h[9]=e=>C(u).udFlag=e),title:"上传物模型插件",width:"600px","before-close":$,"close-on-click-modal":!1},{footer:w((()=>[M("span",$e,[k(q,{onClick:Z},{default:w((()=>[el])),_:1}),k(q,{type:"primary",onClick:K},{default:w((()=>[ll])),_:1})])])),default:w((()=>[k(se,{ref_key:"uploadRef",ref:X,action:"","auto-upload":!1,"http-request":Q,limit:1,"on-exceed":Y,"before-upload":G},{tip:w((()=>[Ze])),default:w((()=>[k(q,{type:"primary"},{default:w((()=>[Ge])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-2584b992"]]);export{al as default};
