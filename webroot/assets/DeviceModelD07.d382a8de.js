import{g as e,e as l,p as t,n as a,o,m as r,A as d,C as s,D as i,L as n,v as c,w as u,q as p,M as m,u as f}from"./element-plus.64650d13.js";import{_ as b,u as g,v as y,s as h}from"./index.98f42e56.js";import{D as v}from"./deviceModel.a85a7758.js";import{I as k,M as _,J as F,L as w}from"./@element-plus.aa3ef65f.js";import{f as M,Y as x,p as C,X,o as D,c as V,a as B,S as L,Q as A,u as S,U as R,a0 as z,at as N,au as I,H as P,h as O,M as U,af as j,P as T,L as q,O as H}from"./@vue.5db09832.js";import"./@vueuse.af8df401.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./vue-router.d969f71f.js";import"./pinia.69c74452.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./vue-echarts.8f00425b.js";import"./resize-detector.4e96b72b.js";import"./echarts.62a08783.js";import"./zrender.56caf4f2.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const E=e=>(N("data-v-0b551bea"),e=e(),I(),e),W={class:"main-container"},Y={class:"main"},G={class:"search-bar"},J=z(" 返回设备模型 "),Q=z(" 导出模型属性 "),$={class:"search-bar",style:{display:"flex"}},K={class:"title",style:{position:"relative","margin-right":"40px","justify-content":"flex-start",padding:"0px 0px",height:"40px"}},Z={class:"tName"},ee=z(" 刷新 "),le=z(" 序号 "),te=E((()=>B("div",null,"无数据",-1))),ae={class:"pagination",style:{"z-index":"9"}};var oe=b({props:{curDeviceModel:{type:Object,default:{}}},emits:["changeShowFlag"],setup(n,{emit:c}){const u=n,p=g();console.log("id -> props",u);const m=M(null),f=x({headerCellStyle:{background:y.primaryColor,color:y.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",rulerId:"",format:"",len:0,accessMode:0,type:0,unit:"",blockAddOffset:0,rulerAddOffset:0},psFlag:!1,selectedProperties:[]}),b=l=>{const t={token:p.token,data:{name:u.curDeviceModel.name}};v.getDeviceModelProperty(t).then((async t=>{console.log("getDeviceModelProperty -> res",t),t&&("0"===t.code?(f.propertyList=t.data,1===l&&e({type:"success",message:"刷新成功！"})):O(t),await P((()=>{f.tableMaxHeight=m.value.clientHeight-34-36-132})))}))};b();const h=C((()=>(console.log("ctxData.propertyList ->",f.propertyList),f.propertyList.filter((e=>{var l=!f.deviceModelProperty,t=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||t})).slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize)))),w=C((()=>f.propertyList.filter((e=>{var l=!f.deviceModelProperty,t=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||t})))),N=e=>{f.currentPage=e},I=e=>{f.pagesize=e},O=l=>{e({type:"error",message:l.message})};return(e,n)=>{const g=l,y=t,M=a,x=o,C=r,P=X("Icon"),U=d,j=s,T=i;return D(),V("div",W,[B("div",Y,[B("div",G,[L(x,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:A((()=>[L(M,{style:{"margin-left":"20px"}},{default:A((()=>[L(y,{type:"primary",plain:"",onClick:n[0]||(n[0]=e=>(console.log("toDeviceModel"),void c("changeShowFlag")))},{default:A((()=>[L(g,{class:"el-input__icon"},{default:A((()=>[L(S(k))])),_:1}),J])),_:1})])),_:1}),L(M,null,{default:A((()=>[L(y,{type:"primary",plain:"",class:"right-btn",onClick:n[1]||(n[1]=e=>(()=>{console.log("exportDPS");const e={token:p.token,responseType:"blob",data:{name:u.curDeviceModel.name}};v.exportDeviceModelProptyAndService(e).then((e=>{if(e&&"1"===e.code)return void O(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:A((()=>[L(g,{class:"el-input__icon"},{default:A((()=>[L(S(_))])),_:1}),Q])),_:1})])),_:1})])),_:1},512)]),B("div",$,[B("div",K,[B("div",Z,R(u.curDeviceModel.label)+"：属性列表",1)]),L(x,{inline:!0,ref:"searchFormRef2","status-icon":"","label-width":"90px"},{default:A((()=>[L(M,{label:""},{default:A((()=>[L(C,{style:{width:"200px"},placeholder:"请输入属性名称",modelValue:S(f).deviceModelProperty,"onUpdate:modelValue":n[2]||(n[2]=e=>S(f).deviceModelProperty=e)},{prefix:A((()=>[L(g,{class:"el-input__icon"},{default:A((()=>[L(S(F))])),_:1})])),_:1},8,["modelValue"])])),_:1}),L(M,null,{default:A((()=>[L(y,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:n[3]||(n[3]=e=>{b(1)})},{default:A((()=>[L(g,{class:"btn-icon"},{default:A((()=>[L(P,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),ee])),_:1})])),_:1})])),_:1},512)]),B("div",{class:"content",ref_key:"contentRef",ref:m},[L(j,{data:S(h),"cell-style":S(f).cellStyle,"header-cell-style":S(f).headerCellStyle,style:{width:"100%"},"max-height":S(f).tableMaxHeight,stripe:""},{empty:A((()=>[te])),default:A((()=>[L(U,{type:"index",width:"60"},{header:A((()=>[le])),_:1}),L(U,{prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),L(U,{prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),L(U,{prop:"rulerId",label:"数据标识",width:"auto","min-width":"150",align:"center"}),L(U,{prop:"format",label:"数据格式",width:"auto","min-width":"150",align:"center"}),L(U,{prop:"len",label:"数据长度",width:"auto","min-width":"150",align:"center"}),L(U,{label:"读写属性",width:"auto","min-width":"80",align:"center"},{default:A((e=>[z(R(S(f).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),L(U,{prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:A((e=>[z(R(S(f).typeNames["t"+e.row.type]),1)])),_:1}),L(U,{prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),L(U,{prop:"blockAddOffset",label:"块偏移地址",width:"auto","min-width":"150",align:"center"}),L(U,{prop:"rulerAddOffset",label:"标识偏移地址",width:"auto","min-width":"150",align:"center"})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),B("div",ae,[L(T,{"current-page":S(f).currentPage,"page-size":S(f).pagesize,"page-sizes":[20,50,200,500],total:S(w).length,onCurrentChange:N,onSizeChange:I,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])])}}},[["__scopeId","data-v-0b551bea"]]);var re=e=>h.request({url:"/tsl/dlt64507/cmd",method:"get",data:e}),de=e=>h.request({url:"/tsl/dlt64507/cmd",method:"post",data:e}),se=e=>h.request({url:"/tsl/dlt64507/cmd",method:"put",data:e}),ie=e=>h.request({url:"/tsl/dlt64507/cmd",method:"delete",data:e}),ne=e=>h.request({url:"/tsl/dlt64507/block/xlsx",method:"post",data:e}),ce=e=>h.request({url:"/tsl/dlt64507/block/xlsx",method:"get",data:e}),ue=e=>h.request({url:"/tsl/dlt64507/cmd/params",method:"get",data:e}),pe=e=>h.request({url:"/tsl/dlt64507/cmd/param",method:"post",data:e}),me=e=>h.request({url:"/tsl/dlt64507/cmd/param",method:"put",data:e}),fe=e=>h.request({url:"/tsl/dlt64507/cmd/params",method:"delete",data:e}),be=e=>h.request({url:"/tsl/dlt64507/cmd/param/xlsx",method:"post",data:e}),ge=e=>h.request({url:"/tsl/dlt64507/cmd/param/xlsx",method:"get",data:e});const ye=e=>(N("data-v-55c5c510"),e=e(),I(),e),he={class:"main-container"},ve={style:{display:"flex","justify-content":"space-between"}},ke={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},_e={class:"tName"},Fe={class:"search-bar",style:{"text-align":"right"}},we=z(" 导入命令参数 "),Me=z(" 导出命令参数 "),xe=z(" 添加 "),Ce=z(" 刷新 "),Xe=z(" 删除 "),De=z("编辑"),Ve=ye((()=>B("div",null,"无数据",-1))),Be={class:"pagination"},Le={class:"dialog-content"},Ae=ye((()=>B("div",{class:"form-title"},[B("div",{class:"tName"},"配置参数")],-1))),Se={class:"dialog-footer"},Re=z("取消"),ze=z("保存"),Ne={class:"dialog-content"},Ie={style:{width:"100%"}},Pe={style:{"padding-right":"10px"}},Oe={class:"dialog-footer"},Ue=z("取消"),je=z("保存"),Te=z("选择文件"),qe=ye((()=>B("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),He={class:"dialog-footer"},Ee=z("取消"),We=z("上传");var Ye=b({props:{curModelBlock:{type:Object,default:{}}},emits:["changeBShowFlag"],setup(f,{emit:b}){const h=f,v=g(),k=M(null),N=x({formulaForm:{},headerCellStyle:{background:y.primaryColor,color:y.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",accessModeOptions:[{label:"只读",value:0},{label:"只写",value:1},{label:"读写",value:2}],typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},formatOptions:[{label:"X.XXX",value:"X.XXX"},{label:"XX",value:"XX"},{label:"XX.XX",value:"XX.XX"},{label:"XX.XXXX",value:"XX.XXXX"},{label:"XXX.X",value:"XXX.X"},{label:"XXX.XXX",value:"XXX.XXX"},{label:"XXXXXX",value:"XXXXXX"},{label:"XXXXXX.XX",value:"XXXXXX.XX"},{label:"XXXXXXXX",value:"XXXXXXXX"},{label:"XXXXXXXXXXXX",value:"XXXXXXXXXXXX"},{label:"DDhh",value:"DDhh"},{label:"MMDDNN",value:"MMDDNN"},{label:"hhmmNN",value:"hhmmNN"},{label:"YYMMDDWW",value:"YYMMDDWW"},{label:"YYMMDDhhmm",value:"YYMMDDhhmm"},{label:"YYMMDDhhmmss",value:"YYMMDDhhmmss"},{label:"C0C1C2C3",value:"C0C1C2C3"}],lenOptions:[{label:1,value:1},{label:2,value:2},{label:3,value:3},{label:4,value:4},{label:5,value:5},{label:6,value:6}],pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,unit:"",rulerId:"",len:0,blockAddOffset:0,rulerAddOffset:0},ruleTypeOptions:{rt1:[{label:"Int_AB",value:"Int_AB"},{label:"Int_BA",value:"Int_BA"}],rt2:[{label:"Long_ABCD",value:"Long_ABCD"},{label:"Long_BADC",value:"Long_BADC"},{label:"Long_DCBA",value:"Long_DCBA"},{label:"Long_CDAB",value:"Long_CDAB"},{label:"Float_ABCD",value:"Float_ABCD"},{label:"Float_BADC",value:"Float_BADC"},{label:"Float_DCBA",value:"Float_DCBA"},{label:"Float_CDAB",value:"Float_CDAB"}],rt4:[{label:"Double_ABCDEFGH",value:"Double_ABCDEFGH"},{label:"Double_GHEFCDAB",value:"Double_GHEFCDAB"},{label:"Double_BADCFEHG",value:"Double_BADCFEHG"},{label:"Double_HGFEDCBA",value:"Double_HGFEDCBA"}]},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",decimals:"小数位数",regCnt:"寄存器数量",ruleType:"解析规则",regAddr:"寄存器地址",formula:"计算公式"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],accessMode:[{required:!0,message:"读写属性不能为空",trigger:"blur"}],type:[{required:!0,message:"属性类型不能为空",trigger:"blur"}],rulerId:[{required:!0,message:"标识数据长度不能为空",trigger:"blur"}],len:[{required:!0,type:"number",message:"数据长度只能输入数字",trigger:"blur"}],blockAddOffset:[{required:!0,type:"number",message:"块数据偏移地址只能输入数字",trigger:"blur"}],rulerAddOffset:[{required:!0,type:"number",message:"标识数据地址只能输入数字",trigger:"blur"}]},psFlag:!1,selectedProperties:[],fFlag:!1,propertyInfo:[],operationList:[{name:"+",label:"+",describe:"加"},{name:"-",label:"-",describe:"减"},{name:"*",label:"*",describe:"乘"},{name:"/",label:"/",describe:"除"},{name:"%",label:"%",describe:"模"},{name:"^",label:"^",describe:"次幂"},{name:"(",label:"(",describe:"左括号"},{name:")",label:")",describe:"右括号"}],curFormula:"",selectionStart:0,pItem:""}),I=l=>{const t={token:v.token,data:{tslName:h.curModelBlock.tslName,cmdName:h.curModelBlock.name}};ue(t).then((async t=>{t&&("0"===t.code?(N.propertyList=null==t.data?[]:t.data,1===l&&e({type:"success",message:"刷新成功！"})):ie(t),await P((()=>{N.tableMaxHeight=k.value.clientHeight-34-22-82})))}))};I();const H=C((()=>N.propertyList.filter((e=>{var l=!N.deviceModelProperty,t=e.name.toLowerCase().includes(N.deviceModelProperty.toLowerCase());return l||t})).slice((N.currentPage-1)*N.pagesize,N.currentPage*N.pagesize))),E=C((()=>N.propertyList.filter((e=>{var l=!N.deviceModelProperty,t=e.name.toLowerCase().includes(N.deviceModelProperty.toLowerCase());return l||t})))),W=e=>{N.currentPage=e},Y=e=>{N.pagesize=e},G=()=>{Q.value&&Q.value.submit()},J=e=>{},Q=M(null),$=e=>{Q.value.clearFiles();const l=e[0];Q.value.handleStart(l)},K=l=>{let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("tslName",h.curModelBlock.tslName),t.append("cmdName",h.curModelBlock.name),t.append("fileName",l);const a={token:v.token,contentType:"multipart/form-data",data:t};be(a).then((l=>{"0"===l.code?(e.success(l.message),N.psFlag=!1,I()):ie(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},Z=()=>{N.psFlag=!1,uploadRef.value.clearFiles()},ee=()=>{Z()},le=e=>{N.pFlag=!0,N.pTitle="编辑属性",N.propertyForm.name=e.name,N.propertyForm.label=e.label,N.propertyForm.rulerId=e.rulerId,N.propertyForm.format=e.format,N.propertyForm.len=e.len,N.propertyForm.unit=e.unit,N.propertyForm.accessMode=e.accessMode,N.propertyForm.type=e.type,N.propertyForm.blockAddOffset=e.blockAddOffset,N.propertyForm.rulerAddOffset=e.rulerAddOffset},te=M(null),ae=()=>{N.pFlag=!1,te.value.resetFields(),de()},oe=e=>{ae()},re=e=>{N.selectedProperties=e},de=()=>{N.propertyForm={name:"",label:"",accessMode:0,type:0,unit:"",len:0,rulerId:"",blockAddOffset:0,rulerAddOffset:0}},se=e=>{N.selectionStart=e.srcElement.selectionStart},ie=l=>{e({type:"error",message:l.message})},ne=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return O((()=>h.curModelBlock),((e,l)=>{I()})),(f,b)=>{const g=l,y=r,M=a,x=t,C=X("Icon"),P=o,O=d,de=s,ce=i,ue=c,be=u,ye=p,Ye=m;return D(),V("div",he,[B("div",ve,[B("div",ke,[B("div",_e,R(h.curModelBlock.label)+"：命令参数列表",1)]),B("div",Fe,[L(P,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:A((()=>[L(M,{style:{"margin-left":"20px"}},{default:A((()=>[L(y,{style:{width:"200px"},placeholder:"请输入命令参数名称",modelValue:S(N).deviceModelProperty,"onUpdate:modelValue":b[0]||(b[0]=e=>S(N).deviceModelProperty=e)},{prefix:A((()=>[L(g,{class:"el-input__icon"},{default:A((()=>[L(S(F))])),_:1})])),_:1},8,["modelValue"])])),_:1}),L(M,null,{default:A((()=>[L(x,{type:"primary",plain:"",class:"right-btn",onClick:b[1]||(b[1]=e=>{N.psFlag=!0})},{default:A((()=>[L(g,{class:"el-input__icon"},{default:A((()=>[L(S(w))])),_:1}),we])),_:1})])),_:1}),L(M,null,{default:A((()=>[L(x,{type:"primary",plain:"",class:"right-btn",onClick:b[2]||(b[2]=e=>(()=>{const e={token:v.token,responseType:"blob",data:{tslName:h.curModelBlock.tslName,cmdName:h.curModelBlock.name}};ge(e).then((e=>{if(e&&"1"===e.code)return void ie(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:A((()=>[L(g,{class:"el-input__icon"},{default:A((()=>[L(S(_))])),_:1}),Me])),_:1})])),_:1}),L(M,null,{default:A((()=>[L(x,{type:"primary",bg:"",class:"right-btn",onClick:b[3]||(b[3]=e=>(N.pFlag=!0,void(N.pTitle="添加属性")))},{default:A((()=>[L(g,{class:"btn-icon"},{default:A((()=>[L(C,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),xe])),_:1})])),_:1}),L(M,null,{default:A((()=>[L(x,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:b[4]||(b[4]=e=>{I(1)})},{default:A((()=>[L(g,{class:"btn-icon"},{default:A((()=>[L(C,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),Ce])),_:1})])),_:1}),L(M,null,{default:A((()=>[L(x,{type:"danger",bg:"",class:"right-btn",onClick:b[5]||(b[5]=l=>(l=>{let t=[];0!==N.selectedProperties.length?(N.selectedProperties.forEach((e=>{t.push(e.name)})),n.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:v.token,data:{tslName:h.curModelBlock.tslName,cmdName:h.curModelBlock.name,propertyNames:t}};fe(e).then((e=>{ne(e,I)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:A((()=>[L(g,{class:"btn-icon"},{default:A((()=>[L(C,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),Xe])),_:1})])),_:1})])),_:1},512)])]),B("div",{class:"content",ref_key:"contentRef",ref:k},[L(de,{data:S(H),"cell-style":S(N).cellStyle,"header-cell-style":S(N).headerCellStyle,style:{width:"100%"},"max-height":S(N).tableMaxHeight,stripe:"",onSelectionChange:re,onRowDblclick:le},{empty:A((()=>[Ve])),default:A((()=>[L(O,{type:"selection",width:"55"}),L(O,{prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),L(O,{prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),L(O,{prop:"rulerId",label:"数据标识",width:"auto","min-width":"150",align:"center"}),L(O,{prop:"format",label:"数据格式",width:"auto","min-width":"150",align:"center"}),L(O,{prop:"len",label:"数据长度",width:"auto","min-width":"150",align:"center"}),L(O,{label:"读写属性",width:"auto","min-width":"80",align:"center"},{default:A((e=>[z(R(S(N).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),L(O,{prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:A((e=>[z(R(S(N).typeNames["t"+e.row.type]),1)])),_:1}),L(O,{prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),L(O,{prop:"blockAddOffset",label:"块偏移地址",width:"auto","min-width":"150",align:"center"}),L(O,{prop:"rulerAddOffset",label:"标识偏移地址",width:"auto","min-width":"150",align:"center"}),L(O,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:A((e=>[L(x,{onClick:l=>le(e.row),text:"",type:"primary"},{default:A((()=>[De])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),B("div",Be,[L(ce,{"current-page":S(N).currentPage,"page-size":S(N).pagesize,"page-sizes":[20,50,200,500],total:S(E).length,onCurrentChange:W,onSizeChange:Y,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),L(ye,{modelValue:S(N).pFlag,"onUpdate:modelValue":b[20]||(b[20]=e=>S(N).pFlag=e),title:S(N).pTitle,width:"800px","before-close":oe,"close-on-click-modal":!1},{footer:A((()=>[B("span",Se,[L(x,{onClick:b[18]||(b[18]=e=>ae())},{default:A((()=>[Re])),_:1}),L(x,{type:"primary",onClick:b[19]||(b[19]=e=>{te.value.validate((e=>{if(!e)return!1;{const e={token:v.token,data:{tslName:h.curModelBlock.tslName,cmdName:h.curModelBlock.name,name:N.propertyForm.name,label:N.propertyForm.label,rulerId:N.propertyForm.rulerId,format:N.propertyForm.format,len:N.propertyForm.len,unit:N.propertyForm.unit,accessMode:N.propertyForm.accessMode,type:N.propertyForm.type,blockAddOffset:N.propertyForm.blockAddOffset,rulerAddOffset:N.propertyForm.rulerAddOffset}};N.pTitle.includes("添加")?pe(e).then((e=>{ne(e,I),ae()})):me(e).then((e=>{ne(e,I),ae()}))}}))})},{default:A((()=>[ze])),_:1})])])),default:A((()=>[B("div",Le,[L(P,{model:S(N).propertyForm,rules:S(N).propertyRules,ref_key:"propertyFormRef",ref:te,"status-icon":"","label-position":"right","label-width":"120px",inline:!0},{default:A((()=>[L(M,{label:"属性名称",prop:"name"},{default:A((()=>[L(y,{style:{width:"220px"},disabled:S(N).pTitle.includes("编辑"),type:"text",modelValue:S(N).propertyForm.name,"onUpdate:modelValue":b[6]||(b[6]=e=>S(N).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),L(M,{label:"属性标签",prop:"label"},{default:A((()=>[L(y,{style:{width:"220px"},type:"text",modelValue:S(N).propertyForm.label,"onUpdate:modelValue":b[7]||(b[7]=e=>S(N).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),L(M,{label:"读写属性",prop:"accessMode"},{default:A((()=>[L(be,{modelValue:S(N).propertyForm.accessMode,"onUpdate:modelValue":b[8]||(b[8]=e=>S(N).propertyForm.accessMode=e),style:{width:"220px"},placeholder:"请选择读写属性"},{default:A((()=>[(D(!0),V(U,null,j(S(N).accessModeOptions,(e=>(D(),T(ue,{key:"accessMode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),L(M,{label:"单位",prop:"unit"},{default:A((()=>[L(y,{style:{width:"220px"},type:"text",modelValue:S(N).propertyForm.unit,"onUpdate:modelValue":b[9]||(b[9]=e=>S(N).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1}),L(M,{label:"属性类型",prop:"type"},{default:A((()=>[L(be,{modelValue:S(N).propertyForm.type,"onUpdate:modelValue":b[10]||(b[10]=e=>S(N).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择属性类型"},{default:A((()=>[(D(!0),V(U,null,j(S(N).typeOptions,(e=>(D(),T(ue,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),1!=h.curModelBlock.format?(D(),T(M,{key:0,label:"",prop:"",style:{width:"220px"}})):q("",!0),L(M,{label:"数据格式",prop:"len"},{default:A((()=>[1==h.curModelBlock.format?(D(),T(y,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:S(N).propertyForm.format,"onUpdate:modelValue":b[11]||(b[11]=e=>S(N).propertyForm.format=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据格式"},null,8,["modelValue"])):(D(),T(be,{key:1,modelValue:S(N).propertyForm.format,"onUpdate:modelValue":b[12]||(b[12]=e=>S(N).propertyForm.format=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择数据格式"},{default:A((()=>[(D(!0),V(U,null,j(S(N).formatOptions,(e=>(D(),T(ue,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),1!=h.curModelBlock.len?(D(),T(M,{key:1,label:"",prop:"",style:{width:"220px"}})):q("",!0),L(M,{label:"数据长度",prop:"len"},{default:A((()=>[1==h.curModelBlock.len?(D(),T(y,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:S(N).propertyForm.len,"onUpdate:modelValue":b[13]||(b[13]=e=>S(N).propertyForm.len=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据长度"},null,8,["modelValue"])):(D(),T(be,{key:1,modelValue:S(N).propertyForm.len,"onUpdate:modelValue":b[14]||(b[14]=e=>S(N).propertyForm.len=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择数据长度"},{default:A((()=>[(D(!0),V(U,null,j(S(N).lenOptions,(e=>(D(),T(ue,{key:"regCount_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),Ae,L(M,{label:"数据标识",prop:"rulerId"},{default:A((()=>[L(y,{type:"text",style:{width:"220px"},modelValue:S(N).propertyForm.rulerId,"onUpdate:modelValue":b[15]||(b[15]=e=>S(N).propertyForm.rulerId=e),autocomplete:"off",placeholder:"请输入数据标识"},null,8,["modelValue"])])),_:1}),1!=h.curModelBlock.blockAddOffset?(D(),T(M,{key:2,label:"",prop:"",style:{width:"220px"}})):q("",!0),L(M,{label:"块偏移地址",prop:"blockAddOffset"},{default:A((()=>[L(y,{type:"text",style:{width:"220px"},modelValue:S(N).propertyForm.blockAddOffset,"onUpdate:modelValue":b[16]||(b[16]=e=>S(N).propertyForm.blockAddOffset=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据块偏移地址"},null,8,["modelValue"])])),_:1}),L(M,{label:"标识偏移地址",prop:"rulerAddOffset"},{default:A((()=>[L(y,{type:"text",style:{width:"220px"},modelValue:S(N).propertyForm.rulerAddOffset,"onUpdate:modelValue":b[17]||(b[17]=e=>S(N).propertyForm.rulerAddOffset=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入标识偏移地址"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),L(ye,{modelValue:S(N).fFlag,"onUpdate:modelValue":b[26]||(b[26]=e=>S(N).fFlag=e),title:"编辑计算公式",width:"600px"},{footer:A((()=>[B("span",Oe,[L(x,{onClick:b[24]||(b[24]=e=>(N.fFlag=!1,void(N.curFormula="")))},{default:A((()=>[Ue])),_:1}),L(x,{type:"primary",onClick:b[25]||(b[25]=e=>(N.fFlag=!1,void(N.propertyForm.formula=N.curFormula)))},{default:A((()=>[je])),_:1})])])),default:A((()=>[B("div",Ne,[L(P,{model:S(N).formulaForm,"label-position":"right","label-width":"120px"},{default:A((()=>[L(M,{label:"运算符号"},{default:A((()=>[B("div",Ie,[(D(!0),V(U,null,j(S(N).operationList,((e,l)=>(D(),V("div",{class:"operation",key:l},[B("div",Pe,[L(x,{style:{width:"100%"},onClick:l=>(e=>{let l=N.curFormula.length;if(l!==N.selectionStart){let t=N.curFormula.substr(0,N.selectionStart),a=N.curFormula.substr(N.selectionStart,l-N.selectionStart);N.curFormula=t+e.name+a,N.selectionStart+=e.name.length}else N.curFormula+=e.name,N.selectionStart+=e.name.length})(e)},{default:A((()=>[z(R(e.label),1)])),_:2},1032,["onClick"])])])))),128))])])),_:1}),L(M,{label:"设备属性"},{default:A((()=>[L(be,{modelValue:S(N).pItem,"onUpdate:modelValue":b[21]||(b[21]=e=>S(N).pItem=e),filterable:"",placeholder:"请选择设备属性",onChange:b[22]||(b[22]=e=>(e=>{let l=N.curFormula.length;if(l!==N.selectionStart){let t=N.curFormula.substr(0,N.selectionStart),a=N.curFormula.substr(N.selectionStart,l-N.selectionStart);N.curFormula=t+"("+e+")"+a,N.selectionStart+=e.length+2}else N.curFormula+="("+e+")",N.selectionStart+=e.length+2})(S(N).pItem)),style:{width:"100%"}},{default:A((()=>[(D(!0),V(U,null,j(S(N).propertyInfo,(e=>(D(),T(ue,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),L(M,{label:"当前公式"},{default:A((()=>[L(y,{type:"text",clearable:"",modelValue:S(N).curFormula,"onUpdate:modelValue":b[23]||(b[23]=e=>S(N).curFormula=e),autocomplete:"off",placeholder:"请编辑计算公式",onBlur:se},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),L(ye,{modelValue:S(N).psFlag,"onUpdate:modelValue":b[27]||(b[27]=e=>S(N).psFlag=e),title:"导入命令参数",width:"600px","before-close":ee,"close-on-click-modal":!1},{footer:A((()=>[B("span",He,[L(x,{onClick:Z},{default:A((()=>[Ee])),_:1}),L(x,{type:"primary",onClick:G},{default:A((()=>[We])),_:1})])])),default:A((()=>[L(Ye,{ref_key:"uploadDPSRef",ref:Q,action:"","auto-upload":!1,"http-request":J,limit:1,"on-exceed":$,"before-upload":K},{tip:A((()=>[qe])),default:A((()=>[L(x,{type:"primary"},{default:A((()=>[Te])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-55c5c510"]]);const Ge=e=>(N("data-v-6fdf46ce"),e=e(),I(),e),Je={class:"main-container"},Qe={class:"main"},$e={class:"mc-left"},Ke={class:"title"},Ze=z(" 返回设备模型 "),el={class:"mcl-content"},ll={class:"mclc-content"},tl={class:"mc-right"},al={class:"mcr-top"},ol={style:{display:"flex","justify-content":"space-between"}},rl={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},dl={class:"tName"},sl={class:"search-bar",style:{"text-align":"right"}},il=z(" 导入命令 "),nl=z(" 导出命令 "),cl=z(" 添加 "),ul=z(" 刷新 "),pl=z(" 删除 "),ml=z("编辑"),fl=z("命令参数详情"),bl=Ge((()=>B("div",null,"无数据",-1))),gl={class:"pagination"},yl={key:0,class:"mcr-bottom"},hl={class:"dialog-content"},vl={class:"dialog-footer"},kl=z("取消"),_l=z("保存"),Fl=z("选择文件"),wl=Ge((()=>B("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),Ml={class:"dialog-footer"},xl=z("取消"),Cl=z("上传");var Xl=b({props:{curDeviceModel:{type:Object,default:{}},deviceModelList:{type:Array,default:[]}},emits:["changeShowFlag"],setup(b,{emit:h}){const v=b,N=g();console.log("id -> props",v);const I=/^[0-9]*[1-9][0-9]*$/,O=M(null),E=x({curDeviceModel:v.curDeviceModel,headerCellStyle:{background:y.primaryColor,color:y.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelBlock:"",BlockReadSw:[{label:"开",value:1},{label:"关",value:0}],SWNames:{SW0:"关",SW1:"开"},typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],funCodeOptions:[{label:"01(读线圈状态)",value:1},{label:"02(读离散输入状态)",value:2},{label:"03(读保持寄存器)",value:3},{label:"04(读输入寄存器)",value:4},{label:"05(写单个线圈)",value:5},{label:"06(写单个保持寄存器)",value:6},{label:"15(写多个线圈)",value:15},{label:"16(写多个保持寄存器)",value:16}],funCodeNames:{f1:"01(读线圈状态)",f2:"02(读离散输入状态)",f3:"03(读保持寄存器)",f4:"04(读输入寄存器)",f5:"05(写单个线圈)",f6:"06(写单个保持寄存器)",f15:"15(写多个线圈)",f16:"16(写多个保持寄存器)"},dataTypeOptions:[{label:"uint8",value:0},{label:"int8",value:1},{label:"uint16",value:2},{label:"int16",value:3},{label:"uint32",value:4},{label:"int32",value:5},{label:"float",value:6},{label:"double",value:7}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},dataTypeNames:{dt0:"uint8",dt1:"int8",dt2:"uint16",dt3:"int16",dt4:"uint32",dt5:"int32",dt6:"float",dt7:"double"},pFlag:!1,pTitle:"添加属性",blockForm:{name:"",label:"",blockRulerId:"",blockRead:0},paramName:{name:"块名称",label:"块标签",funCode:"功能码",type:"属性类型",startRegAddr:"寄存器地址",regCnt:"寄存器数量"},propertyRules:{name:[{required:!0,message:"块名称不能为空",trigger:"blur"}],label:[{required:!0,message:"块标签不能为空",trigger:"blur"}],funCode:[{required:!0,message:"功能码不能为空",trigger:"blur"}],startRegAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{0===l||I.test(l)?t():t(new Error("只能输入自然数！"))}}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{I.test(l)?t():t(new Error("只能输入正整数数字！"))}}]},psFlag:!1,selectedProperties:[],curModelBlock:{},porpFlag:!1}),W=l=>{const t={token:N.token,data:{tslName:E.curDeviceModel.name}};re(t).then((async t=>{t&&("0"===t.code?(E.propertyList=t.data,E.propertyList.length>0?(E.curModelBlock=E.propertyList[0],E.curModelBlock.tslName=E.curDeviceModel.name,console.log("getDeviceModelBlock -> ctxData.curModelBlock",E.curModelBlock),E.porpFlag=!0):E.porpFlag=!1,1===l&&e({type:"success",message:"刷新成功！"})):ye(t),await P((()=>{E.tableMaxHeight=O.value.clientHeight-34-22-82,2===l&&ge(E.curModelBlock)})))}))};W(2);const Y=C((()=>(console.log("ctxData.propertyList ->",E.propertyList),E.propertyList.filter((e=>{var l=!E.deviceModelBlock,t=e.name.toLowerCase().includes(E.deviceModelBlock.toLowerCase());return l||t})).slice((E.currentPage-1)*E.pagesize,E.currentPage*E.pagesize)))),G=C((()=>E.propertyList.filter((e=>{var l=!E.deviceModelBlock,t=e.name.toLowerCase().includes(E.deviceModelBlock.toLowerCase());return l||t})))),J=e=>{E.currentPage=e},Q=e=>{E.pagesize=e},$=()=>{Z.value&&Z.value.submit()},K=e=>{},Z=M(null),ee=e=>{Z.value.clearFiles();const l=e[0];Z.value.handleStart(l)},le=l=>{console.log("beforeUpload -> file",l);let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("name",E.curDeviceModel.name),t.append("fileName",l);const a={token:N.token,contentType:"multipart/form-data",data:t};ne(a).then((l=>{"0"===l.code?(e.success(l.message),E.psFlag=!1,W()):ye(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},te=()=>{E.psFlag=!1,uploadRef.value.clearFiles()},ae=()=>{te()},oe=e=>{E.pFlag=!0,E.pTitle="编辑属性",E.blockForm.name=e.name,E.blockForm.label=e.label,E.blockForm.blockRulerId=e.blockRulerId,E.blockForm.blockRead=e.blockRead},ue=M(null),pe=()=>{E.pFlag=!1,ue.value.resetFields(),be()},me=e=>{pe()},fe=e=>{E.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},be=()=>{E.blockForm={name:"",label:"",blockRulerId:"",blockRead:0}},ge=e=>{E.curModelBlock=e,E.curModelBlock.tslName=E.curDeviceModel.name},ye=l=>{e({type:"error",message:l.message})},he=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(b,g)=>{const y=l,M=t,x=f,C=r,I=a,P=X("Icon"),re=o,ne=d,be=s,ve=i,ke=c,_e=u,Fe=p,we=m;return D(),V("div",Je,[B("div",Qe,[B("div",$e,[B("div",Ke,[L(M,{type:"primary",style:{width:"100%"},plain:"",onClick:g[0]||(g[0]=e=>{h("changeShowFlag")})},{default:A((()=>[L(y,{class:"el-input__icon"},{default:A((()=>[L(S(k))])),_:1}),Ze])),_:1})]),B("div",el,[(D(!0),V(U,null,j(v.deviceModelList,((e,l)=>(D(),T(x,{key:"i"+l,shadow:"hover",class:H({"mclc-card":!0,activeModel:e.name==S(E).curDeviceModel.name}),onClick:l=>(e=>{E.curDeviceModel.name!=e.name&&(E.curDeviceModel=e,W())})(e)},{default:A((()=>[B("div",ll,[B("span",null,R(e.name),1)])])),_:2},1032,["class","onClick"])))),128))])]),B("div",tl,[B("div",al,[B("div",ol,[B("div",rl,[B("div",dl,R(S(E).curDeviceModel.label)+"：命令列表",1)]),B("div",sl,[L(re,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:A((()=>[L(I,{style:{"margin-left":"20px"}},{default:A((()=>[L(C,{style:{width:"200px"},placeholder:"请输入命令名称",modelValue:S(E).deviceModelBlock,"onUpdate:modelValue":g[1]||(g[1]=e=>S(E).deviceModelBlock=e)},{prefix:A((()=>[L(y,{class:"el-input__icon"},{default:A((()=>[L(S(F))])),_:1})])),_:1},8,["modelValue"])])),_:1}),L(I,null,{default:A((()=>[L(M,{type:"primary",plain:"",class:"right-btn",onClick:g[2]||(g[2]=e=>(console.log("importDPS"),void(E.psFlag=!0)))},{default:A((()=>[L(y,{class:"el-input__icon"},{default:A((()=>[L(S(w))])),_:1}),il])),_:1})])),_:1}),L(I,null,{default:A((()=>[L(M,{type:"primary",plain:"",class:"right-btn",onClick:g[3]||(g[3]=e=>(()=>{console.log("exportDPS");const e={token:N.token,responseType:"blob",data:{name:E.curDeviceModel.name}};ce(e).then((e=>{if(e&&"1"===e.code)return void ye(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:A((()=>[L(y,{class:"el-input__icon"},{default:A((()=>[L(S(_))])),_:1}),nl])),_:1})])),_:1}),L(I,null,{default:A((()=>[L(M,{type:"primary",bg:"",class:"right-btn",onClick:g[4]||(g[4]=e=>(console.log("addDeviceModelBlock"),E.pFlag=!0,void(E.pTitle="添加属性")))},{default:A((()=>[L(y,{class:"btn-icon"},{default:A((()=>[L(P,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),cl])),_:1})])),_:1}),L(I,null,{default:A((()=>[L(M,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:g[5]||(g[5]=e=>{W(1)})},{default:A((()=>[L(y,{class:"btn-icon"},{default:A((()=>[L(P,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),ul])),_:1})])),_:1}),L(I,null,{default:A((()=>[L(M,{type:"danger",bg:"",class:"right-btn",onClick:g[6]||(g[6]=l=>(l=>{let t=[];0!==E.selectedProperties.length?(E.selectedProperties.forEach((e=>{t.push(e.name)})),console.log("pList",t),n.confirm("确认要删除这些命令吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:N.token,data:{tslName:E.curDeviceModel.name,names:t}};ie(e).then((e=>{he(e,W)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个命令！")})())},{default:A((()=>[L(y,{class:"btn-icon"},{default:A((()=>[L(P,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),pl])),_:1})])),_:1})])),_:1},512)])]),B("div",{class:"content",ref_key:"contentRef",ref:O},[L(be,{data:S(Y),"cell-style":S(E).cellStyle,"header-cell-style":S(E).headerCellStyle,style:{width:"100%"},"max-height":S(E).tableMaxHeight,stripe:"",onSelectionChange:fe,onRowDblclick:oe},{empty:A((()=>[bl])),default:A((()=>[L(ne,{type:"selection",width:"55"}),L(ne,{prop:"name",label:"命令名称",width:"auto","min-width":"150",align:"center"}),L(ne,{prop:"label",label:"命令标签",width:"auto","min-width":"150",align:"center"}),L(ne,{prop:"blockRulerId",label:"块数据标识",width:"auto","min-width":"120",align:"center"}),L(ne,{label:"块读取开关",width:"auto","min-width":"100",align:"center"},{default:A((e=>[z(R(S(E).SWNames["SW"+e.row.blockRead]),1)])),_:1}),L(ne,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:A((e=>[L(M,{onClick:l=>oe(e.row),text:"",type:"primary"},{default:A((()=>[ml])),_:2},1032,["onClick"]),L(M,{onClick:l=>ge(e.row),text:"",type:"success"},{default:A((()=>[fl])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),B("div",gl,[L(ve,{"current-page":S(E).currentPage,"page-size":S(E).pagesize,"page-sizes":[20,50,200,500],total:S(G).length,onCurrentChange:J,onSizeChange:Q,background:"",layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])],512)]),S(E).porpFlag?(D(),V("div",yl,[L(Ye,{curModelBlock:S(E).curModelBlock},null,8,["curModelBlock"])])):q("",!0)]),L(Fe,{modelValue:S(E).pFlag,"onUpdate:modelValue":g[13]||(g[13]=e=>S(E).pFlag=e),title:S(E).pTitle,width:"600px","before-close":me,"close-on-click-modal":!1},{footer:A((()=>[B("span",vl,[L(M,{onClick:g[11]||(g[11]=e=>pe())},{default:A((()=>[kl])),_:1}),L(M,{type:"primary",onClick:g[12]||(g[12]=e=>{ue.value.validate((e=>{if(!e)return!1;{const e={token:N.token,data:{tslName:E.curDeviceModel.name,name:E.blockForm.name,label:E.blockForm.label,blockRulerId:E.blockForm.blockRulerId,blockRead:E.blockForm.blockRead}};E.pTitle.includes("添加")?de(e).then((e=>{he(e,W),pe()})):se(e).then((l=>{console.log("----GWAI----"),console.log(e),he(l,W),pe()}))}}))})},{default:A((()=>[_l])),_:1})])])),default:A((()=>[B("div",hl,[L(re,{model:S(E).blockForm,rules:S(E).propertyRules,ref_key:"blockFormRef",ref:ue,"status-icon":"","label-position":"right","label-width":"120px"},{default:A((()=>[L(I,{label:"块名称",prop:"name"},{default:A((()=>[L(C,{disabled:S(E).pTitle.includes("编辑"),type:"text",modelValue:S(E).blockForm.name,"onUpdate:modelValue":g[7]||(g[7]=e=>S(E).blockForm.name=e),autocomplete:"off",placeholder:"请输入块名称"},null,8,["disabled","modelValue"])])),_:1}),L(I,{label:"块标签",prop:"label"},{default:A((()=>[L(C,{type:"text",modelValue:S(E).blockForm.label,"onUpdate:modelValue":g[8]||(g[8]=e=>S(E).blockForm.label=e),autocomplete:"off",placeholder:"请输入块标签"},null,8,["modelValue"])])),_:1}),L(I,{label:"块数据标识",prop:"blockRulerId"},{default:A((()=>[L(C,{type:"text",modelValue:S(E).blockForm.blockRulerId,"onUpdate:modelValue":g[9]||(g[9]=e=>S(E).blockForm.blockRulerId=e),placeholder:"请输入块数据标识"},null,8,["modelValue"])])),_:1}),L(I,{label:"块读取开关",prop:"blockRead"},{default:A((()=>[L(_e,{modelValue:S(E).blockForm.blockRead,"onUpdate:modelValue":g[10]||(g[10]=e=>S(E).blockForm.blockRead=e),style:{width:"100%"},placeholder:"请选择是否打开块读取"},{default:A((()=>[(D(!0),V(U,null,j(S(E).BlockReadSw,(e=>(D(),T(ke,{key:"SW"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),L(Fe,{modelValue:S(E).psFlag,"onUpdate:modelValue":g[14]||(g[14]=e=>S(E).psFlag=e),title:"导入命令",width:"600px","before-close":ae,"close-on-click-modal":!1},{footer:A((()=>[B("span",Ml,[L(M,{onClick:te},{default:A((()=>[xl])),_:1}),L(M,{type:"primary",onClick:$},{default:A((()=>[Cl])),_:1})])])),default:A((()=>[L(we,{ref_key:"uploadDPSRef",ref:Z,action:"","auto-upload":!1,"http-request":K,limit:1,"on-exceed":ee,"before-upload":le},{tip:A((()=>[wl])),default:A((()=>[L(M,{type:"primary"},{default:A((()=>[Fl])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-6fdf46ce"]]);const Dl=e=>(N("data-v-5cb8eaa6"),e=e(),I(),e),Vl={class:"main-container"},Bl={key:0,class:"main"},Ll={class:"search-bar"},Al=z(" 刷新 "),Sl={class:"tool-bar"},Rl=z(" 添加 "),zl=z("变量详情"),Nl=z("命令详情"),Il=z("编辑"),Pl=z("删除"),Ol=Dl((()=>B("div",null,"无数据",-1))),Ul={class:"pagination"},jl={class:"dialog-content"},Tl={class:"dialog-footer"},ql=z("取消"),Hl=z("保存");var El=b({setup(c){const u=g(),m=M(null),f=x({typeModel:3,showFlag:0,headerCellStyle:{background:y.primaryColor,color:y.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceModelInfo:"",tableData:[],modelForm:{name:"",label:"",type:0,param:""},modelRules:{name:[{required:!0,message:"采集模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"采集模型标识不能为空",trigger:"blur"}],param:[{required:!0,message:"采集模型插件不能为空",trigger:"blur"}]},udFlag:!1,dmFlag:!1,dmTitle:"添加采集模型",pluginList:[],curDeviceModel:""}),b=l=>{const t={token:u.token,data:{type:f.typeModel}};v.getDeviceModelList(t).then((async t=>{t&&("0"===t.code?(f.tableData=t.data,1===l&&e({type:"success",message:"刷新成功！"})):j(t),await P((()=>{f.tableMaxHeight=m.value.clientHeight-34-36-22})))}))};b();const h=C((()=>f.tableData.filter((e=>{var l=!f.deviceModelInfo,t=e.name.toLowerCase().includes(f.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(f.deviceModelInfo.toLowerCase());return l||t})).slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize))),k=C((()=>f.tableData.filter((e=>{var l=!f.deviceModelInfo,t=e.name.toLowerCase().includes(f.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(f.deviceModelInfo.toLowerCase());return l||t})))),_=e=>{f.currentPage=e},w=e=>{f.pagesize=e},R=e=>{f.dmFlag=!0,f.dmTitle="编辑采集模型",f.modelForm={name:e.name,label:e.label,type:void 0===e.type?0:e.type,param:e.param}},z=M(null),N=()=>{f.dmFlag=!1,z.value.resetFields(),O()},I=()=>{N()},O=()=>{f.modelForm={name:"",label:"",type:0}},U=()=>{f.showFlag=0},j=l=>{e({type:"error",message:l.message})},H=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(c,g)=>{const y=l,M=r,x=a,C=X("Icon"),P=t,O=o,j=d,E=s,W=i,Y=p;return D(),V("div",Vl,[0===S(f).showFlag?(D(),V("div",Bl,[B("div",Ll,[L(O,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:A((()=>[L(x,{label:"采集模型名称"},{default:A((()=>[L(M,{style:{width:"200px"},placeholder:"请输入采集模型名称",modelValue:S(f).deviceModelInfo,"onUpdate:modelValue":g[0]||(g[0]=e=>S(f).deviceModelInfo=e)},{prefix:A((()=>[L(y,{class:"el-input__icon"},{default:A((()=>[L(S(F))])),_:1})])),_:1},8,["modelValue"])])),_:1}),L(x,null,{default:A((()=>[L(P,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:g[1]||(g[1]=e=>{b(1)})},{default:A((()=>[L(y,{class:"btn-icon"},{default:A((()=>[L(C,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),Al])),_:1})])),_:1})])),_:1},512)]),B("div",Sl,[L(P,{type:"primary",bg:"",class:"right-btn",onClick:g[2]||(g[2]=e=>(f.dmFlag=!0,void(f.dmTitle="添加采集模型")))},{default:A((()=>[L(y,{class:"btn-icon"},{default:A((()=>[L(C,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),Rl])),_:1})]),B("div",{class:"content",ref_key:"contentRef",ref:m},[L(E,{data:S(h),"cell-style":S(f).cellStyle,"header-cell-style":S(f).headerCellStyle,"max-height":S(f).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:R},{empty:A((()=>[Ol])),default:A((()=>[L(j,{prop:"name",label:"采集模型名称",width:"auto","min-width":"200",align:"center"}),L(j,{prop:"label",label:"采集模型标签",width:"auto","min-width":"200",align:"center"}),L(j,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:A((l=>[L(P,{onClick:e=>{return t=l.row,f.curDeviceModel=t,void(f.showFlag=1);var t},text:"",type:"success"},{default:A((()=>[zl])),_:2},1032,["onClick"]),L(P,{onClick:e=>{return t=l.row,f.curDeviceModel=t,void(f.showFlag=2);var t},text:"",type:"success"},{default:A((()=>[Nl])),_:2},1032,["onClick"]),L(P,{onClick:e=>R(l.row),text:"",type:"primary"},{default:A((()=>[Il])),_:2},1032,["onClick"]),L(P,{onClick:t=>{return a=l.row,void n.confirm("确定要删除这个采集模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:u.token,data:{name:a.name,type:3}};v.deleteDeviceModel(e).then((e=>{H(e,b)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var a},text:"",type:"danger"},{default:A((()=>[Pl])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),B("div",Ul,[L(W,{"current-page":S(f).currentPage,"page-size":S(f).pagesize,"page-sizes":[20,50,200,500],total:S(k).length,onCurrentChange:_,onSizeChange:w,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):q("",!0),1===S(f).showFlag?(D(),T(oe,{key:1,curDeviceModel:S(f).curDeviceModel,onChangeShowFlag:g[3]||(g[3]=e=>U()),style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel"])):q("",!0),2===S(f).showFlag?(D(),T(Xl,{key:2,curDeviceModel:S(f).curDeviceModel,deviceModelList:S(f).tableData,onChangeShowFlag:g[4]||(g[4]=e=>U()),style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel","deviceModelList"])):q("",!0),L(Y,{modelValue:S(f).dmFlag,"onUpdate:modelValue":g[9]||(g[9]=e=>S(f).dmFlag=e),title:S(f).dmTitle,width:"600px","before-close":I,"close-on-click-modal":!1},{footer:A((()=>[B("span",Tl,[L(P,{onClick:g[7]||(g[7]=e=>N())},{default:A((()=>[ql])),_:1}),L(P,{type:"primary",onClick:g[8]||(g[8]=e=>{z.value.validate((e=>{if(!e)return!1;{f.modelForm.type=f.typeModel;const e={token:u.token,data:f.modelForm};f.dmTitle.includes("添加")?v.addDeviceModel(e).then((e=>{H(e,b),N()})):v.editDeviceModel(e).then((e=>{H(e,b),N()}))}}))})},{default:A((()=>[Hl])),_:1})])])),default:A((()=>[B("div",jl,[L(O,{model:S(f).modelForm,rules:S(f).modelRules,ref_key:"modelFormRef",ref:z,"status-icon":"","label-position":"right","label-width":"120px"},{default:A((()=>[L(x,{label:"采集模型名称",prop:"name"},{default:A((()=>[L(M,{type:"text",disabled:S(f).dmTitle.includes("编辑"),modelValue:S(f).modelForm.name,"onUpdate:modelValue":g[5]||(g[5]=e=>S(f).modelForm.name=e),autocomplete:"off",placeholder:"请输入采集模型名称"},null,8,["disabled","modelValue"])])),_:1}),L(x,{label:"采集模型标签",prop:"label"},{default:A((()=>[L(M,{type:"text",modelValue:S(f).modelForm.label,"onUpdate:modelValue":g[6]||(g[6]=e=>S(f).modelForm.label=e),autocomplete:"off",placeholder:"请输入采集模型标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-5cb8eaa6"]]);export{El as default};
