import{m as e,v as a,w as t,S as s,p as l,F as r,G as o,u as d,g as i}from"./element-plus.2c9426ce.js";import{_ as c,u as n}from"./index.9c81e799.js";import{S as m}from"./sysTool.087279d2.js";import{I as u}from"./interface.75dfa0d7.js";import{P as p}from"./papaparse.0ea4a40d.js";import{d as f}from"./dayjs.2790329b.js";import{J as v,o as h,c as b,a as g,O as j,R as y,u as k,X as _,P as w,aj as D,V as x,W as C,L as V,S as I,av as L,aw as U}from"./@vue.2c474d7f.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.d618444d.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./axios.765908e4.js";import"./vue-router.3b7aa6c5.js";import"./pinia.39330980.js";import"./vue-demi.b3a9cad9.js";import"./@element-plus.e895b9e1.js";import"./screenfull.7cf96174.js";import"./vue-echarts.ebbe6a42.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const R={class:"main-container"},T={class:"main",style:{"background-color":"inherit"}},O=(e=>(L("data-v-94584f44"),e=e(),U(),e))((()=>g("div",{class:"card-header"},[g("span",null,"通讯调试助手")],-1))),S={class:"item"},A={class:"st-receive"},M={class:"str-content"},N={key:0,class:"str-noData"},Y={key:0},z={class:"st-send"},E={class:"st-operate"},F={style:{"margin-bottom":"10px"}},P={class:"st-remark"};var H=c({__name:"CommDebug",setup(c){const L=n(),U=v({receiveData:[],sendData:"",curCollect:"",interfaceList:[{name:"collect01",label:"采集接口01"},{name:"modbusTCP",label:"采集接口02"}],receiveTime:!0,curCheck:0,checkOptions:[{name:0,label:"不校验"},{name:1,label:"CRC16"},{name:2,label:"SUM"}]});(()=>{const e={token:L.token,data:{}};u.getInterfaceList(e).then((e=>{console.log("getInterfaceList -> res",e),e&&("0"===e.code?U.interfaceList=e.data:H(e))}))})();const H=e=>{i({type:"error",message:e.message})};return(i,c)=>{const n=e,u=a,v=t,B=s,G=l,J=r,W=o,X=d;return h(),b("div",R,[g("div",T,[j(W,{gutter:20,style:{height:"100%"}},{default:y((()=>[j(J,{span:24},{default:y((()=>[j(X,{class:"box-card",shadow:"hover"},{header:y((()=>[O])),default:y((()=>[g("div",S,[g("div",A,[g("div",M,[0==k(U).receiveData.length?(h(),b("div",N,"显示区")):_("",!0),(h(!0),b(w,null,D(k(U).receiveData,((e,a)=>(h(),b("div",{key:a},[k(U).receiveTime?(h(),b("div",Y,"【"+C(e.date)+"】",1)):_("",!0),g("div",{class:V(1==e.type?"TxInfo":"RxInfo")},C(1==e.type?"Tx："+e.data:"Rx："+e.data),3)])))),128))])]),g("div",z,[j(n,{modelValue:k(U).sendData,"onUpdate:modelValue":c[0]||(c[0]=e=>k(U).sendData=e),class:"sts-sendArea",rows:"5",type:"textarea",placeholder:""==k(U).sendData?"发送区":""},null,8,["modelValue","placeholder"])]),g("div",E,[g("div",null,[j(v,{modelValue:k(U).curCollect,"onUpdate:modelValue":c[1]||(c[1]=e=>k(U).curCollect=e),style:{width:"100%","margin-bottom":"10px"},placeholder:"请选择采集接口"},{default:y((()=>[(h(!0),b(w,null,D(k(U).interfaceList,(e=>(h(),I(u,{key:e.collInterfaceName,label:e.collInterfaceName,value:e.collInterfaceName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),g("div",F,[j(B,{modelValue:k(U).receiveTime,"onUpdate:modelValue":c[2]||(c[2]=e=>k(U).receiveTime=e),label:"接收时间",border:"",style:{width:"100%",height:"34px"}},null,8,["modelValue"])]),j(G,{type:"danger",plain:"",style:{height:"34px",width:"100%","margin-bottom":"10px"},onClick:c[3]||(c[3]=e=>{U.receiveData=[]})},{default:y((()=>[x("清空显示区")])),_:1}),j(G,{type:"primary",plain:"",style:{height:"34px",width:"100%","margin-left":"0"},onClick:c[4]||(c[4]=e=>(()=>{let e=[],a=["接收方","发送方"];U.receiveData.forEach((t=>{e.push({date:t.date+"\t",type:a[t.type],content:t.data})}));var t=p.unparse(e);let s=new Blob([t]),l=window.URL||window.webkitURL||window,r=l.createObjectURL(s),o=document.createElement("a");o.href=r;let d=U.curCollect+"通讯报文";d+=f(new Date).format("YYYY-MM-DD HH-mm-ss"),o.download=d+".csv",o.click(),l.revokeObjectURL(r)})())},{default:y((()=>[x("导出")])),_:1})]),g("div",null,[j(G,{type:"primary",style:{height:"34px",width:"100%","margin-bottom":"10px"},plain:"",onClick:c[5]||(c[5]=e=>(()=>{if(""===U.curCollect)return void H({message:"请选择采集接口！"});if(""===U.curCheck)return void H({message:"请选择校验方式！"});let e="";if(""===U.sendData)return void H({message:"发送数据不能为空！"});let a=U.sendData.replaceAll(" ","");if(!/^[0-9a-fA-F]+$/.test(a))return H({message:"报文格式错误，只能输入字符【0-9,a-f,A-F或者空格】！"}),U.sendData="",void(a="");const t=a.length;for(var s=0;s<t;s+=2)s<t&&(e+=a.substr(s,2)+(s+2>=t?"":" "));const l={token:L.token,data:{collInterfaceName:U.curCollect,directData:e,checkSum:U.curCheck}};m.sendMessage(l).then((e=>{"0"===e.code?e.data.forEach((e=>{U.receiveData.push(e)})):H(e)}))})())},{default:y((()=>[x(" 发送 ")])),_:1}),j(v,{modelValue:k(U).curCheck,"onUpdate:modelValue":c[6]||(c[6]=e=>k(U).curCheck=e),style:{width:"100%","margin-bottom":"10px"},placeholder:"请选择数据校验"},{default:y((()=>[(h(!0),b(w,null,D(k(U).checkOptions,(e=>(h(),I(u,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),j(G,{type:"danger",style:{height:"34px",width:"100%"},plain:"",onClick:c[7]||(c[7]=e=>{U.sendData=""})},{default:y((()=>[x("清空发送区")])),_:1})])]),g("div",P,[j(W,{gutter:16},{default:y((()=>[j(J,{span:1},{default:y((()=>[x("操作步骤:")])),_:1}),j(J,{span:21},{default:y((()=>[x("1、选择采集接口")])),_:1})])),_:1}),j(W,{gutter:16},{default:y((()=>[j(J,{offset:1,span:21},{default:y((()=>[x("2、选择校验方式")])),_:1})])),_:1}),j(W,{gutter:16},{default:y((()=>[j(J,{offset:1,span:21},{default:y((()=>[x("3、发送区编写发送的报文")])),_:1})])),_:1}),j(W,{gutter:16},{default:y((()=>[j(J,{offset:1,span:21},{default:y((()=>[x("4、显示区显示发送的报文和返回的报文")])),_:1})])),_:1})])])])),_:1})])),_:1})])),_:1})])])}}},[["__scopeId","data-v-94584f44"]]);export{H as default};
