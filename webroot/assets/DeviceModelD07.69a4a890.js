import{g as e,e as l,p as t,n as a,o,m as r,A as d,C as s,D as n,L as i,v as p,w as c,K as u,q as m,M as f,u as b}from"./element-plus.3300f756.js";import{_ as y,u as g,v as h,s as v}from"./index.9b2cfea2.js";import{D as k}from"./deviceModel.16d94447.js";import{b as _,i as F,d as x,h as w}from"./@element-plus.0bef5fa5.js";import{f as M,K as C,k as X,af as D,o as V,c as A,a as L,P as B,S,u as R,W as P,X as z,n as N,aw as I,ax as U,h as O,Q as j,ak as T,T as q,Y as H,M as E}from"./@vue.73d14ebc.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.3d90a471.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./vue-router.43b9a342.js";import"./pinia.3f4aff4f.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.7828944a.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const W={class:"main-container"},Y={class:"main"},G={class:"search-bar"},K={class:"search-bar",style:{display:"flex"}},Q={class:"title",style:{position:"relative","margin-right":"40px","justify-content":"flex-start",padding:"0px 0px",height:"40px"}},$={class:"tName"},J=(e=>(I("data-v-7e8dfd3e"),e=e(),U(),e))((()=>L("div",null,"无数据",-1))),Z={class:"pagination",style:{"z-index":"9"}};var ee=y({__name:"PropertyD07",props:{curDeviceModel:{type:Object,default:{}}},emits:["changeShowFlag"],setup(i,{emit:p}){const c=i,u=g();console.log("id -> props",c);const m=M(null),f=C({headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",rulerId:"",format:"",len:0,accessMode:0,type:0,unit:"",blockAddOffset:0,rulerAddOffset:0},psFlag:!1,selectedProperties:[]}),b=l=>{const t={token:u.token,data:{name:c.curDeviceModel.name}};k.getDeviceModelProperty(t).then((async t=>{console.log("getDeviceModelProperty -> res",t),t&&("0"===t.code?(f.propertyList=t.data,1===l&&e({type:"success",message:"刷新成功！"})):U(t),await N((()=>{f.tableMaxHeight=m.value.clientHeight-34-36-132})))}))};b();const y=X((()=>(console.log("ctxData.propertyList ->",f.propertyList),f.propertyList.filter((e=>{var l=!f.deviceModelProperty,t=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||t})).slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize)))),v=X((()=>f.propertyList.filter((e=>{var l=!f.deviceModelProperty,t=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||t})))),w=e=>{f.currentPage=e},I=e=>{f.pagesize=e},U=l=>{e({type:"error",message:l.message})};return(e,i)=>{const g=l,h=t,M=a,C=o,X=r,N=D("Icon"),O=d,j=s,T=n;return V(),A("div",W,[L("div",Y,[L("div",G,[B(C,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:S((()=>[B(M,{style:{"margin-left":"20px"}},{default:S((()=>[B(h,{type:"primary",plain:"",onClick:i[0]||(i[0]=e=>(console.log("toDeviceModel"),void p("changeShowFlag")))},{default:S((()=>[B(g,{class:"el-input__icon"},{default:S((()=>[B(R(_))])),_:1}),P(" 返回设备模型 ")])),_:1})])),_:1}),B(M,null,{default:S((()=>[B(h,{type:"primary",plain:"",class:"right-btn",onClick:i[1]||(i[1]=e=>(()=>{console.log("exportDPS");const e={token:u.token,responseType:"blob",data:{name:c.curDeviceModel.name}};k.exportDeviceModelProptyAndService(e).then((e=>{if(e&&"1"===e.code)return void U(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:S((()=>[B(g,{class:"el-input__icon"},{default:S((()=>[B(R(F))])),_:1}),P(" 导出模型属性 ")])),_:1})])),_:1})])),_:1},512)]),L("div",K,[L("div",Q,[L("div",$,z(c.curDeviceModel.label)+"：属性列表",1)]),B(C,{inline:!0,ref:"searchFormRef2","status-icon":"","label-width":"90px"},{default:S((()=>[B(M,{label:""},{default:S((()=>[B(X,{style:{width:"200px"},placeholder:"请输入属性名称",modelValue:R(f).deviceModelProperty,"onUpdate:modelValue":i[2]||(i[2]=e=>R(f).deviceModelProperty=e)},{prefix:S((()=>[B(g,{class:"el-input__icon"},{default:S((()=>[B(R(x))])),_:1})])),_:1},8,["modelValue"])])),_:1}),B(M,null,{default:S((()=>[B(h,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:i[3]||(i[3]=e=>{b(1)})},{default:S((()=>[B(g,{class:"btn-icon"},{default:S((()=>[B(N,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),P(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),L("div",{class:"content",ref_key:"contentRef",ref:m},[B(j,{data:R(y),"cell-style":R(f).cellStyle,"header-cell-style":R(f).headerCellStyle,style:{width:"100%"},"max-height":R(f).tableMaxHeight,stripe:""},{empty:S((()=>[J])),default:S((()=>[B(O,{type:"index",width:"60"},{header:S((()=>[P(" 序号 ")])),_:1}),B(O,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"rulerId",label:"数据标识",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"format",label:"数据格式",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"len",label:"数据长度",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",label:"读写属性",width:"auto","min-width":"80",align:"center"},{default:S((e=>[P(z(R(f).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),B(O,{sortable:"",prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:S((e=>[P(z(R(f).typeNames["t"+e.row.type]),1)])),_:1}),B(O,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),B(O,{sortable:"",prop:"blockAddOffset",label:"块偏移地址",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"rulerAddOffset",label:"标识偏移地址",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"step",label:"步长",width:"auto","min-width":"120",align:"center"})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",Z,[B(T,{"current-page":R(f).currentPage,"page-size":R(f).pagesize,"page-sizes":[20,50,200,500],total:R(v).length,onCurrentChange:w,onSizeChange:I,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])])}}},[["__scopeId","data-v-7e8dfd3e"]]);var le=e=>v.request({url:"/tsl/dlt64507/cmd",method:"get",data:e}),te=e=>v.request({url:"/tsl/dlt64507/cmd",method:"post",data:e}),ae=e=>v.request({url:"/tsl/dlt64507/cmd",method:"put",data:e}),oe=e=>v.request({url:"/tsl/dlt64507/cmd",method:"delete",data:e}),re=e=>v.request({url:"/tsl/dlt64507/block/xlsx",method:"post",data:e}),de=e=>v.request({url:"/tsl/dlt64507/block/xlsx",method:"get",data:e}),se=e=>v.request({url:"/tsl/dlt64507/cmd/params",method:"get",data:e}),ne=e=>v.request({url:"/tsl/dlt64507/cmd/param",method:"post",data:e}),ie=e=>v.request({url:"/tsl/dlt64507/cmd/param",method:"put",data:e}),pe=e=>v.request({url:"/tsl/dlt64507/cmd/params",method:"delete",data:e}),ce=e=>v.request({url:"/tsl/dlt64507/cmd/param/xlsx",method:"post",data:e}),ue=e=>v.request({url:"/tsl/dlt64507/cmd/param/xlsx",method:"get",data:e});const me=e=>(I("data-v-32a103cd"),e=e(),U(),e),fe={class:"main-container"},be={style:{display:"flex","justify-content":"space-between"}},ye={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},ge={class:"tName"},he={class:"search-bar",style:{"text-align":"right"}},ve=me((()=>L("div",null,"无数据",-1))),ke={class:"pagination"},_e={class:"dialog-content"},Fe=me((()=>L("div",{class:"form-title"},[L("div",{class:"tName"},"配置参数")],-1))),xe={class:"dialog-footer"},we={class:"dialog-content"},Me={style:{width:"100%"}},Ce={style:{"padding-right":"10px"}},Xe={class:"dialog-footer"},De=me((()=>L("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),Ve={class:"dialog-footer"};var Ae=y({__name:"BlockPropertyD07",props:{curModelBlock:{type:Object,default:{}}},emits:["changeBShowFlag"],setup(b,{emit:y}){const v=b,k=g(),_=M(null),I=C({formulaForm:{},headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",accessModeOptions:[{label:"只读",value:0},{label:"只写",value:1},{label:"读写",value:2}],typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},formatOptions:[{label:"X.XXX",value:"X.XXX"},{label:"XX",value:"XX"},{label:"XX.XX",value:"XX.XX"},{label:"XX.XXXX",value:"XX.XXXX"},{label:"XXX.X",value:"XXX.X"},{label:"XXX.XXX",value:"XXX.XXX"},{label:"XXXXXX",value:"XXXXXX"},{label:"XXXXXX.XX",value:"XXXXXX.XX"},{label:"XXXXXXXX",value:"XXXXXXXX"},{label:"XXXXXXXXXXXX",value:"XXXXXXXXXXXX"},{label:"DDhh",value:"DDhh"},{label:"MMDDNN",value:"MMDDNN"},{label:"hhmmNN",value:"hhmmNN"},{label:"YYMMDDWW",value:"YYMMDDWW"},{label:"YYMMDDhhmm",value:"YYMMDDhhmm"},{label:"YYMMDDhhmmss",value:"YYMMDDhhmmss"},{label:"C0C1C2C3",value:"C0C1C2C3"}],lenOptions:[{label:1,value:1},{label:2,value:2},{label:3,value:3},{label:4,value:4},{label:5,value:5},{label:6,value:6}],pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,unit:"",rulerId:"",len:0,blockAddOffset:0,rulerAddOffset:0,min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,dataLength:"",dataLengthAlarm:!1},ruleTypeOptions:{rt1:[{label:"Int_AB",value:"Int_AB"},{label:"Int_BA",value:"Int_BA"}],rt2:[{label:"Long_ABCD",value:"Long_ABCD"},{label:"Long_BADC",value:"Long_BADC"},{label:"Long_DCBA",value:"Long_DCBA"},{label:"Long_CDAB",value:"Long_CDAB"},{label:"Float_ABCD",value:"Float_ABCD"},{label:"Float_BADC",value:"Float_BADC"},{label:"Float_DCBA",value:"Float_DCBA"},{label:"Float_CDAB",value:"Float_CDAB"}],rt4:[{label:"Double_ABCDEFGH",value:"Double_ABCDEFGH"},{label:"Double_GHEFCDAB",value:"Double_GHEFCDAB"},{label:"Double_BADCFEHG",value:"Double_BADCFEHG"},{label:"Double_HGFEDCBA",value:"Double_HGFEDCBA"}]},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",decimals:"小数位数",regCnt:"寄存器数量",ruleType:"解析规则",regAddr:"寄存器地址",formula:"计算公式",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"步长",stepAlarm:"步长报警",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],accessMode:[{required:!0,message:"读写属性不能为空",trigger:"blur"}],type:[{required:!0,message:"属性类型不能为空",trigger:"blur"}],rulerId:[{required:!0,message:"标识数据长度不能为空",trigger:"blur"}],len:[{required:!0,type:"number",message:"数据长度只能输入数字",trigger:"blur"}],blockAddOffset:[{required:!0,type:"number",message:"块数据偏移地址只能输入数字",trigger:"blur"}],rulerAddOffset:[{required:!0,type:"number",message:"标识数据地址只能输入数字",trigger:"blur"}]},psFlag:!1,selectedProperties:[],fFlag:!1,propertyInfo:[],operationList:[{name:"+",label:"+",describe:"加"},{name:"-",label:"-",describe:"减"},{name:"*",label:"*",describe:"乘"},{name:"/",label:"/",describe:"除"},{name:"%",label:"%",describe:"模"},{name:"^",label:"^",describe:"次幂"},{name:"(",label:"(",describe:"左括号"},{name:")",label:")",describe:"右括号"}],curFormula:"",selectionStart:0,pItem:""}),U=l=>{const t={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name}};se(t).then((async t=>{t&&("0"===t.code?(I.propertyList=null==t.data?[]:t.data,1===l&&e({type:"success",message:"刷新成功！"})):Le(t),await N((()=>{I.tableMaxHeight=_.value.clientHeight-34-22-82})))}))};U();const E=X((()=>I.propertyList.filter((e=>{var l=!I.deviceModelProperty,t=e.name.toLowerCase().includes(I.deviceModelProperty.toLowerCase());return l||t})).slice((I.currentPage-1)*I.pagesize,I.currentPage*I.pagesize))),W=X((()=>I.propertyList.filter((e=>{var l=!I.deviceModelProperty,t=e.name.toLowerCase().includes(I.deviceModelProperty.toLowerCase());return l||t})))),Y=e=>{I.currentPage=e},G=e=>{I.pagesize=e},K=()=>{$.value&&$.value.submit()},Q=e=>{},$=M(null),J=e=>{$.value.clearFiles();const l=e[0];$.value.handleStart(l)},Z=l=>{let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("tslName",v.curModelBlock.tslName),t.append("cmdName",v.curModelBlock.name),t.append("fileName",l);const a={token:k.token,contentType:"multipart/form-data",data:t};ce(a).then((l=>{"0"===l.code?(e.success(l.message),I.psFlag=!1,U()):Le(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ee=()=>{I.psFlag=!1,uploadRef.value.clearFiles()},le=()=>{ee()},te=e=>{I.pFlag=!0,I.pTitle="编辑属性",I.propertyForm.name=e.name,I.propertyForm.label=e.label,I.propertyForm.rulerId=e.rulerId,I.propertyForm.format=e.format,I.propertyForm.len=e.len,I.propertyForm.unit=e.unit,I.propertyForm.accessMode=e.accessMode,I.propertyForm.type=e.type,I.propertyForm.blockAddOffset=e.blockAddOffset,I.propertyForm.rulerAddOffset=e.rulerAddOffset,3!==e.type?(I.propertyForm.min=e.params.min,I.propertyForm.max=e.params.max,I.propertyForm.minMaxAlarm=e.params.minMaxAlarm,I.propertyForm.step=void 0===e.params.step||null===e.params.step?0:e.params.step,I.propertyForm.stepAlarm=e.params.stepAlarm):(I.propertyForm.dataLength=e.params.dataLength,I.propertyForm.dataLengthAlarm=e.params.dataLengthAlarm)},ae=M(null),oe=()=>{I.pFlag=!1,ae.value.resetFields(),me()},re=e=>{oe()},de=e=>{I.selectedProperties=e},me=()=>{I.propertyForm={name:"",label:"",accessMode:0,type:0,unit:"",len:0,rulerId:"",blockAddOffset:0,rulerAddOffset:0,step:0}},Ae=e=>{I.selectionStart=e.srcElement.selectionStart},Le=l=>{e({type:"error",message:l.message})},Be=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return O((()=>v.curModelBlock),((e,l)=>{U()})),(b,y)=>{const g=l,h=r,M=a,C=t,X=D("Icon"),N=o,O=d,se=s,ce=n,me=p,Se=c,Re=u,Pe=m,ze=f;return V(),A("div",fe,[L("div",be,[L("div",ye,[L("div",ge,z(v.curModelBlock.label)+"：命令参数列表",1)]),L("div",he,[B(N,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:S((()=>[B(M,{style:{"margin-left":"20px"}},{default:S((()=>[B(h,{style:{width:"200px"},placeholder:"请输入命令参数名称",modelValue:R(I).deviceModelProperty,"onUpdate:modelValue":y[0]||(y[0]=e=>R(I).deviceModelProperty=e)},{prefix:S((()=>[B(g,{class:"el-input__icon"},{default:S((()=>[B(R(x))])),_:1})])),_:1},8,["modelValue"])])),_:1}),B(M,null,{default:S((()=>[B(C,{type:"primary",plain:"",class:"right-btn",onClick:y[1]||(y[1]=e=>{I.psFlag=!0})},{default:S((()=>[B(g,{class:"el-input__icon"},{default:S((()=>[B(R(w))])),_:1}),P(" 导入命令参数 ")])),_:1})])),_:1}),B(M,null,{default:S((()=>[B(C,{type:"primary",plain:"",class:"right-btn",onClick:y[2]||(y[2]=e=>(()=>{const e={token:k.token,responseType:"blob",data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name}};ue(e).then((e=>{if(e&&"1"===e.code)return void Le(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:S((()=>[B(g,{class:"el-input__icon"},{default:S((()=>[B(R(F))])),_:1}),P(" 导出命令参数 ")])),_:1})])),_:1}),B(M,null,{default:S((()=>[B(C,{type:"primary",bg:"",class:"right-btn",onClick:y[3]||(y[3]=e=>(I.pFlag=!0,void(I.pTitle="添加属性")))},{default:S((()=>[B(g,{class:"btn-icon"},{default:S((()=>[B(X,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),P(" 添加 ")])),_:1})])),_:1}),B(M,null,{default:S((()=>[B(C,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:y[4]||(y[4]=e=>{U(1)})},{default:S((()=>[B(g,{class:"btn-icon"},{default:S((()=>[B(X,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),P(" 刷新 ")])),_:1})])),_:1}),B(M,null,{default:S((()=>[B(C,{type:"danger",bg:"",class:"right-btn",onClick:y[5]||(y[5]=l=>(l=>{let t=[];0!==I.selectedProperties.length?(I.selectedProperties.forEach((e=>{t.push(e.name)})),i.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name,propertyNames:t}};pe(e).then((e=>{Be(e,U)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:S((()=>[B(g,{class:"btn-icon"},{default:S((()=>[B(X,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),P(" 删除 ")])),_:1})])),_:1})])),_:1},512)])]),L("div",{class:"content",ref_key:"contentRef",ref:_},[B(se,{data:R(E),"cell-style":R(I).cellStyle,"header-cell-style":R(I).headerCellStyle,style:{width:"100%"},"max-height":R(I).tableMaxHeight,stripe:"",onSelectionChange:de,onRowDblclick:te},{empty:S((()=>[ve])),default:S((()=>[B(O,{type:"selection",width:"55"}),B(O,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"rulerId",label:"数据标识",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"format",label:"数据格式",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"len",label:"数据长度",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",label:"读写属性",width:"auto","min-width":"100",align:"center"},{default:S((e=>[P(z(R(I).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),B(O,{sortable:"",prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:S((e=>[P(z(R(I).typeNames["t"+e.row.type]),1)])),_:1}),B(O,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),B(O,{sortable:"",prop:"blockAddOffset",label:"块偏移地址",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"rulerAddOffset",label:"标识偏移地址",width:"auto","min-width":"150",align:"center"}),B(O,{sortable:"",prop:"step",label:"步长",width:"auto","min-width":"120",align:"center"}),B(O,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:S((e=>[B(C,{onClick:l=>te(e.row),text:"",type:"primary"},{default:S((()=>[P("编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",ke,[B(ce,{"current-page":R(I).currentPage,"page-size":R(I).pagesize,"page-sizes":[20,50,200,500],total:R(W).length,onCurrentChange:Y,onSizeChange:G,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),B(Pe,{modelValue:R(I).pFlag,"onUpdate:modelValue":y[27]||(y[27]=e=>R(I).pFlag=e),title:R(I).pTitle,width:"800px","before-close":re,"close-on-click-modal":!1},{footer:S((()=>[L("span",xe,[B(C,{onClick:y[25]||(y[25]=e=>oe())},{default:S((()=>[P("取消")])),_:1}),B(C,{type:"primary",onClick:y[26]||(y[26]=e=>{ae.value.validate((e=>{if(!e)return!1;{const e={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name,name:I.propertyForm.name,label:I.propertyForm.label,rulerId:I.propertyForm.rulerId,format:I.propertyForm.format,len:I.propertyForm.len,unit:I.propertyForm.unit,accessMode:I.propertyForm.accessMode,type:I.propertyForm.type,blockAddOffset:I.propertyForm.blockAddOffset,rulerAddOffset:I.propertyForm.rulerAddOffset}};let l={};3!==I.propertyForm.type?(l.min=I.propertyForm.min,l.max=I.propertyForm.max,l.minMaxAlarm=I.propertyForm.minMaxAlarm,l.step=+I.propertyForm.step,l.stepAlarm=I.propertyForm.stepAlarm):(l.dataLength=I.propertyForm.dataLength,l.dataLengthAlarm=I.propertyForm.dataLengthAlarm),e.data.params=l,I.pTitle.includes("添加")?ne(e).then((e=>{Be(e,U),oe()})):ie(e).then((e=>{Be(e,U),oe()}))}}))})},{default:S((()=>[P("保存")])),_:1})])])),default:S((()=>[L("div",_e,[B(N,{model:R(I).propertyForm,rules:R(I).propertyRules,ref_key:"propertyFormRef",ref:ae,"status-icon":"","label-position":"right","label-width":"120px",inline:!0},{default:S((()=>[B(M,{label:"属性名称",prop:"name"},{default:S((()=>[B(h,{style:{width:"220px"},disabled:R(I).pTitle.includes("编辑"),type:"text",modelValue:R(I).propertyForm.name,"onUpdate:modelValue":y[6]||(y[6]=e=>R(I).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),B(M,{label:"属性标签",prop:"label"},{default:S((()=>[B(h,{style:{width:"220px"},type:"text",modelValue:R(I).propertyForm.label,"onUpdate:modelValue":y[7]||(y[7]=e=>R(I).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),B(M,{label:"读写属性",prop:"accessMode"},{default:S((()=>[B(Se,{modelValue:R(I).propertyForm.accessMode,"onUpdate:modelValue":y[8]||(y[8]=e=>R(I).propertyForm.accessMode=e),style:{width:"220px"},placeholder:"请选择读写属性"},{default:S((()=>[(V(!0),A(j,null,T(R(I).accessModeOptions,(e=>(V(),q(me,{key:"accessMode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),B(M,{label:"单位",prop:"unit"},{default:S((()=>[B(h,{style:{width:"220px"},type:"text",modelValue:R(I).propertyForm.unit,"onUpdate:modelValue":y[9]||(y[9]=e=>R(I).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1}),B(M,{label:"属性类型",prop:"type"},{default:S((()=>[B(Se,{modelValue:R(I).propertyForm.type,"onUpdate:modelValue":y[10]||(y[10]=e=>R(I).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择属性类型"},{default:S((()=>[(V(!0),A(j,null,T(R(I).typeOptions,(e=>(V(),q(me,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),L("div",null,[3!==R(I).propertyForm.type?(V(),q(M,{key:0,label:"范围报警",prop:"minMaxAlarm"},{default:S((()=>[B(Re,{modelValue:R(I).propertyForm.minMaxAlarm,"onUpdate:modelValue":y[11]||(y[11]=e=>R(I).propertyForm.minMaxAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0)]),L("div",null,[3!==R(I).propertyForm.type&&R(I).propertyForm.minMaxAlarm?(V(),q(M,{key:0,label:"最小值",prop:"min"},{default:S((()=>[B(h,{type:"text",modelValue:R(I).propertyForm.min,"onUpdate:modelValue":y[12]||(y[12]=e=>R(I).propertyForm.min=e),autocomplete:"off",placeholder:"请输入最小值"},null,8,["modelValue"])])),_:1})):H("",!0)]),3!==R(I).propertyForm.type&&R(I).propertyForm.minMaxAlarm?(V(),q(M,{key:0,label:"最大值",prop:"max"},{default:S((()=>[B(h,{type:"text",modelValue:R(I).propertyForm.max,"onUpdate:modelValue":y[13]||(y[13]=e=>R(I).propertyForm.max=e),autocomplete:"off",placeholder:"请输入最大值"},null,8,["modelValue"])])),_:1})):H("",!0),L("div",null,[3!==R(I).propertyForm.type?(V(),q(M,{key:0,label:"步长报警",prop:"stepAlarm"},{default:S((()=>[B(Re,{modelValue:R(I).propertyForm.stepAlarm,"onUpdate:modelValue":y[14]||(y[14]=e=>R(I).propertyForm.stepAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0)]),3!==R(I).propertyForm.type&&R(I).propertyForm.stepAlarm?(V(),q(M,{key:1,label:"步长",prop:"step"},{default:S((()=>[B(h,{type:"text",modelValue:R(I).propertyForm.step,"onUpdate:modelValue":y[15]||(y[15]=e=>R(I).propertyForm.step=e),autocomplete:"off",placeholder:"请输入步长"},null,8,["modelValue"])])),_:1})):H("",!0),L("div",null,[3===R(I).propertyForm.type?(V(),q(M,{key:0,label:"字符串长度报警",prop:"dataLengthAlarm"},{default:S((()=>[B(Re,{modelValue:R(I).propertyForm.dataLengthAlarm,"onUpdate:modelValue":y[16]||(y[16]=e=>R(I).propertyForm.dataLengthAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0)]),3===R(I).propertyForm.type&&R(I).propertyForm.dataLengthAlarm?(V(),q(M,{key:2,label:"字符串长度",prop:"dataLength"},{default:S((()=>[B(h,{type:"text",modelValue:R(I).propertyForm.dataLength,"onUpdate:modelValue":y[17]||(y[17]=e=>R(I).propertyForm.dataLength=e),autocomplete:"off",placeholder:"请输入字符串长度"},null,8,["modelValue"])])),_:1})):H("",!0),B(M,{label:"数据格式",prop:"len"},{default:S((()=>[1==v.curModelBlock.format?(V(),q(h,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:R(I).propertyForm.format,"onUpdate:modelValue":y[18]||(y[18]=e=>R(I).propertyForm.format=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据格式"},null,8,["modelValue"])):(V(),q(Se,{key:1,modelValue:R(I).propertyForm.format,"onUpdate:modelValue":y[19]||(y[19]=e=>R(I).propertyForm.format=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择数据格式"},{default:S((()=>[(V(!0),A(j,null,T(R(I).formatOptions,(e=>(V(),q(me,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),B(M,{label:"数据长度",prop:"len"},{default:S((()=>[1==v.curModelBlock.len?(V(),q(h,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:R(I).propertyForm.len,"onUpdate:modelValue":y[20]||(y[20]=e=>R(I).propertyForm.len=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据长度"},null,8,["modelValue"])):(V(),q(Se,{key:1,modelValue:R(I).propertyForm.len,"onUpdate:modelValue":y[21]||(y[21]=e=>R(I).propertyForm.len=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择数据长度"},{default:S((()=>[(V(!0),A(j,null,T(R(I).lenOptions,(e=>(V(),q(me,{key:"regCount_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),Fe,B(M,{label:"数据标识",prop:"rulerId"},{default:S((()=>[B(h,{type:"text",style:{width:"220px"},modelValue:R(I).propertyForm.rulerId,"onUpdate:modelValue":y[22]||(y[22]=e=>R(I).propertyForm.rulerId=e),autocomplete:"off",placeholder:"请输入数据标识"},null,8,["modelValue"])])),_:1}),1!=v.curModelBlock.blockAddOffset?(V(),q(M,{key:3,label:"",prop:"",style:{width:"220px"}})):H("",!0),B(M,{label:"块偏移地址",prop:"blockAddOffset"},{default:S((()=>[B(h,{type:"text",style:{width:"220px"},modelValue:R(I).propertyForm.blockAddOffset,"onUpdate:modelValue":y[23]||(y[23]=e=>R(I).propertyForm.blockAddOffset=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据块偏移地址"},null,8,["modelValue"])])),_:1}),B(M,{label:"标识偏移地址",prop:"rulerAddOffset"},{default:S((()=>[B(h,{type:"text",style:{width:"220px"},modelValue:R(I).propertyForm.rulerAddOffset,"onUpdate:modelValue":y[24]||(y[24]=e=>R(I).propertyForm.rulerAddOffset=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入标识偏移地址"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),B(Pe,{modelValue:R(I).fFlag,"onUpdate:modelValue":y[33]||(y[33]=e=>R(I).fFlag=e),title:"编辑计算公式",width:"600px"},{footer:S((()=>[L("span",Xe,[B(C,{onClick:y[31]||(y[31]=e=>(I.fFlag=!1,void(I.curFormula="")))},{default:S((()=>[P("取消")])),_:1}),B(C,{type:"primary",onClick:y[32]||(y[32]=e=>(I.fFlag=!1,void(I.propertyForm.formula=I.curFormula)))},{default:S((()=>[P("保存")])),_:1})])])),default:S((()=>[L("div",we,[B(N,{model:R(I).formulaForm,"label-position":"right","label-width":"120px"},{default:S((()=>[B(M,{label:"运算符号"},{default:S((()=>[L("div",Me,[(V(!0),A(j,null,T(R(I).operationList,((e,l)=>(V(),A("div",{class:"operation",key:l},[L("div",Ce,[B(C,{style:{width:"100%"},onClick:l=>(e=>{let l=I.curFormula.length;if(l!==I.selectionStart){let t=I.curFormula.substr(0,I.selectionStart),a=I.curFormula.substr(I.selectionStart,l-I.selectionStart);I.curFormula=t+e.name+a,I.selectionStart+=e.name.length}else I.curFormula+=e.name,I.selectionStart+=e.name.length})(e)},{default:S((()=>[P(z(e.label),1)])),_:2},1032,["onClick"])])])))),128))])])),_:1}),B(M,{label:"设备属性"},{default:S((()=>[B(Se,{modelValue:R(I).pItem,"onUpdate:modelValue":y[28]||(y[28]=e=>R(I).pItem=e),filterable:"",placeholder:"请选择设备属性",onChange:y[29]||(y[29]=e=>(e=>{let l=I.curFormula.length;if(l!==I.selectionStart){let t=I.curFormula.substr(0,I.selectionStart),a=I.curFormula.substr(I.selectionStart,l-I.selectionStart);I.curFormula=t+"("+e+")"+a,I.selectionStart+=e.length+2}else I.curFormula+="("+e+")",I.selectionStart+=e.length+2})(R(I).pItem)),style:{width:"100%"}},{default:S((()=>[(V(!0),A(j,null,T(R(I).propertyInfo,(e=>(V(),q(me,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),B(M,{label:"当前公式"},{default:S((()=>[B(h,{type:"text",clearable:"",modelValue:R(I).curFormula,"onUpdate:modelValue":y[30]||(y[30]=e=>R(I).curFormula=e),autocomplete:"off",placeholder:"请编辑计算公式",onBlur:Ae},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),B(Pe,{modelValue:R(I).psFlag,"onUpdate:modelValue":y[34]||(y[34]=e=>R(I).psFlag=e),title:"导入命令参数",width:"600px","before-close":le,"close-on-click-modal":!1},{footer:S((()=>[L("span",Ve,[B(C,{onClick:ee},{default:S((()=>[P("取消")])),_:1}),B(C,{type:"primary",onClick:K},{default:S((()=>[P("上传")])),_:1})])])),default:S((()=>[B(ze,{ref_key:"uploadDPSRef",ref:$,action:"","auto-upload":!1,"http-request":Q,limit:1,"on-exceed":J,"before-upload":Z},{tip:S((()=>[De])),default:S((()=>[B(C,{type:"primary"},{default:S((()=>[P("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-32a103cd"]]);const Le=e=>(I("data-v-04282f20"),e=e(),U(),e),Be={class:"main-container"},Se={class:"main"},Re={class:"mc-left"},Pe={class:"title"},ze={class:"mcl-content"},Ne={class:"mclc-content"},Ie={class:"mc-right"},Ue={class:"mcr-top"},Oe={style:{display:"flex","justify-content":"space-between"}},je={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},Te={class:"tName"},qe={class:"search-bar",style:{"text-align":"right"}},He=Le((()=>L("div",null,"无数据",-1))),Ee={class:"pagination"},We={key:0,class:"mcr-bottom"},Ye={class:"dialog-content"},Ge={class:"dialog-footer"},Ke=Le((()=>L("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),Qe={class:"dialog-footer"};var $e=y({__name:"ModelBlockD07",props:{curDeviceModel:{type:Object,default:{}},deviceModelList:{type:Array,default:[]}},emits:["changeShowFlag"],setup(u,{emit:y}){const v=u,k=g();console.log("id -> props",v);const I=/^[0-9]*[1-9][0-9]*$/,U=M(null),O=C({curDeviceModel:v.curDeviceModel,headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelBlock:"",BlockReadSw:[{label:"开",value:1},{label:"关",value:0}],SWNames:{SW0:"关",SW1:"开"},typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],funCodeOptions:[{label:"01(读线圈状态)",value:1},{label:"02(读离散输入状态)",value:2},{label:"03(读保持寄存器)",value:3},{label:"04(读输入寄存器)",value:4},{label:"05(写单个线圈)",value:5},{label:"06(写单个保持寄存器)",value:6},{label:"15(写多个线圈)",value:15},{label:"16(写多个保持寄存器)",value:16}],funCodeNames:{f1:"01(读线圈状态)",f2:"02(读离散输入状态)",f3:"03(读保持寄存器)",f4:"04(读输入寄存器)",f5:"05(写单个线圈)",f6:"06(写单个保持寄存器)",f15:"15(写多个线圈)",f16:"16(写多个保持寄存器)"},dataTypeOptions:[{label:"uint8",value:0},{label:"int8",value:1},{label:"uint16",value:2},{label:"int16",value:3},{label:"uint32",value:4},{label:"int32",value:5},{label:"float",value:6},{label:"double",value:7}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},dataTypeNames:{dt0:"uint8",dt1:"int8",dt2:"uint16",dt3:"int16",dt4:"uint32",dt5:"int32",dt6:"float",dt7:"double"},pFlag:!1,pTitle:"添加属性",blockForm:{name:"",label:"",blockRulerId:"",blockRead:0},paramName:{name:"块名称",label:"块标签",funCode:"功能码",type:"属性类型",startRegAddr:"寄存器地址",regCnt:"寄存器数量"},propertyRules:{name:[{required:!0,message:"块名称不能为空",trigger:"blur"}],label:[{required:!0,message:"块标签不能为空",trigger:"blur"}],funCode:[{required:!0,message:"功能码不能为空",trigger:"blur"}],startRegAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{0===l||I.test(l)?t():t(new Error("只能输入自然数！"))}}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,t)=>{I.test(l)?t():t(new Error("只能输入正整数数字！"))}}]},psFlag:!1,selectedProperties:[],curModelBlock:{},porpFlag:!1}),W=l=>{const t={token:k.token,data:{tslName:O.curDeviceModel.name}};le(t).then((async t=>{t&&("0"===t.code?(O.propertyList=t.data,O.propertyList.length>0?(O.curModelBlock=O.propertyList[0],O.curModelBlock.tslName=O.curDeviceModel.name,console.log("getDeviceModelBlock -> ctxData.curModelBlock",O.curModelBlock),O.porpFlag=!0):O.porpFlag=!1,1===l&&e({type:"success",message:"刷新成功！"})):ge(t),await N((()=>{O.tableMaxHeight=U.value.clientHeight-34-22-82,2===l&&ye(O.curModelBlock)})))}))};W(2);const Y=X((()=>(console.log("ctxData.propertyList ->",O.propertyList),O.propertyList.filter((e=>{var l=!O.deviceModelBlock,t=e.name.toLowerCase().includes(O.deviceModelBlock.toLowerCase());return l||t})).slice((O.currentPage-1)*O.pagesize,O.currentPage*O.pagesize)))),G=X((()=>O.propertyList.filter((e=>{var l=!O.deviceModelBlock,t=e.name.toLowerCase().includes(O.deviceModelBlock.toLowerCase());return l||t})))),K=e=>{O.currentPage=e},Q=e=>{O.pagesize=e},$=()=>{Z.value&&Z.value.submit()},J=e=>{},Z=M(null),ee=e=>{Z.value.clearFiles();const l=e[0];Z.value.handleStart(l)},se=l=>{console.log("beforeUpload -> file",l);let t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(t){if(t){let t=new FormData;t.append("name",O.curDeviceModel.name),t.append("fileName",l);const a={token:k.token,contentType:"multipart/form-data",data:t};re(a).then((l=>{"0"===l.code?(e.success(l.message),O.psFlag=!1,W()):ge(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ne=()=>{O.psFlag=!1,uploadRef.value.clearFiles()},ie=()=>{ne()},pe=e=>{O.pFlag=!0,O.pTitle="编辑属性",O.blockForm.name=e.name,O.blockForm.label=e.label,O.blockForm.blockRulerId=e.blockRulerId,O.blockForm.blockRead=e.blockRead},ce=M(null),ue=()=>{O.pFlag=!1,ce.value.resetFields(),be()},me=e=>{ue()},fe=e=>{O.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},be=()=>{O.blockForm={name:"",label:"",blockRulerId:"",blockRead:0}},ye=e=>{O.curModelBlock=e,O.curModelBlock.tslName=O.curDeviceModel.name},ge=l=>{e({type:"error",message:l.message})},he=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(u,g)=>{const h=l,M=t,C=b,X=r,N=a,I=D("Icon"),le=o,re=d,be=s,ve=n,ke=p,_e=c,Fe=m,xe=f;return V(),A("div",Be,[L("div",Se,[L("div",Re,[L("div",Pe,[B(M,{type:"primary",style:{width:"100%"},plain:"",onClick:g[0]||(g[0]=e=>{y("changeShowFlag")})},{default:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(_))])),_:1}),P(" 返回设备模型 ")])),_:1})]),L("div",ze,[(V(!0),A(j,null,T(v.deviceModelList,((e,l)=>(V(),q(C,{key:"i"+l,shadow:"hover",class:E({"mclc-card":!0,activeModel:e.name==R(O).curDeviceModel.name}),onClick:l=>(e=>{O.curDeviceModel.name!=e.name&&(O.curDeviceModel=e,W())})(e)},{default:S((()=>[L("div",Ne,[L("span",null,z(e.name),1)])])),_:2},1032,["class","onClick"])))),128))])]),L("div",Ie,[L("div",Ue,[L("div",Oe,[L("div",je,[L("div",Te,z(R(O).curDeviceModel.label)+"：命令列表",1)]),L("div",qe,[B(le,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:S((()=>[B(N,{style:{"margin-left":"20px"}},{default:S((()=>[B(X,{style:{width:"200px"},placeholder:"请输入命令名称",modelValue:R(O).deviceModelBlock,"onUpdate:modelValue":g[1]||(g[1]=e=>R(O).deviceModelBlock=e)},{prefix:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(x))])),_:1})])),_:1},8,["modelValue"])])),_:1}),B(N,null,{default:S((()=>[B(M,{type:"primary",plain:"",class:"right-btn",onClick:g[2]||(g[2]=e=>(console.log("importDPS"),void(O.psFlag=!0)))},{default:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(w))])),_:1}),P(" 导入命令 ")])),_:1})])),_:1}),B(N,null,{default:S((()=>[B(M,{type:"primary",plain:"",class:"right-btn",onClick:g[3]||(g[3]=e=>(()=>{console.log("exportDPS");const e={token:k.token,responseType:"blob",data:{name:O.curDeviceModel.name}};de(e).then((e=>{if(e&&"1"===e.code)return void ge(e);const l=new Blob([e.blob]),t=e.fileName,a=document.createElement("a");a.download=t,a.style.display="none",a.href=URL.createObjectURL(l),document.body.appendChild(a),a.click(),URL.revokeObjectURL(a.href),document.body.removeChild(a)}))})())},{default:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(F))])),_:1}),P(" 导出命令 ")])),_:1})])),_:1}),B(N,null,{default:S((()=>[B(M,{type:"primary",bg:"",class:"right-btn",onClick:g[4]||(g[4]=e=>(console.log("addDeviceModelBlock"),O.pFlag=!0,void(O.pTitle="添加属性")))},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(I,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),P(" 添加 ")])),_:1})])),_:1}),B(N,null,{default:S((()=>[B(M,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:g[5]||(g[5]=e=>{W(1)})},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(I,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),P(" 刷新 ")])),_:1})])),_:1}),B(N,null,{default:S((()=>[B(M,{type:"danger",bg:"",class:"right-btn",onClick:g[6]||(g[6]=l=>(l=>{let t=[];0!==O.selectedProperties.length?(O.selectedProperties.forEach((e=>{t.push(e.name)})),console.log("pList",t),i.confirm("确认要删除这些命令吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:k.token,data:{tslName:O.curDeviceModel.name,names:t}};oe(e).then((e=>{he(e,W)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个命令！")})())},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(I,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),P(" 删除 ")])),_:1})])),_:1})])),_:1},512)])]),L("div",{class:"content",ref_key:"contentRef",ref:U},[B(be,{data:R(Y),"cell-style":R(O).cellStyle,"header-cell-style":R(O).headerCellStyle,style:{width:"100%"},"max-height":R(O).tableMaxHeight,stripe:"",onSelectionChange:fe,onRowDblclick:pe},{empty:S((()=>[He])),default:S((()=>[B(re,{type:"selection",width:"55"}),B(re,{sortable:"",prop:"name",label:"命令名称",width:"auto","min-width":"150",align:"center"}),B(re,{sortable:"",prop:"label",label:"命令标签",width:"auto","min-width":"150",align:"center"}),B(re,{sortable:"",prop:"blockRulerId",label:"块数据标识",width:"auto","min-width":"120",align:"center"}),B(re,{sortable:"",label:"块读取开关",width:"auto","min-width":"100",align:"center"},{default:S((e=>[P(z(R(O).SWNames["SW"+e.row.blockRead]),1)])),_:1}),B(re,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:S((e=>[B(M,{onClick:l=>pe(e.row),text:"",type:"primary"},{default:S((()=>[P("编辑")])),_:2},1032,["onClick"]),B(M,{onClick:l=>ye(e.row,2),text:"",type:"success"},{default:S((()=>[P("命令参数详情")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",Ee,[B(ve,{"current-page":R(O).currentPage,"page-size":R(O).pagesize,"page-sizes":[20,50,200,500],total:R(G).length,onCurrentChange:K,onSizeChange:Q,background:"",layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])],512)]),R(O).porpFlag?(V(),A("div",We,[B(Ae,{curModelBlock:R(O).curModelBlock},null,8,["curModelBlock"])])):H("",!0)]),B(Fe,{modelValue:R(O).pFlag,"onUpdate:modelValue":g[13]||(g[13]=e=>R(O).pFlag=e),title:R(O).pTitle,width:"600px","before-close":me,"close-on-click-modal":!1},{footer:S((()=>[L("span",Ge,[B(M,{onClick:g[11]||(g[11]=e=>ue())},{default:S((()=>[P("取消")])),_:1}),B(M,{type:"primary",onClick:g[12]||(g[12]=e=>{ce.value.validate((e=>{if(!e)return!1;{const e={token:k.token,data:{tslName:O.curDeviceModel.name,name:O.blockForm.name,label:O.blockForm.label,blockRulerId:O.blockForm.blockRulerId,blockRead:O.blockForm.blockRead}};O.pTitle.includes("添加")?te(e).then((e=>{he(e,W),ue()})):ae(e).then((l=>{console.log("----GWAI----"),console.log(e),he(l,W),ue()}))}}))})},{default:S((()=>[P("保存")])),_:1})])])),default:S((()=>[L("div",Ye,[B(le,{model:R(O).blockForm,rules:R(O).propertyRules,ref_key:"blockFormRef",ref:ce,"status-icon":"","label-position":"right","label-width":"120px"},{default:S((()=>[B(N,{label:"块名称",prop:"name"},{default:S((()=>[B(X,{disabled:R(O).pTitle.includes("编辑"),type:"text",modelValue:R(O).blockForm.name,"onUpdate:modelValue":g[7]||(g[7]=e=>R(O).blockForm.name=e),autocomplete:"off",placeholder:"请输入块名称"},null,8,["disabled","modelValue"])])),_:1}),B(N,{label:"块标签",prop:"label"},{default:S((()=>[B(X,{type:"text",modelValue:R(O).blockForm.label,"onUpdate:modelValue":g[8]||(g[8]=e=>R(O).blockForm.label=e),autocomplete:"off",placeholder:"请输入块标签"},null,8,["modelValue"])])),_:1}),B(N,{label:"块数据标识",prop:"blockRulerId"},{default:S((()=>[B(X,{type:"text",modelValue:R(O).blockForm.blockRulerId,"onUpdate:modelValue":g[9]||(g[9]=e=>R(O).blockForm.blockRulerId=e),placeholder:"请输入块数据标识"},null,8,["modelValue"])])),_:1}),B(N,{label:"块读取开关",prop:"blockRead"},{default:S((()=>[B(_e,{modelValue:R(O).blockForm.blockRead,"onUpdate:modelValue":g[10]||(g[10]=e=>R(O).blockForm.blockRead=e),style:{width:"100%"},placeholder:"请选择是否打开块读取"},{default:S((()=>[(V(!0),A(j,null,T(R(O).BlockReadSw,(e=>(V(),q(ke,{key:"SW"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),B(Fe,{modelValue:R(O).psFlag,"onUpdate:modelValue":g[14]||(g[14]=e=>R(O).psFlag=e),title:"导入命令",width:"600px","before-close":ie,"close-on-click-modal":!1},{footer:S((()=>[L("span",Qe,[B(M,{onClick:ne},{default:S((()=>[P("取消")])),_:1}),B(M,{type:"primary",onClick:$},{default:S((()=>[P("上传")])),_:1})])])),default:S((()=>[B(xe,{ref_key:"uploadDPSRef",ref:Z,action:"","auto-upload":!1,"http-request":J,limit:1,"on-exceed":ee,"before-upload":se},{tip:S((()=>[Ke])),default:S((()=>[B(M,{type:"primary"},{default:S((()=>[P("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-04282f20"]]);const Je={class:"main-container"},Ze={key:0,class:"main"},el={class:"search-bar"},ll={class:"tool-bar"},tl=(e=>(I("data-v-46170bfd"),e=e(),U(),e))((()=>L("div",null,"无数据",-1))),al={class:"pagination"},ol={class:"dialog-content"},rl={class:"dialog-footer"};var dl=y({__name:"DeviceModelD07",setup(p){const c=g(),u=M(null),f=C({typeModel:3,showFlag:0,headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceModelInfo:"",tableData:[],modelForm:{name:"",label:"",type:0,param:""},modelRules:{name:[{required:!0,message:"采集模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"采集模型标识不能为空",trigger:"blur"}],param:[{required:!0,message:"采集模型插件不能为空",trigger:"blur"}]},udFlag:!1,dmFlag:!1,dmTitle:"添加采集模型",pluginList:[],curDeviceModel:""}),b=l=>{const t={token:c.token,data:{type:f.typeModel}};k.getDeviceModelList(t).then((async t=>{t&&("0"===t.code?(f.tableData=t.data,1===l&&e({type:"success",message:"刷新成功！"})):T(t),await N((()=>{f.tableMaxHeight=u.value.clientHeight-34-36-22})))}))};b();const y=X((()=>f.tableData.filter((e=>{var l=!f.deviceModelInfo,t=e.name.toLowerCase().includes(f.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(f.deviceModelInfo.toLowerCase());return l||t})).slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize))),v=X((()=>f.tableData.filter((e=>{var l=!f.deviceModelInfo,t=e.name.toLowerCase().includes(f.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(f.deviceModelInfo.toLowerCase());return l||t})))),_=e=>{f.currentPage=e},F=e=>{f.pagesize=e},w=e=>{f.dmFlag=!0,f.dmTitle="编辑采集模型",f.modelForm={name:e.name,label:e.label,type:void 0===e.type?0:e.type,param:e.param}},z=M(null),I=()=>{f.dmFlag=!1,z.value.resetFields(),O()},U=()=>{I()},O=()=>{f.modelForm={name:"",label:"",type:0}},j=()=>{f.showFlag=0},T=l=>{e({type:"error",message:l.message})},E=(l,t)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&t&&t()};return(p,g)=>{const h=l,M=r,C=a,X=D("Icon"),N=t,O=o,T=d,W=s,Y=n,G=m;return V(),A("div",Je,[0===R(f).showFlag?(V(),A("div",Ze,[L("div",el,[B(O,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:S((()=>[B(C,{label:"采集模型名称"},{default:S((()=>[B(M,{style:{width:"200px"},placeholder:"请输入采集模型名称",modelValue:R(f).deviceModelInfo,"onUpdate:modelValue":g[0]||(g[0]=e=>R(f).deviceModelInfo=e)},{prefix:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(x))])),_:1})])),_:1},8,["modelValue"])])),_:1}),B(C,null,{default:S((()=>[B(N,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:g[1]||(g[1]=e=>{b(1)})},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(X,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),P(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),L("div",ll,[B(N,{type:"primary",bg:"",class:"right-btn",onClick:g[2]||(g[2]=e=>(f.dmFlag=!0,void(f.dmTitle="添加采集模型")))},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(X,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),P(" 添加 ")])),_:1})]),L("div",{class:"content",ref_key:"contentRef",ref:u},[B(W,{data:R(y),"cell-style":R(f).cellStyle,"header-cell-style":R(f).headerCellStyle,"max-height":R(f).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:w},{empty:S((()=>[tl])),default:S((()=>[B(T,{sortable:"",prop:"name",label:"采集模型名称",width:"auto","min-width":"200",align:"center"}),B(T,{sortable:"",prop:"label",label:"采集模型标签",width:"auto","min-width":"200",align:"center"}),B(T,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:S((l=>[B(N,{onClick:e=>{return t=l.row,f.curDeviceModel=t,void(f.showFlag=1);var t},text:"",type:"success"},{default:S((()=>[P("变量详情")])),_:2},1032,["onClick"]),B(N,{onClick:e=>{return t=l.row,f.curDeviceModel=t,void(f.showFlag=2);var t},text:"",type:"success"},{default:S((()=>[P("命令详情")])),_:2},1032,["onClick"]),B(N,{onClick:e=>w(l.row),text:"",type:"primary"},{default:S((()=>[P("编辑")])),_:2},1032,["onClick"]),B(N,{onClick:t=>{return a=l.row,void i.confirm("确定要删除这个采集模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:c.token,data:{name:a.name,type:3}};k.deleteDeviceModel(e).then((e=>{E(e,b)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var a},text:"",type:"danger"},{default:S((()=>[P("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",al,[B(Y,{"current-page":R(f).currentPage,"page-size":R(f).pagesize,"page-sizes":[20,50,200,500],total:R(v).length,onCurrentChange:_,onSizeChange:F,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):H("",!0),1===R(f).showFlag?(V(),q(ee,{key:1,curDeviceModel:R(f).curDeviceModel,onChangeShowFlag:g[3]||(g[3]=e=>j()),style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel"])):H("",!0),2===R(f).showFlag?(V(),q($e,{key:2,curDeviceModel:R(f).curDeviceModel,deviceModelList:R(f).tableData,onChangeShowFlag:g[4]||(g[4]=e=>j()),style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel","deviceModelList"])):H("",!0),B(G,{modelValue:R(f).dmFlag,"onUpdate:modelValue":g[9]||(g[9]=e=>R(f).dmFlag=e),title:R(f).dmTitle,width:"600px","before-close":U,"close-on-click-modal":!1},{footer:S((()=>[L("span",rl,[B(N,{onClick:g[7]||(g[7]=e=>I())},{default:S((()=>[P("取消")])),_:1}),B(N,{type:"primary",onClick:g[8]||(g[8]=e=>{z.value.validate((e=>{if(!e)return!1;{f.modelForm.type=f.typeModel;const e={token:c.token,data:f.modelForm};f.dmTitle.includes("添加")?k.addDeviceModel(e).then((e=>{E(e,b),I()})):k.editDeviceModel(e).then((e=>{E(e,b),I()}))}}))})},{default:S((()=>[P("保存")])),_:1})])])),default:S((()=>[L("div",ol,[B(O,{model:R(f).modelForm,rules:R(f).modelRules,ref_key:"modelFormRef",ref:z,"status-icon":"","label-position":"right","label-width":"120px"},{default:S((()=>[B(C,{label:"采集模型名称",prop:"name"},{default:S((()=>[B(M,{type:"text",disabled:R(f).dmTitle.includes("编辑"),modelValue:R(f).modelForm.name,"onUpdate:modelValue":g[5]||(g[5]=e=>R(f).modelForm.name=e),autocomplete:"off",placeholder:"请输入采集模型名称"},null,8,["disabled","modelValue"])])),_:1}),B(C,{label:"采集模型标签",prop:"label"},{default:S((()=>[B(M,{type:"text",modelValue:R(f).modelForm.label,"onUpdate:modelValue":g[6]||(g[6]=e=>R(f).modelForm.label=e),autocomplete:"off",placeholder:"请输入采集模型标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-46170bfd"]]);export{dl as default};
