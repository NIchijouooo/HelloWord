import{e,m as a,n as t,p as l,o,A as r,C as i,D as n,v as c,w as s,q as m,g as d,L as f}from"./element-plus.64650d13.js";import{_ as p,u,v as g}from"./index.98f42e56.js";import{I as h}from"./interface.c4e57716.js";import{C as b}from"./commInterface.14cd79b4.js";import{Y as y,f as N,p as I,X as v,o as w,c as _,a as C,S as T,Q as x,u as F,M as j,af as k,a0 as P,at as L,au as V,H as U,P as z}from"./@vue.5db09832.js";import"./@vueuse.af8df401.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./@element-plus.aa3ef65f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./vue-router.d969f71f.js";import"./pinia.69c74452.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./vue-echarts.8f00425b.js";import"./resize-detector.4e96b72b.js";import"./echarts.62a08783.js";import"./zrender.56caf4f2.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const D=e=>(L("data-v-7682023c"),e=e(),V(),e),S={class:"main-container"},M={class:"main"},R={class:"search-bar"},A=P(" 刷新 "),B={class:"tool-bar"},q=P(" 添加 "),H=P("编辑"),O=P("删除"),E=D((()=>C("div",null,"无数据",-1))),W={class:"pagination"},G={class:"dialog-content"},Q=P("单位秒"),X=P("单位次"),Y={class:"dialog-footer"},J=P("取消"),K=P("保存");var Z=p({setup(p){const P=u(),L=y({interfaceName:"",checkAll:!0,headerCellStyle:{background:g.primaryColor,color:g.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,interfaceTableData:[],iFlag:!1,iTitle:"添加采集接口",interfaceForm:{collInterfaceName:"",commInterfaceName:"",protocolTypeName:"",pollPeriod:0,offlinePeriod:0},interfaceRules:{collInterfaceName:[{required:!0,message:"采集接口不能为空",trigger:"blur"}],commInterfaceName:[{required:!0,message:"通讯接口不能为空",trigger:"blur"}],pollPeriod:[{required:!0,message:"采集周期不能为空",trigger:"blur"},{type:"number",message:"采集周期只能输入数字"}],offlinePeriod:[{required:!0,message:"离线判断次数不能为空",trigger:"blur"},{type:"number",message:"离线判断次数只能输入数字"}]},commInterfaceList:[],protocolTypeNameList:[{name:"NULL",label:"NULL"},{name:"LUA",label:"LUA"},{name:"DLT645-2007",label:"DLT645-2007"},{name:"MODBUS-RTU",label:"MODBUS-RTU"},{name:"MODBUS-TCP",label:"MODBUS-TCP"}]}),V=N(null),D=e=>{const a={token:P.token,data:{}};h.getInterfaceList(a).then((async a=>{console.log("getInterfaceList -> res",a),a&&("0"===a.code?(L.interfaceTableData=a.data,L.interfaceTableData.forEach((e=>{e.protocolTypeName||(e.protocolTypeName=L.protocolTypeNameList[0].name)})),1===e&&d({type:"success",message:"刷新成功！"})):re(a),await U((()=>{L.tableMaxHeight=V.value.clientHeight-34-36-22})))}))};D();const Z=I((()=>L.interfaceTableData.filter((e=>{var a=!L.interfaceName,t=e.collInterfaceName.toLowerCase().includes(L.interfaceName.toLowerCase());return a||t})).slice((L.currentPage-1)*L.pagesize,L.currentPage*L.pagesize))),$=I((()=>L.interfaceTableData.filter((e=>{var a=!L.interfaceName,t=e.collInterfaceName.toLowerCase().includes(L.interfaceName.toLowerCase());return a||t}))));(()=>{const e={token:P.token,data:{}};b.getCommInterfaceList(e).then((e=>{e&&(console.log("getCommInterfaceList -> res",e),"0"===e.code?L.commInterfaceList=e.data:re(e))}))})();const ee=e=>{L.iFlag=!0,L.iTitle="编辑采集接口",L.interfaceForm.collInterfaceName=e.collInterfaceName,L.interfaceForm.commInterfaceName=e.commInterfaceName,L.interfaceForm.protocolTypeName=e.protocolTypeName,L.interfaceForm.pollPeriod=e.pollPeriod,L.interfaceForm.offlinePeriod=e.offlinePeriod},ae=N(null),te=()=>{L.iFlag=!1,ae.value.resetFields(),oe()},le=e=>{te()},oe=()=>{L.interfaceForm={collInterfaceName:"",commInterfaceName:"",protocolTypeName:"",pollPeriod:0,offlinePeriod:0}},re=e=>{d({type:"error",message:e.message})},ie=(e,a)=>{d({type:"0"===e.code?"success":"1"===e.code?"error":"warning",message:e.message}),"0"===e.code&&a&&a()};return(p,u)=>{const g=v("search"),b=e,y=a,N=t,I=v("Icon"),U=l,oe=o,re=r,ne=i,ce=n,se=c,me=s,de=m;return w(),_("div",S,[C("div",M,[C("div",R,[T(oe,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:x((()=>[T(N,{label:"采集接口名称"},{default:x((()=>[T(y,{style:{width:"200px"},placeholder:"请输入采集接口名称",modelValue:F(L).interfaceName,"onUpdate:modelValue":u[0]||(u[0]=e=>F(L).interfaceName=e)},{prefix:x((()=>[T(b,{class:"el-input__icon"},{default:x((()=>[T(g)])),_:1})])),_:1},8,["modelValue"])])),_:1}),T(N,null,{default:x((()=>[T(U,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:u[1]||(u[1]=e=>{D(1)})},{default:x((()=>[T(b,{class:"btn-icon"},{default:x((()=>[T(I,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),A])),_:1})])),_:1})])),_:1},512)]),C("div",B,[T(U,{type:"primary",bg:"",class:"right-btn",onClick:u[2]||(u[2]=e=>(L.iFlag=!0,void(L.iTitle="添加采集接口")))},{default:x((()=>[T(b,{class:"btn-icon"},{default:x((()=>[T(I,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),q])),_:1})]),C("div",{class:"content",ref_key:"contentRef",ref:V},[T(ne,{data:F(Z),"cell-style":F(L).cellStyle,"header-cell-style":F(L).headerCellStyle,"max-height":F(L).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:ee},{empty:x((()=>[E])),default:x((()=>[T(re,{prop:"collInterfaceName",label:"采集接口名称",width:"auto","min-width":"150",align:"center"}),T(re,{prop:"commInterfaceName",label:"通讯接口",width:"auto","min-width":"150",align:"center"}),T(re,{prop:"protocolTypeName",label:"通讯协议",width:"auto","min-width":"150",align:"center"}),T(re,{prop:"pollPeriod",label:"采集周期(秒)",width:"auto","min-width":"150",align:"center"}),T(re,{prop:"offlinePeriod",label:"离线判断次数",width:"auto","min-width":"150",align:"center"}),T(re,{prop:"deviceNodeCnt",label:"设备总数",width:"auto","min-width":"150",align:"center"}),T(re,{prop:"deviceNodeOnlineCnt",label:"设备在线数",width:"auto","min-width":"150",align:"center"}),T(re,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:x((e=>[T(U,{onClick:a=>ee(e.row),text:"",type:"primary"},{default:x((()=>[H])),_:2},1032,["onClick"]),T(U,{onClick:a=>{return t=e.row,void f.confirm("确定要删除这个采集接口吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:P.token,data:{name:t.collInterfaceName}};h.deleteInterface(e).then((e=>{ie(e,D)}))})).catch((()=>{d({type:"info",message:"取消删除"})}));var t},text:"",type:"danger"},{default:x((()=>[O])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),C("div",W,[T(ce,{"current-page":F(L).currentPage,"page-size":F(L).pagesize,"page-sizes":[20,50,200,500],total:F($).length,onCurrentChange:p.handleCurrentChange,onSizeChange:p.handleSizeChange,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])])],512)]),T(de,{modelValue:F(L).iFlag,"onUpdate:modelValue":u[10]||(u[10]=e=>F(L).iFlag=e),title:F(L).iTitle,width:"600px","before-close":le,"close-on-click-modal":!1},{footer:x((()=>[C("span",Y,[T(U,{onClick:u[8]||(u[8]=e=>te())},{default:x((()=>[J])),_:1}),T(U,{type:"primary",onClick:u[9]||(u[9]=e=>{ae.value.validate((e=>{if(!e)return!1;{const e={token:P.token,data:L.interfaceForm};L.iTitle.includes("添加")?h.addInterface(e).then((e=>{ie(e,D),te()})):h.editInterface(e).then((e=>{ie(e,D),te()}))}}))})},{default:x((()=>[K])),_:1})])])),default:x((()=>[C("div",G,[T(oe,{model:F(L).interfaceForm,rules:F(L).interfaceRules,ref_key:"interfaceFormRef",ref:ae,"status-icon":"","label-position":"right","label-width":"120px"},{default:x((()=>[T(N,{label:"采集接口名称",prop:"collInterfaceName"},{default:x((()=>[T(y,{disabled:F(L).iTitle.includes("编辑"),type:"text",modelValue:F(L).interfaceForm.collInterfaceName,"onUpdate:modelValue":u[3]||(u[3]=e=>F(L).interfaceForm.collInterfaceName=e),autocomplete:"off",placeholder:"请输入采集接口名称"},null,8,["disabled","modelValue"])])),_:1}),T(N,{label:"通讯接口名称",prop:"commInterfaceName"},{default:x((()=>[T(me,{modelValue:F(L).interfaceForm.commInterfaceName,"onUpdate:modelValue":u[4]||(u[4]=e=>F(L).interfaceForm.commInterfaceName=e),style:{width:"100%"},placeholder:"请选择通讯接口名称"},{default:x((()=>[(w(!0),_(j,null,k(F(L).commInterfaceList,((e,a)=>(w(),z(se,{key:"comm_"+a,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(N,{label:"通讯协议",prop:"protocolTypeName"},{default:x((()=>[T(me,{modelValue:F(L).interfaceForm.protocolTypeName,"onUpdate:modelValue":u[5]||(u[5]=e=>F(L).interfaceForm.protocolTypeName=e),style:{width:"100%"},placeholder:"请选择通讯协议(GWAI ADD 2023-05-10)"},{default:x((()=>[(w(!0),_(j,null,k(F(L).protocolTypeNameList,(e=>(w(),z(se,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(N,{label:"采集周期",prop:"pollPeriod"},{default:x((()=>[T(y,{type:"text",modelValue:F(L).interfaceForm.pollPeriod,"onUpdate:modelValue":u[6]||(u[6]=e=>F(L).interfaceForm.pollPeriod=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入采集周期"},{append:x((()=>[Q])),_:1},8,["modelValue"])])),_:1}),T(N,{label:"离线判断次数",prop:"offlinePeriod"},{default:x((()=>[T(y,{type:"text",modelValue:F(L).interfaceForm.offlinePeriod,"onUpdate:modelValue":u[7]||(u[7]=e=>F(L).interfaceForm.offlinePeriod=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入离线判断次数"},{append:x((()=>[X])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-7682023c"]]);export{Z as default};
