import{P as e,g as a,L as l,e as t,p as o,n as r,o as d,m as n,A as i,C as c,D as s,u as p,y as u,q as m,w as g,M as y,x as f,v as b,K as v,N as w}from"./element-plus.2c9426ce.js";import{J as h,r as F,j as _,w as N,ae as C,o as k,c as V,a as S,O as T,R as x,u as D,V as R,W as I,P as M,aj as L,S as A,X as U,n as P,L as j,av as z,aw as B,_ as q,$ as G}from"./@vue.2c474d7f.js";import{_ as K,u as E,v as O}from"./index.9c81e799.js";import{S as Q}from"./service.27dd2a72.js";import{u as H}from"./vue-router.3b7aa6c5.js";import{I as J}from"./interface.75dfa0d7.js";import{T as Y}from"./transferModel.eb45dd38.js";import{b as W,h as $,i as X,d as Z}from"./@element-plus.e895b9e1.js";import{D as ee}from"./deviceModel.d6fadd82.js";import{P as ae}from"./product.9e96cedd.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.d618444d.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./pinia.39330980.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.ebbe6a42.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const le=e=>(z("data-v-48f96635"),e=e(),B(),e),te={class:"main-container"},oe={class:"main"},re={class:"search-bar"},de={class:"search-bar",style:{display:"flex"}},ne={class:"title",style:{position:"relative","margin-right":"40px",height:"40px",padding:"0px 0","justify-content":"flex-start"}},ie={class:"tName"},ce={class:"param-content"},se={class:"pc-title"},pe={class:"pct-info"},ue={class:"pc-content"},me={class:"param-value"},ge={class:"param-name"},ye=le((()=>S("div",null,"无数据",-1))),fe={class:"pagination"},be={class:"dialog-content"},ve={class:"dialog-cLeft"},we=le((()=>S("div",{class:"card-header"},[S("span",null,"请选择采集设备")],-1))),he={class:"card-main"},Fe={class:"dialog-cRight"},_e=le((()=>S("div",{class:"card-header"},[S("span",null,"请选择一个上报模型")],-1))),Ne={class:"card-main"},Ce={class:"upload-item-text"},ke={class:"dialog-footer"},Ve={class:"dialog-content"},Se={class:"dialog-footer"},Te=le((()=>S("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),xe={class:"dialog-footer"};var De=K({__name:"NodeService",props:{curGateway:{type:Object,default:{}},pageInfo:String},emits:["changeDnFlag"],setup(v,{emit:w}){const z=v,B=E();console.log("id -> props",z);const q=h({headerCellStyle:{background:O.primaryColor,color:O.fontWhiteColor,height:"54px"},paramName:{ProductKey:"产品密钥",DeviceID:"通讯地址",DeviceSecret:"设备密钥"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,nodeTableData:[],dFlag:!1,dTitle:"添加设备",nodeInfo:"",nodeForm:{serviceName:"",collInterfaceName:"",deviceName:"",uploadModel:"",deviceAddr:"",protocol:"",deviceCode:"",productKey:"",deviceID:"",deviceSecret:""},nodeRules:{serviceName:[{required:!0,trigger:"blur"}],collInterfaceName:[{required:!0,trigger:"blur"}],deviceName:[{required:!0,trigger:"blur"}],deviceAddr:[{required:!0,trigger:"blur"}],protocol:[{required:!0,trigger:"blur"}],uploadModel:[{required:!0,message:"上报模型不能为空",trigger:"blur"}],deviceCode:[{required:!0,message:"通讯编码不能为空",trigger:"blur"}],productKey:[{required:!0,message:"产品密钥不能为空",trigger:"blur"}],deviceID:[{required:!0,message:"产品密钥不能为空",trigger:"blur"}],deviceSecret:[{required:!0,message:"产品密钥不能为空",trigger:"blur"}]},nodeModelList:[],selectedNodes:[],dpFlag:!0,interfaceList:[],nFlag:!1,treeProps:{children:"children",label:"label",isLeaf:"leaf"},deviceList:[],interfaceNames:[],uFlag:!1,filterText:"",transferModelList:[],curModelName:""}),G=e=>{const l={token:B.token,data:{serviceName:z.curGateway.serviceName}};Q.getDeviceByServiceIdList(l).then((async l=>{console.log("getDeviceByServiceIdList -> res ",l),l&&("0"===l.code?(q.nodeTableData=l.data,1===e&&a({type:"success",message:"刷新成功！"})):He(l),await P((()=>{q.tableMaxHeight=K.value.clientHeight-34-36-132})))}))};G();const K=F(null);(()=>{const e={token:B.token,data:{}};J.getInterfaceList(e).then((e=>{console.log("getInterfaceList -> res",e),"0"===e.code?(q.interfaceList=[],q.interfaceNames=[],e.data.forEach((e=>{const a={label:e.collInterfaceName,name:e.collInterfaceName,hasChildren:!0};q.interfaceList.push(a),q.interfaceNames.push(e.collInterfaceName)}))):He(e)}))})();const H=e=>{q.selectedNodes=e},ee=e=>{q.currentPage=e},ae=_((()=>{let e=q.nodeInfo;return q.nodeTableData.filter((a=>!e||a.deviceName.toLowerCase().includes(e.toLowerCase())||a.deviceAddr.toLowerCase().includes(e.toLowerCase()))).slice((q.currentPage-1)*q.pagesize,q.currentPage*q.pagesize)})),le=_((()=>{let e=q.nodeInfo;return q.nodeTableData.filter((a=>!e||a.deviceName.toLowerCase().includes(e.toLowerCase())||a.deviceAddr.toLowerCase().includes(e.toLowerCase())))})),De=e=>{q.pagesize=e},Re=(e,a)=>(console.log("loadNode-> node === ",e),0===e.level?a(q.interfaceList):1!==e.level?a([]):(console.log("node->",e),void Ie(e.data.name).then((async l=>(console.log("getCollDevices -> res",l),"0"===l.code?(q.deviceList=[],l.data.deviceNodeMap&&l.data.deviceNodeMap.forEach((a=>{const l={label:a.label,name:a.name,addr:a.addr,collName:e.data.name,hasChildren:!1};q.deviceList.push(l)})),console.log("node->ctxData.deviceList",q.deviceList),a(q.deviceList)):(He(l),a([]))))))),Ie=e=>{const a={token:B.token,data:{name:e}};return J.getCollDevices(a)};(e=>{const a={token:B.token,data:{}};Y.getModelList(a).then((e=>{console.log("getModelList -> res",e),"0"===e.code?q.transferModelList=e.data:He(e)}))})();const Me=F(null);N((()=>q.filterText),(e=>{Me.value&&Me.value.filter(e)}));const Le=(e,a)=>(console.log("filterNode value",e),!e||a.label.includes(e)),Ae=()=>{q.nFlag=!1},Ue=e=>{q.dFlag=!0,q.dTitle="编辑设备",q.nodeForm={serviceName:e.serviceName,collInterfaceName:e.collInterfaceName,deviceName:e.deviceName,deviceLabel:e.deviceLabel,uploadModel:e.uploadModel,deviceAddr:e.deviceAddr,protocol:e.protocol,deviceCode:""===e.param.deviceCode?e.deviceAddr:e.param.deviceCode},q.nodeForm.productKey=e.param.ProductKey,q.nodeForm.deviceID=e.param.DeviceID,q.nodeForm.deviceSecret=e.param.DeviceSecret},Pe=F(null),je=()=>{q.dFlag=!1,Pe.value.resetFields()},ze=e=>{je()},Be=()=>{Ge.value&&Ge.value.submit()},qe=e=>{},Ge=F(null),Ke=e=>{Ge.value.clearFiles();const a=e[0];Ge.value.handleStart(a)},Ee=e=>{console.log("beforeUpload -> file",e);let l=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.type)||""!=e.name&&e.name.indexOf("xlsx")>-1;if(l){if(l){let l=new FormData;l.append("file",e);const t={token:B.token,contentType:"multipart/form-data",data:l};Q.addDeviceFromCSV(t).then((e=>{"0"===e.code?(a.success(e.message),q.uFlag=!1,G()):He(e)}))}}else a({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},Oe=()=>{q.uFlag=!1,Ge.value.clearFiles()},Qe=()=>{Oe()},He=e=>{a({type:"error",message:e.message})},Je=()=>{const e={token:B.token,responseType:"blob",data:{serviceName:z.curGateway.serviceName}};Q.exportDevice(e).then((e=>{if(console.log("exportDevice -> res",e),e&&"1"===e.code)return void He(e);const a=new Blob([e.blob]),l=e.fileName,t=document.createElement("a");t.download=l,t.style.display="none",t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))},Ye=(e,l)=>{a({type:"0"===e.code?"success":"error",message:e.message}),"0"===e.code&&l&&l()};return(v,h)=>{const F=t,_=o,N=r,P=d,E=n,O=C("Icon"),J=i,Ie=c,We=s,$e=e,Xe=p,Ze=f,ea=u,aa=m,la=b,ta=g,oa=y;return k(),V("div",te,[S("div",oe,[S("div",re,[T(P,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:x((()=>[T(N,{style:{"margin-left":"20px"}},{default:x((()=>[T(_,{type:"primary",plain:"",onClick:h[0]||(h[0]=e=>{w("changeDnFlag","goBack")}),style:{"margin-right":"20px"}},{default:x((()=>[T(F,{class:"el-input__icon"},{default:x((()=>[T(D(W))])),_:1}),R(" 返回上报服务 ")])),_:1})])),_:1}),T(N,null,{default:x((()=>[T(_,{type:"primary",plain:"",class:"right-btn",onClick:h[1]||(h[1]=e=>{q.uFlag=!0})},{default:x((()=>[T(F,{class:"el-input__icon"},{default:x((()=>[T(D($))])),_:1}),R(" 导入设备 ")])),_:1})])),_:1}),T(N,null,{default:x((()=>[T(_,{type:"primary",plain:"",class:"right-btn",onClick:Je},{default:x((()=>[T(F,{class:"el-input__icon"},{default:x((()=>[T(D(X))])),_:1}),R(" 导出设备 ")])),_:1})])),_:1})])),_:1},512)]),S("div",de,[S("div",ne,[S("div",ie,I(z.curGateway.serviceName),1)]),T(P,{inline:!0,ref:"searchFormRef2","status-icon":"","label-width":"90px"},{default:x((()=>[T(N,{label:""},{default:x((()=>[T(E,{style:{width:"200px"},placeholder:"请输入 地址/名称 过滤",clearable:"",modelValue:D(q).nodeInfo,"onUpdate:modelValue":h[2]||(h[2]=e=>D(q).nodeInfo=e)},{prefix:x((()=>[T(F,{class:"el-input__icon"},{default:x((()=>[T(D(Z))])),_:1})])),_:1},8,["modelValue"])])),_:1}),T(N,null,{default:x((()=>[T(_,{type:"primary",bg:"",class:"right-btn",onClick:h[3]||(h[3]=e=>(()=>{let e=[];if(0===q.selectedNodes.length)return void a.info("请至少选择一个设备！");q.selectedNodes.forEach((a=>{e.push(a.deviceName)}));const l={token:B.token,data:{serviceName:z.curGateway.serviceName,deviceNames:e}};Y.reportNodes(l).then((e=>{"0"===e.code?a.success(e.message):He(e)}))})())},{default:x((()=>[T(F,{class:"btn-icon"},{default:x((()=>[T(O,{name:"local-report",size:"14px",color:"#ffffff"})])),_:1}),R(" 主动上报 ")])),_:1})])),_:1}),T(N,null,{default:x((()=>[T(_,{type:"primary",bg:"",class:"right-btn",onClick:h[4]||(h[4]=e=>{q.nFlag=!0})},{default:x((()=>[T(F,{class:"btn-icon"},{default:x((()=>[T(O,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),R(" 添加 ")])),_:1})])),_:1}),T(N,null,{default:x((()=>[T(_,{type:"danger",bg:"",class:"right-btn",onClick:h[5]||(h[5]=e=>(()=>{let e=[];0!==q.selectedNodes.length?(q.selectedNodes.forEach((a=>{e.push(a.deviceName)})),console.log("dList",e),l.confirm("确定要删除这些吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const a={token:B.token,data:{serviceName:z.curGateway.serviceName,deviceNames:e}};Q.deleteDevice(a).then((e=>{Ye(e,G)}))})).catch((()=>{a({type:"info",message:"取消删除"})}))):a.info("请至少选择一个设备！")})())},{default:x((()=>[T(F,{class:"btn-icon"},{default:x((()=>[T(O,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),R(" 删除 ")])),_:1})])),_:1}),T(N,null,{default:x((()=>[T(_,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:h[6]||(h[6]=e=>{G(1)})},{default:x((()=>[T(F,{class:"btn-icon"},{default:x((()=>[T(O,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),R(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),S("div",{class:"content",ref_key:"contentRef",ref:K,style:{top:"136px"}},[T(Ie,{data:D(ae),"cell-style":D(q).cellStyle,"header-cell-style":D(q).headerCellStyle,"max-height":D(q).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:H,onRowDblclick:Ue},{empty:x((()=>[ye])),default:x((()=>[T(J,{type:"selection",width:"55"}),T(J,{type:"expand"},{default:x((e=>[S("div",ce,[S("div",se,[S("div",pe,[S("b",null,I(e.row.deviceName),1),R(" 上报参数 ")])]),S("div",ue,[(k(!0),V(M,null,L(e.row.param,((e,a,l)=>(k(),V("div",{class:"param-item",key:l},[S("div",me,I(D(q).paramName[a])+"：",1),S("div",ge,I(e||"-"),1)])))),128))])])])),_:1}),T(J,{sortable:"",prop:"deviceName",label:"设备名称",width:"auto","min-width":"180",align:"center"}),T(J,{sortable:"",prop:"deviceLabel",label:"设备标签",width:"auto","min-width":"180",align:"center"}),T(J,{sortable:"",prop:"deviceAddr",label:"通讯地址",width:"auto","min-width":"150",align:"center"}),T(J,{sortable:"",prop:"uploadModel",label:"上报模型",width:"auto","min-width":"150",align:"center"}),T(J,{sortable:"",prop:"collInterfaceName",label:"采集接口名称",width:"auto","min-width":"150",align:"center"}),T(J,{sortable:"",label:"上报状态",width:"auto","min-width":"100",align:"center"},{default:x((e=>[R(I("onLine"===e.row.reportStatus?"在线":"离线"),1)])),_:1}),T(J,{label:"操作",width:"auto","min-width":"120",align:"center",fixed:"right"},{default:x((e=>[T(_,{onClick:a=>Ue(e.row),text:"",type:"primary"},{default:x((()=>[R("编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),S("div",fe,[T(We,{"current-page":D(q).currentPage,"page-size":D(q).pagesize,"page-sizes":[20,50,200,500],total:D(le).length,onCurrentChange:ee,onSizeChange:De,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)]),T(aa,{modelValue:D(q).nFlag,"onUpdate:modelValue":h[11]||(h[11]=e=>D(q).nFlag=e),title:"添加设备",width:"1000px"},{footer:x((()=>[S("span",ke,[T(_,{onClick:h[9]||(h[9]=e=>Ae())},{default:x((()=>[R("取消")])),_:1}),T(_,{type:"primary",onClick:h[10]||(h[10]=e=>(()=>{var e=Me.value.getCheckedNodes();if(e=e.filter((e=>!e.hasChildren)),console.log("checkedNodes => ",e),console.log("props.curGateway => ",z.curGateway),0!==e.length){let l=0,t=0;e.forEach((o=>{if(o.collName){const r={token:B.token,data:{serviceName:z.curGateway.serviceName,collInterfaceName:o.collName,deviceName:o.name,deviceLabel:o.label,deviceAddr:o.addr,protocol:z.curGateway.protocol,uploadModel:q.curModelName,param:{}}};console.log("pData item -> ",o),console.log("pData",r),Q.addDevice(r).then((o=>{l++,console.log("addDevice -> res ",o),"0"!==o.code?He(o):t++,l===e.length&&(a.success("添加"+l+"个设备，成功"+t+"个，失败"+(l-t)+"个。"),G())}))}})),Ae()}else a.info("请先展开节点，获取节点下的子设备数据！")})())},{default:x((()=>[R("添加")])),_:1})])])),default:x((()=>[S("div",be,[S("div",ve,[T(Xe,{class:"card-box",shadow:"hover"},{header:x((()=>[we])),default:x((()=>[S("div",he,[S("div",null,[T(E,{modelValue:D(q).filterText,"onUpdate:modelValue":h[7]||(h[7]=e=>D(q).filterText=e),placeholder:"节点名称过滤"},null,8,["modelValue"])]),T($e,{ref_key:"nodeTreeRef",ref:Me,props:D(q).treeProps,load:Re,"filter-node-method":Le,lazy:"","show-checkbox":""},null,8,["props"])])])),_:1})]),S("div",Fe,[T(Xe,{class:"card-box",shadow:"hover"},{header:x((()=>[_e])),default:x((()=>[S("div",Ne,[T(ea,{modelValue:D(q).curModelName,"onUpdate:modelValue":h[8]||(h[8]=e=>D(q).curModelName=e),style:{width:"100%"}},{default:x((()=>[(k(!0),V(M,null,L(D(q).transferModelList,(e=>(k(),V("div",{class:j(["upload-item",{isClicked:e.isClicked}]),key:"tml"+e.name},[S("div",Ce,[T(Ze,{label:e.name},{default:x((()=>[R(I(e.label+" ("+e.name+")"),1)])),_:2},1032,["label"])])],2)))),128))])),_:1},8,["modelValue"])])])),_:1})])])])),_:1},8,["modelValue"]),T(aa,{modelValue:D(q).dFlag,"onUpdate:modelValue":h[24]||(h[24]=e=>D(q).dFlag=e),title:"编辑设备",width:"600px","before-close":ze,"close-on-click-modal":!1},{footer:x((()=>[S("span",Se,[T(_,{onClick:h[22]||(h[22]=e=>je())},{default:x((()=>[R("取消")])),_:1}),T(_,{type:"primary",onClick:h[23]||(h[23]=e=>{Pe.value.validate((e=>{if(console.log("ctxData.nodeForm",q.nodeForm),!e)return!1;{const e={serviceName:q.nodeForm.serviceName,collInterfaceName:q.nodeForm.collInterfaceName,uploadModel:q.nodeForm.uploadModel,deviceName:q.nodeForm.deviceName,deviceLabel:q.nodeForm.deviceLabel,deviceAddr:q.nodeForm.deviceAddr,protocol:q.nodeForm.protocol,param:{deviceCode:q.nodeForm.deviceCode,productKey:q.nodeForm.productKey,deviceID:q.nodeForm.deviceID,deviceSecret:q.nodeForm.deviceSecret}},a={token:B.token,data:e};Q.editDevice(a).then((e=>{Ye(e,G),je()}))}}))})},{default:x((()=>[R("保存")])),_:1})])])),default:x((()=>[S("div",Ve,[T(P,{model:D(q).nodeForm,rules:D(q).nodeRules,ref_key:"nodeFormRef",ref:Pe,"status-icon":"","label-position":"right","label-width":"120px"},{default:x((()=>[T(N,{label:"服务名称",prop:"serviceName"},{default:x((()=>[T(E,{disabled:"",type:"text",modelValue:D(q).nodeForm.serviceName,"onUpdate:modelValue":h[12]||(h[12]=e=>D(q).nodeForm.serviceName=e),autocomplete:"off",placeholder:"请输入服务名称"},null,8,["modelValue"])])),_:1}),T(N,{label:"采集接口名称",prop:"collInterfaceName"},{default:x((()=>[T(E,{disabled:"",type:"text",modelValue:D(q).nodeForm.collInterfaceName,"onUpdate:modelValue":h[13]||(h[13]=e=>D(q).nodeForm.collInterfaceName=e),autocomplete:"off",placeholder:"请输入采集接口名称"},null,8,["modelValue"])])),_:1}),T(N,{label:"设备名称",prop:"deviceName"},{default:x((()=>[T(E,{disabled:"",type:"text",modelValue:D(q).nodeForm.deviceName,"onUpdate:modelValue":h[14]||(h[14]=e=>D(q).nodeForm.deviceName=e),autocomplete:"off",placeholder:"请输入设备名称"},null,8,["modelValue"])])),_:1}),T(N,{label:"设备地址",prop:"deviceAddr"},{default:x((()=>[T(E,{disabled:"",type:"text",modelValue:D(q).nodeForm.deviceAddr,"onUpdate:modelValue":h[15]||(h[15]=e=>D(q).nodeForm.deviceAddr=e),autocomplete:"off",placeholder:"请输入设备地址"},null,8,["modelValue"])])),_:1}),T(N,{label:"协议名称",prop:"protocol"},{default:x((()=>[T(E,{disabled:"",type:"text",modelValue:D(q).nodeForm.protocol,"onUpdate:modelValue":h[16]||(h[16]=e=>D(q).nodeForm.protocol=e),autocomplete:"off",placeholder:"请输入协议名称"},null,8,["modelValue"])])),_:1}),T(N,{label:"上报模型",prop:"uploadModel"},{default:x((()=>[T(ta,{modelValue:D(q).nodeForm.uploadModel,"onUpdate:modelValue":h[17]||(h[17]=e=>D(q).nodeForm.uploadModel=e),style:{width:"100%"},placeholder:"请选择上报模型"},{default:x((()=>[(k(!0),V(M,null,L(D(q).transferModelList,(e=>(k(),A(la,{key:"model_"+e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"FSJY.MQTT"!=D(q).nodeForm.protocol?(k(),A(N,{key:0,label:"通讯编码",prop:"deviceCode"},{default:x((()=>[T(E,{type:"text",modelValue:D(q).nodeForm.deviceCode,"onUpdate:modelValue":h[18]||(h[18]=e=>D(q).nodeForm.deviceCode=e),autocomplete:"off",placeholder:"请输入通讯编码"},null,8,["modelValue"])])),_:1})):U("",!0),"FSJY.MQTT"==D(q).nodeForm.protocol?(k(),A(N,{key:1,label:"产品密钥",prop:"productKey"},{default:x((()=>[T(E,{type:"text",modelValue:D(q).nodeForm.productKey,"onUpdate:modelValue":h[19]||(h[19]=e=>D(q).nodeForm.productKey=e),autocomplete:"off",placeholder:"请输入网关产品密钥"},null,8,["modelValue"])])),_:1})):U("",!0),"FSJY.MQTT"==D(q).nodeForm.protocol?(k(),A(N,{key:2,label:"通讯地址",prop:"deviceID"},{default:x((()=>[T(E,{type:"text",modelValue:D(q).nodeForm.deviceID,"onUpdate:modelValue":h[20]||(h[20]=e=>D(q).nodeForm.deviceID=e),autocomplete:"off",placeholder:"请输入网关通讯地址"},null,8,["modelValue"])])),_:1})):U("",!0),"FSJY.MQTT"==D(q).nodeForm.protocol?(k(),A(N,{key:3,label:"设备密钥",prop:"deviceSecret"},{default:x((()=>[T(E,{type:"text",modelValue:D(q).nodeForm.deviceSecret,"onUpdate:modelValue":h[21]||(h[21]=e=>D(q).nodeForm.deviceSecret=e),autocomplete:"off",placeholder:"请输入网关设备密钥"},null,8,["modelValue"])])),_:1})):U("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue"]),T(aa,{modelValue:D(q).uFlag,"onUpdate:modelValue":h[25]||(h[25]=e=>D(q).uFlag=e),title:"上传设备xlsx文件",width:"600px","before-close":Qe,"close-on-click-modal":!1},{footer:x((()=>[S("span",xe,[T(_,{onClick:Oe},{default:x((()=>[R("取消")])),_:1}),T(_,{type:"primary",onClick:Be},{default:x((()=>[R("上传")])),_:1})])])),default:x((()=>[T(oa,{ref_key:"uploadRef",ref:Ge,action:"","auto-upload":!1,"http-request":qe,limit:1,"on-exceed":Ke,"before-upload":Ee},{tip:x((()=>[Te])),default:x((()=>[T(_,{type:"primary"},{default:x((()=>[R("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-48f96635"]]);const Re=e=>(z("data-v-501d5432"),e=e(),B(),e),Ie={class:"main-container"},Me={class:"main"},Le={class:"search-bar"},Ae={class:"search-bar",style:{display:"flex"}},Ue={class:"title",style:{position:"relative","margin-right":"40px","justify-content":"flex-start",padding:"0px 0px",height:"40px"}},Pe={class:"tName"},je=Re((()=>S("div",null,"无数据",-1))),ze={class:"pagination"},Be={class:"dialog-content"},qe={class:"dialog-footer"},Ge=Re((()=>S("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),Ke={class:"dialog-footer"};var Ee=K({__name:"RegInfo",props:{curGateway:{type:Object,default:{}}},emits:["changeDnFlag"],setup(e,{emit:p}){const u=e,f=E();console.log("id -> props",u);const v=/^[0-9]*[1-9][0-9]*$/,w=(e,a,l)=>{0===a||v.test(a)?l():l(new Error("只能输入自然数！"))},N=h({headerCellStyle:{background:O.primaryColor,color:O.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,regTableData:[],rFlag:!1,rTitle:"添加寄存器",regInfo:"",regForm:{serviceName:"",regName:"",label:"",propertyType:0,collName:"",nodeName:"",propertyName:"",regType:0,regAddr:0,regCnt:1,rule:"Int_AB"},regRules:{regName:[{required:!0,message:"寄存器名称不能为空！",trigger:"blur"}],label:[{required:!0,message:"寄存器标签不能为空！",trigger:"blur"}],collName:[{required:!0,message:"采集接口名称不能为空！",trigger:"blur"}],nodeName:[{required:!0,message:"设备名称不能为空！",trigger:"blur"}],propertyName:[{required:!0,message:"设备属性名称不能为空！",trigger:"blur"}],regAddr:[{required:!0,message:"寄存器地址不能为空！",trigger:"blur"},{validator:w,trigger:"blur"}],regCnt:[{required:!0,message:"寄存器数量不能为空！",trigger:"blur"},{validator:w,trigger:"blur"}],rule:[{required:!0,message:"解析规则不能为空！",trigger:"blur"}]},collOptions:[],nodeOptions:[],propertyOptions:[],nameTotsl:{},typeOptions:[{name:0,label:"设备属性"},{name:1,label:"系统属性"}],regTypeOptions:[{name:0,label:"线圈状态寄存器"},{name:1,label:"离散输入状态寄存器"},{name:2,label:"保持寄存器"},{name:3,label:"输入寄存器"}],regCntOptions:[{label:1,value:1},{label:2,value:2},{label:4,value:4}],ruleTypeOptions:{rt1:[{label:"Int_AB",value:"Int_AB"},{label:"Int_BA",value:"Int_BA"}],rt2:[{label:"Long_ABCD",value:"Long_ABCD"},{label:"Long_BADC",value:"Long_BADC"},{label:"Long_DCBA",value:"Long_DCBA"},{label:"Long_CDAB",value:"Long_CDAB"},{label:"Float_ABCD",value:"Float_ABCD"},{label:"Float_BADC",value:"Float_BADC"},{label:"Float_DCBA",value:"Float_DCBA"},{label:"Float_CDAB",value:"Float_CDAB"}],rt4:[{label:"Double_ABCDEFGH",value:"Double_ABCDEFGH"},{label:"Double_GHEFCDAB",value:"Double_GHEFCDAB"},{label:"Double_BADCFEHG",value:"Double_BADCFEHG"},{label:"Double_HGFEDCBA",value:"Double_HGFEDCBA"}]},selectedNodes:[],uFlag:!1}),U=e=>{const l={token:f.token,data:{serviceName:u.curGateway.serviceName}};Q.getRegByServiceIdList(l).then((async l=>{console.log("getRegByServiceIdList -> res ",l),l&&("0"===l.code?(N.regTableData=l.data,1===e&&a({type:"success",message:"刷新成功！"})):fe(l),await P((()=>{N.tableMaxHeight=j.value.clientHeight-34-36-132})))}))};U();const j=F(null);(()=>{const e={token:f.token,data:{}};J.getInterfaceList(e).then((e=>{console.log("getInterfaceList -> res",e),"0"===e.code?(N.collOptions=[],e.data.forEach((e=>{const a={label:e.collInterfaceName,name:e.collInterfaceName};N.collOptions.push(a)}))):fe(e)}))})();const z=e=>{q(e).then((e=>{B(e)})),N.propertyOptions=[]},B=e=>{"0"===e.code?(N.nodeOptions=[],N.nameTotsl={},e.data.deviceNodeMap.forEach((e=>{const a={label:e.label,name:e.name,tsl:e.tsl};N.nameTotsl[""+e.name]=e.tsl,N.nodeOptions.push(a)}))):fe(e)},q=e=>{const a={token:f.token,data:{name:e}};return J.getCollDevices(a)},G=e=>{K(e)},K=e=>{const a={token:f.token,data:{name:N.nameTotsl[e]}};ee.getDeviceModelProperty(a).then((e=>{console.log("getDeviceModelProperty -> res ",e),"0"===e.code?(N.propertyOptions=[],e.data.forEach((e=>{const a={label:e.label,name:e.name};N.propertyOptions.push(a)}))):fe(e)}))},H=e=>{N.selectedNodes=e},ae=e=>{N.currentPage=e},le=_((()=>{let e=N.regInfo;return N.regTableData.filter((a=>!e||a.deviceName.toLowerCase().includes(e.toLowerCase())||a.deviceAddr.toLowerCase().includes(e.toLowerCase()))).slice((N.currentPage-1)*N.pagesize,N.currentPage*N.pagesize)})),te=_((()=>{let e=N.regInfo;return N.regTableData.filter((a=>!e||a.deviceName.toLowerCase().includes(e.toLowerCase())||a.deviceAddr.toLowerCase().includes(e.toLowerCase())))})),oe=e=>{N.pagesize=e},re=e=>{N.rFlag=!0,N.rTitle="编辑寄存器",N.regForm={regName:e.regName,label:e.label,propertyType:e.propertyType,collName:e.collName,nodeName:e.nodeName,propertyName:e.propertyName,regType:e.regType,regAddr:e.regAddr,regCnt:e.regCnt,rule:e.rule},q(N.regForm.collName).then((e=>{B(e),K(N.regForm.nodeName)}))},de=()=>{N.regForm={regName:"",label:"",propertyType:0,collName:"",nodeName:"",propertyName:"",regType:0,regAddr:0,regCnt:1,rule:"Int_AB"}},ne=F(null),ie=()=>{N.rFlag=!1,de()},ce=()=>{pe.value&&pe.value.submit()},se=e=>{},pe=F(null),ue=e=>{pe.value.clearFiles();const a=e[0];pe.value.handleStart(a)},me=e=>{console.log("beforeUpload -> file",e);let l=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.type);if(l){if(l){let l=new FormData;l.append("serviceName",u.curGateway.serviceName),l.append("fileName",e);const t={token:f.token,contentType:"multipart/form-data",data:l};Q.importReg(t).then((e=>{"0"===e.code?(a.success(e.message),N.uFlag=!1,U()):fe(e)}))}}else a({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ge=()=>{N.uFlag=!1,pe.value.clearFiles()},ye=()=>{ge()},fe=e=>{a({type:"error",message:e.message})},be=(e,l)=>{a({type:"0"===e.code?"success":"error",message:e.message}),"0"===e.code&&l&&l()};return(e,v)=>{const w=t,h=o,F=r,_=d,P=n,B=C("Icon"),q=i,K=c,E=s,O=b,J=g,ee=m,ve=y;return k(),V("div",Ie,[S("div",Me,[S("div",Le,[T(_,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:x((()=>[T(F,{style:{"margin-left":"20px"}},{default:x((()=>[T(h,{type:"primary",plain:"",onClick:v[0]||(v[0]=e=>{p("changeDnFlag","goBack")}),style:{"margin-right":"20px"}},{default:x((()=>[T(w,{class:"el-input__icon"},{default:x((()=>[T(D(W))])),_:1}),R(" 返回上报服务 ")])),_:1})])),_:1}),T(F,null,{default:x((()=>[T(h,{type:"primary",plain:"",class:"right-btn",onClick:v[1]||(v[1]=e=>{N.uFlag=!0})},{default:x((()=>[T(w,{class:"el-input__icon"},{default:x((()=>[T(D($))])),_:1}),R(" 导入寄存器 ")])),_:1})])),_:1}),T(F,null,{default:x((()=>[T(h,{type:"primary",plain:"",class:"right-btn",onClick:v[2]||(v[2]=e=>(()=>{const e={token:f.token,responseType:"blob",data:{serviceName:u.curGateway.serviceName}};Q.exportReg(e).then((e=>{if(console.log("exportReg -> res",e),e&&"1"===e.code)return void fe(e);const a=new Blob([e.blob]),l=e.fileName,t=document.createElement("a");t.download=l,t.style.display="none",t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})())},{default:x((()=>[T(w,{class:"el-input__icon"},{default:x((()=>[T(D(X))])),_:1}),R(" 导出寄存器 ")])),_:1})])),_:1})])),_:1},512)]),S("div",Ae,[S("div",Ue,[S("div",Pe,I(u.curGateway.serviceName),1)]),T(_,{inline:!0,ref:"searchFormRef2","status-icon":"","label-width":"90px"},{default:x((()=>[T(F,{label:""},{default:x((()=>[T(P,{style:{width:"200px"},placeholder:"请输入 地址/名称 过滤",clearable:"",modelValue:D(N).regInfo,"onUpdate:modelValue":v[3]||(v[3]=e=>D(N).regInfo=e)},{prefix:x((()=>[T(w,{class:"el-input__icon"},{default:x((()=>[T(D(Z))])),_:1})])),_:1},8,["modelValue"])])),_:1}),T(F,null,{default:x((()=>[T(h,{type:"primary",bg:"",class:"right-btn",onClick:v[4]||(v[4]=e=>(()=>{let e=[];if(0===N.selectedNodes.length)return void a.info("请至少选择一个设备！");N.selectedNodes.forEach((a=>{e.push(a.deviceName)}));const l={token:f.token,data:{serviceName:u.curGateway.serviceName,deviceNames:e}};Y.reportNodes(l).then((e=>{"0"===e.code?a.success(e.message):fe(e)}))})())},{default:x((()=>[T(w,{class:"btn-icon"},{default:x((()=>[T(B,{name:"local-report",size:"14px",color:"#ffffff"})])),_:1}),R(" 主动上报 ")])),_:1})])),_:1}),T(F,null,{default:x((()=>[T(h,{type:"primary",bg:"",class:"right-btn",onClick:v[5]||(v[5]=e=>(N.rFlag=!0,N.rTitle="添加寄存器",void de()))},{default:x((()=>[T(w,{class:"btn-icon"},{default:x((()=>[T(B,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),R(" 添加 ")])),_:1})])),_:1}),T(F,null,{default:x((()=>[T(h,{type:"danger",bg:"",class:"right-btn",onClick:v[6]||(v[6]=e=>(()=>{let e=[];0!==N.selectedNodes.length?(N.selectedNodes.forEach((a=>{e.push(a.regName)})),console.log("dList",e),l.confirm("确定要删除这些吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const a={token:f.token,data:{serviceName:u.curGateway.serviceName,registers:e}};Q.deleteReg(a).then((e=>{be(e,U)}))})).catch((()=>{a({type:"info",message:"取消删除"})}))):a.info("请至少选择一个寄存器！")})())},{default:x((()=>[T(w,{class:"btn-icon"},{default:x((()=>[T(B,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),R(" 删除 ")])),_:1})])),_:1}),T(F,null,{default:x((()=>[T(h,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:v[7]||(v[7]=e=>{U(1)})},{default:x((()=>[T(w,{class:"btn-icon"},{default:x((()=>[T(B,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),R(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),S("div",{class:"content",ref_key:"contentRef",ref:j,style:{top:"136px"}},[T(K,{data:D(le),"cell-style":D(N).cellStyle,"header-cell-style":D(N).headerCellStyle,"max-height":D(N).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:H,onRowDblclick:re},{empty:x((()=>[je])),default:x((()=>[T(q,{type:"selection",width:"55"}),T(q,{sortable:"",prop:"regName",label:"寄存器名称",width:"auto","min-width":"180",align:"center"}),T(q,{sortable:"",prop:"label",label:"寄存器标签",width:"auto","min-width":"180",align:"center"}),T(q,{sortable:"",prop:"propertyType",label:"属性类型",width:"auto","min-width":"120",align:"center"}),T(q,{sortable:"",prop:"collName",label:"采集接口名称",width:"auto","min-width":"180",align:"center"}),T(q,{sortable:"",prop:"nodeName",label:"设备名称",width:"auto","min-width":"180",align:"center"}),T(q,{sortable:"",prop:"propertyName",label:"设备属性名称",width:"auto","min-width":"150",align:"center"}),T(q,{sortable:"",prop:"regType",label:"寄存器类型",width:"auto","min-width":"100",align:"center"}),T(q,{sortable:"",prop:"regAddr",label:"寄存器地址",width:"auto","min-width":"100",align:"center"}),T(q,{sortable:"",prop:"regCnt",label:"寄存器数量",width:"auto","min-width":"100",align:"center"}),T(q,{sortable:"",prop:"rule",label:"解析规则",width:"auto","min-width":"100",align:"center"}),T(q,{label:"操作",width:"auto","min-width":"120",align:"center",fixed:"right"},{default:x((e=>[T(h,{onClick:a=>re(e.row),text:"",type:"primary"},{default:x((()=>[R("编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),S("div",ze,[T(E,{"current-page":D(N).currentPage,"page-size":D(N).pagesize,"page-sizes":[20,50,200,500],total:D(te).length,onCurrentChange:ae,onSizeChange:oe,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)]),T(ee,{modelValue:D(N).rFlag,"onUpdate:modelValue":v[21]||(v[21]=e=>D(N).rFlag=e),title:D(N).rTitle,width:"600px"},{footer:x((()=>[S("span",qe,[T(h,{onClick:v[19]||(v[19]=e=>ie())},{default:x((()=>[R("取消")])),_:1}),T(h,{type:"primary",onClick:v[20]||(v[20]=e=>{ne.value.validate((e=>{if(!e)return!1;{const e={token:f.token,data:{serviceName:u.curGateway.serviceName,register:N.regForm}};N.rTitle.includes("添加")?Q.addReg(e).then((e=>{be(e,U),ie()})):Q.editReg(e).then((e=>{be(e,U),ie()}))}}))})},{default:x((()=>[R("保存")])),_:1})])])),default:x((()=>[S("div",Be,[T(_,{model:D(N).regForm,rules:D(N).regRules,ref_key:"regFormRef",ref:ne,"status-icon":"","label-position":"right","label-width":"120px"},{default:x((()=>[T(F,{label:"采集接口名称",prop:"collName"},{default:x((()=>[T(J,{modelValue:D(N).regForm.collName,"onUpdate:modelValue":v[8]||(v[8]=e=>D(N).regForm.collName=e),style:{width:"100%"},placeholder:"请选择采集接口名称",onChange:z,clearable:"",filterable:""},{default:x((()=>[(k(!0),V(M,null,L(D(N).collOptions,(e=>(k(),A(O,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(F,{label:"设备名称",prop:"nodeName"},{default:x((()=>[T(J,{modelValue:D(N).regForm.nodeName,"onUpdate:modelValue":v[9]||(v[9]=e=>D(N).regForm.nodeName=e),style:{width:"100%"},placeholder:"请选择设备名称",onChange:G,clearable:"",filterable:""},{default:x((()=>[(k(!0),V(M,null,L(D(N).nodeOptions,(e=>(k(),A(O,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(F,{label:"设备属性名称",prop:"propertyName"},{default:x((()=>[T(J,{modelValue:D(N).regForm.propertyName,"onUpdate:modelValue":v[10]||(v[10]=e=>D(N).regForm.propertyName=e),style:{width:"100%"},placeholder:"请选择设备属性名称",clearable:"",filterable:""},{default:x((()=>[(k(!0),V(M,null,L(D(N).propertyOptions,(e=>(k(),A(O,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(F,{label:"寄存器名称",prop:"regName"},{default:x((()=>[T(P,{type:"text",modelValue:D(N).regForm.regName,"onUpdate:modelValue":v[11]||(v[11]=e=>D(N).regForm.regName=e),autocomplete:"off",placeholder:"请输入寄存器名称"},null,8,["modelValue"])])),_:1}),T(F,{label:"寄存器标签",prop:"label"},{default:x((()=>[T(P,{type:"text",modelValue:D(N).regForm.label,"onUpdate:modelValue":v[12]||(v[12]=e=>D(N).regForm.label=e),autocomplete:"off",placeholder:"请输入寄存器标签"},null,8,["modelValue"])])),_:1}),T(F,{label:"属性类型",prop:"propertyType"},{default:x((()=>[T(J,{modelValue:D(N).regForm.propertyType,"onUpdate:modelValue":v[13]||(v[13]=e=>D(N).regForm.propertyType=e),style:{width:"100%"},placeholder:"请选择属性类型",clearable:"",filterable:""},{default:x((()=>[(k(!0),V(M,null,L(D(N).typeOptions,(e=>(k(),A(O,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(F,{label:"寄存器类型",prop:"regType"},{default:x((()=>[T(J,{modelValue:D(N).regForm.regType,"onUpdate:modelValue":v[14]||(v[14]=e=>D(N).regForm.regType=e),style:{width:"100%"},placeholder:"请选择寄存器类型",clearable:"",filterable:""},{default:x((()=>[(k(!0),V(M,null,L(D(N).regTypeOptions,(e=>(k(),A(O,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(F,{label:"寄存器地址",prop:"regAddr"},{default:x((()=>[T(P,{type:"text",modelValue:D(N).regForm.regAddr,"onUpdate:modelValue":v[15]||(v[15]=e=>D(N).regForm.regAddr=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入寄存器地址"},null,8,["modelValue"])])),_:1}),T(F,{label:"寄存器数量",prop:"regCnt"},{default:x((()=>[T(J,{modelValue:D(N).regForm.regCnt,"onUpdate:modelValue":v[16]||(v[16]=e=>D(N).regForm.regCnt=e),modelModifiers:{number:!0},style:{width:"100%"},onChange:v[17]||(v[17]=e=>(()=>{const e=N.regForm.regCnt;1===e&&(N.regForm.rule="Int_AB"),2===e&&(N.regForm.rule="Long_ABCD"),4===e&&(N.regForm.rule="Double_ABCDEFGH")})()),placeholder:"请选择寄存器数量"},{default:x((()=>[(k(!0),V(M,null,L(D(N).regCntOptions,(e=>(k(),A(O,{key:"regCount_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(F,{label:"解析规则",prop:"rule"},{default:x((()=>[T(J,{modelValue:D(N).regForm.rule,"onUpdate:modelValue":v[18]||(v[18]=e=>D(N).regForm.rule=e),modelModifiers:{number:!0},style:{width:"100%"},placeholder:"请选择解析规则"},{default:x((()=>[(k(!0),V(M,null,L(D(N).ruleTypeOptions["rt"+D(N).regForm.regCnt],(e=>(k(),A(O,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),T(ee,{modelValue:D(N).uFlag,"onUpdate:modelValue":v[22]||(v[22]=e=>D(N).uFlag=e),title:"上传寄存器xlsx文件",width:"600px","before-close":ye,"close-on-click-modal":!1},{footer:x((()=>[S("span",Ke,[T(h,{onClick:ge},{default:x((()=>[R("取消")])),_:1}),T(h,{type:"primary",onClick:ce},{default:x((()=>[R("上传")])),_:1})])])),default:x((()=>[T(ve,{ref_key:"uploadRef",ref:pe,action:"","auto-upload":!1,"http-request":se,limit:1,"on-exceed":ue,"before-upload":me},{tip:x((()=>[Ge])),default:x((()=>[T(h,{type:"primary"},{default:x((()=>[R("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-501d5432"]]);const Oe={class:"main-container"},Qe={key:0,class:"main"},He={class:"search-bar"},Je={class:"tool-bar"},Ye={class:"param-content"},We={class:"pc-title"},$e={class:"pct-info"},Xe={class:"pc-content"},Ze={class:"param-value"},ea={class:"param-name"},aa=(e=>(z("data-v-1602cd2d"),e=e(),B(),e))((()=>S("div",null,"无数据",-1))),la={class:"pagination"},ta={class:"dialog-content"},oa={class:"dialog-footer"};var ra=K({__name:"DataService",setup(e){const p=E();console.log("window.location",window.location);const u=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,y=/^(?=^.{3,255}$)(http(s)?:\/\/)?(www\.)?[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+(:\d+)*(\/\w+\.\w+)*$/,f=/^[0-9]*[1-9][0-9]*$/,N=(e,a,l)=>{0===a||f.test(a)?l():l(new Error("只能输入自然数！"))},j=F(null),z=h({headerCellStyle:{background:O.primaryColor,color:O.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,dataServiceName:"",gatewayTableData:[],dFlag:!1,dTitle:"添加上报服务",networkNames:[],gatewayForm:{serviceName:"",ip:"",port:"",reportTime:0,protocol:"",userName:"",password:"",clientID:"",keepAlive:"",cleanSession:!1,deviceName:"",projectCode:"",token:"",slaveID:0,coilStatusRegStart:0,coilStatusRegCnt:0,inputStatusRegStart:0,inputStatusRegCnt:0,holdingRegStart:0,holdingRegCnt:0,inputRegStart:0,inputRegCnt:0,appKey:"",productKey:"",deviceID:"",deviceSecret:"",reportNetSw:!1,reportNet:""},paramName:{serviceName:"服务名称",ip:"服务名称",port:"服务名称",reportTime:"上报时间",protocol:"协议名称",UserName:"用户名",Password:"密码",ClientID:"客户端名称",keepAlive:"保活时间",cleanSession:"是否清除会话",deviceName:"通信编码",projectCode:"项目编码",token:"密钥",AppKey:"appKey",ProductKey:"产品密钥",DeviceID:"通讯地址",DeviceSecret:"设备密钥"},gatewayRules:{serviceName:[{required:!0,message:"服务名称不能为空",trigger:"blur"}],ip:[{required:!0,validator:(e,a,l)=>{console.log("validateIP"),z.gatewayForm.reportNetSw?u.test(a)?l():l(new Error("请输入正确的IP地址！")):u.test(a)||y.test(a)?l():l(new Error("请输入正确的IP地址、域名地址！"))},trigger:"blur"}],port:[{required:!0,message:"端口不能为空",trigger:"blur"}],reportTime:[{required:!0,message:"上报时间不能为空",trigger:"blur"},{type:"number",message:"上报时间只能输入数字"}],protocol:[{required:!0,message:"协议名称不能为空",trigger:"blur"}],ModbusTCP:[{required:!0,message:"上报地址不能为空",trigger:"blur"}],userName:[{required:!0,message:"用户名不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}],clientID:[{required:!0,message:"客户端名称不能为空",trigger:"blur"}],deviceName:[{required:!0,message:"通讯编码不能为空",trigger:"blur"}],projectCode:[{required:!0,message:"项目编码不能为空",trigger:"blur"}],token:[{required:!0,message:"密钥不能为空",trigger:"blur"}],slaveID:[{required:!0,message:"从机ID不能为空",trigger:"blur"},{validator:N,trigger:"blur"}],coilStatusRegStart:[{validator:N,trigger:"blur"}],coilStatusRegCnt:[{validator:N,trigger:"blur"}],inputStatusRegStart:[{validator:N,trigger:"blur"}],inputStatusRegCnt:[{validator:N,trigger:"blur"}],holdingRegStart:[{validator:N,trigger:"blur"}],holdingRegCnt:[{validator:N,trigger:"blur"}],inputRegStart:[{validator:N,trigger:"blur"}],inputRegCnt:[{validator:N,trigger:"blur"}],appKey:[{required:!0,message:"appKey不能为空",trigger:"blur"}],productKey:[{required:!0,message:"产品密钥不能为空",trigger:"blur"}],deviceID:[{required:!0,message:"产品密钥不能为空",trigger:"blur"}],deviceSecret:[{required:!0,message:"产品密钥不能为空",trigger:"blur"}],reportNet:[{required:!0,message:"上报网卡不能为空",trigger:"blur"}]},protocolOptions:[{name:"EMQX.MQTT",label:"EMQX.MQTT"},{name:"RT.STLV1",label:"RT.STLV1"},{name:"RT.STLV2",label:"RT.STLV2"},{name:"RT.MQTT",label:"RT.MQTT"},{name:"ModbusTCP",label:"ModbusTCP"},{name:"FSJY.MQTT",label:"FSJY.MQTT"}],dnList:["RT.STLV1","RT.STLV2"],kaList:["EMQX.MQTT","RT.MQTT","RT.STLV2","FSJY.MQTT"],dnFlag:1,serviceName:"",handleFlag:""}),B=H();z.serviceName=B.query.serviceName;const K=e=>{const l={token:p.token,data:{}};Q.getGatewayList(l).then((async l=>{if(console.log("getGatewayList -> res",l),l){if("0"===l.code){if(z.gatewayTableData=l.data,z.serviceName&&!z.handleFlag){const e=z.gatewayTableData.find((e=>e.serviceName===z.serviceName));ee(e)}1===e&&a({type:"success",message:"刷新成功！"})}else de(l);await P((()=>{z.tableMaxHeight=j.value.clientHeight-34-36-22}))}}))};K();(()=>{const e={token:p.token,data:{}};Q.getReportProtocolList(e).then((e=>{e&&(console.log("getReportProtocolList -> res",e),"0"===e.code?z.protocolOptions=e.data:de(e))}))})();const J=_((()=>z.gatewayTableData.filter((e=>!z.dataServiceName||e.serviceName.toLowerCase().includes(z.dataServiceName.toLowerCase()))).slice((z.currentPage-1)*z.pagesize,z.currentPage*z.pagesize))),Y=_((()=>z.gatewayTableData.filter((e=>!z.dataServiceName||e.serviceName.toLowerCase().includes(z.dataServiceName.toLowerCase()))))),W=e=>{z.currentPage=e},$=e=>{z.pagesize=e},X=e=>{z.dFlag=!0,z.dTitle="编辑上报服务",z.gatewayForm={serviceName:e.serviceName,ip:e.ip,port:e.port,reportTime:e.reportTime,protocol:e.protocol},z.gatewayForm.reportNetSw=e.reportNetSw,z.gatewayForm.reportNet=e.reportNet,e.protocol.includes("FSJY.MQTT")?(z.gatewayForm.userName=e.param.UserName,z.gatewayForm.password=e.param.Password,z.gatewayForm.clientID=e.param.ClientID,z.gatewayForm.keepAlive=e.param.KeepAlive,z.gatewayForm.cleanSession=e.param.CleanSession,z.gatewayForm.appKey=e.param.AppKey,z.gatewayForm.productKey=e.param.ProductKey,z.gatewayForm.deviceID=e.param.DeviceID,z.gatewayForm.deviceSecret=e.param.DeviceSecret):e.protocol.includes("MQTT")?(z.gatewayForm.userName=e.param.userName,z.gatewayForm.password=e.param.password,z.gatewayForm.clientID=e.param.clientID,z.gatewayForm.keepAlive=e.param.keepAlive,z.gatewayForm.cleanSession=e.param.cleanSession):"RT.STLV1"===e.protocol?z.gatewayForm.deviceName=e.param.deviceName:"RT.STLV2"===e.protocol?(z.gatewayForm.projectCode=e.param.projectCode,z.gatewayForm.deviceName=e.param.deviceName,z.gatewayForm.keepAlive=e.param.keepAlive,z.gatewayForm.token=e.param.token):"ModbusTCP"===e.protocol&&(z.gatewayForm.ip="",z.gatewayForm.reportTime=0,z.gatewayForm.slaveID=e.param.slaveID,z.gatewayForm.coilStatusRegStart=e.param.coilStatusRegStart,z.gatewayForm.coilStatusRegCnt=e.param.coilStatusRegCnt,z.gatewayForm.inputStatusRegStart=e.param.inputStatusRegStart,z.gatewayForm.inputStatusRegCnt=e.param.inputStatusRegCnt,z.gatewayForm.holdingRegStart=e.param.holdingRegStart,z.gatewayForm.holdingRegCnt=e.param.holdingRegCnt,z.gatewayForm.inputRegStart=e.param.inputRegStart,z.gatewayForm.inputRegCnt=e.param.inputRegCnt)},ee=e=>{z.dnFlag=2,z.curGateway=e},le=e=>{z.handleFlag=e,z.dnFlag=1,K()},te=F(null),oe=()=>{z.dFlag=!1,te.value.resetFields(),z.gatewayForm={serviceName:"",ip:"",port:"",reportTime:0,protocol:"",userName:"",password:"",clientID:"",keepAlive:"",cleanSession:!1,deviceName:"",projectCode:"",token:"",appKey:"",productKey:"",deviceID:"",deviceSecret:"",reportNetSw:!1,reportNet:""}},re=e=>{oe()},de=e=>{a({type:"error",message:e.message})},ne=(e,l)=>{a({type:"0"===e.code?"success":"error",message:e.message}),"0"===e.code&&l&&l()};return(e,u)=>{const y=t,f=n,h=r,F=C("Icon"),_=o,N=d,P=i,B=c,E=s,O=b,H=g,ie=v,ce=w,se=m;return k(),V("div",Oe,[1===D(z).dnFlag?(k(),V("div",Qe,[S("div",He,[T(N,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:x((()=>[T(h,{label:"上报服务名称"},{default:x((()=>[T(f,{style:{width:"200px"},placeholder:"请输入上报服务名称",clearable:"",modelValue:D(z).dataServiceName,"onUpdate:modelValue":u[0]||(u[0]=e=>D(z).dataServiceName=e)},{prefix:x((()=>[T(y,{class:"el-input__icon"},{default:x((()=>[T(D(Z))])),_:1})])),_:1},8,["modelValue"])])),_:1}),T(h,null,{default:x((()=>[T(_,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:u[1]||(u[1]=e=>{K(1)})},{default:x((()=>[T(y,{class:"btn-icon"},{default:x((()=>[T(F,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),R(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),S("div",Je,[T(_,{type:"primary",bg:"",class:"right-btn",onClick:u[2]||(u[2]=e=>(z.dFlag=!0,void(z.dTitle="添加上报服务")))},{default:x((()=>[T(y,{class:"btn-icon"},{default:x((()=>[T(F,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),R(" 添加 ")])),_:1})]),S("div",{class:"content",ref_key:"contentRef",ref:j},[T(B,{data:D(J),"cell-style":D(z).cellStyle,"header-cell-style":D(z).headerCellStyle,style:{width:"100%"},"max-height":D(z).tableMaxHeight,stripe:"",onRowDblclick:X},{empty:x((()=>[aa])),default:x((()=>[T(P,{type:"expand","min-width":"80"},{default:x((e=>[S("div",Ye,[S("div",We,[S("div",$e,[S("b",null,I(e.row.serviceName),1),R(" 参数详情 ")])]),S("div",Xe,[(k(!0),V(M,null,L(e.row.param,((e,a,l)=>(k(),V("div",{class:"param-item",key:l},[S("div",Ze,I(D(z).paramName[a])+"：",1),S("div",ea,I(e||"-"),1)])))),128))])])])),_:1}),T(P,{sortable:"",prop:"serviceName",label:"服务名称",width:"auto","min-width":"150",align:"center"}),T(P,{sortable:"",prop:"protocol",label:"协议名称",width:"auto","min-width":"150",align:"center"}),T(P,{sortable:"",prop:"reportNetSW",label:"指定上报通道",width:"auto","min-width":"100",align:"center"},{default:x((e=>[R(I(!1===e.row.reportNetSW?"否":"是"),1)])),_:1}),T(P,{sortable:"",prop:"reportNet",label:"上报网卡",width:"auto","min-width":"100",align:"center"},{default:x((e=>[R(I(!1===e.row.reportNetSW?"-":e.row.reportNet),1)])),_:1}),T(P,{sortable:"",prop:"ip",label:"上报地址",width:"auto","min-width":"150",align:"center"}),T(P,{sortable:"",prop:"port",label:"上报端口",width:"auto","min-width":"100",align:"center"}),T(P,{sortable:"",prop:"reportTime",label:"上报周期（秒）",width:"auto","min-width":"150",align:"center"}),T(P,{sortable:"",label:"在线状态",width:"auto","min-width":"100",align:"center"},{default:x((e=>[R(I("onLine"===e.row.reportStatus?"在线":"离线"),1)])),_:1}),T(P,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:x((e=>["ModbusTCP"!==e.row.protocol?(k(),A(_,{key:0,onClick:a=>ee(e.row),text:"",type:"success"},{default:x((()=>[R(" 上报节点 ")])),_:2},1032,["onClick"])):U("",!0),"ModbusTCP"==e.row.protocol?(k(),A(_,{key:1,onClick:a=>{return l=e.row,z.dnFlag=3,void(z.curGateway=l);var l},text:"",type:"success"},{default:x((()=>[R(" 寄存器详情 ")])),_:2},1032,["onClick"])):U("",!0),T(_,{onClick:a=>X(e.row),text:"",type:"primary"},{default:x((()=>[R("编辑")])),_:2},1032,["onClick"]),T(_,{onClick:t=>{return o=e.row,void l.confirm("确定要删除这个上报服务吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:p.token,data:{serviceName:o.serviceName}};Q.deleteGateway(e).then((e=>{ne(e,K)}))})).catch((()=>{a({type:"info",message:"取消删除"})}));var o},text:"",type:"danger"},{default:x((()=>[R("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),S("div",la,[T(E,{"current-page":D(z).currentPage,"page-size":D(z).pagesize,"page-sizes":[20,50,200,500],total:D(Y).length,onCurrentChange:W,onSizeChange:$,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):U("",!0),2===D(z).dnFlag?(k(),A(De,{key:1,curGateway:D(z).curGateway,onChangeDnFlag:le,style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curGateway"])):U("",!0),3===D(z).dnFlag?(k(),A(Ee,{key:2,curGateway:D(z).curGateway,onChangeDnFlag:le,style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curGateway"])):U("",!0),T(se,{modelValue:D(z).dFlag,"onUpdate:modelValue":u[35]||(u[35]=e=>D(z).dFlag=e),title:D(z).dTitle,width:"600px","before-close":re,"close-on-click-modal":!1},{footer:x((()=>[S("span",oa,[T(_,{onClick:u[33]||(u[33]=e=>oe())},{default:x((()=>[R("取消")])),_:1}),T(_,{type:"primary",onClick:u[34]||(u[34]=e=>{te.value.validate((e=>{if(!e)return!1;{const e={serviceName:z.gatewayForm.serviceName,ip:z.gatewayForm.ip,port:z.gatewayForm.port,reportTime:z.gatewayForm.reportTime,protocol:z.gatewayForm.protocol,reportNetSw:z.gatewayForm.reportNetSw,reportNet:z.gatewayForm.reportNet,param:{}};let a={};z.gatewayForm.protocol.includes("FSJY.MQTT")?(a.userName=z.gatewayForm.userName,a.password=z.gatewayForm.password,a.clientID=z.gatewayForm.clientID,a.keepAlive=z.gatewayForm.keepAlive,a.cleanSession=z.gatewayForm.cleanSession,a.appKey=z.gatewayForm.appKey,a.productKey=z.gatewayForm.productKey,a.deviceID=z.gatewayForm.deviceID,a.deviceSecret=z.gatewayForm.deviceSecret):z.gatewayForm.protocol.includes("MQTT")?(a.userName=z.gatewayForm.userName,a.password=z.gatewayForm.password,a.clientID=z.gatewayForm.clientID,a.keepAlive=z.gatewayForm.keepAlive,a.cleanSession=z.gatewayForm.cleanSession):"RT.STLV1"===z.gatewayForm.protocol?a.deviceName=z.gatewayForm.deviceName:"RT.STLV2"===z.gatewayForm.protocol?(a.projectCode=z.gatewayForm.projectCode,a.deviceName=z.gatewayForm.deviceName,a.keepAlive=z.gatewayForm.keepAlive,a.token=z.gatewayForm.token):"ModbusTCP"===z.gatewayForm.protocol&&(a.slaveID=z.gatewayForm.slaveID,a.coilStatusRegStart=z.gatewayForm.coilStatusRegStart,a.coilStatusRegCnt=z.gatewayForm.coilStatusRegCnt,a.inputStatusRegStart=z.gatewayForm.inputStatusRegStart,a.inputStatusRegCnt=z.gatewayForm.inputStatusRegCnt,a.holdingRegStart=z.gatewayForm.holdingRegStart,a.holdingRegCnt=z.gatewayForm.holdingRegCnt,a.inputRegStart=z.gatewayForm.inputRegStart,a.inputRegCnt=z.gatewayForm.inputRegCnt),e.param=a;const l={token:p.token,data:e};z.dTitle.includes("添加")?Q.addGateway(l).then((e=>{ne(e,K),oe()})):Q.editGateway(l).then((e=>{ne(e,K),oe()}))}}))})},{default:x((()=>[R("保存")])),_:1})])])),default:x((()=>[S("div",ta,[T(N,{model:D(z).gatewayForm,rules:D(z).gatewayRules,ref_key:"gatewayFormRef",ref:te,"status-icon":"","label-position":"right","label-width":"120px",style:{height:"450px"}},{default:x((()=>[T(h,{label:"服务名称",prop:"serviceName"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.serviceName,"onUpdate:modelValue":u[3]||(u[3]=e=>D(z).gatewayForm.serviceName=e),autocomplete:"off",placeholder:"请输入服务名称"},null,8,["modelValue"])])),_:1}),T(h,{label:"协议类型",prop:"protocol"},{default:x((()=>[T(H,{modelValue:D(z).gatewayForm.protocol,"onUpdate:modelValue":u[4]||(u[4]=e=>D(z).gatewayForm.protocol=e),onChange:u[5]||(u[5]=e=>{"RT.MQTT"===D(z).gatewayForm.protocol&&(z.gatewayForm.ip="mqtt.reatgreen.com",z.gatewayForm.port="1883",z.gatewayForm.userName="reatgreen",z.gatewayForm.password="Reat@2022",z.gatewayForm.reportTime=900,z.gatewayForm.keepAlive="30",z.gatewayForm.cleanSession=!0)}),style:{width:"100%"},placeholder:"请选择协议类型"},{default:x((()=>[(k(!0),V(M,null,L(D(z).protocolOptions,(e=>(k(),A(O,{key:"protocol"+e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(h,{label:"指定上报通道"},{default:x((()=>[T(ie,{modelValue:D(z).gatewayForm.reportNetSw,"onUpdate:modelValue":u[6]||(u[6]=e=>D(z).gatewayForm.reportNetSw=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1}),D(z).gatewayForm.reportNetSw?(k(),A(h,{key:0,label:"上报网卡",prop:"reportNet"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.reportNet,"onUpdate:modelValue":u[7]||(u[7]=e=>D(z).gatewayForm.reportNet=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入上报网卡"},null,8,["modelValue"])])),_:1})):U("",!0),q(T(h,{label:"上报地址",prop:"ModbusTCP"!==D(z).gatewayForm.protocol?"ip":""},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.ip,"onUpdate:modelValue":u[8]||(u[8]=e=>D(z).gatewayForm.ip=e),autocomplete:"off",placeholder:"请输入上报地址"},null,8,["modelValue"])])),_:1},8,["prop"]),[[G,"ModbusTCP"!==D(z).gatewayForm.protocol]]),T(h,{label:"上报端口",prop:"port"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.port,"onUpdate:modelValue":u[9]||(u[9]=e=>D(z).gatewayForm.port=e),autocomplete:"off",placeholder:"请输入上报端口"},null,8,["modelValue"])])),_:1}),q(T(h,{label:"上报周期",prop:"ModbusTCP"!==D(z).gatewayForm.protocol?"reportTime":""},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.reportTime,"onUpdate:modelValue":u[10]||(u[10]=e=>D(z).gatewayForm.reportTime=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入上报周期"},{append:x((()=>[R("单位秒")])),_:1},8,["modelValue"])])),_:1},8,["prop"]),[[G,"ModbusTCP"!==D(z).gatewayForm.protocol]]),D(z).gatewayForm.protocol.includes("MQTT")?(k(),A(h,{key:1,label:"用户名",prop:"userName"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.userName,"onUpdate:modelValue":u[11]||(u[11]=e=>D(z).gatewayForm.userName=e),autocomplete:"off",placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1})):U("",!0),D(z).gatewayForm.protocol.includes("MQTT")?(k(),A(h,{key:2,label:"密码",prop:"password"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.password,"onUpdate:modelValue":u[12]||(u[12]=e=>D(z).gatewayForm.password=e),autocomplete:"off",placeholder:"请输入密码"},null,8,["modelValue"])])),_:1})):U("",!0),D(z).gatewayForm.protocol.includes("MQTT")?(k(),A(h,{key:3,label:"客户端名称",prop:"clientID"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.clientID,"onUpdate:modelValue":u[14]||(u[14]=e=>D(z).gatewayForm.clientID=e),autocomplete:"off",placeholder:"请输入客户端名称"},{append:x((()=>[T(_,{onClick:u[13]||(u[13]=e=>(()=>{const e={token:p.token,data:{}};ae.getGatewaySN(e).then((e=>{"0"===e.code?z.gatewayForm.clientID=e.data.sn:de(e)}))})())},{default:x((()=>[R("同步SN")])),_:1})])),_:1},8,["modelValue"])])),_:1})):U("",!0),D(z).gatewayForm.protocol.includes("FSJY")?(k(),A(h,{key:4,label:"APP-KEY",prop:"appKey"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.appKey,"onUpdate:modelValue":u[15]||(u[15]=e=>D(z).gatewayForm.appKey=e),autocomplete:"off",placeholder:"请输入appKey"},null,8,["modelValue"])])),_:1})):U("",!0),D(z).gatewayForm.protocol.includes("FSJY")?(k(),A(h,{key:5,label:"产品密钥",prop:"productKey"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.productKey,"onUpdate:modelValue":u[16]||(u[16]=e=>D(z).gatewayForm.productKey=e),autocomplete:"off",placeholder:"请输入网关产品密钥"},null,8,["modelValue"])])),_:1})):U("",!0),D(z).gatewayForm.protocol.includes("FSJY")?(k(),A(h,{key:6,label:"通讯地址",prop:"deviceID"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.deviceID,"onUpdate:modelValue":u[17]||(u[17]=e=>D(z).gatewayForm.deviceID=e),autocomplete:"off",placeholder:"请输入网关通讯地址"},null,8,["modelValue"])])),_:1})):U("",!0),D(z).gatewayForm.protocol.includes("FSJY")?(k(),A(h,{key:7,label:"设备密钥",prop:"deviceSecret"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.deviceSecret,"onUpdate:modelValue":u[18]||(u[18]=e=>D(z).gatewayForm.deviceSecret=e),autocomplete:"off",placeholder:"请输入网关设备密钥"},null,8,["modelValue"])])),_:1})):U("",!0),"RT.STLV2"===D(z).gatewayForm.protocol?(k(),A(h,{key:8,label:"项目编码",prop:"projectCode"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.projectCode,"onUpdate:modelValue":u[19]||(u[19]=e=>D(z).gatewayForm.projectCode=e),autocomplete:"off",placeholder:"请输入项目编码"},null,8,["modelValue"])])),_:1})):U("",!0),D(z).dnList.includes(D(z).gatewayForm.protocol)?(k(),A(h,{key:9,label:"通信编码",prop:"deviceName"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.deviceName,"onUpdate:modelValue":u[20]||(u[20]=e=>D(z).gatewayForm.deviceName=e),autocomplete:"off",placeholder:"请输入通信编码"},null,8,["modelValue"])])),_:1})):U("",!0),D(z).kaList.includes(D(z).gatewayForm.protocol)?(k(),A(h,{key:10,label:"保活时间",prop:"keepAlive"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.keepAlive,"onUpdate:modelValue":u[21]||(u[21]=e=>D(z).gatewayForm.keepAlive=e),autocomplete:"off",placeholder:"请输入保活时间"},{append:x((()=>[R("单位秒")])),_:1},8,["modelValue"])])),_:1})):U("",!0),D(z).gatewayForm.protocol.includes("MQTT")?(k(),A(h,{key:11,label:"是否清除会话",prop:"cleanSession"},{default:x((()=>[T(ie,{modelValue:D(z).gatewayForm.cleanSession,"onUpdate:modelValue":u[22]||(u[22]=e=>D(z).gatewayForm.cleanSession=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):U("",!0),"RT.STLV2"===D(z).gatewayForm.protocol?(k(),A(h,{key:12,label:"秘钥",prop:"token"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.token,"onUpdate:modelValue":u[23]||(u[23]=e=>D(z).gatewayForm.token=e),autocomplete:"off",placeholder:"请输入秘钥"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(h,{key:13,label:"从机ID",prop:"slaveID"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.slaveID,"onUpdate:modelValue":u[24]||(u[24]=e=>D(z).gatewayForm.slaveID=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入从机ID"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(ce,{key:14,"content-position":"center"},{default:x((()=>[R(" 线圈状态寄存器 ")])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(h,{key:15,label:"起始地址",prop:"coilStatusRegStart"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.coilStatusRegStart,"onUpdate:modelValue":u[25]||(u[25]=e=>D(z).gatewayForm.coilStatusRegStart=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入线圈状态寄存器起始地址"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(h,{key:16,label:"数量",prop:"coilStatusRegCnt"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.coilStatusRegCnt,"onUpdate:modelValue":u[26]||(u[26]=e=>D(z).gatewayForm.coilStatusRegCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入线圈状态寄存器数量"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(ce,{key:17,"content-position":"center"},{default:x((()=>[R(" 离散输入状态寄存器 ")])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(h,{key:18,label:"起始地址",prop:"inputStatusRegStart"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.inputStatusRegStart,"onUpdate:modelValue":u[27]||(u[27]=e=>D(z).gatewayForm.inputStatusRegStart=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入离散输入状态寄存器起始地址"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(h,{key:19,label:"数量",prop:"inputStatusRegCnt"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.inputStatusRegCnt,"onUpdate:modelValue":u[28]||(u[28]=e=>D(z).gatewayForm.inputStatusRegCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入离散输入状态寄存器数量"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(ce,{key:20,"content-position":"center"},{default:x((()=>[R(" 保持寄存器 ")])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(h,{key:21,label:"起始地址",prop:"holdingRegStart"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.holdingRegStart,"onUpdate:modelValue":u[29]||(u[29]=e=>D(z).gatewayForm.holdingRegStart=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入保持寄存器起始地址"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(h,{key:22,label:"数量",prop:"holdingRegCnt"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.holdingRegCnt,"onUpdate:modelValue":u[30]||(u[30]=e=>D(z).gatewayForm.holdingRegCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入保持寄存器数量"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(ce,{key:23,"content-position":"center"},{default:x((()=>[R(" 输入寄存器 ")])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(h,{key:24,label:"起始地址",prop:"inputRegStart"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.inputRegStart,"onUpdate:modelValue":u[31]||(u[31]=e=>D(z).gatewayForm.inputRegStart=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入输入寄存器起始地址"},null,8,["modelValue"])])),_:1})):U("",!0),"ModbusTCP"===D(z).gatewayForm.protocol?(k(),A(h,{key:25,label:"数量",prop:"inputRegCnt"},{default:x((()=>[T(f,{type:"text",modelValue:D(z).gatewayForm.inputRegCnt,"onUpdate:modelValue":u[32]||(u[32]=e=>D(z).gatewayForm.inputRegCnt=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入输入寄存器数量"},null,8,["modelValue"])])),_:1})):U("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-1602cd2d"]]);export{ra as default};
