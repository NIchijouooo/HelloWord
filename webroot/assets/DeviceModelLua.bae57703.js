import{h as e,C as a,e as l,p as t,I as o,J as r,K as s,m as i,D as d,F as n,G as p,n as c,y as m,A as u,o as f,q as y,H as g,v,L as h}from"./element-plus.795748f2.js";import{f as b,Y as F,p as _,X as x,o as M,c as w,a as k,S as C,Q as L,u as D,U as P,a0 as V,L as z,M as j,af as A,P as U,as as T,at as S,H as R,J as I,K as q}from"./@vue.8518410d.js";import{_ as O,u as H,v as N,s as B}from"./index.c4bb92fc.js";import{D as E}from"./deviceModel.de9e06d6.js";import{J,L as K,M as W,I as G}from"./@element-plus.102632fb.js";import"./@vueuse.c0256496.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./vue-router.ae8a7199.js";import"./pinia.4a496763.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./nprogress.aae2b787.js";const Q=e=>(T("data-v-3e21e0e9"),e=e(),S(),e),X={class:"main"},Y={class:"title",style:{"justify-content":"space-between"}},Z=V(" 返回设备模型 "),$={style:{display:"flex","align-items":"center"}},ee=V("属性"),ae=V(" 导入属性 "),le=V(" 导出属性 "),te={key:0},oe={class:"title",style:{top:"60px",height:"76px",padding:"20px 0","justify-content":"space-between"}},re={class:"tName"},se={style:{display:"flex"}},ie=V(" 同步 "),de=V(" 添加 "),ne=V(" 刷新 "),pe=V(" 删除 "),ce=V("编辑"),me=Q((()=>k("div",null,"无数据",-1))),ue={class:"pagination"},fe=Q((()=>k("div",{"e-else":""},null,-1))),ye={class:"dialog-content"},ge={class:"dialog-footer"},ve=V("取消"),he=V("保存"),be=V("选择文件"),Fe=Q((()=>k("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),_e={class:"dialog-footer"},xe=V("取消"),Me=V("上传");var we=O({props:{curDeviceModel:{type:Object,default:{}}},emits:["changeDpFlag"],setup(v,{emit:h}){const T=v,S=H();console.log("id -> props",T);const I=b(null),q=F({headerCellStyle:{background:N.primaryColor,color:N.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,varParamType:"Properties",propertyList:[],serviceList:[],deviceModelProperty:"",deviceModelService:"",accessModeOptions:[{label:"只读",value:0},{label:"只写",value:1},{label:"读写",value:2}],typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,unit:"",decimals:0,min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,dataLength:"",dataLengthAlarm:!1},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"布长",stepAlarm:"布长报警",unit:"单位",decimals:"小数位数",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],accessMode:[{required:!0,message:"读写属性不能为空",trigger:"blur"}],type:[{required:!0,message:"数据类型不能为空",trigger:"blur"}],decimals:[{type:"number",message:"小数位数只能输入数字",trigger:"blur"}]},psFlag:!1,selectedProperties:[]}),O=a=>{const l={token:S.token,data:{name:T.curDeviceModel.name}};E.getDeviceModelProperty(l).then((async l=>{console.log("getDeviceModelProperty -> res",l),l&&("0"===l.code?(q.propertyList=l.data,1===a&&e({type:"success",message:"刷新成功！"})):qe(l),await R((()=>{q.tableMaxHeight=I.value.clientHeight-34-36-22})))}))};O();const B=_((()=>(console.log("ctxData.propertyList ->",q.propertyList),q.propertyList.filter((e=>{var a=!q.deviceModelProperty,l=e.name.toLowerCase().includes(q.deviceModelProperty.toLowerCase());return a||l})).slice((q.currentPage-1)*q.pagesize,q.currentPage*q.pagesize)))),Q=_((()=>q.propertyList.filter((e=>{var a=!q.deviceModelProperty,l=e.name.toLowerCase().includes(q.deviceModelProperty.toLowerCase());return a||l}))));_((()=>(console.log("ctxData.serviceList ->",q.serviceList),q.serviceList.filter((e=>{var a=!q.deviceModelService,l=e.name.toLowerCase().includes(q.deviceModelService.toLowerCase());return a||l})).slice((q.currentPage-1)*q.pagesize,q.currentPage*q.pagesize))));const we=e=>{q.currentPage=e},ke=e=>{q.pagesize=e},Ce=()=>{De.value&&De.value.submit()},Le=e=>{},De=b(null),Pe=e=>{De.value.clearFiles();const a=e[0];De.value.handleStart(a)},Ve=a=>{console.log("beforeUpload -> file",a);let l=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(a.type);if(l){if(l){let l=new FormData;l.append("name",T.curDeviceModel.name),l.append("fileName",a);const t={token:S.token,contentType:"multipart/form-data",data:l};E.importDeviceModelProptyAndService(t).then((a=>{"0"===a.code?(e.success(a.message),q.psFlag=!1,O()):qe(a)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ze=()=>{q.psFlag=!1,uploadRef.value.clearFiles()},je=()=>{ze()},Ae=e=>{q.pFlag=!0,q.pTitle="编辑属性",q.propertyForm.name=e.name,q.propertyForm.label=e.label,q.propertyForm.accessMode=e.accessMode,q.propertyForm.type=e.type,q.propertyForm.unit=e.unit,2===e.type&&(q.propertyForm.decimals=e.decimals),3!==e.type?(q.propertyForm.min=e.params.min,q.propertyForm.max=e.params.max,q.propertyForm.minMaxAlarm=e.params.minMaxAlarm,q.propertyForm.step=e.params.step,q.propertyForm.stepAlarm=e.params.stepAlarm):(q.propertyForm.dataLength=e.params.dataLength,q.propertyForm.dataLengthAlarm=e.params.dataLengthAlarm)},Ue=b(null),Te=()=>{q.pFlag=!1,Ue.value.resetFields(),Ie()},Se=e=>{Te()},Re=e=>{q.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},Ie=()=>{q.propertyForm={name:"",label:"",accessMode:0,type:0,min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,unit:"",decimals:0,dataLength:"",dataLengthAlarm:!1}},qe=a=>{e({type:"error",message:a.message})},Oe=(a,l)=>{e({type:"0"===a.code?"success":"error",message:a.message}),"0"===a.code&&l&&l()};return(v,b)=>{const F=l,_=t,R=o,H=r,N=s,Ie=i,He=x("Icon"),Ne=d,Be=n,Ee=p,Je=c,Ke=m,We=u,Ge=f,Qe=y,Xe=g;return M(),w("div",X,[k("div",Y,[k("div",null,[C(_,{type:"primary",plain:"",onClick:b[0]||(b[0]=e=>(console.log("toDeviceModel"),void h("changeDpFlag")))},{default:L((()=>[C(F,{class:"el-input__icon"},{default:L((()=>[C(D(J))])),_:1}),Z])),_:1})]),k("div",$,[C(H,{modelValue:D(q).varParamType,"onUpdate:modelValue":b[1]||(b[1]=e=>D(q).varParamType=e),style:{"margin-right":"20px"}},{default:L((()=>[C(R,{label:"Properties",border:""},{default:L((()=>[ee])),_:1})])),_:1},8,["modelValue"]),C(N,{direction:"vertical",style:{height:"2em"}}),C(_,{type:"primary",plain:"",class:"right-btn",onClick:b[2]||(b[2]=e=>(console.log("importDPS"),void(q.psFlag=!0)))},{default:L((()=>[C(F,{class:"el-input__icon"},{default:L((()=>[C(D(K))])),_:1}),ae])),_:1}),C(_,{type:"primary",plain:"",class:"right-btn",onClick:b[3]||(b[3]=e=>(()=>{console.log("exportDPS");const e={token:S.token,responseType:"blob",data:{name:T.curDeviceModel.name}};E.exportDeviceModelProptyAndService(e).then((e=>{if(e&&"1"===e.code)return void qe(e);const a=new Blob([e.blob]),l=e.fileName,t=document.createElement("a");t.download=l,t.style.display="none",t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})())},{default:L((()=>[C(F,{class:"el-input__icon"},{default:L((()=>[C(D(W))])),_:1}),le])),_:1})])]),"Properties"===D(q).varParamType?(M(),w("div",te,[k("div",oe,[k("div",re,P(T.curDeviceModel.label)+"："+P("Properties"===D(q).varParamType?"属性列表":"服务列表"),1),k("div",se,[C(Ie,{style:{width:"200px"},placeholder:"请输入属性名称",modelValue:D(q).deviceModelProperty,"onUpdate:modelValue":b[4]||(b[4]=e=>D(q).deviceModelProperty=e)},{prefix:L((()=>[C(F,{class:"el-input__icon"},{default:L((()=>[C(D(G))])),_:1})])),_:1},8,["modelValue"]),C(_,{type:"primary",bg:"",class:"right-btn",onClick:b[5]||(b[5]=e=>(()=>{const e={token:S.token,data:{name:T.curDeviceModel.name}};E.syncDeviceModelProperty(e).then((e=>{console.log(e),Oe(e,O)}))})())},{default:L((()=>[C(F,{class:"btn-icon"},{default:L((()=>[C(He,{name:"local-tongbu",size:"14px",color:"#ffffff"})])),_:1}),ie])),_:1}),C(_,{type:"primary",bg:"",class:"right-btn",onClick:b[6]||(b[6]=e=>(console.log("addDeviceModelProperty"),q.pFlag=!0,void(q.pTitle="添加属性")))},{default:L((()=>[C(F,{class:"btn-icon"},{default:L((()=>[C(He,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),de])),_:1}),C(_,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:b[7]||(b[7]=e=>{O(1)})},{default:L((()=>[C(F,{class:"btn-icon"},{default:L((()=>[C(He,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),ne])),_:1}),C(_,{type:"danger",bg:"",class:"right-btn",onClick:b[8]||(b[8]=l=>(l=>{let t=[];0!==q.selectedProperties.length?(q.selectedProperties.forEach((e=>{t.push(e.name)})),console.log("pList",t),a.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:S.token,data:{name:T.curDeviceModel.name,properties:t}};E.deleteDeviceModelProperty(e).then((e=>{Oe(e,O)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:L((()=>[C(F,{class:"btn-icon"},{default:L((()=>[C(He,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),pe])),_:1})])]),k("div",{class:"content",ref_key:"contentRef",ref:I,style:{top:"136px"}},[C(Be,{data:D(B),"cell-style":D(q).cellStyle,"header-cell-style":D(q).headerCellStyle,"max-height":D(q).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:Re,onRowDblclick:Ae},{empty:L((()=>[me])),default:L((()=>[C(Ne,{type:"selection",width:"55"}),C(Ne,{prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),C(Ne,{prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),C(Ne,{label:"读写属性",width:"auto","min-width":"80",align:"center"},{default:L((e=>[V(P(D(q).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),C(Ne,{label:"属性类型",width:"auto","min-width":"80",align:"center"},{default:L((e=>[V(P(D(q).typeNames["t"+e.row.type]),1)])),_:1}),C(Ne,{label:"小数位数",width:"auto","min-width":"80",align:"center"},{default:L((e=>[V(P(void 0===e.row.decimals||""===e.row.decimals?0:e.row.decimals),1)])),_:1}),C(Ne,{prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),C(Ne,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:L((e=>[C(_,{onClick:a=>Ae(e.row),text:"",type:"primary"},{default:L((()=>[ce])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),k("div",ue,[C(Ee,{"current-page":D(q).currentPage,"page-size":D(q).pagesize,"page-sizes":[20,50,200,500],total:D(Q).length,onCurrentChange:we,onSizeChange:ke,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):z("",!0),fe,C(Qe,{modelValue:D(q).pFlag,"onUpdate:modelValue":b[17]||(b[17]=e=>D(q).pFlag=e),title:D(q).pTitle,width:"600px","before-close":Se,"close-on-click-modal":!1},{footer:L((()=>[k("span",ge,[C(_,{onClick:b[15]||(b[15]=e=>Te())},{default:L((()=>[ve])),_:1}),C(_,{type:"primary",onClick:b[16]||(b[16]=e=>{Ue.value.validate((e=>{if(console.log("valid",e),!e)return!1;{let e={};e.name=q.propertyForm.name,e.label=q.propertyForm.label,e.accessMode=q.propertyForm.accessMode,e.type=q.propertyForm.type,e.unit=q.propertyForm.unit,2===q.propertyForm.type&&(e.decimals=q.propertyForm.decimals);let a={};3!==q.propertyForm.type?(a.min=q.propertyForm.min,a.max=q.propertyForm.max,a.minMaxAlarm=q.propertyForm.minMaxAlarm,a.step=q.propertyForm.step,a.stepAlarm=q.propertyForm.stepAlarm):(a.dataLength=q.propertyForm.dataLength,a.dataLengthAlarm=q.propertyForm.dataLengthAlarm),e.params=a,console.log("submitPorpertyForm -> property",e);const l={token:S.token,data:{name:T.curDeviceModel.name,property:e}};q.pTitle.includes("添加")?(console.log("添加属性"),E.addDeviceModelProperty(l).then((e=>{Oe(e,O),Te()}))):(console.log("编辑属性"),E.editDeviceModelProperty(l).then((e=>{Oe(e,O),Te()})))}}))})},{default:L((()=>[he])),_:1})])])),default:L((()=>[k("div",ye,[C(Ge,{model:D(q).propertyForm,rules:D(q).propertyRules,ref_key:"propertyFormRef",ref:Ue,"status-icon":"","label-position":"right","label-width":"120px"},{default:L((()=>[C(Je,{label:"属性名称",prop:"name"},{default:L((()=>[C(Ie,{disabled:D(q).pTitle.includes("编辑"),type:"text",modelValue:D(q).propertyForm.name,"onUpdate:modelValue":b[9]||(b[9]=e=>D(q).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),C(Je,{label:"属性标签",prop:"label"},{default:L((()=>[C(Ie,{type:"text",modelValue:D(q).propertyForm.label,"onUpdate:modelValue":b[10]||(b[10]=e=>D(q).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),C(Je,{label:"读写属性",prop:"accessMode"},{default:L((()=>[C(We,{modelValue:D(q).propertyForm.accessMode,"onUpdate:modelValue":b[11]||(b[11]=e=>D(q).propertyForm.accessMode=e),style:{width:"100%"},placeholder:"请选择读写属性"},{default:L((()=>[(M(!0),w(j,null,A(D(q).accessModeOptions,(e=>(M(),U(Ke,{key:"accessMode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),C(Je,{label:"属性类型",prop:"type"},{default:L((()=>[C(We,{modelValue:D(q).propertyForm.type,"onUpdate:modelValue":b[12]||(b[12]=e=>D(q).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"100%"},placeholder:"请选择属性类型"},{default:L((()=>[(M(!0),w(j,null,A(D(q).typeOptions,(e=>(M(),U(Ke,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),2===D(q).propertyForm.type?(M(),U(Je,{key:0,label:"小数位数",prop:"decimals"},{default:L((()=>[C(Ie,{type:"text",modelValue:D(q).propertyForm.decimals,"onUpdate:modelValue":b[13]||(b[13]=e=>D(q).propertyForm.decimals=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入小数位数"},null,8,["modelValue"])])),_:1})):z("",!0),3!==D(q).propertyForm.type?(M(),U(Je,{key:1,label:"单位",prop:"unit"},{default:L((()=>[C(Ie,{type:"text",modelValue:D(q).propertyForm.unit,"onUpdate:modelValue":b[14]||(b[14]=e=>D(q).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1})):z("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),C(Qe,{modelValue:D(q).psFlag,"onUpdate:modelValue":b[18]||(b[18]=e=>D(q).psFlag=e),title:"导入设备属性",width:"600px","before-close":je,"close-on-click-modal":!1},{footer:L((()=>[k("span",_e,[C(_,{onClick:ze},{default:L((()=>[xe])),_:1}),C(_,{type:"primary",onClick:Ce},{default:L((()=>[Me])),_:1})])])),default:L((()=>[C(Xe,{ref_key:"uploadDPSRef",ref:De,action:"","auto-upload":!1,"http-request":Le,limit:1,"on-exceed":Pe,"before-upload":Ve},{tip:L((()=>[Fe])),default:L((()=>[C(_,{type:"primary"},{default:L((()=>[be])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-3e21e0e9"]]);var ke=e=>B.request({url:"/tsl/plugin/file",method:"post",data:e}),Ce=e=>B.request({url:"/tsl/plugin/file",method:"get",data:e}),Le=e=>B.request({url:"/tsl/plugin/param",method:"get",data:e});const De=e=>(T("data-v-61feedd3"),e=e(),S(),e),Pe={class:"main-container"},Ve={key:0,class:"main"},ze={class:"title",style:{"justify-content":"space-between"}},je=V(" 添加 "),Ae=V(" 刷新 "),Ue={class:"param-content"},Te={class:"pc-title"},Se={class:"pct-info"},Re=V("参数详情 "),Ie={class:"pc-content"},qe={class:"param-item"},Oe=De((()=>k("div",{class:"param-value"},"插件名称：",-1))),He={class:"param-name"},Ne={class:"param-item"},Be=De((()=>k("div",{class:"param-value"},"插件标签：",-1))),Ee={class:"param-name"},Je={class:"param-item"},Ke=De((()=>k("div",{class:"param-value"},"插件版本：",-1))),We={class:"param-name"},Ge={class:"param-item"},Qe=De((()=>k("div",{class:"param-value"},"插件描述：",-1))),Xe={class:"param-name"},Ye={class:"param-item"},Ze=De((()=>k("div",{class:"param-value"},"上传日期：",-1))),$e={class:"param-name"},ea={class:"param-item"},aa=De((()=>k("div",{class:"param-value"},"插件作者：",-1))),la={class:"param-name"},ta=V("导入插件"),oa=V("导出插件"),ra=V("变量详情"),sa=V("编辑"),ia=V("删除"),da=De((()=>k("div",null,"无数据",-1))),na={class:"pagination"},pa={class:"dialog-content"},ca={class:"dialog-footer"},ma=V("取消"),ua=V("保存"),fa=V("选择文件"),ya=De((()=>k("div",{class:"el-upload__tip"},"只能上传一个文件，只支持zip格式文件，且文件尺寸不大于1MB！",-1))),ga={class:"dialog-footer"},va=V("取消"),ha=V("上传");var ba=O({setup(o){const r=H(),s=b(null),m=F({typeModel:0,dpFlag:!0,headerCellStyle:{background:N.primaryColor,color:N.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceModelInfo:"",tableData:[],modelForm:{name:"",label:"",type:0,param:""},modelRules:{name:[{required:!0,message:"采集模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"采集模型标识不能为空",trigger:"blur"}],param:[{required:!0,message:"采集模型插件不能为空",trigger:"blur"}]},udFlag:!1,dmFlag:!1,dmTitle:"添加采集模型",pluginList:[],curDeviceModel:""}),u=a=>{const l={token:r.token,data:{type:m.typeModel}};E.getDeviceModelList(l).then((async l=>{console.log("getDeviceModelList -> res = ",l),l&&("0"===l.code?(m.tableData=l.data,1===a&&e({type:"success",message:"刷新成功！"})):te(l),await R((()=>{m.tableMaxHeight=s.value.clientHeight-34-36-22})))}))};u();const j=_((()=>m.tableData.filter((e=>{var a=!m.deviceModelInfo,l=e.name.toLowerCase().includes(m.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(m.deviceModelInfo.toLowerCase());return a||l})).slice((m.currentPage-1)*m.pagesize,m.currentPage*m.pagesize))),A=_((()=>m.tableData.filter((e=>{var a=!m.deviceModelInfo,l=e.name.toLowerCase().includes(m.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(m.deviceModelInfo.toLowerCase());return a||l})))),T=e=>{m.currentPage=e},S=e=>{m.pagesize=e},O=e=>{m.dmFlag=!0,m.dmTitle="编辑采集模型",m.modelForm={name:e.name,label:e.label,type:void 0===e.type?0:e.type,param:e.param}},B=b(null),J=()=>{m.dmFlag=!1,B.value.resetFields(),W()},K=()=>{J()},W=()=>{m.modelForm={name:"",label:"",type:0}},Q=()=>{Y.value&&Y.value.submit()},X=e=>{},Y=b(null),Z=e=>{Y.value.clearFiles(),console.log("handleExceed -> files",e);const a=e[0];Y.value.handleStart(a)},$=a=>{console.log("beforeUpload -> file",a);const l=["application/x-zip-compressed","application/zip"].includes(a.type),t=a.size/1024<=1024;if(l)if(t){if(l&&t){let l=new FormData;l.append("fileName",a),console.log("formData",l.get("file"));const t={token:r.token,contentType:"multipart/form-data",data:l};ke(t).then((l=>{if("0"===l.code){e.success("导入成功！"),Y.value.clearFiles();const l=a.name.substring(0,a.name.lastIndexOf("."));le(l)}else te(l);console.log("importOnePlugin -> res = ",l)}))}}else e({type:"error",message:"文件大小不正确,不能超过1MB！"});else e({type:"error",message:"文件格式不正确,必须是zip文件！"})},ee=()=>{m.udFlag=!1,Y.value.clearFiles()},ae=()=>{ee()},le=e=>{const a={token:r.token,data:{name:e}};Le(a).then((e=>{if("0"===e.code){m.curDeviceModel.param=e.data;const a={token:r.token,data:m.curDeviceModel};E.editDeviceModel(a).then((e=>{oe(e,u),m.udFlag=!1}))}else te(e)}))},te=a=>{e({type:"error",message:a.message})},oe=(a,l)=>{e({type:"0"===a.code?"success":"error",message:a.message}),"0"===a.code&&l&&l()};return(o,b)=>{const F=l,_=i,R=x("Icon"),H=t,N=d,W=v,le=h,re=n,se=p,ie=c,de=f,ne=y,pe=g;return M(),w("div",Pe,[D(m).dpFlag?(M(),w("div",Ve,[k("div",ze,[C(_,{style:{width:"200px"},placeholder:"请输入采集模型名称/标签",modelValue:D(m).deviceModelInfo,"onUpdate:modelValue":b[0]||(b[0]=e=>D(m).deviceModelInfo=e)},{prefix:L((()=>[C(F,{class:"el-input__icon"},{default:L((()=>[C(D(G))])),_:1})])),_:1},8,["modelValue"]),k("div",null,[C(H,{type:"primary",bg:"",class:"right-btn",onClick:b[1]||(b[1]=e=>(m.dmFlag=!0,void(m.dmTitle="添加采集模型")))},{default:L((()=>[C(F,{class:"btn-icon"},{default:L((()=>[C(R,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),je])),_:1}),C(H,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:b[2]||(b[2]=e=>{u(1)})},{default:L((()=>[C(F,{class:"btn-icon"},{default:L((()=>[C(R,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),Ae])),_:1})])]),k("div",{class:"content",ref_key:"contentRef",ref:s},[C(re,{data:D(j),"cell-style":D(m).cellStyle,"header-cell-style":D(m).headerCellStyle,"max-height":D(m).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:O},{empty:L((()=>[da])),default:L((()=>[C(N,{prop:"name",label:"采集模型名称",width:"auto","min-width":"150",align:"center"}),C(N,{prop:"label",label:"采集模型标签",width:"auto","min-width":"150",align:"center"}),C(N,{label:"采集模型插件信息",width:"auto","min-width":"600",align:"center"},{default:L((e=>[void 0===e.row.type||0===e.row.type?(M(),U(le,{key:0,trigger:"hover","show-after":500,"auto-close":500,effect:"light",width:"auto",placement:"left"},{default:L((()=>[k("div",Ue,[k("div",Te,[k("div",Se,[k("b",null,P(e.row.name),1),Re])]),k("div",Ie,[k("div",qe,[Oe,k("div",He,P(e.row.param.name),1)]),k("div",Ne,[Be,k("div",Ee,P(e.row.param.label),1)]),k("div",Je,[Ke,k("div",We,P(e.row.param.version),1)]),k("div",Ge,[Qe,k("div",Xe,P(e.row.param.message),1)]),k("div",Ye,[Ze,k("div",$e,P(e.row.param.date),1)]),k("div",ea,[aa,k("div",la,P(e.row.param.author),1)])])])])),reference:L((()=>[C(W,{size:"large"},{default:L((()=>[V(P(e.row.param),1)])),_:2},1024)])),_:2},1024)):z("",!0)])),_:1}),C(N,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:L((l=>[C(H,{onClick:e=>{return a=l.row,m.udFlag=!0,m.curDeviceModel=a,void(Y.value&&Y.value.clearFiles());var a},text:"",type:"info"},{default:L((()=>[ta])),_:2},1032,["onClick"]),I(C(H,{onClick:e=>(e=>{const a={token:r.token,responseType:"blob",data:{name:e.param.name}};Ce(a).then((e=>{if(console.log("exportOnePlugin -> res",e),e&&"1"===e.code)return void te(e);const a=new Blob([e.blob]),l=e.fileName,t=document.createElement("a");t.download=l,t.style.display="none",t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})(l.row),text:"",type:"info"},{default:L((()=>[oa])),_:2},1032,["onClick"]),[[q,""!==l.row.param.name]]),C(H,{onClick:e=>{return a=l.row,m.curDeviceModel=a,void(m.dpFlag=!1);var a},text:"",type:"success"},{default:L((()=>[ra])),_:2},1032,["onClick"]),C(H,{onClick:e=>O(l.row),text:"",type:"primary"},{default:L((()=>[sa])),_:2},1032,["onClick"]),C(H,{onClick:t=>{return o=l.row,void a.confirm("确定要删除这个采集模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:r.token,data:{name:o.name,type:0}};E.deleteDeviceModel(e).then((e=>{oe(e,u)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var o},text:"",type:"danger"},{default:L((()=>[ia])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),k("div",na,[C(se,{"current-page":D(m).currentPage,"page-size":D(m).pagesize,"page-sizes":[20,50,200,500],total:D(A).length,onCurrentChange:T,onSizeChange:S,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):(M(),U(we,{key:1,curDeviceModel:D(m).curDeviceModel,onChangeDpFlag:b[3]||(b[3]=e=>{m.dpFlag=!0})},null,8,["curDeviceModel"])),C(ne,{modelValue:D(m).dmFlag,"onUpdate:modelValue":b[8]||(b[8]=e=>D(m).dmFlag=e),title:D(m).dmTitle,width:"600px","before-close":K,"close-on-click-modal":!1},{footer:L((()=>[k("span",ca,[C(H,{onClick:b[6]||(b[6]=e=>J())},{default:L((()=>[ma])),_:1}),C(H,{type:"primary",onClick:b[7]||(b[7]=e=>{B.value.validate((e=>{if(!e)return!1;{m.modelForm.type=m.typeModel;const e={token:r.token,data:m.modelForm};m.dmTitle.includes("添加")?E.addDeviceModel(e).then((e=>{oe(e,u),J()})):E.editDeviceModel(e).then((e=>{oe(e,u),J()}))}}))})},{default:L((()=>[ua])),_:1})])])),default:L((()=>[k("div",pa,[C(de,{model:D(m).modelForm,rules:D(m).modelRules,ref_key:"modelFormRef",ref:B,"status-icon":"","label-position":"right","label-width":"120px"},{default:L((()=>[C(ie,{label:"采集模型名称",prop:"name"},{default:L((()=>[C(_,{type:"text",disabled:D(m).dmTitle.includes("编辑"),modelValue:D(m).modelForm.name,"onUpdate:modelValue":b[4]||(b[4]=e=>D(m).modelForm.name=e),autocomplete:"off",placeholder:"请输入采集模型名称，必须和插件名称一致！"},null,8,["disabled","modelValue"])])),_:1}),C(ie,{label:"采集模型标签",prop:"label"},{default:L((()=>[C(_,{type:"text",modelValue:D(m).modelForm.label,"onUpdate:modelValue":b[5]||(b[5]=e=>D(m).modelForm.label=e),autocomplete:"off",placeholder:"请输入采集模型标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),C(ne,{modelValue:D(m).udFlag,"onUpdate:modelValue":b[9]||(b[9]=e=>D(m).udFlag=e),title:"上传物模型插件",width:"600px","before-close":ae,"close-on-click-modal":!1},{footer:L((()=>[k("span",ga,[C(H,{onClick:ee},{default:L((()=>[va])),_:1}),C(H,{type:"primary",onClick:Q},{default:L((()=>[ha])),_:1})])])),default:L((()=>[C(pe,{ref_key:"uploadRef",ref:Y,action:"","auto-upload":!1,"http-request":X,limit:1,"on-exceed":Z,"before-upload":$},{tip:L((()=>[ya])),default:L((()=>[C(H,{type:"primary"},{default:L((()=>[fa])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-61feedd3"]]);export{ba as default};
