import{e,p as l,u as a,O as s,y as t,A as o,P as n,H as d,q as i,Q as u,R as r,h as c}from"./element-plus.795748f2.js";import{_ as p,u as m,S as f}from"./index.c4bb92fc.js";import{L as b,M as v}from"./@element-plus.102632fb.js";import{Y as h,f as _,o as g,c as y,a as k,S as j,Q as x,u as F,M as w,af as L,as as C,at as V,a0 as N,P as R}from"./@vue.8518410d.js";import"./@vueuse.c0256496.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./vue-router.ae8a7199.js";import"./pinia.4a496763.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./nprogress.aae2b787.js";const S=e=>(C("data-v-aa6179c6"),e=e(),V(),e),U={class:"main-container"},I={class:"main",style:{"background-color":"inherit"}},z=S((()=>k("div",{class:"card-header"},[k("span",null,"本地备份")],-1))),T={class:"item"},O=S((()=>k("div",{class:"card-header"},[k("span",null,"备份系统文件")],-1))),q={class:"item"},M=S((()=>k("div",null,"将当前系统配置导出并保存在您的计算机中。今后若需要恢复此配置，直接导入该备份文件即可。",-1))),P=S((()=>k("br",null,null,-1))),Q=S((()=>k("div",null,"提示：导出的配置文件会加密存储您的个人数据，请妥善保存。",-1))),A=S((()=>k("br",null,null,-1))),B=S((()=>k("br",null,null,-1))),D=S((()=>k("br",null,null,-1))),E={style:{"text-align":"center"}},H=N(" 导出系统配置文件 "),Y=S((()=>k("div",{class:"card-header"},[k("span",null,"还原系统文件")],-1))),G={class:"item"},J=S((()=>k("div",null,"请选择您要恢复的配置文件。",-1))),K=S((()=>k("br",null,null,-1))),W=S((()=>k("br",null,null,-1))),X=S((()=>k("br",null,null,-1))),Z={style:{"text-align":"center"}},$=N(" 导入系统配置文件 "),ee=S((()=>k("div",{class:"card-header"},[k("span",null,"远程备份")],-1))),le={class:"item"},ae=S((()=>k("div",{class:"card-header"},[k("span",null,"备份系统文件")],-1))),se={class:"item"},te=S((()=>k("div",null,"将当前系统配置导出并保存在云平台。今后若需要恢复此配置，可以从云平台导入需要的版本即可。",-1))),oe=S((()=>k("br",null,null,-1))),ne=S((()=>k("div",null,"提示：云平台只保存最新的5次备份文件。",-1))),de=S((()=>k("br",null,null,-1))),ie=S((()=>k("br",null,null,-1))),ue=S((()=>k("br",null,null,-1))),re={style:{"text-align":"center"}},ce=N(" 备份系统配置文件至云平台 "),pe=S((()=>k("div",{class:"card-header"},[k("span",null,"还原系统文件")],-1))),me={class:"item"},fe=S((()=>k("div",null,"1、点击“获取远程备份文件”按钮，获取备份文件列表；",-1))),be=S((()=>k("div",null,"2、请选择您需要的版本，点击“还原系统配置文件”按钮，来恢复系统配置文件；",-1))),ve=S((()=>k("div",null,"3、请重启网关。",-1))),he=S((()=>k("br",null,null,-1))),_e=S((()=>k("br",null,null,-1))),ge=S((()=>k("br",null,null,-1))),ye={style:{"text-align":"center"}},ke=N("获取远程备份文件"),je=N(" 还原系统配置文件 "),xe=N("选择文件"),Fe=S((()=>k("div",{class:"el-upload__tip"},"只能上传一个文件，只支持zip格式文件！",-1))),we={class:"dialog-footer"},Le=N("取消"),Ce=N("上传"),Ve=N("通讯接口"),Ne=N("采集接口"),Re=N("驱动插件"),Se=N("上报接口"),Ue={class:"dialog-footer"},Ie=N("导出");var ze=p({setup(p){const C=m(),V=h({uFlag:!1,fileList:[],fileName:"",sn:"",sFlag:!1,checkList:["comm","coll","plugin","report"]});let N=sessionStorage.getItem("SN");""!==N&&(V.sn=N,console.log("SN = ",V.sn));const S=()=>{const e={token:C.token,responseType:"blob",data:{names:V.checkList}};f.exportSystemConfig(e).then((e=>{if(e&&"1"===e.code)return void Ae(e);const l=new Blob([e.blob]),a=e.fileName,s=document.createElement("a");s.download=a,s.style.display="none",s.href=URL.createObjectURL(l),document.body.appendChild(s),s.click(),URL.revokeObjectURL(s.href),document.body.removeChild(s)}))},ze=()=>{Oe.value&&Oe.value.submit()},Te=e=>{},Oe=_(null),qe=e=>{Oe.value.clearFiles();const l=e[0];Oe.value.handleStart(l)},Me=e=>{console.log("beforeUpload -> file",e);const l=["application/x-zip-compressed","application/zip"].includes(e.type);if(l){if(l){let l=new FormData;l.append("file",e);const a={token:C.token,contentType:"multipart/form-data",data:l};f.importSystemConfig(a).then((e=>{"0"===e.code?(c.success(e.message),V.uFlag=!1,getNodeList()):Ae(e)}))}}else c({type:"error",message:"文件格式不正确,必须是zip文件！"})},Pe=()=>{V.uFlag=!1,Oe.value.clearFiles()},Qe=()=>{Pe()},Ae=e=>{c({type:"error",message:e.message})};return(p,m)=>{const h=e,_=l,N=a,Be=s,De=t,Ee=o,He=n,Ye=d,Ge=i,Je=u,Ke=r;return g(),y("div",U,[k("div",I,[j(He,{gutter:20},{default:x((()=>[j(Be,{span:12},{default:x((()=>[j(N,{class:"box-card",shadow:"hover"},{header:x((()=>[z])),default:x((()=>[k("div",T,[j(N,{class:"box-card",shadow:"hover"},{header:x((()=>[O])),default:x((()=>[k("div",q,[M,P,Q,A,B,D,k("div",E,[j(_,{type:"primary",onClick:m[0]||(m[0]=e=>{V.sFlag=!0})},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(F(b))])),_:1}),H])),_:1})])])])),_:1}),j(N,{class:"box-card",shadow:"hover"},{header:x((()=>[Y])),default:x((()=>[k("div",G,[J,K,W,X,k("div",Z,[j(_,{type:"primary",onClick:m[1]||(m[1]=e=>{V.uFlag=!0})},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(F(v))])),_:1}),$])),_:1})])])])),_:1})])])),_:1})])),_:1}),j(Be,{span:12},{default:x((()=>[j(N,{class:"box-card",shadow:"hover"},{header:x((()=>[ee])),default:x((()=>[k("div",le,[j(N,{class:"box-card",shadow:"hover"},{header:x((()=>[ae])),default:x((()=>[k("div",se,[te,oe,ne,de,ie,ue,k("div",re,[j(_,{type:"primary",onClick:m[2]||(m[2]=e=>(()=>{const e={token:C.token,data:{}};f.backupRemote(e).then((e=>{"0"===e.code?c({type:"success",message:e.message}):Ae(e)}))})())},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(F(v))])),_:1}),ce])),_:1})])])])),_:1}),j(N,{class:"box-card",shadow:"hover"},{header:x((()=>[pe])),default:x((()=>[k("div",me,[fe,be,ve,he,_e,ge,k("div",ye,[j(_,{type:"primary",onClick:m[3]||(m[3]=e=>(()=>{if(""===V.sn)c.warning("本网关为配置SN号！");else{const e={token:C.token,data:{sn:V.sn}};f.getRemoteFileInfo(e).then((e=>{"0"===e.code?V.fileList=e.data:Ae(e)}))}})())},{default:x((()=>[ke])),_:1}),j(Ee,{modelValue:F(V).fileName,"onUpdate:modelValue":m[4]||(m[4]=e=>F(V).fileName=e),style:{margin:"0 20px"}},{default:x((()=>[(g(!0),y(w,null,L(F(V).fileList,(e=>(g(),R(De,{key:e.backupId+e.backupTime,label:e.backupId+"("+e.backupTime+")",value:e.backupId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),j(_,{type:"primary",onClick:m[5]||(m[5]=e=>(()=>{if(""!==V.fileName){const e={token:C.token,data:{sn:V.sn,backupId:V.fileName}};f.getRemoteFile(e).then((e=>{"0"===e.code?c.success("获取备份文件成功！"):Ae(e)}))}else c.warning("请选择备份文件的版本！")})())},{default:x((()=>[j(h,{class:"el-input__icon"},{default:x((()=>[j(F(b))])),_:1}),je])),_:1})])])])),_:1})])])),_:1})])),_:1})])),_:1})]),j(Ge,{modelValue:F(V).uFlag,"onUpdate:modelValue":m[6]||(m[6]=e=>F(V).uFlag=e),title:"上传系统配置文件",width:"600px","before-close":Qe,"close-on-click-modal":!1},{footer:x((()=>[k("span",we,[j(_,{onClick:Pe},{default:x((()=>[Le])),_:1}),j(_,{type:"primary",onClick:ze},{default:x((()=>[Ce])),_:1})])])),default:x((()=>[j(Ye,{ref_key:"uploadRef",ref:Oe,action:"","auto-upload":!1,"http-request":Te,limit:1,"on-exceed":qe,"before-upload":Me},{tip:x((()=>[Fe])),default:x((()=>[j(_,{type:"primary"},{default:x((()=>[xe])),_:1})])),_:1},512)])),_:1},8,["modelValue"]),j(Ge,{modelValue:F(V).sFlag,"onUpdate:modelValue":m[8]||(m[8]=e=>F(V).sFlag=e),title:"需要导出的内容",width:"500px"},{footer:x((()=>[k("span",Ue,[j(_,{type:"primary",onClick:S},{default:x((()=>[Ie])),_:1})])])),default:x((()=>[j(Ke,{modelValue:F(V).checkList,"onUpdate:modelValue":m[7]||(m[7]=e=>F(V).checkList=e)},{default:x((()=>[j(Je,{label:"comm"},{default:x((()=>[Ve])),_:1}),j(Je,{label:"coll"},{default:x((()=>[Ne])),_:1}),j(Je,{label:"plugin"},{default:x((()=>[Re])),_:1}),j(Je,{label:"report"},{default:x((()=>[Se])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-aa6179c6"]]);export{ze as default};
