import{h as e,C as a,e as l,p as t,m as r,D as o,v as p,L as n,F as i,G as s,n as m,y as d,A as c,K as u,B as y,o as f,q as g,I as h,J as v,u as b}from"./element-plus.795748f2.js";import{s as F,_ as x,u as _,v as w}from"./index.3a6602e1.js";import{I as V}from"./interface.d9f27ae5.js";import{D as k}from"./deviceModel.eb023515.js";import{J as C,I as N}from"./@element-plus.102632fb.js";import{f as L,Y as P,p as D,X as A,o as M,c as I,a as U,S as z,Q as S,u as T,U as j,a0 as E,M as q,af as O,P as R,L as H,O as B,as as J,at as W,H as G}from"./@vue.8518410d.js";import"./@vueuse.c0256496.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./vue-router.ae8a7199.js";import"./pinia.4a496763.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./nprogress.aae2b787.js";var K=e=>F.request({url:"/virtual/devices",method:"get",data:e}),Q=e=>F.request({url:"/virtual/device",method:"post",data:e}),X=e=>F.request({url:"/virtual/device",method:"put",data:e}),Y=e=>F.request({url:"/virtual/devices",method:"delete",data:e}),Z=e=>F.request({url:"/virtual/properties",method:"get",data:e}),$=e=>F.request({url:"/virtual/property",method:"post",data:e}),ee=e=>F.request({url:"/virtual/property",method:"put",data:e}),ae=e=>F.request({url:"/virtual/properties",method:"delete",data:e});const le=e=>(J("data-v-7957a015"),e=e(),W(),e),te={class:"main"},re={class:"title",style:{"justify-content":"space-between"}},oe={class:"title-left"},pe=E(" 返回上报模型 "),ne={class:"title",style:{top:"60px",height:"76px",padding:"20px 0","justify-content":"space-between"}},ie={class:"tName"},se={style:{display:"flex","align-items":"center"}},me=E(" 添加 "),de=E(" 删除 "),ce=E(" 刷新 "),ue={class:"param-content"},ye={class:"pc-title"},fe={class:"pct-info"},ge=E(" "+j("参数详情")),he={class:"pc-content"},ve={class:"param-item"},be={class:"param-value"},Fe={class:"param-name"},xe={class:"param-content"},_e={class:"pc-title"},we={class:"pct-info"},Ve=E(" "+j("参数详情")),ke={class:"pc-content"},Ce={class:"param-item"},Ne={class:"param-value"},Le={class:"param-name"},Pe=E("编辑"),De=le((()=>U("div",null,"无数据",-1))),Ae={class:"pagination"},Me={class:"dialog-content"},Ie=E("同步"),Ue=E(" 映射参数 "),ze=E("编辑"),Se=E(" 报警参数 "),Te={class:"dialog-footer"},je=E("取消"),Ee=E("保存"),qe={class:"dialog-content"},Oe={style:{width:"100%"}},Re={class:"operation"},He={style:{"padding-right":"10px"}},Be={class:"dialog-footer"},Je=E("取消"),We=E("保存"),Ge={class:"dialog-content"},Ke={class:"dialog-cLeft"},Qe=le((()=>U("div",{class:"card-header"},[U("span",null,"请选择采集模型")],-1))),Xe={class:"card-main"},Ye=["onClick"],Ze={class:"dialog-cRight"},$e=le((()=>U("div",{class:"card-header"},[U("span",null,"请选择模型属性")],-1))),ea={class:"card-main"},aa=["onClick"],la={class:"dialog-footer"},ta=E("取消"),ra=E("保存");var oa=x({props:{curVirtualDevice:{type:Object,default:{}}},emits:["changeDpFlag"],setup(F,{emit:x}){const J=F,W=_();console.log(J);const K=L(null),Q=P({formulaForm:{},headerCellStyle:{background:w.primaryColor,color:w.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,PropertyTableData:[],pFlag:!1,pTitle:"添加属性",PropertyInfo:"",propertyForm:{name:"",label:"",type:0,unit:"",decimals:0,collName:"",deviceName:"",propertyName:"",saveEnable:!1,formula:"",min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,dataLength:"",dataLengthAlarm:!1},typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},paramName:{name:"属性名称",label:"属性标签",type:"数据类型",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"布长",stepAlarm:"布长报警",unit:"单位",decimals:"小数位数",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警",collName:"采集接口名称",deviceName:"设备名称",propertyName:"属性名称",saveEnable:"掉电保存",formula:"计算公式"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],label:[{required:!0,message:"属性标签不能为空",trigger:"blur"}],type:[{required:!0,message:"数据类型不能为空",trigger:"blur"}],decimals:[{type:"number",message:"小数位数只能输入数字"}],collName:[{required:!0,message:"采集接口名称不能为空",trigger:"blur"}],deviceName:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],propertyName:[{required:!0,message:"设备属性名称不能为空",trigger:"blur"}]},collOptions:[],nodeOptions:[],propertyOptions:[],nameTotsl:{},propertyInfo:[],operationList:[{name:"+",label:"+",describe:"加"},{name:"-",label:"-",describe:"减"},{name:"*",label:"*",describe:"乘"},{name:"/",label:"/",describe:"除"},{name:"%",label:"%",describe:"模"},{name:"^",label:"^",describe:"次幂"},{name:"(",label:"(",describe:"左括号"},{name:")",label:")",describe:"右括号"}],curFormula:"",selectionStart:0,pItem:"",fFlag:!1,selectedProperties:[],modelList:[],curModelName:"",curPropertyName:"",propertyList:[],mpFlag:!1,curProperty:{}}),X=a=>{const l={token:W.token,data:{deviceName:J.curVirtualDevice.name}};Z(l).then((async l=>{l&&("0"===l.code?(Q.PropertyTableData=l.data,1===a&&e({type:"success",message:"刷新成功！"})):wa(l),await G((()=>{Q.tableMaxHeight=K.value.clientHeight-34-36-22})))}))};X();const Y=D((()=>{let e=Q.PropertyInfo;return Q.PropertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase()))).slice((Q.currentPage-1)*Q.pagesize,Q.currentPage*Q.pagesize)})),le=D((()=>{let e=Q.PropertyInfo;return Q.PropertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase())))})),oa=e=>{Q.currentPage=e},pa=e=>{Q.pagesize=e},na=()=>{Q.mpFlag=!1},ia=()=>{const e={token:W.token,data:{name:Q.curModelName}};k.getDeviceModelProperty(e).then((e=>{console.log("getDeviceModelProperty -> res",e),e&&("0"===e.code?Q.propertyList=e.data:wa(e))}))},sa=()=>{Q.mpFlag=!0,(()=>{const e={token:W.token,data:{}};k.getDeviceModelList(e).then((e=>{console.log("getDeviceModelList -> res = ",e),e&&("0"===e.code?Q.modelList=e.data:wa(e))}))})()},ma=e=>{console.log("editProperty -> row ",e),Q.pFlag=!0,Q.pTitle="编辑属性",Q.propertyForm.name=e.name,Q.propertyForm.label=e.label,Q.propertyForm.type=e.type,Q.propertyForm.decimals=e.decimals,Q.propertyForm.unit=e.unit,Q.propertyForm.collName=e.params.collName,Q.propertyForm.deviceName=e.params.deviceName,Q.propertyForm.propertyName=e.params.propertyName,Q.propertyForm.formula=e.params.formula,Q.propertyForm.saveEnable=e.params.saveEnable,3!==e.type?(Q.propertyForm.min=e.alarmParams.min,Q.propertyForm.max=e.alarmParams.max,Q.propertyForm.minMaxAlarm=e.alarmParams.minMaxAlarm,Q.propertyForm.step=e.alarmParams.step,Q.propertyForm.stepAlarm=e.alarmParams.stepAlarm):(Q.propertyForm.dataLength=e.alarmParams.dataLength,Q.propertyForm.dataLengthAlarm=e.alarmParams.dataLengthAlarm),console.log("ctxData.propertyForm",Q.propertyForm),va(Q.propertyForm.collName).then((e=>{ha(e),Fa(Q.propertyForm.deviceName)}))},da=L(null),ca=()=>{Q.pFlag=!1,da.value.resetFields(),ua()},ua=()=>{Q.propertyForm={name:"",label:"",type:0,unit:"",decimals:0,collName:"",deviceName:"",propertyName:"",saveEnable:!1,formula:"",min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,dataLength:"",dataLengthAlarm:!1}},ya=e=>{ca()},fa=e=>{Q.selectedProperties=e};(()=>{const e={token:W.token,data:{}};V.getInterfaceList(e).then((e=>{console.log("getInterfaceList -> res",e),"0"===e.code?(Q.collOptions=[],e.data.forEach((e=>{const a={label:e.collInterfaceName,name:e.collInterfaceName};Q.collOptions.push(a)}))):wa(e)}))})();const ga=e=>{va(e).then((e=>{ha(e)})),Q.propertyOptions=[]},ha=e=>{"0"===e.code?(Q.nodeOptions=[],Q.nameTotsl={},e.data.deviceNodeMap.forEach((e=>{const a={label:e.label,name:e.name,tsl:e.tsl};Q.nameTotsl[""+e.name]=e.tsl,Q.nodeOptions.push(a)}))):wa(e)},va=e=>{const a={token:W.token,data:{name:e}};return V.getCollDevices(a)},ba=e=>{Fa(e)},Fa=e=>{const a={token:W.token,data:{name:Q.nameTotsl[e]}};k.getDeviceModelProperty(a).then((e=>{"0"===e.code?(Q.propertyOptions=[],e.data.forEach((e=>{const a={label:e.name+"("+e.label+")",name:e.name};Q.propertyOptions.push(a)}))):wa(e)}))},xa=()=>{Q.propertyInfo=[{name:"t",label:"当前属性"}],Q.PropertyTableData.forEach((e=>{Q.propertyInfo.push({name:e.name,label:e.label})}))},_a=e=>{Q.selectionStart=e.srcElement.selectionStart},wa=a=>{e({type:"error",message:a.message})},Va=(a,l)=>{e({type:"0"===a.code?"success":"error",message:a.message}),"0"===a.code&&l&&l()};return(F,_)=>{const w=l,V=t,k=r,L=A("Icon"),P=o,D=p,G=n,Z=i,ua=s,ha=m,va=d,Fa=c,wa=u,ka=y,Ca=f,Na=g,La=h,Pa=v,Da=b;return M(),I("div",te,[U("div",re,[U("div",oe,[z(V,{type:"primary",plain:"",onClick:_[0]||(_[0]=e=>{x("changeDpFlag")}),style:{"margin-right":"20px"}},{default:S((()=>[z(w,{class:"el-input__icon"},{default:S((()=>[z(T(C))])),_:1}),pe])),_:1})])]),U("div",ne,[U("div",ie,j(J.curVirtualDevice.label),1),U("div",se,[z(k,{style:{width:"200px"},placeholder:"请输入属性名称或者标签",clearable:"",modelValue:T(Q).PropertyInfo,"onUpdate:modelValue":_[1]||(_[1]=e=>T(Q).PropertyInfo=e)},{prefix:S((()=>[z(w,{class:"el-input__icon"},{default:S((()=>[z(T(N))])),_:1})])),_:1},8,["modelValue"]),z(V,{type:"primary",bg:"",class:"right-btn",onClick:_[2]||(_[2]=e=>(Q.pFlag=!0,void(Q.pTitle="添加属性")))},{default:S((()=>[z(w,{class:"btn-icon"},{default:S((()=>[z(L,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),me])),_:1}),z(V,{type:"danger",bg:"",class:"right-btn",onClick:_[3]||(_[3]=l=>(()=>{let l=[];0!==Q.selectedProperties.length?(Q.selectedProperties.forEach((e=>{l.push(e.name)})),console.log("pList",l),a.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:W.token,data:{deviceName:J.curVirtualDevice.name,PropertyNames:l}};ae(e).then((e=>{Va(e,X)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:S((()=>[z(w,{class:"btn-icon"},{default:S((()=>[z(L,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),de])),_:1}),z(V,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:_[4]||(_[4]=e=>{X(1)})},{default:S((()=>[z(w,{class:"btn-icon"},{default:S((()=>[z(L,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),ce])),_:1})])]),U("div",{class:"content",ref_key:"contentRef",ref:K,style:{top:"136px"}},[z(Z,{data:T(Y),"cell-style":T(Q).cellStyle,"header-cell-style":T(Q).headerCellStyle,"max-height":T(Q).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:fa,onRowDblclick:ma},{empty:S((()=>[De])),default:S((()=>[z(P,{type:"selection",width:"55"}),z(P,{prop:"name",label:"属性名称",width:"auto","min-width":"180",align:"center"}),z(P,{prop:"label",label:"属性标签",width:"auto","min-width":"180",align:"center"}),z(P,{label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:S((e=>[E(j(T(Q).typeNames["t"+e.row.type]),1)])),_:1}),z(P,{label:"小数位数",width:"auto","min-width":"80",align:"center"},{default:S((e=>[E(j(void 0===e.row.decimals||""===e.row.decimals?0:e.row.decimals),1)])),_:1}),z(P,{prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),z(P,{label:"映射参数详情",width:"auto","min-width":"300",align:"center"},{default:S((e=>[z(G,{trigger:"hover","show-after":500,"auto-close":500,effect:"light",width:"auto",placement:"left"},{default:S((()=>[U("div",ue,[U("div",ye,[U("div",fe,[U("b",null,j(e.row.name),1),ge])]),U("div",he,[(M(!0),I(q,null,O(e.row.params,((e,a,l)=>(M(),I("div",ve,[U("div",be,j(T(Q).paramName[a])+"：",1),U("div",Fe,j("boolean"==typeof e?e?"是":"否":e),1)])))),256))])])])),reference:S((()=>[z(D,{size:"large"},{default:S((()=>[E(j(e.row.params),1)])),_:2},1024)])),_:2},1024)])),_:1}),z(P,{label:"报警参数详情",width:"auto","min-width":"300",align:"center"},{default:S((e=>[z(G,{trigger:"hover","show-after":500,"auto-close":500,effect:"light",width:"auto",placement:"left"},{default:S((()=>[U("div",xe,[U("div",_e,[U("div",we,[U("b",null,j(e.row.name),1),Ve])]),U("div",ke,[(M(!0),I(q,null,O(e.row.alarmParams,((e,a,l)=>(M(),I("div",Ce,[U("div",Ne,j(T(Q).paramName[a])+"：",1),U("div",Le,j("boolean"==typeof e?e?"是":"否":e),1)])))),256))])])])),reference:S((()=>[z(D,{size:"large"},{default:S((()=>[E(j(e.row.alarmParams),1)])),_:2},1024)])),_:2},1024)])),_:1}),z(P,{label:"操作",width:"auto","min-width":"150",align:"center",fixed:"right"},{default:S((e=>[z(V,{onClick:a=>ma(e.row),text:"",type:"primary"},{default:S((()=>[Pe])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),U("div",Ae,[z(ua,{"current-page":T(Q).currentPage,"page-size":T(Q).pagesize,"page-sizes":[20,50,200,500],total:T(le).length,onCurrentChange:oa,onSizeChange:pa,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),z(Na,{modelValue:T(Q).pFlag,"onUpdate:modelValue":_[26]||(_[26]=e=>T(Q).pFlag=e),title:T(Q).pTitle,width:"800px","before-close":ya,"close-on-click-modal":!1},{footer:S((()=>[U("span",Te,[z(V,{onClick:_[24]||(_[24]=e=>ca())},{default:S((()=>[je])),_:1}),z(V,{type:"primary",onClick:_[25]||(_[25]=e=>{da.value.validate((e=>{if(console.log("valid",e),!e)return!1;{let e={};e.name=Q.propertyForm.name,e.label=Q.propertyForm.label,e.type=Q.propertyForm.type,e.decimals=Q.propertyForm.decimals,e.unit=Q.propertyForm.unit;let a={collName:Q.propertyForm.collName,deviceName:Q.propertyForm.deviceName,propertyName:Q.propertyForm.propertyName,formula:Q.propertyForm.formula,saveEnable:Q.propertyForm.saveEnable},l={};3!==Q.propertyForm.type?(l.min=Q.propertyForm.min,l.max=Q.propertyForm.max,l.minMaxAlarm=Q.propertyForm.minMaxAlarm,l.step=Q.propertyForm.step,l.stepAlarm=Q.propertyForm.stepAlarm):(l.dataLength=Q.propertyForm.dataLength,l.dataLengthAlarm=Q.propertyForm.dataLengthAlarm),e.alarmParams=l,e.params=a,console.log("submitPorpertyForm -> property",e);const t={token:W.token,data:{deviceName:J.curVirtualDevice.name,property:e}};Q.pTitle.includes("添加")?(console.log("添加属性"),$(t).then((e=>{Va(e,X),ca()}))):(console.log("编辑属性"),ee(t).then((e=>{Va(e,X),ca()})))}}))})},{default:S((()=>[Ee])),_:1})])])),default:S((()=>[U("div",Me,[z(Ca,{model:T(Q).propertyForm,rules:T(Q).propertyRules,ref_key:"propertyFormRef",ref:da,"status-icon":"","label-position":"right","label-width":"120px",inline:!0},{default:S((()=>[z(ha,{label:"属性名称",prop:"name"},{default:S((()=>[z(k,{style:{width:"220px"},disabled:T(Q).pTitle.includes("编辑"),readonly:!0,type:"text",modelValue:T(Q).propertyForm.name,"onUpdate:modelValue":_[6]||(_[6]=e=>T(Q).propertyForm.name=e),autocomplete:"off",placeholder:"请选择属性名称"},{append:S((()=>[z(V,{onClick:_[5]||(_[5]=e=>sa())},{default:S((()=>[Ie])),_:1})])),_:1},8,["disabled","modelValue"])])),_:1}),z(ha,{label:"属性标签",prop:"label"},{default:S((()=>[z(k,{style:{width:"220px"},type:"text",readonly:!0,modelValue:T(Q).propertyForm.label,"onUpdate:modelValue":_[7]||(_[7]=e=>T(Q).propertyForm.label=e),autocomplete:"off",placeholder:"请选择属性名称同步属性标签"},null,8,["modelValue"])])),_:1}),z(ha,{label:"数据类型",prop:"type"},{default:S((()=>[z(Fa,{modelValue:T(Q).propertyForm.type,"onUpdate:modelValue":_[8]||(_[8]=e=>T(Q).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择数据类型"},{default:S((()=>[(M(!0),I(q,null,O(T(Q).typeOptions,(e=>(M(),R(va,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),2===T(Q).propertyForm.type?(M(),R(ha,{key:0,label:"小数位数",prop:"decimals"},{default:S((()=>[z(k,{style:{width:"220px"},type:"text",modelValue:T(Q).propertyForm.decimals,"onUpdate:modelValue":_[9]||(_[9]=e=>T(Q).propertyForm.decimals=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入小数位数"},null,8,["modelValue"])])),_:1})):H("",!0),3!==T(Q).propertyForm.type?(M(),R(ha,{key:1,label:"单位",prop:"unit"},{default:S((()=>[z(k,{style:{width:"220px"},type:"text",modelValue:T(Q).propertyForm.unit,"onUpdate:modelValue":_[10]||(_[10]=e=>T(Q).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1})):H("",!0),z(wa,{"content-position":"center"},{default:S((()=>[Ue])),_:1}),z(ha,{label:"采集接口名称",prop:"collName"},{default:S((()=>[z(Fa,{modelValue:T(Q).propertyForm.collName,"onUpdate:modelValue":_[11]||(_[11]=e=>T(Q).propertyForm.collName=e),style:{width:"220px"},placeholder:"请选择采集接口名称",onChange:ga,clearable:"",filterable:""},{default:S((()=>[(M(!0),I(q,null,O(T(Q).collOptions,(e=>(M(),R(va,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),z(ha,{label:"设备名称",prop:"deviceName"},{default:S((()=>[z(Fa,{modelValue:T(Q).propertyForm.deviceName,"onUpdate:modelValue":_[12]||(_[12]=e=>T(Q).propertyForm.deviceName=e),style:{width:"220px"},placeholder:"请选择设备名称",onChange:ba,clearable:"",filterable:""},{default:S((()=>[(M(!0),I(q,null,O(T(Q).nodeOptions,(e=>(M(),R(va,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),z(ha,{label:"设备属性名称",prop:"propertyName"},{default:S((()=>[z(Fa,{modelValue:T(Q).propertyForm.propertyName,"onUpdate:modelValue":_[13]||(_[13]=e=>T(Q).propertyForm.propertyName=e),style:{width:"220px"},placeholder:"请选择设备属性名称",clearable:"",filterable:""},{default:S((()=>[(M(!0),I(q,null,O(T(Q).propertyOptions,(e=>(M(),R(va,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),z(ha,{label:"掉电保存"},{default:S((()=>[z(ka,{style:{width:"220px"},modelValue:T(Q).propertyForm.saveEnable,"onUpdate:modelValue":_[14]||(_[14]=e=>T(Q).propertyForm.saveEnable=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1}),z(ha,{label:"计算公式"},{default:S((()=>[z(k,{style:{width:"220px"},type:"text",readonly:"",modelValue:T(Q).propertyForm.formula,"onUpdate:modelValue":_[16]||(_[16]=e=>T(Q).propertyForm.formula=e),autocomplete:"off",placeholder:"请编辑计算公式"},{append:S((()=>[z(V,{onClick:_[15]||(_[15]=e=>(Q.fFlag=!0,Q.curFormula=Q.propertyForm.formula,void xa()))},{default:S((()=>[ze])),_:1})])),_:1},8,["modelValue"])])),_:1}),z(wa,{"content-position":"center"},{default:S((()=>[Se])),_:1}),3!==T(Q).propertyForm.type?(M(),R(ha,{key:2,label:"范围报警",prop:"minMaxAlarm"},{default:S((()=>[z(ka,{style:{width:"220px"},modelValue:T(Q).propertyForm.minMaxAlarm,"onUpdate:modelValue":_[17]||(_[17]=e=>T(Q).propertyForm.minMaxAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0),3!==T(Q).propertyForm.type?(M(),R(ha,{key:3,label:"布长报警",prop:"stepAlarm"},{default:S((()=>[z(ka,{style:{width:"220px"},modelValue:T(Q).propertyForm.stepAlarm,"onUpdate:modelValue":_[18]||(_[18]=e=>T(Q).propertyForm.stepAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0),3!==T(Q).propertyForm.type&&T(Q).propertyForm.minMaxAlarm?(M(),R(ha,{key:4,label:"最小值",prop:"min"},{default:S((()=>[z(k,{style:{width:"220px"},type:"text",modelValue:T(Q).propertyForm.min,"onUpdate:modelValue":_[19]||(_[19]=e=>T(Q).propertyForm.min=e),autocomplete:"off",placeholder:"请输入最小值"},null,8,["modelValue"])])),_:1})):H("",!0),3!==T(Q).propertyForm.type&&T(Q).propertyForm.minMaxAlarm?(M(),R(ha,{key:5,label:"最大值",prop:"max"},{default:S((()=>[z(k,{style:{width:"220px"},type:"text",modelValue:T(Q).propertyForm.max,"onUpdate:modelValue":_[20]||(_[20]=e=>T(Q).propertyForm.max=e),autocomplete:"off",placeholder:"请输入最大值"},null,8,["modelValue"])])),_:1})):H("",!0),3!==T(Q).propertyForm.type&&T(Q).propertyForm.stepAlarm?(M(),R(ha,{key:6,label:"布长",prop:"step"},{default:S((()=>[z(k,{style:{width:"220px"},type:"text",modelValue:T(Q).propertyForm.step,"onUpdate:modelValue":_[21]||(_[21]=e=>T(Q).propertyForm.step=e),autocomplete:"off",placeholder:"请输入布长"},null,8,["modelValue"])])),_:1})):H("",!0),3===T(Q).propertyForm.type?(M(),R(ha,{key:7,label:"字符串长度报警",prop:"dataLengthAlarm"},{default:S((()=>[z(ka,{style:{width:"220px"},modelValue:T(Q).propertyForm.dataLengthAlarm,"onUpdate:modelValue":_[22]||(_[22]=e=>T(Q).propertyForm.dataLengthAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0),3===T(Q).propertyForm.type&&T(Q).propertyForm.dataLengthAlarm?(M(),R(ha,{key:8,label:"字符串长度",prop:"dataLength"},{default:S((()=>[z(k,{style:{width:"220px"},type:"text",modelValue:T(Q).propertyForm.dataLength,"onUpdate:modelValue":_[23]||(_[23]=e=>T(Q).propertyForm.dataLength=e),autocomplete:"off",placeholder:"请输入字符串长度"},null,8,["modelValue"])])),_:1})):H("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),z(Na,{modelValue:T(Q).fFlag,"onUpdate:modelValue":_[32]||(_[32]=e=>T(Q).fFlag=e),title:"编辑计算公式",width:"600px"},{footer:S((()=>[U("span",Be,[z(V,{onClick:_[30]||(_[30]=e=>(Q.fFlag=!1,void(Q.curFormula="")))},{default:S((()=>[Je])),_:1}),z(V,{type:"primary",onClick:_[31]||(_[31]=e=>(Q.fFlag=!1,void(Q.propertyForm.formula=Q.curFormula)))},{default:S((()=>[We])),_:1})])])),default:S((()=>[U("div",qe,[z(Ca,{model:T(Q).formulaForm,"label-position":"right","label-width":"120px"},{default:S((()=>[z(ha,{label:"运算符号"},{default:S((()=>[U("div",Oe,[(M(!0),I(q,null,O(T(Q).operationList,(e=>(M(),I("div",Re,[U("div",He,[z(V,{style:{width:"100%"},onClick:a=>(e=>{let a=Q.curFormula.length;if(a!==Q.selectionStart){let l=Q.curFormula.substr(0,Q.selectionStart),t=Q.curFormula.substr(Q.selectionStart,a-Q.selectionStart);Q.curFormula=l+e.name+t,Q.selectionStart+=e.name.length}else Q.curFormula+=e.name,Q.selectionStart+=e.name.length})(e)},{default:S((()=>[E(j(e.label),1)])),_:2},1032,["onClick"])])])))),256))])])),_:1}),z(ha,{label:"设备属性"},{default:S((()=>[z(Fa,{modelValue:T(Q).pItem,"onUpdate:modelValue":_[27]||(_[27]=e=>T(Q).pItem=e),filterable:"",placeholder:"请选择设备属性",onChange:_[28]||(_[28]=e=>(e=>{let a=Q.curFormula.length;if(a!==Q.selectionStart){let l=Q.curFormula.substr(0,Q.selectionStart),t=Q.curFormula.substr(Q.selectionStart,a-Q.selectionStart);Q.curFormula=l+"("+e+")"+t,Q.selectionStart+=e.length+2}else Q.curFormula+="("+e+")",Q.selectionStart+=e.length+2})(T(Q).pItem)),style:{width:"100%"}},{default:S((()=>[(M(!0),I(q,null,O(T(Q).propertyInfo,(e=>(M(),R(va,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),z(ha,{label:"当前公式"},{default:S((()=>[z(k,{type:"text",clearable:"",modelValue:T(Q).curFormula,"onUpdate:modelValue":_[29]||(_[29]=e=>T(Q).curFormula=e),autocomplete:"off",placeholder:"请编辑计算公式",onBlur:_a},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),z(Na,{modelValue:T(Q).mpFlag,"onUpdate:modelValue":_[37]||(_[37]=e=>T(Q).mpFlag=e),title:"模型属性选择",width:"1000px"},{footer:S((()=>[U("span",la,[z(V,{onClick:_[35]||(_[35]=e=>na())},{default:S((()=>[ta])),_:1}),z(V,{type:"primary",onClick:_[36]||(_[36]=e=>(Q.propertyForm.name=Q.curProperty.name,Q.propertyForm.label=Q.curProperty.label,void na()))},{default:S((()=>[ra])),_:1})])])),default:S((()=>[U("div",Ge,[U("div",Ke,[z(Da,{class:"card-box",shadow:"hover"},{header:S((()=>[Qe])),default:S((()=>[U("div",Xe,[z(Pa,{modelValue:T(Q).curModelName,"onUpdate:modelValue":_[33]||(_[33]=e=>T(Q).curModelName=e),style:{width:"100%"}},{default:S((()=>[(M(!0),I(q,null,O(T(Q).modelList,(e=>(M(),I("div",{class:B(["upload-item",{isClicked:e.isClicked}]),key:"tml"+e.name},[U("div",{class:"upload-item-text",onClick:a=>(e=>{Q.curModelName=e.name,ia()})(e)},[z(La,{label:e.name},{default:S((()=>[E(j(e.label+" ("+e.name+")"),1)])),_:2},1032,["label"])],8,Ye)],2)))),128))])),_:1},8,["modelValue"])])])),_:1})]),U("div",Ze,[z(Da,{class:"card-box",shadow:"hover"},{header:S((()=>[$e])),default:S((()=>[U("div",ea,[z(Pa,{modelValue:T(Q).curPropertyName,"onUpdate:modelValue":_[34]||(_[34]=e=>T(Q).curPropertyName=e),style:{width:"100%"}},{default:S((()=>[(M(!0),I(q,null,O(T(Q).propertyList,(e=>(M(),I("div",{class:B(["upload-item",{isClicked:e.isClicked}]),key:"tml"+e.name},[U("div",{class:"upload-item-text",onClick:a=>(e=>{Q.curProperty=e})(e)},[z(La,{label:e.name},{default:S((()=>[E(j(e.label+" ("+e.name+")"),1)])),_:2},1032,["label"])],8,aa)],2)))),128))])),_:1},8,["modelValue"])])])),_:1})])])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-7957a015"]]);const pa=e=>(J("data-v-540c4e7b"),e=e(),W(),e),na={class:"main-container"},ia={key:0,class:"main"},sa={class:"title",style:{"justify-content":"space-between"}},ma=E(" 添加 "),da=E(" 删除 "),ca=E(" 刷新 "),ua=E("变量详情"),ya=E("编辑"),fa=E("删除"),ga=pa((()=>U("div",null,"无数据",-1))),ha={class:"pagination"},va={class:"dialog-content"},ba={class:"dialog-footer"},Fa=E("取消"),xa=E("保存");var _a=x({setup(p){const n=_(),d=L(null),c=P({virtualDeviceInfo:"",headerCellStyle:{background:w.primaryColor,color:w.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,tableData:[],dpFlag:!0,vdFlag:!1,vdTitle:"添加虚拟设备",curVirtualDevice:{},virtualForm:{name:"",label:""},virtualRules:{name:[{required:!0,message:"虚拟设备名称不能为空",trigger:"blur"}],label:[{required:!0,message:"虚拟设备标识不能为空",trigger:"blur"}]},selectedDevice:[]}),u=a=>{const l={token:n.token,data:{}};K(l).then((async l=>{l&&("0"===l.code?(c.tableData=l.data,1===a&&e({type:"success",message:"刷新成功！"})):j(l),await G((()=>{c.tableMaxHeight=d.value.clientHeight-34-36-22})))}))};u();const y=D((()=>c.tableData.filter((e=>{var a=!c.virtualDeviceInfo,l=e.name.toLowerCase().includes(c.virtualDeviceInfo.toLowerCase());return a||l})).slice((c.currentPage-1)*c.pagesize,c.currentPage*c.pagesize))),h=D((()=>c.tableData.filter((e=>{var a=!c.virtualDeviceInfo,l=e.name.toLowerCase().includes(c.virtualDeviceInfo.toLowerCase());return a||l})))),v=e=>{c.currentPage=e},b=e=>{c.pagesize=e},F=L(null),x=()=>{c.vdFlag=!1,F.value.resetFields(),C()},V=()=>{x()},k=e=>{c.selectedDevice=e,console.log("handleSelectionChange -> val =",e)},C=()=>{c.virtualForm={name:"",label:""}},j=a=>{e({type:"error",message:a.message})},E=(a,l)=>{e({type:"0"===a.code?"success":"error",message:a.message}),"0"===a.code&&l&&l()};return(p,_)=>{const w=l,C=r,L=A("Icon"),P=t,D=o,j=i,q=s,O=m,H=f,B=g;return M(),I("div",na,[T(c).dpFlag?(M(),I("div",ia,[U("div",sa,[z(C,{style:{width:"200px"},placeholder:"请输入虚拟设备名/标签",modelValue:T(c).virtualDeviceInfo,"onUpdate:modelValue":_[0]||(_[0]=e=>T(c).virtualDeviceInfo=e)},{prefix:S((()=>[z(w,{class:"el-input__icon"},{default:S((()=>[z(T(N))])),_:1})])),_:1},8,["modelValue"]),U("div",null,[z(P,{type:"primary",bg:"",class:"right-btn",onClick:_[1]||(_[1]=e=>(c.vdFlag=!0,void(c.vdTitle="添加虚拟设备")))},{default:S((()=>[z(w,{class:"btn-icon"},{default:S((()=>[z(L,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),ma])),_:1}),z(P,{type:"danger",bg:"",class:"right-btn",onClick:_[2]||(_[2]=l=>(()=>{let l=[];0!==c.selectedDevice.length?(c.selectedDevice.forEach((e=>{l.push(e.name)})),a.confirm("确定要删除这些虚拟设备吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:n.token,data:{names:l}};Y(e).then((e=>{E(e,u)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个虚拟设备！")})())},{default:S((()=>[z(w,{class:"btn-icon"},{default:S((()=>[z(L,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),da])),_:1}),z(P,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:_[3]||(_[3]=e=>{u(1)})},{default:S((()=>[z(w,{class:"btn-icon"},{default:S((()=>[z(L,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),ca])),_:1})])]),U("div",{class:"content",ref_key:"contentRef",ref:d},[z(j,{data:T(y),"cell-style":T(c).cellStyle,"header-cell-style":T(c).headerCellStyle,"max-height":T(c).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:k},{empty:S((()=>[ga])),default:S((()=>[z(D,{type:"selection",width:"55"}),z(D,{prop:"name",label:"虚拟设备名称",width:"auto","min-width":"150",align:"center"}),z(D,{prop:"label",label:"虚拟设备标签",width:"auto","min-width":"150",align:"center"}),z(D,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:S((l=>[z(P,{onClick:e=>{return a=l.row,console.log("showVariableDetail ->",a),c.curVirtualDevice=a,void(c.dpFlag=!1);var a},text:"",type:"success"},{default:S((()=>[ua])),_:2},1032,["onClick"]),z(P,{onClick:e=>{return a=l.row,c.vdFlag=!0,c.vdTitle="编辑虚拟设备",void(c.virtualForm={name:a.name,label:a.label});var a},text:"",type:"primary"},{default:S((()=>[ya])),_:2},1032,["onClick"]),z(P,{onClick:t=>{return r=l.row,void a.confirm("确定要删除这个虚拟设备吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:n.token,data:{names:[r.name]}};Y(e).then((e=>{E(e,u)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var r},text:"",type:"danger"},{default:S((()=>[fa])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),U("div",ha,[z(q,{"current-page":T(c).currentPage,"page-size":T(c).pagesize,"page-sizes":[20,50,200,500],total:T(h).length,onCurrentChange:v,onSizeChange:b,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):(M(),R(oa,{key:1,curVirtualDevice:T(c).curVirtualDevice,onChangeDpFlag:_[4]||(_[4]=e=>{c.dpFlag=!0})},null,8,["curVirtualDevice"])),z(B,{modelValue:T(c).vdFlag,"onUpdate:modelValue":_[9]||(_[9]=e=>T(c).vdFlag=e),title:T(c).vdTitle,width:"600px","before-close":V,"close-on-click-modal":!1},{footer:S((()=>[U("span",ba,[z(P,{onClick:_[7]||(_[7]=e=>x())},{default:S((()=>[Fa])),_:1}),z(P,{type:"primary",onClick:_[8]||(_[8]=e=>{F.value.validate((e=>{if(!e)return!1;{const e={token:n.token,data:c.virtualForm};c.vdTitle.includes("添加")?Q(e).then((e=>{E(e,u),x()})):X(e).then((e=>{E(e,u),x()}))}}))})},{default:S((()=>[xa])),_:1})])])),default:S((()=>[U("div",va,[z(H,{model:T(c).virtualForm,rules:T(c).virtualRules,ref_key:"virtualFormRef",ref:F,"status-icon":"","label-position":"right","label-width":"120px"},{default:S((()=>[z(O,{label:"虚拟设备名称",prop:"name"},{default:S((()=>[z(C,{type:"text",disabled:T(c).vdTitle.includes("编辑"),modelValue:T(c).virtualForm.name,"onUpdate:modelValue":_[5]||(_[5]=e=>T(c).virtualForm.name=e),autocomplete:"off",placeholder:"请输入虚拟设备名称"},null,8,["disabled","modelValue"])])),_:1}),z(O,{label:"虚拟设备标签",prop:"label"},{default:S((()=>[z(C,{type:"text",modelValue:T(c).virtualForm.label,"onUpdate:modelValue":_[6]||(_[6]=e=>T(c).virtualForm.label=e),autocomplete:"off",placeholder:"请输入虚拟设备标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-540c4e7b"]]);export{_a as default};
