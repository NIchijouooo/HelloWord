import{e,m as a,p as t,D as l,F as o,G as r,n as i,y as n,A as c,o as m,q as s,h as d,C as f}from"./element-plus.795748f2.js";import{_ as p,u,v as g}from"./index.c4bb92fc.js";import{I as h}from"./interface.650ae22c.js";import{C as b}from"./commInterface.2b207307.js";import{Y as y,f as N,p as I,o as w,c as v,a as C,S as T,Q as _,u as F,M as x,af as k,a0 as P,as as j,at as L,H as V,X as U,P as D}from"./@vue.8518410d.js";import"./@vueuse.c0256496.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./@element-plus.102632fb.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./vue-router.ae8a7199.js";import"./pinia.4a496763.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./nprogress.aae2b787.js";const z=e=>(j("data-v-c054c7c4"),e=e(),L(),e),S={class:"main-container"},M={class:"main"},A={class:"title",style:{"justify-content":"space-between"}},R=P(" 添加 "),B=P(" 刷新 "),q=P("编辑"),H=P("删除"),O=z((()=>C("div",null,"无数据",-1))),E={class:"pagination"},G={class:"dialog-content"},W=P("单位秒"),Q=P("单位次"),X={class:"dialog-footer"},Y=P("取消"),J=P("保存");var K=p({setup(p){const P=u(),j=y({interfaceName:"",checkAll:!0,headerCellStyle:{background:g.primaryColor,color:g.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,interfaceTableData:[],iFlag:!1,iTitle:"添加采集接口",interfaceForm:{collInterfaceName:"",commInterfaceName:"",protocolTypeName:"",pollPeriod:0,offlinePeriod:0},interfaceRules:{collInterfaceName:[{required:!0,message:"采集接口不能为空",trigger:"blur"}],commInterfaceName:[{required:!0,message:"通讯接口不能为空",trigger:"blur"}],pollPeriod:[{required:!0,message:"采集周期不能为空",trigger:"blur"},{type:"number",message:"采集周期只能输入数字"}],offlinePeriod:[{required:!0,message:"离线判断次数不能为空",trigger:"blur"},{type:"number",message:"离线判断次数只能输入数字"}]},commInterfaceList:[],protocolTypeNameList:[{name:"NULL",label:"NULL"},{name:"LUA",label:"LUA"},{name:"DLT645-2007",label:"DLT645-2007"},{name:"MODBUS-RTU",label:"MODBUS-RTU"},{name:"MODBUS-TCP",label:"MODBUS-TCP"}]}),L=N(null),z=e=>{const a={token:P.token,data:{}};h.getInterfaceList(a).then((async a=>{console.log("getInterfaceList -> res",a),a&&("0"===a.code?(j.interfaceTableData=a.data,j.interfaceTableData.forEach((e=>{e.protocolTypeName||(e.protocolTypeName=j.protocolTypeNameList[0].name)})),1===e&&d({type:"success",message:"刷新成功！"})):oe(a),await V((()=>{j.tableMaxHeight=L.value.clientHeight-34-36-22})))}))};z();const K=I((()=>j.interfaceTableData.filter((e=>{var a=!j.interfaceName,t=e.collInterfaceName.toLowerCase().includes(j.interfaceName.toLowerCase());return a||t})).slice((j.currentPage-1)*j.pagesize,j.currentPage*j.pagesize))),Z=I((()=>j.interfaceTableData.filter((e=>{var a=!j.interfaceName,t=e.collInterfaceName.toLowerCase().includes(j.interfaceName.toLowerCase());return a||t}))));(()=>{const e={token:P.token,data:{}};b.getCommInterfaceList(e).then((e=>{e&&(console.log("getCommInterfaceList -> res",e),"0"===e.code?j.commInterfaceList=e.data:oe(e))}))})();const $=e=>{j.iFlag=!0,j.iTitle="编辑采集接口",j.interfaceForm.collInterfaceName=e.collInterfaceName,j.interfaceForm.commInterfaceName=e.commInterfaceName,j.interfaceForm.protocolTypeName=e.protocolTypeName,j.interfaceForm.pollPeriod=e.pollPeriod,j.interfaceForm.offlinePeriod=e.offlinePeriod},ee=N(null),ae=()=>{j.iFlag=!1,ee.value.resetFields(),le()},te=e=>{ae()},le=()=>{j.interfaceForm={collInterfaceName:"",commInterfaceName:"",protocolTypeName:"",pollPeriod:0,offlinePeriod:0}},oe=e=>{d({type:"error",message:e.message})},re=(e,a)=>{d({type:"0"===e.code?"success":"1"===e.code?"error":"warning",message:e.message}),"0"===e.code&&a&&a()};return(p,u)=>{const g=U("search"),b=e,y=a,N=U("Icon"),I=t,V=l,le=o,oe=r,ie=i,ne=n,ce=c,me=m,se=s;return w(),v("div",S,[C("div",M,[C("div",A,[T(y,{style:{width:"200px"},placeholder:"请输入采集接口名称",modelValue:F(j).interfaceName,"onUpdate:modelValue":u[0]||(u[0]=e=>F(j).interfaceName=e)},{prefix:_((()=>[T(b,{class:"el-input__icon"},{default:_((()=>[T(g)])),_:1})])),_:1},8,["modelValue"]),C("div",null,[T(I,{type:"primary",bg:"",class:"right-btn",onClick:u[1]||(u[1]=e=>(j.iFlag=!0,void(j.iTitle="添加采集接口")))},{default:_((()=>[T(b,{class:"btn-icon"},{default:_((()=>[T(N,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),R])),_:1}),T(I,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:u[2]||(u[2]=e=>{z(1)})},{default:_((()=>[T(b,{class:"btn-icon"},{default:_((()=>[T(N,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),B])),_:1})])]),C("div",{class:"content",ref_key:"contentRef",ref:L},[T(le,{data:F(K),"cell-style":F(j).cellStyle,"header-cell-style":F(j).headerCellStyle,"max-height":F(j).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:$},{empty:_((()=>[O])),default:_((()=>[T(V,{prop:"collInterfaceName",label:"采集接口名称",width:"auto","min-width":"150",align:"center"}),T(V,{prop:"commInterfaceName",label:"通讯接口",width:"auto","min-width":"150",align:"center"}),T(V,{prop:"protocolTypeName",label:"通讯协议",width:"auto","min-width":"150",align:"center"}),T(V,{prop:"pollPeriod",label:"采集周期(秒)",width:"auto","min-width":"150",align:"center"}),T(V,{prop:"offlinePeriod",label:"离线判断次数",width:"auto","min-width":"150",align:"center"}),T(V,{prop:"deviceNodeCnt",label:"设备总数",width:"auto","min-width":"150",align:"center"}),T(V,{prop:"deviceNodeOnlineCnt",label:"设备在线数",width:"auto","min-width":"150",align:"center"}),T(V,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:_((e=>[T(I,{onClick:a=>$(e.row),text:"",type:"primary"},{default:_((()=>[q])),_:2},1032,["onClick"]),T(I,{onClick:a=>{return t=e.row,void f.confirm("确定要删除这个采集接口吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:P.token,data:{name:t.collInterfaceName}};h.deleteInterface(e).then((e=>{re(e,z)}))})).catch((()=>{d({type:"info",message:"取消删除"})}));var t},text:"",type:"danger"},{default:_((()=>[H])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),C("div",E,[T(oe,{"current-page":F(j).currentPage,"page-size":F(j).pagesize,"page-sizes":[20,50,200,500],total:F(Z).length,onCurrentChange:p.handleCurrentChange,onSizeChange:p.handleSizeChange,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])])],512)]),T(se,{modelValue:F(j).iFlag,"onUpdate:modelValue":u[10]||(u[10]=e=>F(j).iFlag=e),title:F(j).iTitle,width:"600px","before-close":te,"close-on-click-modal":!1},{footer:_((()=>[C("span",X,[T(I,{onClick:u[8]||(u[8]=e=>ae())},{default:_((()=>[Y])),_:1}),T(I,{type:"primary",onClick:u[9]||(u[9]=e=>{ee.value.validate((e=>{if(!e)return!1;{const e={token:P.token,data:j.interfaceForm};j.iTitle.includes("添加")?h.addInterface(e).then((e=>{re(e,z),ae()})):h.editInterface(e).then((e=>{re(e,z),ae()}))}}))})},{default:_((()=>[J])),_:1})])])),default:_((()=>[C("div",G,[T(me,{model:F(j).interfaceForm,rules:F(j).interfaceRules,ref_key:"interfaceFormRef",ref:ee,"status-icon":"","label-position":"right","label-width":"120px"},{default:_((()=>[T(ie,{label:"采集接口名称",prop:"collInterfaceName"},{default:_((()=>[T(y,{disabled:F(j).iTitle.includes("编辑"),type:"text",modelValue:F(j).interfaceForm.collInterfaceName,"onUpdate:modelValue":u[3]||(u[3]=e=>F(j).interfaceForm.collInterfaceName=e),autocomplete:"off",placeholder:"请输入采集接口名称"},null,8,["disabled","modelValue"])])),_:1}),T(ie,{label:"通讯接口名称",prop:"commInterfaceName"},{default:_((()=>[T(ce,{modelValue:F(j).interfaceForm.commInterfaceName,"onUpdate:modelValue":u[4]||(u[4]=e=>F(j).interfaceForm.commInterfaceName=e),style:{width:"100%"},placeholder:"请选择通讯接口名称"},{default:_((()=>[(w(!0),v(x,null,k(F(j).commInterfaceList,((e,a)=>(w(),D(ne,{key:"comm_"+a,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(ie,{label:"通讯协议",prop:"protocolTypeName"},{default:_((()=>[T(ce,{modelValue:F(j).interfaceForm.protocolTypeName,"onUpdate:modelValue":u[5]||(u[5]=e=>F(j).interfaceForm.protocolTypeName=e),style:{width:"100%"},placeholder:"请选择通讯协议(GWAI ADD 2023-05-10)"},{default:_((()=>[(w(!0),v(x,null,k(F(j).protocolTypeNameList,(e=>(w(),D(ne,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(ie,{label:"采集周期",prop:"pollPeriod"},{default:_((()=>[T(y,{type:"text",modelValue:F(j).interfaceForm.pollPeriod,"onUpdate:modelValue":u[6]||(u[6]=e=>F(j).interfaceForm.pollPeriod=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入采集周期"},{append:_((()=>[W])),_:1},8,["modelValue"])])),_:1}),T(ie,{label:"离线判断次数",prop:"offlinePeriod"},{default:_((()=>[T(y,{type:"text",modelValue:F(j).interfaceForm.offlinePeriod,"onUpdate:modelValue":u[7]||(u[7]=e=>F(j).interfaceForm.offlinePeriod=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入离线判断次数"},{append:_((()=>[Q])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-c054c7c4"]]);export{K as default};
