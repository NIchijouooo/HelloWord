import{g as e,e as l,p as a,n as t,o,m as r,A as d,C as s,D as n,L as i,v as p,w as c,K as u,q as m,M as f,u as b}from"./element-plus.3300f756.js";import{_ as y,u as g,v as h,s as v}from"./index.f61f902c.js";import{D as k}from"./deviceModel.7d24566f.js";import{b as _,i as F,d as x,h as w}from"./@element-plus.0bef5fa5.js";import{f as M,K as C,k as X,af as D,o as V,c as A,a as L,P as B,S,u as R,W as N,X as P,Q as z,ak as I,n as U,aw as O,ax as j,h as T,T as q,Y as H,M as E}from"./@vue.73d14ebc.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.3d90a471.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./vue-router.43b9a342.js";import"./pinia.3f4aff4f.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.7828944a.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const W={class:"main-container"},Y={class:"main"},G={class:"search-bar"},K={class:"search-bar",style:{display:"flex"}},Q={class:"title",style:{position:"relative","margin-right":"40px","justify-content":"flex-start",padding:"0px 0px",height:"40px"}},$={class:"tName"},J={class:"param-content"},Z={class:"pc-title"},ee={class:"pct-info"},le={class:"pc-content"},ae={class:"param-value"},te={class:"param-name"},oe=(e=>(O("data-v-259b3476"),e=e(),j(),e))((()=>L("div",null,"无数据",-1))),re={class:"pagination",style:{"z-index":"9"}};var de=y({__name:"PropertyD07",props:{curDeviceModel:{type:Object,default:{}}},emits:["changeShowFlag"],setup(i,{emit:p}){const c=i,u=g();console.log("id -> props",c);const m=M(null),f=C({headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",decimals:"小数位数",regCnt:"寄存器数量",ruleType:"解析规则",regAddr:"寄存器地址",formula:"计算公式",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"步长",stepAlarm:"步长报警",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",rulerId:"",format:"",len:0,accessMode:0,type:0,unit:"",blockAddOffset:0,rulerAddOffset:0},psFlag:!1,selectedProperties:[]}),b=l=>{const a={token:u.token,data:{name:c.curDeviceModel.name}};k.getDeviceModelProperty(a).then((async a=>{console.log("getDeviceModelProperty -> res",a),a&&("0"===a.code?(f.propertyList=a.data,1===l&&e({type:"success",message:"刷新成功！"})):j(a),await U((()=>{f.tableMaxHeight=m.value.clientHeight-34-36-132})))}))};b();const y=X((()=>(console.log("ctxData.propertyList ->",f.propertyList),f.propertyList.filter((e=>{var l=!f.deviceModelProperty,a=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||a})).slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize)))),v=X((()=>f.propertyList.filter((e=>{var l=!f.deviceModelProperty,a=e.name.toLowerCase().includes(f.deviceModelProperty.toLowerCase());return l||a})))),w=e=>{f.currentPage=e},O=e=>{f.pagesize=e},j=l=>{e({type:"error",message:l.message})};return(e,i)=>{const g=l,h=a,M=t,C=o,X=r,U=D("Icon"),T=d,q=s,H=n;return V(),A("div",W,[L("div",Y,[L("div",G,[B(C,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:S((()=>[B(M,{style:{"margin-left":"20px"}},{default:S((()=>[B(h,{type:"primary",plain:"",onClick:i[0]||(i[0]=e=>(console.log("toDeviceModel"),void p("changeShowFlag")))},{default:S((()=>[B(g,{class:"el-input__icon"},{default:S((()=>[B(R(_))])),_:1}),N(" 返回设备模型 ")])),_:1})])),_:1}),B(M,null,{default:S((()=>[B(h,{type:"primary",plain:"",class:"right-btn",onClick:i[1]||(i[1]=e=>(()=>{console.log("exportDPS");const e={token:u.token,responseType:"blob",data:{name:c.curDeviceModel.name}};k.exportDeviceModelProptyAndService(e).then((e=>{if(e&&"1"===e.code)return void j(e);const l=new Blob([e.blob]),a=e.fileName,t=document.createElement("a");t.download=a,t.style.display="none",t.href=URL.createObjectURL(l),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})())},{default:S((()=>[B(g,{class:"el-input__icon"},{default:S((()=>[B(R(F))])),_:1}),N(" 导出模型属性 ")])),_:1})])),_:1})])),_:1},512)]),L("div",K,[L("div",Q,[L("div",$,P(c.curDeviceModel.label)+"：属性列表",1)]),B(C,{inline:!0,ref:"searchFormRef2","status-icon":"","label-width":"90px"},{default:S((()=>[B(M,{label:""},{default:S((()=>[B(X,{style:{width:"200px"},placeholder:"请输入属性名称",modelValue:R(f).deviceModelProperty,"onUpdate:modelValue":i[2]||(i[2]=e=>R(f).deviceModelProperty=e)},{prefix:S((()=>[B(g,{class:"el-input__icon"},{default:S((()=>[B(R(x))])),_:1})])),_:1},8,["modelValue"])])),_:1}),B(M,null,{default:S((()=>[B(h,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:i[3]||(i[3]=e=>{b(1)})},{default:S((()=>[B(g,{class:"btn-icon"},{default:S((()=>[B(U,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),N(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),L("div",{class:"content",ref_key:"contentRef",ref:m},[B(q,{data:R(y),"cell-style":R(f).cellStyle,"header-cell-style":R(f).headerCellStyle,style:{width:"100%"},"max-height":R(f).tableMaxHeight,stripe:""},{empty:S((()=>[oe])),default:S((()=>[B(T,{type:"expand",width:"60"},{default:S((e=>[L("div",J,[L("div",Z,[L("div",ee,[L("b",null,P(e.row.name),1),N(" 参数详情 ")])]),L("div",le,[(V(!0),A(z,null,I(e.row.params,((e,l,a)=>(V(),A("div",{class:"param-item",key:a},[L("div",ae,P(R(f).paramName[l])+"：",1),L("div",te,P(e||"-"),1)])))),128))])])])),_:1}),B(T,{type:"index",width:"60"},{header:S((()=>[N(" 序号 ")])),_:1}),B(T,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"rulerId",label:"数据标识",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"format",label:"数据格式",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"len",label:"数据长度",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",label:"读写属性",width:"auto","min-width":"100",align:"center"},{default:S((e=>[N(P(R(f).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),B(T,{sortable:"",prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:S((e=>[N(P(R(f).typeNames["t"+e.row.type]),1)])),_:1}),B(T,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),B(T,{sortable:"",prop:"blockAddOffset",label:"块偏移地址",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"rulerAddOffset",label:"标识偏移地址",width:"auto","min-width":"150",align:"center"})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",re,[B(H,{"current-page":R(f).currentPage,"page-size":R(f).pagesize,"page-sizes":[20,50,200,500],total:R(v).length,onCurrentChange:w,onSizeChange:O,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])])}}},[["__scopeId","data-v-259b3476"]]);var se=e=>v.request({url:"/tsl/dlt64507/cmd",method:"get",data:e}),ne=e=>v.request({url:"/tsl/dlt64507/cmd",method:"post",data:e}),ie=e=>v.request({url:"/tsl/dlt64507/cmd",method:"put",data:e}),pe=e=>v.request({url:"/tsl/dlt64507/cmd",method:"delete",data:e}),ce=e=>v.request({url:"/tsl/dlt64507/block/xlsx",method:"post",data:e}),ue=e=>v.request({url:"/tsl/dlt64507/block/xlsx",method:"get",data:e}),me=e=>v.request({url:"/tsl/dlt64507/cmd/params",method:"get",data:e}),fe=e=>v.request({url:"/tsl/dlt64507/cmd/param",method:"post",data:e}),be=e=>v.request({url:"/tsl/dlt64507/cmd/param",method:"put",data:e}),ye=e=>v.request({url:"/tsl/dlt64507/cmd/params",method:"delete",data:e}),ge=e=>v.request({url:"/tsl/dlt64507/cmd/param/xlsx",method:"post",data:e}),he=e=>v.request({url:"/tsl/dlt64507/cmd/param/xlsx",method:"get",data:e});const ve=e=>(O("data-v-47307258"),e=e(),j(),e),ke={class:"main-container"},_e={style:{display:"flex","justify-content":"space-between"}},Fe={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},xe={class:"tName"},we={class:"search-bar",style:{"text-align":"right"}},Me={class:"param-content"},Ce={class:"pc-title"},Xe={class:"pct-info"},De={class:"pc-content"},Ve={class:"param-value"},Ae={class:"param-name"},Le=ve((()=>L("div",null,"无数据",-1))),Be={class:"pagination"},Se={class:"dialog-content"},Re=ve((()=>L("div",{class:"form-title"},[L("div",{class:"tName"},"配置参数")],-1))),Ne={class:"dialog-footer"},Pe={class:"dialog-content"},ze={style:{width:"100%"}},Ie={style:{"padding-right":"10px"}},Ue={class:"dialog-footer"},Oe=ve((()=>L("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),je={class:"dialog-footer"};var Te=y({__name:"BlockPropertyD07",props:{curModelBlock:{type:Object,default:{}}},emits:["changeBShowFlag"],setup(b,{emit:y}){const v=b,k=g(),_=M(null),O=C({formulaForm:{},headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelProperty:"",accessModeOptions:[{label:"只读",value:0},{label:"只写",value:1},{label:"读写",value:2}],typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},accessModeNames:{am0:"只读",am1:"只写",am2:"读写"},formatOptions:[{label:"X.XXX",value:"X.XXX"},{label:"XX",value:"XX"},{label:"XX.XX",value:"XX.XX"},{label:"XX.XXXX",value:"XX.XXXX"},{label:"XXX.X",value:"XXX.X"},{label:"XXX.XXX",value:"XXX.XXX"},{label:"XXXXXX",value:"XXXXXX"},{label:"XXXXXX.XX",value:"XXXXXX.XX"},{label:"XXXXXXXX",value:"XXXXXXXX"},{label:"XXXXXXXXXXXX",value:"XXXXXXXXXXXX"},{label:"DDhh",value:"DDhh"},{label:"MMDDNN",value:"MMDDNN"},{label:"hhmmNN",value:"hhmmNN"},{label:"YYMMDDWW",value:"YYMMDDWW"},{label:"YYMMDDhhmm",value:"YYMMDDhhmm"},{label:"YYMMDDhhmmss",value:"YYMMDDhhmmss"},{label:"C0C1C2C3",value:"C0C1C2C3"}],lenOptions:[{label:1,value:1},{label:2,value:2},{label:3,value:3},{label:4,value:4},{label:5,value:5},{label:6,value:6}],pFlag:!1,pTitle:"添加属性",propertyForm:{name:"",label:"",accessMode:0,type:0,unit:"",rulerId:"",len:0,blockAddOffset:0,rulerAddOffset:0,min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,dataLength:"",dataLengthAlarm:!1},ruleTypeOptions:{rt1:[{label:"Int_AB",value:"Int_AB"},{label:"Int_BA",value:"Int_BA"}],rt2:[{label:"Long_ABCD",value:"Long_ABCD"},{label:"Long_BADC",value:"Long_BADC"},{label:"Long_DCBA",value:"Long_DCBA"},{label:"Long_CDAB",value:"Long_CDAB"},{label:"Float_ABCD",value:"Float_ABCD"},{label:"Float_BADC",value:"Float_BADC"},{label:"Float_DCBA",value:"Float_DCBA"},{label:"Float_CDAB",value:"Float_CDAB"}],rt4:[{label:"Double_ABCDEFGH",value:"Double_ABCDEFGH"},{label:"Double_GHEFCDAB",value:"Double_GHEFCDAB"},{label:"Double_BADCFEHG",value:"Double_BADCFEHG"},{label:"Double_HGFEDCBA",value:"Double_HGFEDCBA"}]},paramName:{name:"属性名称",label:"属性标签",accessMode:"读写模式",type:"属性类型",decimals:"小数位数",regCnt:"寄存器数量",ruleType:"解析规则",regAddr:"寄存器地址",formula:"计算公式",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"步长",stepAlarm:"步长报警",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],accessMode:[{required:!0,message:"读写属性不能为空",trigger:"blur"}],type:[{required:!0,message:"属性类型不能为空",trigger:"blur"}],rulerId:[{required:!0,message:"标识数据长度不能为空",trigger:"blur"}],len:[{required:!0,type:"number",message:"数据长度只能输入数字",trigger:"blur"}],blockAddOffset:[{required:!0,type:"number",message:"块数据偏移地址只能输入数字",trigger:"blur"}],rulerAddOffset:[{required:!0,type:"number",message:"标识数据地址只能输入数字",trigger:"blur"}]},psFlag:!1,selectedProperties:[],fFlag:!1,propertyInfo:[],operationList:[{name:"+",label:"+",describe:"加"},{name:"-",label:"-",describe:"减"},{name:"*",label:"*",describe:"乘"},{name:"/",label:"/",describe:"除"},{name:"%",label:"%",describe:"模"},{name:"^",label:"^",describe:"次幂"},{name:"(",label:"(",describe:"左括号"},{name:")",label:")",describe:"右括号"}],curFormula:"",selectionStart:0,pItem:""}),j=l=>{const a={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name}};me(a).then((async a=>{a&&("0"===a.code?(O.propertyList=null==a.data?[]:a.data,1===l&&e({type:"success",message:"刷新成功！"})):ie(a),await U((()=>{O.tableMaxHeight=_.value.clientHeight-34-22-82})))}))};j();const E=X((()=>O.propertyList.filter((e=>{var l=!O.deviceModelProperty,a=e.name.toLowerCase().includes(O.deviceModelProperty.toLowerCase());return l||a})).slice((O.currentPage-1)*O.pagesize,O.currentPage*O.pagesize))),W=X((()=>O.propertyList.filter((e=>{var l=!O.deviceModelProperty,a=e.name.toLowerCase().includes(O.deviceModelProperty.toLowerCase());return l||a})))),Y=e=>{O.currentPage=e},G=e=>{O.pagesize=e},K=()=>{$.value&&$.value.submit()},Q=e=>{},$=M(null),J=e=>{$.value.clearFiles();const l=e[0];$.value.handleStart(l)},Z=l=>{let a=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(a){if(a){let a=new FormData;a.append("tslName",v.curModelBlock.tslName),a.append("cmdName",v.curModelBlock.name),a.append("fileName",l);const t={token:k.token,contentType:"multipart/form-data",data:a};ge(t).then((l=>{"0"===l.code?(e.success(l.message),O.psFlag=!1,j()):ie(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ee=()=>{O.psFlag=!1,uploadRef.value.clearFiles()},le=()=>{ee()},ae=e=>{O.pFlag=!0,O.pTitle="编辑属性",O.propertyForm.name=e.name,O.propertyForm.label=e.label,O.propertyForm.rulerId=e.rulerId,O.propertyForm.format=e.format,O.propertyForm.len=e.len,O.propertyForm.unit=e.unit,O.propertyForm.accessMode=e.accessMode,O.propertyForm.type=e.type,O.propertyForm.blockAddOffset=e.blockAddOffset,O.propertyForm.rulerAddOffset=e.rulerAddOffset,3!==e.type?(O.propertyForm.min=e.params.min,O.propertyForm.max=e.params.max,O.propertyForm.minMaxAlarm=e.params.minMaxAlarm,O.propertyForm.step=void 0===e.params.step||null===e.params.step?0:e.params.step,O.propertyForm.stepAlarm=e.params.stepAlarm):(O.propertyForm.dataLength=e.params.dataLength,O.propertyForm.dataLengthAlarm=e.params.dataLengthAlarm)},te=M(null),oe=()=>{O.pFlag=!1,te.value.resetFields(),se()},re=e=>{oe()},de=e=>{O.selectedProperties=e},se=()=>{O.propertyForm={name:"",label:"",accessMode:0,type:0,unit:"",len:0,rulerId:"",blockAddOffset:0,rulerAddOffset:0,step:0}},ne=e=>{O.selectionStart=e.srcElement.selectionStart},ie=l=>{e({type:"error",message:l.message})},pe=(l,a)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&a&&a()};return T((()=>v.curModelBlock),((e,l)=>{j()})),(b,y)=>{const g=l,h=r,M=t,C=a,X=D("Icon"),U=o,T=d,se=s,ce=n,ue=p,me=c,ge=u,ve=m,Te=f;return V(),A("div",ke,[L("div",_e,[L("div",Fe,[L("div",xe,P(v.curModelBlock.label)+"：命令参数列表",1)]),L("div",we,[B(U,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:S((()=>[B(M,{style:{"margin-left":"20px"}},{default:S((()=>[B(h,{style:{width:"200px"},placeholder:"请输入命令参数名称",modelValue:R(O).deviceModelProperty,"onUpdate:modelValue":y[0]||(y[0]=e=>R(O).deviceModelProperty=e)},{prefix:S((()=>[B(g,{class:"el-input__icon"},{default:S((()=>[B(R(x))])),_:1})])),_:1},8,["modelValue"])])),_:1}),B(M,null,{default:S((()=>[B(C,{type:"primary",plain:"",class:"right-btn",onClick:y[1]||(y[1]=e=>{O.psFlag=!0})},{default:S((()=>[B(g,{class:"el-input__icon"},{default:S((()=>[B(R(w))])),_:1}),N(" 导入命令参数 ")])),_:1})])),_:1}),B(M,null,{default:S((()=>[B(C,{type:"primary",plain:"",class:"right-btn",onClick:y[2]||(y[2]=e=>(()=>{const e={token:k.token,responseType:"blob",data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name}};he(e).then((e=>{if(e&&"1"===e.code)return void ie(e);const l=new Blob([e.blob]),a=e.fileName,t=document.createElement("a");t.download=a,t.style.display="none",t.href=URL.createObjectURL(l),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})())},{default:S((()=>[B(g,{class:"el-input__icon"},{default:S((()=>[B(R(F))])),_:1}),N(" 导出命令参数 ")])),_:1})])),_:1}),B(M,null,{default:S((()=>[B(C,{type:"primary",bg:"",class:"right-btn",onClick:y[3]||(y[3]=e=>(O.pFlag=!0,void(O.pTitle="添加属性")))},{default:S((()=>[B(g,{class:"btn-icon"},{default:S((()=>[B(X,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),N(" 添加 ")])),_:1})])),_:1}),B(M,null,{default:S((()=>[B(C,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:y[4]||(y[4]=e=>{j(1)})},{default:S((()=>[B(g,{class:"btn-icon"},{default:S((()=>[B(X,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),N(" 刷新 ")])),_:1})])),_:1}),B(M,null,{default:S((()=>[B(C,{type:"danger",bg:"",class:"right-btn",onClick:y[5]||(y[5]=l=>(l=>{let a=[];0!==O.selectedProperties.length?(O.selectedProperties.forEach((e=>{a.push(e.name)})),i.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name,propertyNames:a}};ye(e).then((e=>{pe(e,j)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:S((()=>[B(g,{class:"btn-icon"},{default:S((()=>[B(X,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),N(" 删除 ")])),_:1})])),_:1})])),_:1},512)])]),L("div",{class:"content",ref_key:"contentRef",ref:_},[B(se,{data:R(E),"cell-style":R(O).cellStyle,"header-cell-style":R(O).headerCellStyle,style:{width:"100%"},"max-height":R(O).tableMaxHeight,stripe:"",onSelectionChange:de,onRowDblclick:ae},{empty:S((()=>[Le])),default:S((()=>[B(T,{type:"selection",width:"55"}),B(T,{type:"expand",width:"60"},{default:S((e=>[L("div",Me,[L("div",Ce,[L("div",Xe,[L("b",null,P(e.row.name),1),N(" 参数详情 ")])]),L("div",De,[(V(!0),A(z,null,I(e.row.params,((e,l,a)=>(V(),A("div",{class:"param-item",key:a},[L("div",Ve,P(R(O).paramName[l])+"：",1),L("div",Ae,P(e||"-"),1)])))),128))])])])),_:1}),B(T,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"rulerId",label:"数据标识",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"format",label:"数据格式",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"len",label:"数据长度",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",label:"读写属性",width:"auto","min-width":"100",align:"center"},{default:S((e=>[N(P(R(O).accessModeNames["am"+e.row.accessMode]),1)])),_:1}),B(T,{sortable:"",prop:"type",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:S((e=>[N(P(R(O).typeNames["t"+e.row.type]),1)])),_:1}),B(T,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),B(T,{sortable:"",prop:"blockAddOffset",label:"块偏移地址",width:"auto","min-width":"150",align:"center"}),B(T,{sortable:"",prop:"rulerAddOffset",label:"标识偏移地址",width:"auto","min-width":"150",align:"center"}),B(T,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:S((e=>[B(C,{onClick:l=>ae(e.row),text:"",type:"primary"},{default:S((()=>[N("编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",Be,[B(ce,{"current-page":R(O).currentPage,"page-size":R(O).pagesize,"page-sizes":[20,50,200,500],total:R(W).length,onCurrentChange:Y,onSizeChange:G,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),B(ve,{modelValue:R(O).pFlag,"onUpdate:modelValue":y[27]||(y[27]=e=>R(O).pFlag=e),title:R(O).pTitle,width:"800px","before-close":re,"close-on-click-modal":!1},{footer:S((()=>[L("span",Ne,[B(C,{onClick:y[25]||(y[25]=e=>oe())},{default:S((()=>[N("取消")])),_:1}),B(C,{type:"primary",onClick:y[26]||(y[26]=e=>{te.value.validate((e=>{if(!e)return!1;{const e={token:k.token,data:{tslName:v.curModelBlock.tslName,cmdName:v.curModelBlock.name,name:O.propertyForm.name,label:O.propertyForm.label,rulerId:O.propertyForm.rulerId,format:O.propertyForm.format,len:O.propertyForm.len,unit:O.propertyForm.unit,accessMode:O.propertyForm.accessMode,type:O.propertyForm.type,blockAddOffset:O.propertyForm.blockAddOffset,rulerAddOffset:O.propertyForm.rulerAddOffset}};let l={};3!==O.propertyForm.type?(l.min=O.propertyForm.min,l.max=O.propertyForm.max,l.minMaxAlarm=O.propertyForm.minMaxAlarm,l.step=O.propertyForm.step,l.stepAlarm=O.propertyForm.stepAlarm):(l.dataLength=O.propertyForm.dataLength,l.dataLengthAlarm=O.propertyForm.dataLengthAlarm),e.data.params=l,O.pTitle.includes("添加")?fe(e).then((e=>{pe(e,j),oe()})):be(e).then((e=>{pe(e,j),oe()}))}}))})},{default:S((()=>[N("保存")])),_:1})])])),default:S((()=>[L("div",Se,[B(U,{model:R(O).propertyForm,rules:R(O).propertyRules,ref_key:"propertyFormRef",ref:te,"status-icon":"","label-position":"right","label-width":"120px",inline:!0},{default:S((()=>[B(M,{label:"属性名称",prop:"name"},{default:S((()=>[B(h,{style:{width:"220px"},disabled:R(O).pTitle.includes("编辑"),type:"text",modelValue:R(O).propertyForm.name,"onUpdate:modelValue":y[6]||(y[6]=e=>R(O).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),B(M,{label:"属性标签",prop:"label"},{default:S((()=>[B(h,{style:{width:"220px"},type:"text",modelValue:R(O).propertyForm.label,"onUpdate:modelValue":y[7]||(y[7]=e=>R(O).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),B(M,{label:"读写属性",prop:"accessMode"},{default:S((()=>[B(me,{modelValue:R(O).propertyForm.accessMode,"onUpdate:modelValue":y[8]||(y[8]=e=>R(O).propertyForm.accessMode=e),style:{width:"220px"},placeholder:"请选择读写属性"},{default:S((()=>[(V(!0),A(z,null,I(R(O).accessModeOptions,(e=>(V(),q(ue,{key:"accessMode_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),B(M,{label:"单位",prop:"unit"},{default:S((()=>[B(h,{style:{width:"220px"},type:"text",modelValue:R(O).propertyForm.unit,"onUpdate:modelValue":y[9]||(y[9]=e=>R(O).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1}),B(M,{label:"属性类型",prop:"type"},{default:S((()=>[B(me,{modelValue:R(O).propertyForm.type,"onUpdate:modelValue":y[10]||(y[10]=e=>R(O).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择属性类型"},{default:S((()=>[(V(!0),A(z,null,I(R(O).typeOptions,(e=>(V(),q(ue,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),L("div",null,[3!==R(O).propertyForm.type?(V(),q(M,{key:0,label:"范围报警",prop:"minMaxAlarm"},{default:S((()=>[B(ge,{modelValue:R(O).propertyForm.minMaxAlarm,"onUpdate:modelValue":y[11]||(y[11]=e=>R(O).propertyForm.minMaxAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0)]),L("div",null,[3!==R(O).propertyForm.type&&R(O).propertyForm.minMaxAlarm?(V(),q(M,{key:0,label:"最小值",prop:"min"},{default:S((()=>[B(h,{type:"text",modelValue:R(O).propertyForm.min,"onUpdate:modelValue":y[12]||(y[12]=e=>R(O).propertyForm.min=e),autocomplete:"off",placeholder:"请输入最小值"},null,8,["modelValue"])])),_:1})):H("",!0)]),3!==R(O).propertyForm.type&&R(O).propertyForm.minMaxAlarm?(V(),q(M,{key:0,label:"最大值",prop:"max"},{default:S((()=>[B(h,{type:"text",modelValue:R(O).propertyForm.max,"onUpdate:modelValue":y[13]||(y[13]=e=>R(O).propertyForm.max=e),autocomplete:"off",placeholder:"请输入最大值"},null,8,["modelValue"])])),_:1})):H("",!0),L("div",null,[3!==R(O).propertyForm.type?(V(),q(M,{key:0,label:"步长报警",prop:"stepAlarm"},{default:S((()=>[B(ge,{modelValue:R(O).propertyForm.stepAlarm,"onUpdate:modelValue":y[14]||(y[14]=e=>R(O).propertyForm.stepAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0)]),3!==R(O).propertyForm.type&&R(O).propertyForm.stepAlarm?(V(),q(M,{key:1,label:"步长",prop:"step"},{default:S((()=>[B(h,{type:"text",modelValue:R(O).propertyForm.step,"onUpdate:modelValue":y[15]||(y[15]=e=>R(O).propertyForm.step=e),autocomplete:"off",placeholder:"请输入步长"},null,8,["modelValue"])])),_:1})):H("",!0),L("div",null,[3===R(O).propertyForm.type?(V(),q(M,{key:0,label:"字符串长度报警",prop:"dataLengthAlarm"},{default:S((()=>[B(ge,{modelValue:R(O).propertyForm.dataLengthAlarm,"onUpdate:modelValue":y[16]||(y[16]=e=>R(O).propertyForm.dataLengthAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0)]),3===R(O).propertyForm.type&&R(O).propertyForm.dataLengthAlarm?(V(),q(M,{key:2,label:"字符串长度",prop:"dataLength"},{default:S((()=>[B(h,{type:"text",modelValue:R(O).propertyForm.dataLength,"onUpdate:modelValue":y[17]||(y[17]=e=>R(O).propertyForm.dataLength=e),autocomplete:"off",placeholder:"请输入字符串长度"},null,8,["modelValue"])])),_:1})):H("",!0),B(M,{label:"数据格式",prop:"len"},{default:S((()=>[1==v.curModelBlock.format?(V(),q(h,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:R(O).propertyForm.format,"onUpdate:modelValue":y[18]||(y[18]=e=>R(O).propertyForm.format=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据格式"},null,8,["modelValue"])):(V(),q(me,{key:1,modelValue:R(O).propertyForm.format,"onUpdate:modelValue":y[19]||(y[19]=e=>R(O).propertyForm.format=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择数据格式"},{default:S((()=>[(V(!0),A(z,null,I(R(O).formatOptions,(e=>(V(),q(ue,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),B(M,{label:"数据长度",prop:"len"},{default:S((()=>[1==v.curModelBlock.len?(V(),q(h,{key:0,type:"text",style:{width:"220px"},disabled:"",modelValue:R(O).propertyForm.len,"onUpdate:modelValue":y[20]||(y[20]=e=>R(O).propertyForm.len=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据长度"},null,8,["modelValue"])):(V(),q(me,{key:1,modelValue:R(O).propertyForm.len,"onUpdate:modelValue":y[21]||(y[21]=e=>R(O).propertyForm.len=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择数据长度"},{default:S((()=>[(V(!0),A(z,null,I(R(O).lenOptions,(e=>(V(),q(ue,{key:"regCount_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]))])),_:1}),Re,B(M,{label:"数据标识",prop:"rulerId"},{default:S((()=>[B(h,{type:"text",style:{width:"220px"},modelValue:R(O).propertyForm.rulerId,"onUpdate:modelValue":y[22]||(y[22]=e=>R(O).propertyForm.rulerId=e),autocomplete:"off",placeholder:"请输入数据标识"},null,8,["modelValue"])])),_:1}),1!=v.curModelBlock.blockAddOffset?(V(),q(M,{key:3,label:"",prop:"",style:{width:"220px"}})):H("",!0),B(M,{label:"块偏移地址",prop:"blockAddOffset"},{default:S((()=>[B(h,{type:"text",style:{width:"220px"},modelValue:R(O).propertyForm.blockAddOffset,"onUpdate:modelValue":y[23]||(y[23]=e=>R(O).propertyForm.blockAddOffset=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入数据块偏移地址"},null,8,["modelValue"])])),_:1}),B(M,{label:"标识偏移地址",prop:"rulerAddOffset"},{default:S((()=>[B(h,{type:"text",style:{width:"220px"},modelValue:R(O).propertyForm.rulerAddOffset,"onUpdate:modelValue":y[24]||(y[24]=e=>R(O).propertyForm.rulerAddOffset=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入标识偏移地址"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),B(ve,{modelValue:R(O).fFlag,"onUpdate:modelValue":y[33]||(y[33]=e=>R(O).fFlag=e),title:"编辑计算公式",width:"600px"},{footer:S((()=>[L("span",Ue,[B(C,{onClick:y[31]||(y[31]=e=>(O.fFlag=!1,void(O.curFormula="")))},{default:S((()=>[N("取消")])),_:1}),B(C,{type:"primary",onClick:y[32]||(y[32]=e=>(O.fFlag=!1,void(O.propertyForm.formula=O.curFormula)))},{default:S((()=>[N("保存")])),_:1})])])),default:S((()=>[L("div",Pe,[B(U,{model:R(O).formulaForm,"label-position":"right","label-width":"120px"},{default:S((()=>[B(M,{label:"运算符号"},{default:S((()=>[L("div",ze,[(V(!0),A(z,null,I(R(O).operationList,((e,l)=>(V(),A("div",{class:"operation",key:l},[L("div",Ie,[B(C,{style:{width:"100%"},onClick:l=>(e=>{let l=O.curFormula.length;if(l!==O.selectionStart){let a=O.curFormula.substr(0,O.selectionStart),t=O.curFormula.substr(O.selectionStart,l-O.selectionStart);O.curFormula=a+e.name+t,O.selectionStart+=e.name.length}else O.curFormula+=e.name,O.selectionStart+=e.name.length})(e)},{default:S((()=>[N(P(e.label),1)])),_:2},1032,["onClick"])])])))),128))])])),_:1}),B(M,{label:"设备属性"},{default:S((()=>[B(me,{modelValue:R(O).pItem,"onUpdate:modelValue":y[28]||(y[28]=e=>R(O).pItem=e),filterable:"",placeholder:"请选择设备属性",onChange:y[29]||(y[29]=e=>(e=>{let l=O.curFormula.length;if(l!==O.selectionStart){let a=O.curFormula.substr(0,O.selectionStart),t=O.curFormula.substr(O.selectionStart,l-O.selectionStart);O.curFormula=a+"("+e+")"+t,O.selectionStart+=e.length+2}else O.curFormula+="("+e+")",O.selectionStart+=e.length+2})(R(O).pItem)),style:{width:"100%"}},{default:S((()=>[(V(!0),A(z,null,I(R(O).propertyInfo,(e=>(V(),q(ue,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),B(M,{label:"当前公式"},{default:S((()=>[B(h,{type:"text",clearable:"",modelValue:R(O).curFormula,"onUpdate:modelValue":y[30]||(y[30]=e=>R(O).curFormula=e),autocomplete:"off",placeholder:"请编辑计算公式",onBlur:ne},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),B(ve,{modelValue:R(O).psFlag,"onUpdate:modelValue":y[34]||(y[34]=e=>R(O).psFlag=e),title:"导入命令参数",width:"600px","before-close":le,"close-on-click-modal":!1},{footer:S((()=>[L("span",je,[B(C,{onClick:ee},{default:S((()=>[N("取消")])),_:1}),B(C,{type:"primary",onClick:K},{default:S((()=>[N("上传")])),_:1})])])),default:S((()=>[B(Te,{ref_key:"uploadDPSRef",ref:$,action:"","auto-upload":!1,"http-request":Q,limit:1,"on-exceed":J,"before-upload":Z},{tip:S((()=>[Oe])),default:S((()=>[B(C,{type:"primary"},{default:S((()=>[N("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-47307258"]]);const qe=e=>(O("data-v-04282f20"),e=e(),j(),e),He={class:"main-container"},Ee={class:"main"},We={class:"mc-left"},Ye={class:"title"},Ge={class:"mcl-content"},Ke={class:"mclc-content"},Qe={class:"mc-right"},$e={class:"mcr-top"},Je={style:{display:"flex","justify-content":"space-between"}},Ze={class:"title",style:{position:"relative",width:"40%","justify-content":"flex-start"}},el={class:"tName"},ll={class:"search-bar",style:{"text-align":"right"}},al=qe((()=>L("div",null,"无数据",-1))),tl={class:"pagination"},ol={key:0,class:"mcr-bottom"},rl={class:"dialog-content"},dl={class:"dialog-footer"},sl=qe((()=>L("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),nl={class:"dialog-footer"};var il=y({__name:"ModelBlockD07",props:{curDeviceModel:{type:Object,default:{}},deviceModelList:{type:Array,default:[]}},emits:["changeShowFlag"],setup(u,{emit:y}){const v=u,k=g();console.log("id -> props",v);const O=/^[0-9]*[1-9][0-9]*$/,j=M(null),T=C({curDeviceModel:v.curDeviceModel,headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"48px"},cellStyle:{height:"42px",padding:"2px 0"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyList:[],deviceModelBlock:"",BlockReadSw:[{label:"开",value:1},{label:"关",value:0}],SWNames:{SW0:"关",SW1:"开"},typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],funCodeOptions:[{label:"01(读线圈状态)",value:1},{label:"02(读离散输入状态)",value:2},{label:"03(读保持寄存器)",value:3},{label:"04(读输入寄存器)",value:4},{label:"05(写单个线圈)",value:5},{label:"06(写单个保持寄存器)",value:6},{label:"15(写多个线圈)",value:15},{label:"16(写多个保持寄存器)",value:16}],funCodeNames:{f1:"01(读线圈状态)",f2:"02(读离散输入状态)",f3:"03(读保持寄存器)",f4:"04(读输入寄存器)",f5:"05(写单个线圈)",f6:"06(写单个保持寄存器)",f15:"15(写多个线圈)",f16:"16(写多个保持寄存器)"},dataTypeOptions:[{label:"uint8",value:0},{label:"int8",value:1},{label:"uint16",value:2},{label:"int16",value:3},{label:"uint32",value:4},{label:"int32",value:5},{label:"float",value:6},{label:"double",value:7}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},dataTypeNames:{dt0:"uint8",dt1:"int8",dt2:"uint16",dt3:"int16",dt4:"uint32",dt5:"int32",dt6:"float",dt7:"double"},pFlag:!1,pTitle:"添加属性",blockForm:{name:"",label:"",blockRulerId:"",blockRead:0},paramName:{name:"块名称",label:"块标签",funCode:"功能码",type:"属性类型",startRegAddr:"寄存器地址",regCnt:"寄存器数量"},propertyRules:{name:[{required:!0,message:"块名称不能为空",trigger:"blur"}],label:[{required:!0,message:"块标签不能为空",trigger:"blur"}],funCode:[{required:!0,message:"功能码不能为空",trigger:"blur"}],startRegAddr:[{required:!0,message:"寄存器地址不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,a)=>{0===l||O.test(l)?a():a(new Error("只能输入自然数！"))}}],regCnt:[{required:!0,message:"寄存器数量不能为空",trigger:"blur"},{trigger:"blur",validator:(e,l,a)=>{O.test(l)?a():a(new Error("只能输入正整数数字！"))}}]},psFlag:!1,selectedProperties:[],curModelBlock:{},porpFlag:!1}),W=l=>{const a={token:k.token,data:{tslName:T.curDeviceModel.name}};se(a).then((async a=>{a&&("0"===a.code?(T.propertyList=a.data,T.propertyList.length>0?(T.curModelBlock=T.propertyList[0],T.curModelBlock.tslName=T.curDeviceModel.name,console.log("getDeviceModelBlock -> ctxData.curModelBlock",T.curModelBlock),T.porpFlag=!0):T.porpFlag=!1,1===l&&e({type:"success",message:"刷新成功！"})):ge(a),await U((()=>{T.tableMaxHeight=j.value.clientHeight-34-22-82,2===l&&ye(T.curModelBlock)})))}))};W(2);const Y=X((()=>(console.log("ctxData.propertyList ->",T.propertyList),T.propertyList.filter((e=>{var l=!T.deviceModelBlock,a=e.name.toLowerCase().includes(T.deviceModelBlock.toLowerCase());return l||a})).slice((T.currentPage-1)*T.pagesize,T.currentPage*T.pagesize)))),G=X((()=>T.propertyList.filter((e=>{var l=!T.deviceModelBlock,a=e.name.toLowerCase().includes(T.deviceModelBlock.toLowerCase());return l||a})))),K=e=>{T.currentPage=e},Q=e=>{T.pagesize=e},$=()=>{Z.value&&Z.value.submit()},J=e=>{},Z=M(null),ee=e=>{Z.value.clearFiles();const l=e[0];Z.value.handleStart(l)},le=l=>{console.log("beforeUpload -> file",l);let a=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type);if(a){if(a){let a=new FormData;a.append("name",T.curDeviceModel.name),a.append("fileName",l);const t={token:k.token,contentType:"multipart/form-data",data:a};ce(t).then((l=>{"0"===l.code?(e.success(l.message),T.psFlag=!1,W()):ge(l)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ae=()=>{T.psFlag=!1,uploadRef.value.clearFiles()},te=()=>{ae()},oe=e=>{T.pFlag=!0,T.pTitle="编辑属性",T.blockForm.name=e.name,T.blockForm.label=e.label,T.blockForm.blockRulerId=e.blockRulerId,T.blockForm.blockRead=e.blockRead},re=M(null),de=()=>{T.pFlag=!1,re.value.resetFields(),be()},me=e=>{de()},fe=e=>{T.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},be=()=>{T.blockForm={name:"",label:"",blockRulerId:"",blockRead:0}},ye=e=>{T.curModelBlock=e,T.curModelBlock.tslName=T.curDeviceModel.name},ge=l=>{e({type:"error",message:l.message})},he=(l,a)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&a&&a()};return(u,g)=>{const h=l,M=a,C=b,X=r,U=t,O=D("Icon"),se=o,ce=d,be=s,ve=n,ke=p,_e=c,Fe=m,xe=f;return V(),A("div",He,[L("div",Ee,[L("div",We,[L("div",Ye,[B(M,{type:"primary",style:{width:"100%"},plain:"",onClick:g[0]||(g[0]=e=>{y("changeShowFlag")})},{default:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(_))])),_:1}),N(" 返回设备模型 ")])),_:1})]),L("div",Ge,[(V(!0),A(z,null,I(v.deviceModelList,((e,l)=>(V(),q(C,{key:"i"+l,shadow:"hover",class:E({"mclc-card":!0,activeModel:e.name==R(T).curDeviceModel.name}),onClick:l=>(e=>{T.curDeviceModel.name!=e.name&&(T.curDeviceModel=e,W())})(e)},{default:S((()=>[L("div",Ke,[L("span",null,P(e.name),1)])])),_:2},1032,["class","onClick"])))),128))])]),L("div",Qe,[L("div",$e,[L("div",Je,[L("div",Ze,[L("div",el,P(R(T).curDeviceModel.label)+"：命令列表",1)]),L("div",ll,[B(se,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"90px"},{default:S((()=>[B(U,{style:{"margin-left":"20px"}},{default:S((()=>[B(X,{style:{width:"200px"},placeholder:"请输入命令名称",modelValue:R(T).deviceModelBlock,"onUpdate:modelValue":g[1]||(g[1]=e=>R(T).deviceModelBlock=e)},{prefix:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(x))])),_:1})])),_:1},8,["modelValue"])])),_:1}),B(U,null,{default:S((()=>[B(M,{type:"primary",plain:"",class:"right-btn",onClick:g[2]||(g[2]=e=>(console.log("importDPS"),void(T.psFlag=!0)))},{default:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(w))])),_:1}),N(" 导入命令 ")])),_:1})])),_:1}),B(U,null,{default:S((()=>[B(M,{type:"primary",plain:"",class:"right-btn",onClick:g[3]||(g[3]=e=>(()=>{console.log("exportDPS");const e={token:k.token,responseType:"blob",data:{name:T.curDeviceModel.name}};ue(e).then((e=>{if(e&&"1"===e.code)return void ge(e);const l=new Blob([e.blob]),a=e.fileName,t=document.createElement("a");t.download=a,t.style.display="none",t.href=URL.createObjectURL(l),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})())},{default:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(F))])),_:1}),N(" 导出命令 ")])),_:1})])),_:1}),B(U,null,{default:S((()=>[B(M,{type:"primary",bg:"",class:"right-btn",onClick:g[4]||(g[4]=e=>(console.log("addDeviceModelBlock"),T.pFlag=!0,void(T.pTitle="添加属性")))},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(O,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),N(" 添加 ")])),_:1})])),_:1}),B(U,null,{default:S((()=>[B(M,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:g[5]||(g[5]=e=>{W(1)})},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(O,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),N(" 刷新 ")])),_:1})])),_:1}),B(U,null,{default:S((()=>[B(M,{type:"danger",bg:"",class:"right-btn",onClick:g[6]||(g[6]=l=>(l=>{let a=[];0!==T.selectedProperties.length?(T.selectedProperties.forEach((e=>{a.push(e.name)})),console.log("pList",a),i.confirm("确认要删除这些命令吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:k.token,data:{tslName:T.curDeviceModel.name,names:a}};pe(e).then((e=>{he(e,W)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个命令！")})())},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(O,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),N(" 删除 ")])),_:1})])),_:1})])),_:1},512)])]),L("div",{class:"content",ref_key:"contentRef",ref:j},[B(be,{data:R(Y),"cell-style":R(T).cellStyle,"header-cell-style":R(T).headerCellStyle,style:{width:"100%"},"max-height":R(T).tableMaxHeight,stripe:"",onSelectionChange:fe,onRowDblclick:oe},{empty:S((()=>[al])),default:S((()=>[B(ce,{type:"selection",width:"55"}),B(ce,{sortable:"",prop:"name",label:"命令名称",width:"auto","min-width":"150",align:"center"}),B(ce,{sortable:"",prop:"label",label:"命令标签",width:"auto","min-width":"150",align:"center"}),B(ce,{sortable:"",prop:"blockRulerId",label:"块数据标识",width:"auto","min-width":"120",align:"center"}),B(ce,{sortable:"",label:"块读取开关",width:"auto","min-width":"100",align:"center"},{default:S((e=>[N(P(R(T).SWNames["SW"+e.row.blockRead]),1)])),_:1}),B(ce,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:S((e=>[B(M,{onClick:l=>oe(e.row),text:"",type:"primary"},{default:S((()=>[N("编辑")])),_:2},1032,["onClick"]),B(M,{onClick:l=>ye(e.row,2),text:"",type:"success"},{default:S((()=>[N("命令参数详情")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",tl,[B(ve,{"current-page":R(T).currentPage,"page-size":R(T).pagesize,"page-sizes":[20,50,200,500],total:R(G).length,onCurrentChange:K,onSizeChange:Q,background:"",layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])],512)]),R(T).porpFlag?(V(),A("div",ol,[B(Te,{curModelBlock:R(T).curModelBlock},null,8,["curModelBlock"])])):H("",!0)]),B(Fe,{modelValue:R(T).pFlag,"onUpdate:modelValue":g[13]||(g[13]=e=>R(T).pFlag=e),title:R(T).pTitle,width:"600px","before-close":me,"close-on-click-modal":!1},{footer:S((()=>[L("span",dl,[B(M,{onClick:g[11]||(g[11]=e=>de())},{default:S((()=>[N("取消")])),_:1}),B(M,{type:"primary",onClick:g[12]||(g[12]=e=>{re.value.validate((e=>{if(!e)return!1;{const e={token:k.token,data:{tslName:T.curDeviceModel.name,name:T.blockForm.name,label:T.blockForm.label,blockRulerId:T.blockForm.blockRulerId,blockRead:T.blockForm.blockRead}};T.pTitle.includes("添加")?ne(e).then((e=>{he(e,W),de()})):ie(e).then((l=>{console.log("----GWAI----"),console.log(e),he(l,W),de()}))}}))})},{default:S((()=>[N("保存")])),_:1})])])),default:S((()=>[L("div",rl,[B(se,{model:R(T).blockForm,rules:R(T).propertyRules,ref_key:"blockFormRef",ref:re,"status-icon":"","label-position":"right","label-width":"120px"},{default:S((()=>[B(U,{label:"块名称",prop:"name"},{default:S((()=>[B(X,{disabled:R(T).pTitle.includes("编辑"),type:"text",modelValue:R(T).blockForm.name,"onUpdate:modelValue":g[7]||(g[7]=e=>R(T).blockForm.name=e),autocomplete:"off",placeholder:"请输入块名称"},null,8,["disabled","modelValue"])])),_:1}),B(U,{label:"块标签",prop:"label"},{default:S((()=>[B(X,{type:"text",modelValue:R(T).blockForm.label,"onUpdate:modelValue":g[8]||(g[8]=e=>R(T).blockForm.label=e),autocomplete:"off",placeholder:"请输入块标签"},null,8,["modelValue"])])),_:1}),B(U,{label:"块数据标识",prop:"blockRulerId"},{default:S((()=>[B(X,{type:"text",modelValue:R(T).blockForm.blockRulerId,"onUpdate:modelValue":g[9]||(g[9]=e=>R(T).blockForm.blockRulerId=e),placeholder:"请输入块数据标识"},null,8,["modelValue"])])),_:1}),B(U,{label:"块读取开关",prop:"blockRead"},{default:S((()=>[B(_e,{modelValue:R(T).blockForm.blockRead,"onUpdate:modelValue":g[10]||(g[10]=e=>R(T).blockForm.blockRead=e),style:{width:"100%"},placeholder:"请选择是否打开块读取"},{default:S((()=>[(V(!0),A(z,null,I(R(T).BlockReadSw,(e=>(V(),q(ke,{key:"SW"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),B(Fe,{modelValue:R(T).psFlag,"onUpdate:modelValue":g[14]||(g[14]=e=>R(T).psFlag=e),title:"导入命令",width:"600px","before-close":te,"close-on-click-modal":!1},{footer:S((()=>[L("span",nl,[B(M,{onClick:ae},{default:S((()=>[N("取消")])),_:1}),B(M,{type:"primary",onClick:$},{default:S((()=>[N("上传")])),_:1})])])),default:S((()=>[B(xe,{ref_key:"uploadDPSRef",ref:Z,action:"","auto-upload":!1,"http-request":J,limit:1,"on-exceed":ee,"before-upload":le},{tip:S((()=>[sl])),default:S((()=>[B(M,{type:"primary"},{default:S((()=>[N("选择文件")])),_:1})])),_:1},512)])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-04282f20"]]);const pl={class:"main-container"},cl={key:0,class:"main"},ul={class:"search-bar"},ml={class:"tool-bar"},fl=(e=>(O("data-v-46170bfd"),e=e(),j(),e))((()=>L("div",null,"无数据",-1))),bl={class:"pagination"},yl={class:"dialog-content"},gl={class:"dialog-footer"};var hl=y({__name:"DeviceModelD07",setup(p){const c=g(),u=M(null),f=C({typeModel:3,showFlag:0,headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceModelInfo:"",tableData:[],modelForm:{name:"",label:"",type:0,param:""},modelRules:{name:[{required:!0,message:"采集模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"采集模型标识不能为空",trigger:"blur"}],param:[{required:!0,message:"采集模型插件不能为空",trigger:"blur"}]},udFlag:!1,dmFlag:!1,dmTitle:"添加采集模型",pluginList:[],curDeviceModel:""}),b=l=>{const a={token:c.token,data:{type:f.typeModel}};k.getDeviceModelList(a).then((async a=>{a&&("0"===a.code?(f.tableData=a.data,1===l&&e({type:"success",message:"刷新成功！"})):T(a),await U((()=>{f.tableMaxHeight=u.value.clientHeight-34-36-22})))}))};b();const y=X((()=>f.tableData.filter((e=>{var l=!f.deviceModelInfo,a=e.name.toLowerCase().includes(f.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(f.deviceModelInfo.toLowerCase());return l||a})).slice((f.currentPage-1)*f.pagesize,f.currentPage*f.pagesize))),v=X((()=>f.tableData.filter((e=>{var l=!f.deviceModelInfo,a=e.name.toLowerCase().includes(f.deviceModelInfo.toLowerCase())||e.label.toLowerCase().includes(f.deviceModelInfo.toLowerCase());return l||a})))),_=e=>{f.currentPage=e},F=e=>{f.pagesize=e},w=e=>{f.dmFlag=!0,f.dmTitle="编辑采集模型",f.modelForm={name:e.name,label:e.label,type:void 0===e.type?0:e.type,param:e.param}},P=M(null),z=()=>{f.dmFlag=!1,P.value.resetFields(),O()},I=()=>{z()},O=()=>{f.modelForm={name:"",label:"",type:0}},j=()=>{f.showFlag=0},T=l=>{e({type:"error",message:l.message})},E=(l,a)=>{e({type:"0"===l.code?"success":"error",message:l.message}),"0"===l.code&&a&&a()};return(p,g)=>{const h=l,M=r,C=t,X=D("Icon"),U=a,O=o,T=d,W=s,Y=n,G=m;return V(),A("div",pl,[0===R(f).showFlag?(V(),A("div",cl,[L("div",ul,[B(O,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:S((()=>[B(C,{label:"采集模型名称"},{default:S((()=>[B(M,{style:{width:"200px"},placeholder:"请输入采集模型名称",modelValue:R(f).deviceModelInfo,"onUpdate:modelValue":g[0]||(g[0]=e=>R(f).deviceModelInfo=e)},{prefix:S((()=>[B(h,{class:"el-input__icon"},{default:S((()=>[B(R(x))])),_:1})])),_:1},8,["modelValue"])])),_:1}),B(C,null,{default:S((()=>[B(U,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:g[1]||(g[1]=e=>{b(1)})},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(X,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),N(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),L("div",ml,[B(U,{type:"primary",bg:"",class:"right-btn",onClick:g[2]||(g[2]=e=>(f.dmFlag=!0,void(f.dmTitle="添加采集模型")))},{default:S((()=>[B(h,{class:"btn-icon"},{default:S((()=>[B(X,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),N(" 添加 ")])),_:1})]),L("div",{class:"content",ref_key:"contentRef",ref:u},[B(W,{data:R(y),"cell-style":R(f).cellStyle,"header-cell-style":R(f).headerCellStyle,"max-height":R(f).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:w},{empty:S((()=>[fl])),default:S((()=>[B(T,{sortable:"",prop:"name",label:"采集模型名称",width:"auto","min-width":"200",align:"center"}),B(T,{sortable:"",prop:"label",label:"采集模型标签",width:"auto","min-width":"200",align:"center"}),B(T,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:S((l=>[B(U,{onClick:e=>{return a=l.row,f.curDeviceModel=a,void(f.showFlag=1);var a},text:"",type:"success"},{default:S((()=>[N("变量详情")])),_:2},1032,["onClick"]),B(U,{onClick:e=>{return a=l.row,f.curDeviceModel=a,void(f.showFlag=2);var a},text:"",type:"success"},{default:S((()=>[N("命令详情")])),_:2},1032,["onClick"]),B(U,{onClick:e=>w(l.row),text:"",type:"primary"},{default:S((()=>[N("编辑")])),_:2},1032,["onClick"]),B(U,{onClick:a=>{return t=l.row,void i.confirm("确定要删除这个采集模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:c.token,data:{name:t.name,type:3}};k.deleteDeviceModel(e).then((e=>{E(e,b)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var t},text:"",type:"danger"},{default:S((()=>[N("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",bl,[B(Y,{"current-page":R(f).currentPage,"page-size":R(f).pagesize,"page-sizes":[20,50,200,500],total:R(v).length,onCurrentChange:_,onSizeChange:F,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):H("",!0),1===R(f).showFlag?(V(),q(de,{key:1,curDeviceModel:R(f).curDeviceModel,onChangeShowFlag:g[3]||(g[3]=e=>j()),style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel"])):H("",!0),2===R(f).showFlag?(V(),q(il,{key:2,curDeviceModel:R(f).curDeviceModel,deviceModelList:R(f).tableData,onChangeShowFlag:g[4]||(g[4]=e=>j()),style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curDeviceModel","deviceModelList"])):H("",!0),B(G,{modelValue:R(f).dmFlag,"onUpdate:modelValue":g[9]||(g[9]=e=>R(f).dmFlag=e),title:R(f).dmTitle,width:"600px","before-close":I,"close-on-click-modal":!1},{footer:S((()=>[L("span",gl,[B(U,{onClick:g[7]||(g[7]=e=>z())},{default:S((()=>[N("取消")])),_:1}),B(U,{type:"primary",onClick:g[8]||(g[8]=e=>{P.value.validate((e=>{if(!e)return!1;{f.modelForm.type=f.typeModel;const e={token:c.token,data:f.modelForm};f.dmTitle.includes("添加")?k.addDeviceModel(e).then((e=>{E(e,b),z()})):k.editDeviceModel(e).then((e=>{E(e,b),z()}))}}))})},{default:S((()=>[N("保存")])),_:1})])])),default:S((()=>[L("div",yl,[B(O,{model:R(f).modelForm,rules:R(f).modelRules,ref_key:"modelFormRef",ref:P,"status-icon":"","label-position":"right","label-width":"120px"},{default:S((()=>[B(C,{label:"采集模型名称",prop:"name"},{default:S((()=>[B(M,{type:"text",disabled:R(f).dmTitle.includes("编辑"),modelValue:R(f).modelForm.name,"onUpdate:modelValue":g[5]||(g[5]=e=>R(f).modelForm.name=e),autocomplete:"off",placeholder:"请输入采集模型名称"},null,8,["disabled","modelValue"])])),_:1}),B(C,{label:"采集模型标签",prop:"label"},{default:S((()=>[B(M,{type:"text",modelValue:R(f).modelForm.label,"onUpdate:modelValue":g[6]||(g[6]=e=>R(f).modelForm.label=e),autocomplete:"off",placeholder:"请输入采集模型标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-46170bfd"]]);export{hl as default};
