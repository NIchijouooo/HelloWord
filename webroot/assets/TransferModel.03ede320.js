import{g as e,O as a,L as l,e as t,p as r,n as o,o as p,m as n,A as s,C as i,D as d,w as m,K as c,q as u,M as g,v as f}from"./element-plus.2c9426ce.js";import{_ as y,u as b,v as h}from"./index.d5c032bc.js";import{T as x}from"./transferModel.deb1bd3f.js";import{D as F}from"./deviceModel.d8833265.js";import{b as v,d as _}from"./@element-plus.e895b9e1.js";import{J as w,r as C,j as k,ae as V,o as M,c as P,a as L,O as A,R as T,u as N,V as z,W as j,P as U,aj as D,S,X as R,U as q,n as I,av as H,aw as O}from"./@vue.2c474d7f.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.d618444d.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./vue-router.3b7aa6c5.js";import"./pinia.39330980.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.ebbe6a42.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const B=e=>(H("data-v-822b1342"),e=e(),O(),e),E={class:"main-container"},W={class:"main"},$={class:"search-bar"},J={class:"search-bar",style:{display:"flex"}},K={class:"title",style:{position:"relative","margin-right":"40px",height:"40px",padding:"0px 0","justify-content":"flex-start"}},X={class:"tName"},G={class:"param-content"},Q={class:"pc-title"},Y={class:"pct-info"},Z={class:"pc-content"},ee={class:"param-value"},ae={class:"param-name"},le=B((()=>L("div",null,"无数据",-1))),te={class:"pagination"},re={class:"dialog-content"},oe={class:"dialog-footer"},pe=B((()=>L("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),ne={class:"dialog-footer"},se={class:"dialog-content",style:{"min-height":"408px",overflow:"unset",padding:"0"}},ie={class:"dialog-content-head"},de={class:"dialog-content-content"},me={class:"pagination dialog-pagination"},ce={class:"dialog-footer"};var ue=y({__name:"ModelProperty",props:{curTransferModel:{type:Object,default:{}}},emits:["changeTmFlag"],setup(y,{emit:H}){const O=y,B=b();console.log("id -> props",O);const ue=/^[0-9]+(.[0-9]{1,2})?$/,ge=(e,a,l)=>{ue.test(a)?l():l(new Error("只能输入大于等于0,最多两位小数的数字！"))},fe=w({headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,PropertyTableData:[],pFlag:!1,pTitle:"添加属性",PropertyInfo:"",propertyForm:{name:"",label:"",uploadName:"",type:0,min:0,max:0,minMaxAlarm:!1,step:0,stepAlarm:!1,unit:0,decimals:0,dataLength:"",dataLengthAlarm:!1},typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},paramName:{name:"属性名称",label:"属性标签",uploadName:"上报属性名称",type:"数据类型",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"步长",stepAlarm:"步长报警",unit:"单位",decimals:"小数位数",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],label:[{required:!0,message:"属性标签不能为空",trigger:"blur"}],uploadName:[{required:!0,message:"上报属性名称不能为空",trigger:"blur"}],type:[{required:!0,message:"数据类型不能为空",trigger:"blur"}],decimals:[{type:"number",message:"小数位数只能输入数字"}],step:[{required:!0,message:"步长不能为空",trigger:"blur"},{trigger:"blur",validator:ge}],min:[{required:!0,message:"最小值不能为空",trigger:"blur"},{trigger:"blur",validator:ge}],max:[{required:!0,message:"最大值不能为空",trigger:"blur"},{trigger:"blur",validator:ge}],dataLength:[{required:!0,message:"字符串长度不能为空",trigger:"blur"},{trigger:"blur",validator:/^[0-9]*[1-9][0-9]*$/}]},psFlag:!1,selectedProperties:[],collDeviceModelList:[],curCollName:"",selectList:[],AllPropertyNameList:[],pName:"",pTableData:[],pHeadStyle:{color:h.headerTextColor,borderColor:"#C0C4CC",height:"48px"},pCellStyle:{borderColor:"#C0C4CC",height:"48px"},pCurrentPage:1,pPagesize:5}),ye=C(null),be=a=>{const l={token:B.token,data:{name:O.curTransferModel.name}};x.getPropertiesByModelIdList(l).then((async l=>{console.log("getPropertiesByModelIdList -> res",l),l&&("0"===l.code?(fe.PropertyTableData=l.data,fe.AllPropertyNameList=[],fe.PropertyTableData.forEach((e=>{fe.AllPropertyNameList.push(e.name)})),console.log("AllPropertyNameList ->",fe.AllPropertyNameList),1===a&&e({type:"success",message:"刷新成功！"})):Re(l),await I((()=>{fe.tableMaxHeight=ye.value.clientHeight-34-36-132})))}))};be();const he=k((()=>{let e=fe.PropertyInfo;return fe.PropertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase()))).slice((fe.currentPage-1)*fe.pagesize,fe.currentPage*fe.pagesize)})),xe=k((()=>{let e=fe.PropertyInfo;return fe.PropertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase())))})),Fe=e=>{fe.currentPage=e},ve=e=>{fe.pagesize=e},_e=()=>{const e={token:B.token,data:{name:fe.curCollName}};F.getDeviceModelProperty(e).then((e=>{console.log("getDeviceModelProperty -> res",e),"0"===e.code?fe.pTableData=e.data:(fe.pTableData=[],Re(e))}))},we=e=>{fe.selectList=e},Ce=()=>{fe.plFlag=!0,(()=>{const e={token:B.token,data:{}};F.getDeviceModelList(e).then((e=>{console.log("getDeviceModelList -> res = ",e),"0"===e.code?(fe.collDeviceModelList=e.data,e.data.length>0&&(fe.curCollName=e.data[0].name),_e()):Re(e)}))})()},ke=()=>{_e()},Ve=e=>{fe.pCurrentPage=e},Me=e=>{fe.pPagesize=e},Pe=e=>!fe.AllPropertyNameList.includes(e.name),Le=async()=>{const l=a.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});if(console.log("saveProperties"),fe.selectList.length>0){let a=[];fe.selectList.map((e=>{let l={};l.name=e.name,l.label=e.label,l.uploadName=e.name,l.type=e.type,l.decimals=e.decimals,l.unit=e.unit;let t={};3!==e.type?(t.min=e.params.min,t.max=e.params.max,t.minMaxAlarm=e.params.minMaxAlarm,t.step=e.params.step,t.stepAlarm=e.params.stepAlarm):(t.dataLength=e.params.dataLength,t.dataLengthAlarm=e.params.dataLengthAlarm),l.params=t,a.push(l)})),console.log("saveProperties -> properties",a);const t={token:B.token,data:{name:O.curTransferModel.name,property:a}},r=await x.addProperties(t),o=a.length;if(r.data==o)l.close(),qe(r,be),Ae();else if(r.data){l.close();let a=r.data+"个添加成功，"+(o-r.data)+"个添加失败";e({type:"error",message:a}),ke()}else{l.close(),e({type:"error",message:"添加失败"}),ke()}}},Ae=()=>{fe.plFlag=!1},Te=e=>{Ae()},Ne=e=>{fe.pFlag=!0,fe.pTitle="编辑属性",fe.propertyForm.name=e.name,fe.propertyForm.label=e.label,fe.propertyForm.uploadName=e.uploadName,console.log("editProperty -> row ",e),fe.propertyForm.type=e.type,fe.propertyForm.decimals=e.decimals,fe.propertyForm.unit=e.unit,3!==e.type?(fe.propertyForm.min=e.params.min,fe.propertyForm.max=e.params.max,fe.propertyForm.minMaxAlarm=e.params.minMaxAlarm,fe.propertyForm.step=e.params.step,fe.propertyForm.stepAlarm=e.params.stepAlarm):(fe.propertyForm.dataLength=e.params.dataLength,fe.propertyForm.dataLengthAlarm=e.params.dataLengthAlarm),console.log("ctxData.propertyForm",fe.propertyForm)},ze=C(null),je=()=>{fe.pFlag=!1,ze.value.resetFields(),Se()},Ue=e=>{je()},De=e=>{fe.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},Se=()=>{fe.propertyForm={name:"",label:"",type:0,min:0,max:0,minMaxAlarm:!1,step:0,stepAlarm:!1,unit:"",decimals:0,dataLength:0,dataLengthAlarm:!1}},Re=a=>{e({type:"error",message:a.message})},qe=(a,l)=>{e({type:"0"===a.code?"success":"error",message:a.message}),"0"===a.code&&l&&l()};return(a,y)=>{const b=t,F=r,w=o,C=p,k=n,I=V("Icon"),ue=s,ge=i,_e=d,Se=f,Re=m,Ie=c,He=u,Oe=g;return M(),P("div",E,[L("div",W,[L("div",$,[A(C,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:T((()=>[A(w,{style:{"margin-left":"20px"}},{default:T((()=>[A(F,{type:"primary",plain:"",onClick:y[0]||(y[0]=e=>{H("changeTmFlag")}),style:{"margin-right":"20px"}},{default:T((()=>[A(b,{class:"el-input__icon"},{default:T((()=>[A(N(v))])),_:1}),z(" 返回上报模型 ")])),_:1})])),_:1})])),_:1},512)]),L("div",J,[L("div",K,[L("div",X,j(O.curTransferModel.label),1)]),A(C,{inline:!0,ref:"searchFormRef2","status-icon":"","label-width":"90px"},{default:T((()=>[A(w,{label:""},{default:T((()=>[A(k,{style:{width:"200px"},placeholder:"请输入属性名称或者标签",clearable:"",modelValue:N(fe).PropertyInfo,"onUpdate:modelValue":y[1]||(y[1]=e=>N(fe).PropertyInfo=e)},{prefix:T((()=>[A(b,{class:"el-input__icon"},{default:T((()=>[A(N(_))])),_:1})])),_:1},8,["modelValue"])])),_:1}),A(w,null,{default:T((()=>[A(F,{type:"primary",bg:"",class:"right-btn",onClick:y[2]||(y[2]=e=>(console.log("addDeviceModelProperty"),fe.pFlag=!0,void(fe.pTitle="添加属性")))},{default:T((()=>[A(b,{class:"btn-icon"},{default:T((()=>[A(I,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),z(" 手动添加 ")])),_:1})])),_:1}),A(w,null,{default:T((()=>[A(F,{type:"primary",bg:"",class:"right-btn",onClick:y[3]||(y[3]=e=>Ce())},{default:T((()=>[A(b,{class:"btn-icon"},{default:T((()=>[A(I,{name:"local-tongbu",size:"14px",color:"#ffffff"})])),_:1}),z(" 同步 ")])),_:1})])),_:1}),A(w,null,{default:T((()=>[A(F,{type:"danger",bg:"",class:"right-btn",onClick:y[4]||(y[4]=a=>(()=>{let a=[];0!==fe.selectedProperties.length?(fe.selectedProperties.forEach((e=>{a.push(e.name)})),console.log("pList",a),l.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:B.token,data:{name:O.curTransferModel.name,properties:a}};x.deleteProperty(e).then((e=>{qe(e,be)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:T((()=>[A(b,{class:"btn-icon"},{default:T((()=>[A(I,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),z(" 删除 ")])),_:1})])),_:1}),A(w,null,{default:T((()=>[A(F,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:y[5]||(y[5]=e=>{be(1)})},{default:T((()=>[A(b,{class:"btn-icon"},{default:T((()=>[A(I,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),z(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),L("div",{class:"content",ref_key:"contentRef",ref:ye,style:{top:"136px"}},[A(ge,{data:N(he),"cell-style":N(fe).cellStyle,"header-cell-style":N(fe).headerCellStyle,"max-height":N(fe).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:De,onRowDblclick:Ne},{empty:T((()=>[le])),default:T((()=>[A(ue,{type:"selection",width:"55"}),A(ue,{type:"expand"},{default:T((e=>[L("div",G,[L("div",Q,[L("div",Y,[L("b",null,j(e.row.name),1),z(" "+j("参数详情"))])]),L("div",Z,[(M(!0),P(U,null,D(e.row.params,((e,a,l)=>(M(),P("div",{class:"param-item",key:l},[L("div",ee,j(N(fe).paramName[a])+"：",1),L("div",ae,j("boolean"==typeof e?e?"是":"否":e||"-"),1)])))),128))])])])),_:1}),A(ue,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"180",align:"center"}),A(ue,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"180",align:"center"}),A(ue,{sortable:"",prop:"uploadName",label:"上报属性名称",width:"auto","min-width":"180",align:"center"}),A(ue,{sortable:"",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:T((e=>[z(j(N(fe).typeNames["t"+e.row.type]),1)])),_:1}),A(ue,{sortable:"",label:"小数位数",width:"auto","min-width":"80",align:"center"},{default:T((e=>[z(j(void 0===e.row.decimals||""===e.row.decimals?0:e.row.decimals),1)])),_:1}),A(ue,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),A(ue,{label:"操作",width:"auto","min-width":"150",align:"center",fixed:"right"},{default:T((e=>[A(F,{onClick:a=>Ne(e.row),text:"",type:"primary"},{default:T((()=>[z("编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",te,[A(_e,{"current-page":N(fe).currentPage,"page-size":N(fe).pagesize,"page-sizes":[20,50,200,500],total:N(xe).length,onCurrentChange:Fe,onSizeChange:ve,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),A(He,{modelValue:N(fe).pFlag,"onUpdate:modelValue":y[21]||(y[21]=e=>N(fe).pFlag=e),title:N(fe).pTitle,width:"600px","before-close":Ue,"close-on-click-modal":!1},{footer:T((()=>[L("span",oe,[A(F,{onClick:y[19]||(y[19]=e=>je())},{default:T((()=>[z("取消")])),_:1}),A(F,{type:"primary",onClick:y[20]||(y[20]=a=>{3!==fe.propertyForm.type&&Number(fe.propertyForm.min)>Number(fe.propertyForm.max)?e.warning("最大值必须大于最小值"):ze.value.validate((e=>{if(console.log("valid",e),!e)return!1;{let e={};e.name=fe.propertyForm.name,e.label=fe.propertyForm.label,e.uploadName=fe.propertyForm.uploadName,e.type=fe.propertyForm.type,e.decimals=fe.propertyForm.decimals,e.unit=fe.propertyForm.unit.toString();let a={};3!==fe.propertyForm.type?(a.min=fe.propertyForm.min.toString(),a.max=fe.propertyForm.max.toString(),a.minMaxAlarm=fe.propertyForm.minMaxAlarm,a.step=fe.propertyForm.step.toString(),a.stepAlarm=fe.propertyForm.stepAlarm):(a.dataLength=fe.propertyForm.dataLength.toString(),a.dataLengthAlarm=fe.propertyForm.dataLengthAlarm),e.params=a,console.log("submitPorpertyForm -> property",e);const l={token:B.token,data:{name:O.curTransferModel.name,property:e}};fe.pTitle.includes("添加")?(console.log("添加属性"),x.addProperty(l).then((e=>{qe(e,be),je()}))):(console.log("编辑属性"),x.editProperty(l).then((e=>{qe(e,be),je()})))}}))})},{default:T((()=>[z("保存")])),_:1})])])),default:T((()=>[L("div",re,[A(C,{model:N(fe).propertyForm,rules:N(fe).propertyRules,ref_key:"propertyFormRef",ref:ze,"status-icon":"","label-position":"right","label-width":"120px"},{default:T((()=>[A(w,{label:"属性名称",prop:"name"},{default:T((()=>[A(k,{disabled:N(fe).pTitle.includes("编辑"),type:"text",modelValue:N(fe).propertyForm.name,"onUpdate:modelValue":y[6]||(y[6]=e=>N(fe).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),A(w,{label:"属性标签",prop:"label"},{default:T((()=>[A(k,{type:"text",modelValue:N(fe).propertyForm.label,"onUpdate:modelValue":y[7]||(y[7]=e=>N(fe).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),A(w,{label:"上报属性名称",prop:"uploadName"},{default:T((()=>[A(k,{type:"text",modelValue:N(fe).propertyForm.uploadName,"onUpdate:modelValue":y[8]||(y[8]=e=>N(fe).propertyForm.uploadName=e),autocomplete:"off",placeholder:"请输入上报属性名称"},null,8,["modelValue"])])),_:1}),A(w,{label:"数据类型",prop:"type"},{default:T((()=>[A(Re,{modelValue:N(fe).propertyForm.type,"onUpdate:modelValue":y[9]||(y[9]=e=>N(fe).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"100%"},placeholder:"请选择数据类型"},{default:T((()=>[(M(!0),P(U,null,D(N(fe).typeOptions,(e=>(M(),S(Se,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),3!==N(fe).propertyForm.type?(M(),S(w,{key:0,label:"范围报警",prop:"minMaxAlarm"},{default:T((()=>[A(Ie,{modelValue:N(fe).propertyForm.minMaxAlarm,"onUpdate:modelValue":y[10]||(y[10]=e=>N(fe).propertyForm.minMaxAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):R("",!0),3!==N(fe).propertyForm.type&&N(fe).propertyForm.minMaxAlarm?(M(),S(w,{key:1,label:"最小值",prop:"min"},{default:T((()=>[A(k,{type:"text",modelValue:N(fe).propertyForm.min,"onUpdate:modelValue":y[11]||(y[11]=e=>N(fe).propertyForm.min=e),autocomplete:"off",placeholder:"请输入最小值"},null,8,["modelValue"])])),_:1})):R("",!0),3!==N(fe).propertyForm.type&&N(fe).propertyForm.minMaxAlarm?(M(),S(w,{key:2,label:"最大值",prop:"max"},{default:T((()=>[A(k,{type:"text",modelValue:N(fe).propertyForm.max,"onUpdate:modelValue":y[12]||(y[12]=e=>N(fe).propertyForm.max=e),autocomplete:"off",placeholder:"请输入最大值"},null,8,["modelValue"])])),_:1})):R("",!0),3!==N(fe).propertyForm.type?(M(),S(w,{key:3,label:"步长报警",prop:"stepAlarm"},{default:T((()=>[A(Ie,{modelValue:N(fe).propertyForm.stepAlarm,"onUpdate:modelValue":y[13]||(y[13]=e=>N(fe).propertyForm.stepAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):R("",!0),3!==N(fe).propertyForm.type&&N(fe).propertyForm.stepAlarm?(M(),S(w,{key:4,label:"步长",prop:"step"},{default:T((()=>[A(k,{type:"text",modelValue:N(fe).propertyForm.step,"onUpdate:modelValue":y[14]||(y[14]=e=>N(fe).propertyForm.step=e),autocomplete:"off",placeholder:"请输入步长"},null,8,["modelValue"])])),_:1})):R("",!0),2===N(fe).propertyForm.type?(M(),S(w,{key:5,label:"小数位数",prop:"decimals"},{default:T((()=>[A(k,{type:"text",modelValue:N(fe).propertyForm.decimals,"onUpdate:modelValue":y[15]||(y[15]=e=>N(fe).propertyForm.decimals=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入小数位数"},null,8,["modelValue"])])),_:1})):R("",!0),3!==N(fe).propertyForm.type?(M(),S(w,{key:6,label:"单位",prop:"unit"},{default:T((()=>[A(k,{type:"text",modelValue:N(fe).propertyForm.unit,"onUpdate:modelValue":y[16]||(y[16]=e=>N(fe).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1})):R("",!0),3===N(fe).propertyForm.type?(M(),S(w,{key:7,label:"字符串长度报警",prop:"dataLengthAlarm"},{default:T((()=>[A(Ie,{modelValue:N(fe).propertyForm.dataLengthAlarm,"onUpdate:modelValue":y[17]||(y[17]=e=>N(fe).propertyForm.dataLengthAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):R("",!0),3===N(fe).propertyForm.type&&N(fe).propertyForm.dataLengthAlarm?(M(),S(w,{key:8,label:"字符串长度",prop:"dataLength"},{default:T((()=>[A(k,{type:"text",modelValue:N(fe).propertyForm.dataLength,"onUpdate:modelValue":y[18]||(y[18]=e=>N(fe).propertyForm.dataLength=e),autocomplete:"off",placeholder:"请输入字符串长度"},null,8,["modelValue"])])),_:1})):R("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),A(He,{modelValue:N(fe).psFlag,"onUpdate:modelValue":y[22]||(y[22]=e=>N(fe).psFlag=e),title:"导入属性",width:"600px","before-close":a.beforeCloseUploadProperty,"close-on-click-modal":!1},{footer:T((()=>[L("span",ne,[A(F,{onClick:a.cancelUploadProperty},{default:T((()=>[z("取消")])),_:1},8,["onClick"]),A(F,{type:"primary",onClick:a.submitUploadProperty},{default:T((()=>[z("上传")])),_:1},8,["onClick"])])])),default:T((()=>[A(Oe,{ref:"uploadPropertyRef",action:"","auto-upload":!1,"http-request":a.myRequestProperty,limit:1,"on-exceed":a.handleExceedProperty,"before-upload":a.beforeUploadProperty},{tip:T((()=>[pe])),default:T((()=>[A(F,{type:"primary"},{default:T((()=>[z("选择文件")])),_:1})])),_:1},8,["http-request","on-exceed","before-upload"])])),_:1},8,["modelValue","before-close"]),A(He,{title:"同步采集属性",modelValue:N(fe).plFlag,"onUpdate:modelValue":y[26]||(y[26]=e=>N(fe).plFlag=e),width:"1000px","before-close":Te,"close-on-click-modal":!1},{footer:T((()=>[L("span",ce,[A(F,{onClick:Ae},{default:T((()=>[z("取消")])),_:1}),A(F,{type:"primary",onClick:Le},{default:T((()=>[z("保存")])),_:1})])])),default:T((()=>[L("div",se,[L("div",ie,[A(Re,{modelValue:N(fe).curCollName,"onUpdate:modelValue":y[23]||(y[23]=e=>N(fe).curCollName=e),placeholder:"请选择采集模型",onChange:y[24]||(y[24]=e=>ke())},{default:T((()=>[(M(!0),P(U,null,D(N(fe).collDeviceModelList,(e=>(M(),S(Se,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),A(k,{placeholder:"请输入属性名称或者标签",style:{width:"200px"},clearable:"",modelValue:N(fe).pName,"onUpdate:modelValue":y[25]||(y[25]=e=>N(fe).pName=e)},{prefix:T((()=>[A(b,{class:"el-input__icon"},{default:T((()=>[A(N(_))])),_:1})])),_:1},8,["modelValue"])]),L("div",de,[A(ge,{data:N(fe).pTableData.filter((e=>!N(fe).pName||e.name.includes(N(fe).pName)||e.label.includes(N(fe).pName))).slice((N(fe).pCurrentPage-1)*N(fe).pPagesize,N(fe).pCurrentPage*N(fe).pPagesize),"header-cell-style":N(fe).pHeadStyle,"cell-style":N(fe).pCellStyle,style:{border:"1px solid #c0c4cc"},"max-height":"290",onSelectionChange:we,stripe:""},{default:T((()=>[A(ue,{type:"selection",width:"60",selectable:Pe}),A(ue,{prop:"name",label:"属性名称","min-width":"200",width:"auto",align:"center"}),A(ue,{prop:"label",label:"属性标签","min-width":"200",width:"auto",align:"center"}),A(ue,{label:"状态","min-width":"120",width:"auto",align:"center"},{default:T((e=>[L("span",{style:q({color:N(fe).AllPropertyNameList.includes(e.row.name)?N(h).successColor:N(h).dangerColor})},j(N(fe).AllPropertyNameList.includes(e.row.name)?"已选择":"未选择"),5)])),_:1})])),_:1},8,["data","header-cell-style","cell-style"]),L("div",me,[A(_e,{"current-page":N(fe).pCurrentPage,"page-size":N(fe).pPagesize,"page-sizes":[5,20,50,200],total:N(fe).pTableData.length,onCurrentChange:Ve,onSizeChange:Me,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"22px"}},null,8,["current-page","page-size","total"])])])])])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-822b1342"]]);const ge={class:"main-container"},fe={key:0,class:"main"},ye={class:"search-bar"},be={class:"tool-bar"},he=(e=>(H("data-v-7c5934a5"),e=e(),O(),e))((()=>L("div",null,"无数据",-1))),xe={class:"pagination"},Fe={class:"dialog-content"},ve={class:"dialog-footer"};var _e=y({__name:"TransferModel",setup(a){const c=b(),g=C(null),y=w({headerCellStyle:{background:h.primaryColor,color:h.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:10,transferName:"",transferTableData:[{name:"测试01",label:"测试01"}],isModel:!0,curTransferModel:null,tFlag:!1,tTitle:"添加上报模型",transferForm:{name:"",label:"",code:""},transferRules:{name:[{required:!0,message:"上报模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"上报模型标签不能为空",trigger:"blur"}],code:[{required:!0,message:"上报模型编号不能为空",trigger:"blur"}]},collectOptions:[]}),v=a=>{const l={token:c.token,data:{}};x.getModelList(l).then((async l=>{console.log("getModelList -> res",l),l&&("0"===l.code?(y.transferTableData=l.data,1===a&&e({type:"success",message:"刷新成功！"})):J(l),await I((()=>{y.tableMaxHeight=g.value.clientHeight-34-36-22})))}))};v();(()=>{const e={token:c.token,data:{}};F.getDeviceModelList(e).then((e=>{e&&("0"===e.code?y.collectOptions=e.data:J(e))}))})();const j=e=>{y.currentPage=e},R=e=>{y.pagesize=e},q=k((()=>y.transferTableData.filter((e=>!y.transferModelName||e.name.toLowerCase().includes(y.transferModelName.toLowerCase()))).slice((y.currentPage-1)*y.pagesize,y.currentPage*y.pagesize))),H=k((()=>y.transferTableData.filter((e=>!y.transferModelName||e.name.toLowerCase().includes(y.transferModelName.toLowerCase()))))),O=()=>{y.transferForm={name:"",label:"",code:""},y.tTitle="添加上报模型",y.tFlag=!0},B=e=>{y.tTitle="编辑上报模型",y.tFlag=!0,y.transferForm.name=e.name,y.transferForm.label=e.label,y.transferForm.code=e.code},E=C(null),W=()=>{y.tFlag=!1},$=()=>{W()},J=a=>{e({type:"error",message:a.message})},K=(a,l)=>{e({type:"0"===a.code?"success":"error",message:a.message}),"0"===a.code&&l&&l()};return(a,b)=>{const h=t,F=n,w=o,C=V("Icon"),k=r,I=p,J=s,X=i,G=d,Q=f,Y=m,Z=u;return M(),P("div",ge,[N(y).isModel?(M(),P("div",fe,[L("div",ye,[A(I,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:T((()=>[A(w,{label:"上报模型名称"},{default:T((()=>[A(F,{style:{width:"200px"},placeholder:"请输入上报模型名称",clearable:"",modelValue:N(y).transferModelName,"onUpdate:modelValue":b[0]||(b[0]=e=>N(y).transferModelName=e)},{prefix:T((()=>[A(h,{class:"el-input__icon"},{default:T((()=>[A(N(_))])),_:1})])),_:1},8,["modelValue"])])),_:1}),A(w,null,{default:T((()=>[A(k,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:b[1]||(b[1]=e=>{v(1)})},{default:T((()=>[A(h,{class:"btn-icon"},{default:T((()=>[A(C,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),z(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),L("div",be,[A(k,{type:"primary",bg:"",class:"right-btn",onClick:b[2]||(b[2]=e=>O())},{default:T((()=>[A(h,{class:"btn-icon"},{default:T((()=>[A(C,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),z(" 添加 ")])),_:1})]),L("div",{class:"content",ref_key:"contentRef",ref:g},[A(X,{data:N(q),"cell-style":N(y).cellStyle,"header-cell-style":N(y).headerCellStyle,"max-height":N(y).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:B},{empty:T((()=>[he])),default:T((()=>[A(J,{sortable:"",prop:"name",label:"上报模型名称",width:"auto","min-width":"200",align:"center"}),A(J,{sortable:"",prop:"label",label:"上报模型标签",width:"auto","min-width":"200",align:"center"}),A(J,{sortable:"",prop:"code",label:"上报模型编号",width:"auto","min-width":"200",align:"center"}),A(J,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:T((a=>[A(k,{onClick:e=>{return l=a.row,y.curTransferModel=l,void(y.isModel=!1);var l},text:"",type:"success"},{default:T((()=>[z("变量详情")])),_:2},1032,["onClick"]),A(k,{onClick:e=>B(a.row),text:"",type:"primary"},{default:T((()=>[z("编辑")])),_:2},1032,["onClick"]),A(k,{onClick:t=>{return r=a.row,void l.confirm("确定要删除这个上报模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:c.token,data:{name:r.name}};x.deleteModel(e).then((e=>{K(e,v)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var r},text:"",type:"danger"},{default:T((()=>[z("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",xe,[A(G,{"current-page":N(y).currentPage,"page-size":N(y).pagesize,"page-sizes":[5,10,20,50],total:N(H).length,onCurrentChange:j,onSizeChange:R,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):(M(),S(ue,{key:1,curTransferModel:N(y).curTransferModel,onChangeTmFlag:b[3]||(b[3]=e=>{y.isModel=!0}),style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curTransferModel"])),A(Z,{modelValue:N(y).tFlag,"onUpdate:modelValue":b[9]||(b[9]=e=>N(y).tFlag=e),title:N(y).tTitle,width:"600px","before-close":$,"close-on-click-modal":!1},{footer:T((()=>[L("span",ve,[A(k,{onClick:b[7]||(b[7]=e=>W())},{default:T((()=>[z("取消")])),_:1}),A(k,{type:"primary",onClick:b[8]||(b[8]=e=>{E.value.validate((e=>{if(!e)return!1;{const e={token:c.token,data:y.transferForm};y.tTitle.includes("添加")?x.addModel(e).then((e=>{K(e,v),W()})):x.editModel(e).then((e=>{K(e,v),W()}))}}))})},{default:T((()=>[z("保存")])),_:1})])])),default:T((()=>[L("div",Fe,[A(I,{model:N(y).transferForm,rules:N(y).transferRules,ref_key:"transferFormRef",ref:E,"status-icon":"","label-position":"right","label-width":"120px"},{default:T((()=>[A(w,{label:"上报模型名称",prop:"name"},{default:T((()=>[A(Y,{modelValue:N(y).transferForm.name,"onUpdate:modelValue":b[4]||(b[4]=e=>N(y).transferForm.name=e),filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或者输入上报模型名称",style:{width:"100%"}},{default:T((()=>[(M(!0),P(U,null,D(N(y).collectOptions,(e=>(M(),S(Q,{key:e.name,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),A(w,{label:"上报模型标签",prop:"label"},{default:T((()=>[A(Y,{modelValue:N(y).transferForm.label,"onUpdate:modelValue":b[5]||(b[5]=e=>N(y).transferForm.label=e),filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或者输入上报模型标签",style:{width:"100%"}},{default:T((()=>[(M(!0),P(U,null,D(N(y).collectOptions,(e=>(M(),S(Q,{key:e.label,label:e.label,value:e.label},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),A(w,{label:"上报模型编号",prop:"code"},{default:T((()=>[A(F,{type:"text",modelValue:N(y).transferForm.code,"onUpdate:modelValue":b[6]||(b[6]=e=>N(y).transferForm.code=e),autocomplete:"off",placeholder:"请输入上报模型编号"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-7c5934a5"]]);export{_e as default};
