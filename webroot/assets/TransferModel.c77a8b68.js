import{h as e,C as a,e as l,p as t,m as o,D as r,v as p,L as n,F as s,G as i,n as d,y as m,A as c,B as u,o as y,q as f,H as g}from"./element-plus.795748f2.js";import{_ as h,u as b,v as F}from"./index.c4bb92fc.js";import{T as x}from"./transferModel.7ae75bb0.js";import{D as v}from"./deviceModel.de9e06d6.js";import{J as _,I as w}from"./@element-plus.102632fb.js";import{Y as C,f as k,p as V,X as P,o as M,c as L,a as A,S as T,Q as N,u as z,U,a0 as D,M as j,af as S,P as H,L as I,V as R,as as q,at as B,H as O}from"./@vue.8518410d.js";import"./@vueuse.c0256496.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./vue-router.ae8a7199.js";import"./pinia.4a496763.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./nprogress.aae2b787.js";const E=e=>(q("data-v-88056280"),e=e(),B(),e),W={class:"main"},G={class:"title",style:{"justify-content":"space-between"}},J={class:"title-left"},Q=D(" 返回上报模型 "),X={class:"title",style:{top:"60px",height:"76px",padding:"20px 0","justify-content":"space-between"}},Y={class:"tName"},K={style:{display:"flex","align-items":"center"}},Z=D(" 手动添加 "),$=D(" 同步 "),ee=D(" 删除 "),ae=D(" 刷新 "),le={class:"param-content"},te={class:"pc-title"},oe={class:"pct-info"},re=D(" "+U("参数详情")),pe={class:"pc-content"},ne={class:"param-item"},se={class:"param-value"},ie={class:"param-name"},de=D("编辑"),me=E((()=>A("div",null,"无数据",-1))),ce={class:"pagination"},ue={class:"dialog-content"},ye={class:"dialog-footer"},fe=D("取消"),ge=D("保存"),he=D("选择文件"),be=E((()=>A("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),Fe={class:"dialog-footer"},xe=D("取消"),ve=D("上传"),_e={class:"dialog-content",style:{"min-height":"408px",overflow:"unset",padding:"0"}},we={class:"dialog-content-head"},Ce={class:"dialog-content-content"},ke={class:"pagination dialog-pagination"},Ve={class:"dialog-footer"},Pe=D("取消"),Me=D("保存");var Le=h({props:{curTransferModel:{type:Object,default:{}}},emits:["changeTmFlag"],setup(h,{emit:q}){const B=h,E=b();console.log("id -> props",B);const Le=C({headerCellStyle:{background:F.primaryColor,color:F.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,PropertyTableData:[],pFlag:!1,pTitle:"添加属性",PropertyInfo:"",propertyForm:{name:"",label:"",uploadName:"",type:0,min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,unit:"",decimals:0,dataLength:"",dataLengthAlarm:!1},typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},paramName:{name:"属性名称",label:"属性标签",uploadName:"上报属性名称",type:"数据类型",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"布长",stepAlarm:"布长报警",unit:"单位",decimals:"小数位数",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],label:[{required:!0,message:"属性标签不能为空",trigger:"blur"}],uploadName:[{required:!0,message:"上报属性名称不能为空",trigger:"blur"}],type:[{required:!0,message:"数据类型不能为空",trigger:"blur"}],decimals:[{type:"number",message:"小数位数只能输入数字"}]},psFlag:!1,selectedProperties:[],collDeviceModelList:[],curCollName:"",selectList:[],AllPropertyNameList:[],pName:"",pTableData:[],pHeadStyle:{color:F.headerTextColor,borderColor:"#C0C4CC",height:"48px"},pCellStyle:{borderColor:"#C0C4CC",height:"48px"},pCurrentPage:1,pPagesize:5}),Ae=k(null),Te=a=>{const l={token:E.token,data:{name:B.curTransferModel.name}};x.getPropertiesByModelIdList(l).then((async l=>{console.log("getPropertiesByModelIdList -> res",l),l&&("0"===l.code?(Le.PropertyTableData=l.data,Le.AllPropertyNameList=[],Le.PropertyTableData.forEach((e=>{Le.AllPropertyNameList.push(e.name)})),console.log("AllPropertyNameList ->",Le.AllPropertyNameList),1===a&&e({type:"success",message:"刷新成功！"})):Ke(l),await O((()=>{Le.tableMaxHeight=Ae.value.clientHeight-34-36-22})))}))};Te();const Ne=V((()=>{let e=Le.PropertyInfo;return Le.PropertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase()))).slice((Le.currentPage-1)*Le.pagesize,Le.currentPage*Le.pagesize)})),ze=V((()=>{let e=Le.PropertyInfo;return Le.PropertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase())))})),Ue=e=>{Le.currentPage=e},De=e=>{Le.pagesize=e},je=()=>{const e={token:E.token,data:{name:Le.curCollName}};v.getDeviceModelProperty(e).then((e=>{console.log("getDeviceModelProperty -> res",e),"0"===e.code?Le.pTableData=e.data:(Le.pTableData=[],Ke(e))}))},Se=e=>{Le.selectList=e},He=()=>{Le.plFlag=!0,(()=>{const e={token:E.token,data:{}};v.getDeviceModelList(e).then((e=>{console.log("getDeviceModelList -> res = ",e),"0"===e.code?(Le.collDeviceModelList=e.data,e.data.length>0&&(Le.curCollName=e.data[0].name),je()):Ke(e)}))})()},Ie=e=>{Le.pCurrentPage=e},Re=e=>{Le.pPagesize=e},qe=e=>!Le.AllPropertyNameList.includes(e.name),Be=async()=>{if(console.log("saveProperties"),Le.selectList.length>0){const e=Le.selectList.map((async e=>{let a={};a.name=e.name,a.label=e.label,a.uploadName=e.name,a.type=e.type,a.decimals=e.decimals,a.unit=e.unit;let l={};3!==e.type?(l.min="",l.max="",l.minMaxAlarm=!1,l.step="",l.stepAlarm=!1):(l.dataLength="",l.dataLengthAlarm=!1),a.params=l,console.log("saveProperties -> property",a);const t={token:E.token,data:{name:B.curTransferModel.name,property:a}};return await x.addProperty(t)})),a=await Promise.all(e);if(a.length>0){const e=a[a.length-1];Ze(e,Te),Oe()}}},Oe=()=>{Le.plFlag=!1},Ee=e=>{Oe()},We=e=>{Le.pFlag=!0,Le.pTitle="编辑属性",Le.propertyForm.name=e.name,Le.propertyForm.label=e.label,Le.propertyForm.uploadName=e.uploadName,console.log("editProperty -> row ",e),Le.propertyForm.type=e.type,Le.propertyForm.decimals=e.decimals,Le.propertyForm.unit=e.unit,3!==e.type?(Le.propertyForm.min=e.params.min,Le.propertyForm.max=e.params.max,Le.propertyForm.minMaxAlarm=e.params.minMaxAlarm,Le.propertyForm.step=e.params.step,Le.propertyForm.stepAlarm=e.params.stepAlarm):(Le.propertyForm.dataLength=e.params.dataLength,Le.propertyForm.dataLengthAlarm=e.params.dataLengthAlarm),console.log("ctxData.propertyForm",Le.propertyForm)},Ge=k(null),Je=()=>{Le.pFlag=!1,Ge.value.resetFields(),Ye()},Qe=e=>{Je()},Xe=e=>{Le.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},Ye=()=>{Le.propertyForm={name:"",label:"",type:0,min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,unit:"",decimals:0,dataLength:"",dataLengthAlarm:!1}},Ke=a=>{e({type:"error",message:a.message})},Ze=(a,l)=>{e({type:"0"===a.code?"success":"error",message:a.message}),"0"===a.code&&l&&l()};return(h,b)=>{const v=l,C=t,k=o,V=P("Icon"),O=r,Ye=p,Ke=n,$e=s,ea=i,aa=d,la=m,ta=c,oa=u,ra=y,pa=f,na=g;return M(),L("div",W,[A("div",G,[A("div",J,[T(C,{type:"primary",plain:"",onClick:b[0]||(b[0]=e=>{q("changeTmFlag")}),style:{"margin-right":"20px"}},{default:N((()=>[T(v,{class:"el-input__icon"},{default:N((()=>[T(z(_))])),_:1}),Q])),_:1})])]),A("div",X,[A("div",Y,U(B.curTransferModel.label),1),A("div",K,[T(k,{style:{width:"200px"},placeholder:"请输入属性名称或者标签",clearable:"",modelValue:z(Le).PropertyInfo,"onUpdate:modelValue":b[1]||(b[1]=e=>z(Le).PropertyInfo=e)},{prefix:N((()=>[T(v,{class:"el-input__icon"},{default:N((()=>[T(z(w))])),_:1})])),_:1},8,["modelValue"]),T(C,{type:"primary",bg:"",class:"right-btn",onClick:b[2]||(b[2]=e=>(console.log("addDeviceModelProperty"),Le.pFlag=!0,void(Le.pTitle="添加属性")))},{default:N((()=>[T(v,{class:"btn-icon"},{default:N((()=>[T(V,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),Z])),_:1}),T(C,{type:"primary",bg:"",class:"right-btn",onClick:b[3]||(b[3]=e=>He())},{default:N((()=>[T(v,{class:"btn-icon"},{default:N((()=>[T(V,{name:"local-tongbu",size:"14px",color:"#ffffff"})])),_:1}),$])),_:1}),T(C,{type:"danger",bg:"",class:"right-btn",onClick:b[4]||(b[4]=l=>(()=>{let l=[];0!==Le.selectedProperties.length?(Le.selectedProperties.forEach((e=>{l.push(e.name)})),console.log("pList",l),a.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:E.token,data:{name:B.curTransferModel.name,properties:l}};x.deleteProperty(e).then((e=>{Ze(e,Te)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:N((()=>[T(v,{class:"btn-icon"},{default:N((()=>[T(V,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),ee])),_:1}),T(C,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:b[5]||(b[5]=e=>{Te(1)})},{default:N((()=>[T(v,{class:"btn-icon"},{default:N((()=>[T(V,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),ae])),_:1})])]),A("div",{class:"content",ref_key:"contentRef",ref:Ae,style:{top:"136px"}},[T($e,{data:z(Ne),"cell-style":z(Le).cellStyle,"header-cell-style":z(Le).headerCellStyle,"max-height":z(Le).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:Xe,onRowDblclick:We},{empty:N((()=>[me])),default:N((()=>[T(O,{type:"selection",width:"55"}),T(O,{prop:"name",label:"属性名称",width:"auto","min-width":"180",align:"center"}),T(O,{prop:"label",label:"属性标签",width:"auto","min-width":"180",align:"center"}),T(O,{prop:"uploadName",label:"上报属性名称",width:"auto","min-width":"180",align:"center"}),T(O,{label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:N((e=>[D(U(z(Le).typeNames["t"+e.row.type]),1)])),_:1}),T(O,{label:"小数位数",width:"auto","min-width":"80",align:"center"},{default:N((e=>[D(U(void 0===e.row.decimals||""===e.row.decimals?0:e.row.decimals),1)])),_:1}),T(O,{prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),T(O,{label:"参数详情",width:"auto","min-width":"400",align:"center"},{default:N((e=>[T(Ke,{trigger:"hover","show-after":500,"auto-close":500,effect:"light",width:"auto",placement:"left"},{default:N((()=>[A("div",le,[A("div",te,[A("div",oe,[A("b",null,U(e.row.name),1),re])]),A("div",pe,[(M(!0),L(j,null,S(e.row.params,((e,a,l)=>(M(),L("div",ne,[A("div",se,U(z(Le).paramName[a])+"：",1),A("div",ie,U("boolean"==typeof e?e?"是":"否":e),1)])))),256))])])])),reference:N((()=>[T(Ye,{size:"large"},{default:N((()=>[D(U(e.row.params),1)])),_:2},1024)])),_:2},1024)])),_:1}),T(O,{label:"操作",width:"auto","min-width":"150",align:"center",fixed:"right"},{default:N((e=>[T(C,{onClick:a=>We(e.row),text:"",type:"primary"},{default:N((()=>[de])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),A("div",ce,[T(ea,{"current-page":z(Le).currentPage,"page-size":z(Le).pagesize,"page-sizes":[20,50,200,500],total:z(ze).length,onCurrentChange:Ue,onSizeChange:De,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),T(pa,{modelValue:z(Le).pFlag,"onUpdate:modelValue":b[21]||(b[21]=e=>z(Le).pFlag=e),title:z(Le).pTitle,width:"600px","before-close":Qe,"close-on-click-modal":!1},{footer:N((()=>[A("span",ye,[T(C,{onClick:b[19]||(b[19]=e=>Je())},{default:N((()=>[fe])),_:1}),T(C,{type:"primary",onClick:b[20]||(b[20]=e=>{Ge.value.validate((e=>{if(console.log("valid",e),!e)return!1;{let e={};e.name=Le.propertyForm.name,e.label=Le.propertyForm.label,e.uploadName=Le.propertyForm.uploadName,e.type=Le.propertyForm.type,e.decimals=Le.propertyForm.decimals,e.unit=Le.propertyForm.unit;let a={};3!==Le.propertyForm.type?(a.min=Le.propertyForm.min,a.max=Le.propertyForm.max,a.minMaxAlarm=Le.propertyForm.minMaxAlarm,a.step=Le.propertyForm.step,a.stepAlarm=Le.propertyForm.stepAlarm):(a.dataLength=Le.propertyForm.dataLength,a.dataLengthAlarm=Le.propertyForm.dataLengthAlarm),e.params=a,console.log("submitPorpertyForm -> property",e);const l={token:E.token,data:{name:B.curTransferModel.name,property:e}};Le.pTitle.includes("添加")?(console.log("添加属性"),x.addProperty(l).then((e=>{Ze(e,Te),Je()}))):(console.log("编辑属性"),x.editProperty(l).then((e=>{Ze(e,Te),Je()})))}}))})},{default:N((()=>[ge])),_:1})])])),default:N((()=>[A("div",ue,[T(ra,{model:z(Le).propertyForm,rules:z(Le).propertyRules,ref_key:"propertyFormRef",ref:Ge,"status-icon":"","label-position":"right","label-width":"120px"},{default:N((()=>[T(aa,{label:"属性名称",prop:"name"},{default:N((()=>[T(k,{disabled:z(Le).pTitle.includes("编辑"),type:"text",modelValue:z(Le).propertyForm.name,"onUpdate:modelValue":b[6]||(b[6]=e=>z(Le).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),T(aa,{label:"属性标签",prop:"label"},{default:N((()=>[T(k,{type:"text",modelValue:z(Le).propertyForm.label,"onUpdate:modelValue":b[7]||(b[7]=e=>z(Le).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),T(aa,{label:"上报属性名称",prop:"uploadName"},{default:N((()=>[T(k,{type:"text",modelValue:z(Le).propertyForm.uploadName,"onUpdate:modelValue":b[8]||(b[8]=e=>z(Le).propertyForm.uploadName=e),autocomplete:"off",placeholder:"请输入上报属性名称"},null,8,["modelValue"])])),_:1}),T(aa,{label:"数据类型",prop:"type"},{default:N((()=>[T(ta,{modelValue:z(Le).propertyForm.type,"onUpdate:modelValue":b[9]||(b[9]=e=>z(Le).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"100%"},placeholder:"请选择数据类型"},{default:N((()=>[(M(!0),L(j,null,S(z(Le).typeOptions,(e=>(M(),H(la,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),3!==z(Le).propertyForm.type?(M(),H(aa,{key:0,label:"范围报警",prop:"minMaxAlarm"},{default:N((()=>[T(oa,{modelValue:z(Le).propertyForm.minMaxAlarm,"onUpdate:modelValue":b[10]||(b[10]=e=>z(Le).propertyForm.minMaxAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):I("",!0),3!==z(Le).propertyForm.type&&z(Le).propertyForm.minMaxAlarm?(M(),H(aa,{key:1,label:"最小值",prop:"min"},{default:N((()=>[T(k,{type:"text",modelValue:z(Le).propertyForm.min,"onUpdate:modelValue":b[11]||(b[11]=e=>z(Le).propertyForm.min=e),autocomplete:"off",placeholder:"请输入最小值"},null,8,["modelValue"])])),_:1})):I("",!0),3!==z(Le).propertyForm.type&&z(Le).propertyForm.minMaxAlarm?(M(),H(aa,{key:2,label:"最大值",prop:"max"},{default:N((()=>[T(k,{type:"text",modelValue:z(Le).propertyForm.max,"onUpdate:modelValue":b[12]||(b[12]=e=>z(Le).propertyForm.max=e),autocomplete:"off",placeholder:"请输入最大值"},null,8,["modelValue"])])),_:1})):I("",!0),3!==z(Le).propertyForm.type?(M(),H(aa,{key:3,label:"布长报警",prop:"stepAlarm"},{default:N((()=>[T(oa,{modelValue:z(Le).propertyForm.stepAlarm,"onUpdate:modelValue":b[13]||(b[13]=e=>z(Le).propertyForm.stepAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):I("",!0),3!==z(Le).propertyForm.type&&z(Le).propertyForm.stepAlarm?(M(),H(aa,{key:4,label:"布长",prop:"step"},{default:N((()=>[T(k,{type:"text",modelValue:z(Le).propertyForm.step,"onUpdate:modelValue":b[14]||(b[14]=e=>z(Le).propertyForm.step=e),autocomplete:"off",placeholder:"请输入布长"},null,8,["modelValue"])])),_:1})):I("",!0),2===z(Le).propertyForm.type?(M(),H(aa,{key:5,label:"小数位数",prop:"decimals"},{default:N((()=>[T(k,{type:"text",modelValue:z(Le).propertyForm.decimals,"onUpdate:modelValue":b[15]||(b[15]=e=>z(Le).propertyForm.decimals=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入小数位数"},null,8,["modelValue"])])),_:1})):I("",!0),3!==z(Le).propertyForm.type?(M(),H(aa,{key:6,label:"单位",prop:"unit"},{default:N((()=>[T(k,{type:"text",modelValue:z(Le).propertyForm.unit,"onUpdate:modelValue":b[16]||(b[16]=e=>z(Le).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1})):I("",!0),3===z(Le).propertyForm.type?(M(),H(aa,{key:7,label:"字符串长度报警",prop:"dataLengthAlarm"},{default:N((()=>[T(oa,{modelValue:z(Le).propertyForm.dataLengthAlarm,"onUpdate:modelValue":b[17]||(b[17]=e=>z(Le).propertyForm.dataLengthAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):I("",!0),3===z(Le).propertyForm.type&&z(Le).propertyForm.dataLengthAlarm?(M(),H(aa,{key:8,label:"字符串长度",prop:"dataLength"},{default:N((()=>[T(k,{type:"text",modelValue:z(Le).propertyForm.dataLength,"onUpdate:modelValue":b[18]||(b[18]=e=>z(Le).propertyForm.dataLength=e),autocomplete:"off",placeholder:"请输入字符串长度"},null,8,["modelValue"])])),_:1})):I("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),T(pa,{modelValue:z(Le).psFlag,"onUpdate:modelValue":b[22]||(b[22]=e=>z(Le).psFlag=e),title:"导入属性",width:"600px","before-close":h.beforeCloseUploadProperty,"close-on-click-modal":!1},{footer:N((()=>[A("span",Fe,[T(C,{onClick:h.cancelUploadProperty},{default:N((()=>[xe])),_:1},8,["onClick"]),T(C,{type:"primary",onClick:h.submitUploadProperty},{default:N((()=>[ve])),_:1},8,["onClick"])])])),default:N((()=>[T(na,{ref:"uploadPropertyRef",action:"","auto-upload":!1,"http-request":h.myRequestProperty,limit:1,"on-exceed":h.handleExceedProperty,"before-upload":h.beforeUploadProperty},{tip:N((()=>[be])),default:N((()=>[T(C,{type:"primary"},{default:N((()=>[he])),_:1})])),_:1},8,["http-request","on-exceed","before-upload"])])),_:1},8,["modelValue","before-close"]),T(pa,{title:"同步采集属性",modelValue:z(Le).plFlag,"onUpdate:modelValue":b[26]||(b[26]=e=>z(Le).plFlag=e),width:"1000px","before-close":Ee,"close-on-click-modal":!1},{footer:N((()=>[A("span",Ve,[T(C,{onClick:Oe},{default:N((()=>[Pe])),_:1}),T(C,{type:"primary",onClick:Be},{default:N((()=>[Me])),_:1})])])),default:N((()=>[A("div",_e,[A("div",we,[T(ta,{modelValue:z(Le).curCollName,"onUpdate:modelValue":b[23]||(b[23]=e=>z(Le).curCollName=e),placeholder:"请选择采集模型",onChange:b[24]||(b[24]=e=>{je()})},{default:N((()=>[(M(!0),L(j,null,S(z(Le).collDeviceModelList,(e=>(M(),H(la,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),T(k,{placeholder:"请输入属性名称或者标签",style:{width:"200px"},clearable:"",modelValue:z(Le).pName,"onUpdate:modelValue":b[25]||(b[25]=e=>z(Le).pName=e)},{prefix:N((()=>[T(v,{class:"el-input__icon"},{default:N((()=>[T(z(w))])),_:1})])),_:1},8,["modelValue"])]),A("div",Ce,[T($e,{data:z(Le).pTableData.filter((e=>!z(Le).pName||e.name.includes(z(Le).pName)||e.label.includes(z(Le).pName))).slice((z(Le).pCurrentPage-1)*z(Le).pPagesize,z(Le).pCurrentPage*z(Le).pPagesize),"header-cell-style":z(Le).pHeadStyle,"cell-style":z(Le).pCellStyle,style:{border:"1px solid #c0c4cc"},"max-height":"290",onSelectionChange:Se,stripe:""},{default:N((()=>[T(O,{type:"selection",width:"60",selectable:qe}),T(O,{prop:"name",label:"属性名称","min-width":"200",width:"auto",align:"center"}),T(O,{prop:"label",label:"属性标签","min-width":"200",width:"auto",align:"center"}),T(O,{label:"状态","min-width":"120",width:"auto",align:"center"},{default:N((e=>[A("span",{style:R({color:z(Le).AllPropertyNameList.includes(e.row.name)?z(F).successColor:z(F).dangerColor})},U(z(Le).AllPropertyNameList.includes(e.row.name)?"已选择":"未选择"),5)])),_:1})])),_:1},8,["data","header-cell-style","cell-style"]),A("div",ke,[T(ea,{"current-page":z(Le).pCurrentPage,"page-size":z(Le).pPagesize,"page-sizes":[5,20,50,200],total:z(Le).pTableData.length,onCurrentChange:Ie,onSizeChange:Re,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"22px"}},null,8,["current-page","page-size","total"])])])])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-88056280"]]);const Ae=e=>(q("data-v-7a5fd322"),e=e(),B(),e),Te={class:"main-container"},Ne={key:0,class:"main"},ze={class:"title",style:{"justify-content":"space-between"}},Ue=D(" 添加 "),De=D(" 刷新 "),je=D("变量详情"),Se=D("编辑"),He=D("删除"),Ie=Ae((()=>A("div",null,"无数据",-1))),Re={class:"pagination"},qe={class:"dialog-content"},Be={class:"dialog-footer"},Oe=D("取消"),Ee=D("保存");var We=h({setup(p){const n=b(),u=k(null),g=C({headerCellStyle:{background:F.primaryColor,color:F.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:10,transferName:"",transferTableData:[{name:"测试01",label:"测试01"}],isModel:!0,curTransferModel:null,tFlag:!1,tTitle:"添加上报模型",transferForm:{name:"",label:"",code:""},transferRules:{name:[{required:!0,message:"上报模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"上报模型标签不能为空",trigger:"blur"}],code:[{required:!0,message:"上报模型编号不能为空",trigger:"blur"}]},collectOptions:[]}),h=a=>{const l={token:n.token,data:{}};x.getModelList(l).then((async l=>{console.log("getModelList -> res",l),l&&("0"===l.code?(g.transferTableData=l.data,1===a&&e({type:"success",message:"刷新成功！"})):G(l),await O((()=>{g.tableMaxHeight=u.value.clientHeight-34-36-22})))}))};h();(()=>{const e={token:n.token,data:{}};v.getDeviceModelList(e).then((e=>{e&&("0"===e.code?g.collectOptions=e.data:G(e))}))})();const _=e=>{g.currentPage=e},U=e=>{g.pagesize=e},D=V((()=>g.transferTableData.filter((e=>!g.transferModelName||e.name.toLowerCase().includes(g.transferModelName.toLowerCase()))).slice((g.currentPage-1)*g.pagesize,g.currentPage*g.pagesize))),I=V((()=>g.transferTableData.filter((e=>!g.transferModelName||e.name.toLowerCase().includes(g.transferModelName.toLowerCase()))))),R=()=>{g.transferForm={name:"",label:"",code:""},g.tTitle="添加上报模型",g.tFlag=!0},q=e=>{g.tTitle="编辑上报模型",g.tFlag=!0,g.transferForm.name=e.name,g.transferForm.label=e.label,g.transferForm.code=e.code},B=k(null),E=()=>{g.tFlag=!1},W=()=>{E()},G=a=>{e({type:"error",message:a.message})},J=(a,l)=>{e({type:"0"===a.code?"success":"error",message:a.message}),"0"===a.code&&l&&l()};return(p,b)=>{const F=l,v=o,C=P("Icon"),k=t,V=r,O=s,G=i,Q=m,X=c,Y=d,K=y,Z=f;return M(),L("div",Te,[z(g).isModel?(M(),L("div",Ne,[A("div",ze,[T(v,{style:{width:"200px"},placeholder:"请输入上报模型名称",clearable:"",modelValue:z(g).transferModelName,"onUpdate:modelValue":b[0]||(b[0]=e=>z(g).transferModelName=e)},{prefix:N((()=>[T(F,{class:"el-input__icon"},{default:N((()=>[T(z(w))])),_:1})])),_:1},8,["modelValue"]),A("div",null,[T(k,{type:"primary",bg:"",class:"right-btn",onClick:b[1]||(b[1]=e=>R())},{default:N((()=>[T(F,{class:"btn-icon"},{default:N((()=>[T(C,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),Ue])),_:1}),T(k,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:b[2]||(b[2]=e=>{h(1)})},{default:N((()=>[T(F,{class:"btn-icon"},{default:N((()=>[T(C,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),De])),_:1})])]),A("div",{class:"content",ref_key:"contentRef",ref:u},[T(O,{data:z(D),"cell-style":z(g).cellStyle,"header-cell-style":z(g).headerCellStyle,"max-height":z(g).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:q},{empty:N((()=>[Ie])),default:N((()=>[T(V,{prop:"name",label:"上报模型名称",width:"auto","min-width":"200",align:"center"}),T(V,{prop:"label",label:"上报模型标签",width:"auto","min-width":"200",align:"center"}),T(V,{prop:"code",label:"上报模型编号",width:"auto","min-width":"200",align:"center"}),T(V,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:N((l=>[T(k,{onClick:e=>{return a=l.row,g.curTransferModel=a,void(g.isModel=!1);var a},text:"",type:"success"},{default:N((()=>[je])),_:2},1032,["onClick"]),T(k,{onClick:e=>q(l.row),text:"",type:"primary"},{default:N((()=>[Se])),_:2},1032,["onClick"]),T(k,{onClick:t=>{return o=l.row,void a.confirm("确定要删除这个上报模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:n.token,data:{name:o.name}};x.deleteModel(e).then((e=>{J(e,h)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var o},text:"",type:"danger"},{default:N((()=>[He])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),A("div",Re,[T(G,{"current-page":z(g).currentPage,"page-size":z(g).pagesize,"page-sizes":[5,10,20,50],total:z(I).length,onCurrentChange:_,onSizeChange:U,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):(M(),H(Le,{key:1,curTransferModel:z(g).curTransferModel,onChangeTmFlag:b[3]||(b[3]=e=>{g.isModel=!0})},null,8,["curTransferModel"])),T(Z,{modelValue:z(g).tFlag,"onUpdate:modelValue":b[9]||(b[9]=e=>z(g).tFlag=e),title:z(g).tTitle,width:"600px","before-close":W,"close-on-click-modal":!1},{footer:N((()=>[A("span",Be,[T(k,{onClick:b[7]||(b[7]=e=>E())},{default:N((()=>[Oe])),_:1}),T(k,{type:"primary",onClick:b[8]||(b[8]=e=>{B.value.validate((e=>{if(!e)return!1;{const e={token:n.token,data:g.transferForm};g.tTitle.includes("添加")?x.addModel(e).then((e=>{J(e,h),E()})):x.editModel(e).then((e=>{J(e,h),E()}))}}))})},{default:N((()=>[Ee])),_:1})])])),default:N((()=>[A("div",qe,[T(K,{model:z(g).transferForm,rules:z(g).transferRules,ref_key:"transferFormRef",ref:B,"status-icon":"","label-position":"right","label-width":"120px"},{default:N((()=>[T(Y,{label:"上报模型名称",prop:"name"},{default:N((()=>[T(X,{modelValue:z(g).transferForm.name,"onUpdate:modelValue":b[4]||(b[4]=e=>z(g).transferForm.name=e),filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或者输入上报模型名称",style:{width:"100%"}},{default:N((()=>[(M(!0),L(j,null,S(z(g).collectOptions,(e=>(M(),H(Q,{key:e.name,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(Y,{label:"上报模型标签",prop:"label"},{default:N((()=>[T(X,{modelValue:z(g).transferForm.label,"onUpdate:modelValue":b[5]||(b[5]=e=>z(g).transferForm.label=e),filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或者输入上报模型标签",style:{width:"100%"}},{default:N((()=>[(M(!0),L(j,null,S(z(g).collectOptions,(e=>(M(),H(Q,{key:e.label,label:e.label,value:e.label},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(Y,{label:"上报模型编号",prop:"code"},{default:N((()=>[T(v,{type:"text",modelValue:z(g).transferForm.code,"onUpdate:modelValue":b[6]||(b[6]=e=>z(g).transferForm.code=e),autocomplete:"off",placeholder:"请输入上报模型编号"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-7a5fd322"]]);export{We as default};
