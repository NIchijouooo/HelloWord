import{U as e,v as a,w as t,e as l,p as o,A as s,B as c,C as r,D as n,g as i}from"./element-plus.2c9426ce.js";import{_ as p,u as d,v as g}from"./index.9c81e799.js";import{I as m}from"./interface.75dfa0d7.js";import{S as u}from"./service.27dd2a72.js";import{P as h}from"./papaparse.0ea4a40d.js";import{d as b}from"./dayjs.2790329b.js";import{j as y,k as f,_ as w,h as k}from"./@element-plus.e895b9e1.js";import{r as v,J as j,n as _,j as S,w as N,I as T,o as C,c as z,a as L,O as x,R as F,u as I,W as P,S as U,X as V,V as H,P as R,aj as D,av as M,aw as O}from"./@vue.2c474d7f.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.d618444d.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./axios.765908e4.js";import"./vue-router.3b7aa6c5.js";import"./pinia.39330980.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.ebbe6a42.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const W={class:"SysLog"},Y={class:"title"},E={class:"content"},B={class:"cTitle"},J={class:"tName"},A={class:"option"},G=(e=>(M("data-v-b9057fa2"),e=e(),O(),e))((()=>L("div",null,"无数据",-1))),X={class:"pagination"};var q=p({__name:"SysLog",setup(p){const M=d();console.log("location -> ",location);const O=v(null),q=j({websocket:null,headerCellStyle:{background:g.primaryColor,color:g.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,logType:0,logName:["采集日志","上报日志","系统日志"],collectName:"",collectList:[],uploadName:"",uploadList:[],startStopFlag:!0,dataTable:[],dataType:["接收方","发送方"]}),K=e=>{console.log("onChange -> val",e),q.logType=e,console.log("ctxData.startStopFlag = ",q.startStopFlag),q.startStopFlag||(q.startStopFlag=!0,ee())},Q=e=>{q.startStopFlag=e,!1===e?Z():ee()},Z=()=>{let e="";e=location.origin.replace("https://","").replace("http://","");let a="ws://"+e+"/api/ws"+("?type="+q.logType+"&name="+(0===q.logType?q.collectName:1===q.logType?q.uploadName:"systemLog"));console.log("url = "+a),q.websocket=new WebSocket(a),$(),ae(),te()},$=()=>{q.websocket.onmessage=function(e){console.log("event.data",e.data),e.data&&""!=e.data&&q.dataTable.push(JSON.parse(e.data))}},ee=()=>{q.websocket&&(console.log("关闭ws命令"),q.websocket.close(),console.log("closeWs",q.websocket))},ae=()=>{q.websocket.onclose=e=>{console.log("onClose - > e",e),q.startStopFlag=!0,q.websocket=null}},te=()=>{q.websocket.onerror=e=>{console.log("onError - > e",e),q.startStopFlag=!0,q.websocket=null}};(()=>{const e={token:M.token,data:{}};m.getInterfaceList(e).then((e=>{e&&("0"===e.code?(q.collectList=e.data,e.data.length>0&&(q.collectName=e.data[0].collInterfaceName)):ce(e))}))})();(()=>{const e={token:M.token,data:{}};u.getGatewayList(e).then((e=>{e&&("0"===e.code?(q.uploadList=e.data,e.data.length>0&&(q.uploadName=e.data[0].serviceName)):ce(e))}))})(),_((()=>{q.tableMaxHeight=O.value.clientHeight-34-36-22}));const le=e=>{q.currentPage=e},oe=e=>{q.pagesize=e},se=S((()=>q.dataTable.slice((q.currentPage-1)*q.pagesize,q.currentPage*q.pagesize)));N((()=>q.collectName),((e,a)=>{q.startStopFlag=!0,ee()})),N((()=>q.uploadName),((e,a)=>{q.startStopFlag=!0,ee()}));const ce=e=>{i({type:"error",message:e.message})};return T((()=>{console.log("页面关闭了"),ee()})),(i,p)=>{const d=e,g=a,m=t,u=l,v=o,j=s,_=c,S=r,N=n;return C(),z("div",W,[L("div",Y,[x(d,{size:"large",checked:0===I(q).logType,onChange:p[0]||(p[0]=e=>K(0))},{default:F((()=>[H("采集日志")])),_:1},8,["checked"]),x(d,{size:"large",checked:1===I(q).logType,onChange:p[1]||(p[1]=e=>K(1))},{default:F((()=>[H("上报日志")])),_:1},8,["checked"]),x(d,{size:"large",checked:2===I(q).logType,onChange:p[2]||(p[2]=e=>K(2))},{default:F((()=>[H("系统日志")])),_:1},8,["checked"])]),L("div",E,[L("div",B,[L("div",J,P(I(q).logName[I(q).logType]),1),L("div",A,[0===I(q).logType?(C(),U(m,{key:0,modelValue:I(q).collectName,"onUpdate:modelValue":p[3]||(p[3]=e=>I(q).collectName=e),style:{width:"100%"},placeholder:"请选择采集接口"},{default:F((()=>[(C(!0),z(R,null,D(I(q).collectList,(e=>(C(),U(g,{key:"collect_"+e.collInterfaceName,label:e.collInterfaceName,value:e.collInterfaceName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):V("",!0),1===I(q).logType?(C(),U(m,{key:1,modelValue:I(q).uploadName,"onUpdate:modelValue":p[4]||(p[4]=e=>I(q).uploadName=e),style:{width:"100%"},placeholder:"请选择上报接口"},{default:F((()=>[(C(!0),z(R,null,D(I(q).uploadList,(e=>(C(),U(g,{key:"upload_"+e.serviceName,label:e.serviceName,value:e.serviceName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):V("",!0),I(q).startStopFlag?(C(),U(v,{key:2,onClick:p[5]||(p[5]=e=>Q(!1)),class:"right-btn",type:"success",plain:""},{default:F((()=>[x(u,{class:"el-input__icon"},{default:F((()=>[x(I(y))])),_:1}),H(" 开始 ")])),_:1})):(C(),U(v,{key:3,class:"right-btn",onClick:p[6]||(p[6]=e=>Q(!0)),type:"danger",plain:""},{default:F((()=>[x(u,{class:"el-input__icon"},{default:F((()=>[x(I(f))])),_:1}),H(" 停止 ")])),_:1})),x(v,{class:"right-btn",onClick:p[7]||(p[7]=e=>{q.dataTable=[]}),type:"warning",plain:""},{default:F((()=>[x(u,{class:"el-input__icon"},{default:F((()=>[x(I(w))])),_:1}),H(" 清空 ")])),_:1}),x(v,{class:"right-btn",onClick:p[8]||(p[8]=e=>(()=>{let e=[];q.dataTable.forEach((a=>{e.push({timeStamp:a.timeStamp+"\t",direction:q.dataType[a.direction],label:a.label,content:a.content})}));var a=h.unparse(e);let t=new Blob([a]),l=window.URL||window.webkitURL||window,o=l.createObjectURL(t),s=document.createElement("a");s.href=o;let c="";c=0===q.logType?"采集日志":1===q.logType?"上报日志":"系统日志",c+=b(new Date).format("YYYY-MM-DD HH-mm-ss"),s.download=c+".csv",s.click(),l.revokeObjectURL(o)})()),type:"primary",plain:""},{default:F((()=>[x(u,{class:"el-input__icon"},{default:F((()=>[x(I(k))])),_:1}),H(" 导出 ")])),_:1})])]),L("div",{class:"cTable",ref_key:"contentRef",ref:O},[x(S,{data:I(se),"cell-style":I(q).cellStyle,"header-cell-style":I(q).headerCellStyle,"max-height":I(q).tableMaxHeight,style:{width:"100%"},stripe:""},{empty:F((()=>[G])),default:F((()=>[x(j,{prop:"timeStamp",label:"时间戳",width:"auto","min-width":"220",align:"center"}),x(j,{label:"数据方向",width:"auto","min-width":"150",align:"center"},{default:F((e=>[x(_,{type:0===e.row.direction?"success":"warning"},{default:F((()=>[H(P(I(q).dataType[e.row.direction]),1)])),_:2},1032,["type"])])),_:1}),x(j,{prop:"label",label:"数据标识",width:"auto","min-width":"150",align:"center"}),x(j,{prop:"content",label:"数据内容",width:"auto","min-width":"1000",align:"left"})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",X,[x(N,{"current-page":I(q).currentPage,"page-size":I(q).pagesize,"page-sizes":[20,50,200,500],total:I(q).dataTable.length,onCurrentChange:le,onSizeChange:oe,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])])}}},[["__scopeId","data-v-b9057fa2"]]);export{q as default};
