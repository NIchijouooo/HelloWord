import{R as e,g as a,L as l,e as t,p as r,m as o,A as p,B as n,C as i,D as s,n as m,w as d,N as c,K as u,o as y,q as f,y as g,u as h,v as b,x as v}from"./element-plus.3300f756.js";import{s as F,_ as x,u as _,v as w}from"./index.bef3255d.js";import{I as V}from"./interface.6c1d0ded.js";import{D as k}from"./deviceModel.302b0c9b.js";import{b as C,d as N}from"./@element-plus.0bef5fa5.js";import{f as P,K as L,k as D,af as A,o as j,c as M,a as z,P as I,S,u as U,W as T,X as E,Q as q,ak as O,T as R,Y as B,n as H,M as W,aw as K,ax as Q}from"./@vue.73d14ebc.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.3d90a471.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./vue-router.43b9a342.js";import"./pinia.3f4aff4f.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.7828944a.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";var X=e=>F.request({url:"/virtual/devices",method:"get",data:e}),Y=e=>F.request({url:"/virtual/device",method:"post",data:e}),G=e=>F.request({url:"/virtual/device",method:"put",data:e}),J=e=>F.request({url:"/virtual/devices",method:"delete",data:e}),Z=e=>F.request({url:"/virtual/properties",method:"get",data:e}),$=e=>F.request({url:"/virtual/property",method:"post",data:e}),ee=e=>F.request({url:"/virtual/property",method:"put",data:e}),ae=e=>F.request({url:"/virtual/properties",method:"delete",data:e});const le=e=>(K("data-v-641ea1e7"),e=e(),Q(),e),te={class:"main"},re={class:"title",style:{"justify-content":"space-between"}},oe={class:"title-left"},pe={class:"title",style:{top:"60px",height:"76px",padding:"20px 0","justify-content":"space-between"}},ne={class:"tName"},ie={style:{display:"flex","align-items":"center"}},se={class:"param-content"},me={class:"pc-title"},de={class:"pct-info"},ce={class:"pc-content"},ue={class:"param-value"},ye={class:"param-name"},fe={class:"param-content"},ge={class:"pc-title"},he={class:"pct-info"},be={class:"pc-content"},ve={class:"param-value"},Fe={class:"param-name"},xe=le((()=>z("div",null,"无数据",-1))),_e={class:"pagination"},we={class:"dialog-content"},Ve={class:"dialog-footer"},ke={class:"dialog-content"},Ce={style:{width:"100%"}},Ne={style:{"padding-right":"10px"}},Pe={class:"dialog-footer"},Le={class:"dialog-content"},De={class:"dialog-cLeft"},Ae=le((()=>z("div",{class:"card-header"},[z("span",null,"请选择采集模型")],-1))),je={class:"card-main"},Me=["onClick"],ze={class:"dialog-cRight"},Ie=le((()=>z("div",{class:"card-header"},[z("span",null,"请选择模型属性")],-1))),Se={class:"card-main"},Ue=["onClick"],Te={class:"dialog-footer"};var Ee=x({__name:"DeviceProperty",props:{curVirtualDevice:{type:Object,default:{}}},emits:["changeDpFlag"],setup(F,{emit:x}){const K=F,Q=_();console.log(K);const X=P(null),Y=L({formulaForm:{},headerCellStyle:{background:w.primaryColor,color:w.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,PropertyTableData:[],pFlag:!1,pTitle:"添加属性",PropertyInfo:"",propertyForm:{name:"",label:"",type:0,unit:"",decimals:0,collName:"",deviceName:"",propertyName:"",saveEnable:!1,formula:"",min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,dataLength:"",dataLengthAlarm:!1},typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},paramName:{name:"属性名称",label:"属性标签",type:"数据类型",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"步长",stepAlarm:"步长报警",unit:"单位",decimals:"小数位数",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警",collName:"采集接口名称",deviceName:"设备名称",propertyName:"属性名称",saveEnable:"掉电保存",formula:"计算公式"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],label:[{required:!0,message:"属性标签不能为空",trigger:"blur"}],type:[{required:!0,message:"数据类型不能为空",trigger:"blur"}],decimals:[{type:"number",message:"小数位数只能输入数字"}],collName:[{required:!0,message:"采集接口名称不能为空",trigger:"blur"}],deviceName:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],propertyName:[{required:!0,message:"设备属性名称不能为空",trigger:"blur"}]},collOptions:[],nodeOptions:[],propertyOptions:[],nameTotsl:{},propertyInfo:[],operationList:[{name:"+",label:"+",describe:"加"},{name:"-",label:"-",describe:"减"},{name:"*",label:"*",describe:"乘"},{name:"/",label:"/",describe:"除"},{name:"%",label:"%",describe:"模"},{name:"^",label:"^",describe:"次幂"},{name:"(",label:"(",describe:"左括号"},{name:")",label:")",describe:"右括号"}],curFormula:"",selectionStart:0,pItem:"",fFlag:!1,selectedProperties:[],modelList:[],curModelName:"",curPropertyName:"",propertyList:[],mpFlag:!1,curProperty:{}}),G=e=>{const l={token:Q.token,data:{deviceName:K.curVirtualDevice.name}};Z(l).then((async l=>{l&&("0"===l.code?(Y.PropertyTableData=l.data,1===e&&a({type:"success",message:"刷新成功！"})):ta(l),await H((()=>{Y.tableMaxHeight=X.value.clientHeight-34-36-22})))}))};G();const J=D((()=>{let e=Y.PropertyInfo;return Y.PropertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase()))).slice((Y.currentPage-1)*Y.pagesize,Y.currentPage*Y.pagesize)})),le=D((()=>{let e=Y.PropertyInfo;return Y.PropertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase())))})),Ee=e=>{Y.currentPage=e},qe=e=>{Y.pagesize=e},Oe=()=>{Y.mpFlag=!1},Re=()=>{const e={token:Q.token,data:{name:Y.curModelName}};k.getDeviceModelProperty(e).then((e=>{console.log("getDeviceModelProperty -> res",e),e&&("0"===e.code?Y.propertyList=e.data:ta(e))}))},Be=()=>{Y.mpFlag=!0,(()=>{const e={token:Q.token,data:{}};k.getDeviceModelList(e).then((e=>{console.log("getDeviceModelList -> res = ",e),e&&("0"===e.code?Y.modelList=e.data:ta(e))}))})()},He=e=>{console.log("editProperty -> row ",e),Y.pFlag=!0,Y.pTitle="编辑属性",Y.propertyForm.name=e.name,Y.propertyForm.label=e.label,Y.propertyForm.type=e.type,Y.propertyForm.decimals=e.decimals,Y.propertyForm.unit=e.unit,Y.propertyForm.collName=e.params.collName,Y.propertyForm.deviceName=e.params.deviceName,Y.propertyForm.propertyName=e.params.propertyName,Y.propertyForm.formula=e.params.formula,Y.propertyForm.saveEnable=e.params.saveEnable,3!==e.type?(Y.propertyForm.min=e.alarmParams.min,Y.propertyForm.max=e.alarmParams.max,Y.propertyForm.minMaxAlarm=e.alarmParams.minMaxAlarm,Y.propertyForm.step=e.alarmParams.step,Y.propertyForm.stepAlarm=e.alarmParams.stepAlarm):(Y.propertyForm.dataLength=e.alarmParams.dataLength,Y.propertyForm.dataLengthAlarm=e.alarmParams.dataLengthAlarm),console.log("ctxData.propertyForm",Y.propertyForm),Ze(Y.propertyForm.collName).then((e=>{Je(e),ea(Y.propertyForm.deviceName)}))},We=P(null),Ke=()=>{Y.pFlag=!1,We.value.resetFields(),Qe()},Qe=()=>{Y.propertyForm={name:"",label:"",type:0,unit:"",decimals:0,collName:"",deviceName:"",propertyName:"",saveEnable:!1,formula:"",min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,dataLength:"",dataLengthAlarm:!1}},Xe=e=>{Ke()},Ye=e=>{Y.selectedProperties=e};(()=>{const e={token:Q.token,data:{}};V.getInterfaceList(e).then((e=>{console.log("getInterfaceList -> res",e),"0"===e.code?(Y.collOptions=[],e.data.forEach((e=>{const a={label:e.collInterfaceName,name:e.collInterfaceName};Y.collOptions.push(a)}))):ta(e)}))})();const Ge=e=>{Ze(e).then((e=>{Je(e)})),Y.propertyOptions=[]},Je=e=>{"0"===e.code?(Y.nodeOptions=[],Y.nameTotsl={},e.data.deviceNodeMap.forEach((e=>{const a={label:e.label,name:e.name,tsl:e.tsl};Y.nameTotsl[""+e.name]=e.tsl,Y.nodeOptions.push(a)}))):ta(e)},Ze=e=>{const a={token:Q.token,data:{name:e}};return V.getCollDevices(a)},$e=e=>{ea(e)},ea=e=>{const a={token:Q.token,data:{name:Y.nameTotsl[e]}};k.getDeviceModelProperty(a).then((e=>{"0"===e.code?(Y.propertyOptions=[],e.data.forEach((e=>{const a={label:e.name+"("+e.label+")",name:e.name};Y.propertyOptions.push(a)}))):ta(e)}))},aa=()=>{Y.propertyInfo=[{name:"t",label:"当前属性"}],Y.PropertyTableData.forEach((e=>{Y.propertyInfo.push({name:e.name,label:e.label})}))},la=e=>{Y.selectionStart=e.srcElement.selectionStart},ta=e=>{a({type:"error",message:e.message})},ra=(e,l)=>{a({type:"0"===e.code?"success":"error",message:e.message}),"0"===e.code&&l&&l()};return(F,_)=>{const w=t,V=r,k=o,P=A("Icon"),L=p,D=n,H=e,Z=i,Qe=s,Je=m,Ze=b,ea=d,ta=c,oa=u,pa=y,na=f,ia=v,sa=g,ma=h;return j(),M("div",te,[z("div",re,[z("div",oe,[I(V,{type:"primary",plain:"",onClick:_[0]||(_[0]=e=>{x("changeDpFlag")}),style:{"margin-right":"20px"}},{default:S((()=>[I(w,{class:"el-input__icon"},{default:S((()=>[I(U(C))])),_:1}),T(" 返回上报模型 ")])),_:1})])]),z("div",pe,[z("div",ne,E(K.curVirtualDevice.label),1),z("div",ie,[I(k,{style:{width:"200px"},placeholder:"请输入属性名称或者标签",clearable:"",modelValue:U(Y).PropertyInfo,"onUpdate:modelValue":_[1]||(_[1]=e=>U(Y).PropertyInfo=e)},{prefix:S((()=>[I(w,{class:"el-input__icon"},{default:S((()=>[I(U(N))])),_:1})])),_:1},8,["modelValue"]),I(V,{type:"primary",bg:"",class:"right-btn",onClick:_[2]||(_[2]=e=>(Y.pFlag=!0,void(Y.pTitle="添加属性")))},{default:S((()=>[I(w,{class:"btn-icon"},{default:S((()=>[I(P,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),T(" 添加 ")])),_:1}),I(V,{type:"danger",bg:"",class:"right-btn",onClick:_[3]||(_[3]=e=>(()=>{let e=[];0!==Y.selectedProperties.length?(Y.selectedProperties.forEach((a=>{e.push(a.name)})),console.log("pList",e),l.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const a={token:Q.token,data:{deviceName:K.curVirtualDevice.name,PropertyNames:e}};ae(a).then((e=>{ra(e,G)}))})).catch((()=>{a({type:"info",message:"取消删除"})}))):a.info("请至少选择一个属性！")})())},{default:S((()=>[I(w,{class:"btn-icon"},{default:S((()=>[I(P,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),T(" 删除 ")])),_:1}),I(V,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:_[4]||(_[4]=e=>{G(1)})},{default:S((()=>[I(w,{class:"btn-icon"},{default:S((()=>[I(P,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),T(" 刷新 ")])),_:1})])]),z("div",{class:"content",ref_key:"contentRef",ref:X,style:{top:"136px"}},[I(Z,{data:U(J),"cell-style":U(Y).cellStyle,"header-cell-style":U(Y).headerCellStyle,"max-height":U(Y).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:Ye,onRowDblclick:He},{empty:S((()=>[xe])),default:S((()=>[I(L,{type:"selection",width:"55"}),I(L,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"180",align:"center"}),I(L,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"180",align:"center"}),I(L,{sortable:"",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:S((e=>[T(E(U(Y).typeNames["t"+e.row.type]),1)])),_:1}),I(L,{sortable:"",label:"小数位数",width:"auto","min-width":"80",align:"center"},{default:S((e=>[T(E(void 0===e.row.decimals||""===e.row.decimals?0:e.row.decimals),1)])),_:1}),I(L,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),I(L,{sortable:"",label:"映射参数详情",width:"auto","min-width":"300",align:"center"},{default:S((e=>[I(H,{trigger:"hover","show-after":500,"auto-close":500,effect:"light",width:"auto",placement:"left"},{default:S((()=>[z("div",se,[z("div",me,[z("div",de,[z("b",null,E(e.row.name),1),T(" "+E("参数详情"))])]),z("div",ce,[(j(!0),M(q,null,O(e.row.params,((e,a,l)=>(j(),M("div",{class:"param-item",key:l},[z("div",ue,E(U(Y).paramName[a])+"：",1),z("div",ye,E("boolean"==typeof e?e?"是":"否":e),1)])))),128))])])])),reference:S((()=>[I(D,{size:"large"},{default:S((()=>[T(E(e.row.params),1)])),_:2},1024)])),_:2},1024)])),_:1}),I(L,{label:"报警参数详情",width:"auto","min-width":"300",align:"center"},{default:S((e=>[I(H,{trigger:"hover","show-after":500,"auto-close":500,effect:"light",width:"auto",placement:"left"},{default:S((()=>[z("div",fe,[z("div",ge,[z("div",he,[z("b",null,E(e.row.name),1),T(" "+E("参数详情"))])]),z("div",be,[(j(!0),M(q,null,O(e.row.alarmParams,((e,a,l)=>(j(),M("div",{class:"param-item",key:l},[z("div",ve,E(U(Y).paramName[a])+"：",1),z("div",Fe,E("boolean"==typeof e?e?"是":"否":e),1)])))),128))])])])),reference:S((()=>[I(D,{size:"large"},{default:S((()=>[T(E(e.row.alarmParams),1)])),_:2},1024)])),_:2},1024)])),_:1}),I(L,{label:"操作",width:"auto","min-width":"150",align:"center",fixed:"right"},{default:S((e=>[I(V,{onClick:a=>He(e.row),text:"",type:"primary"},{default:S((()=>[T("编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),z("div",_e,[I(Qe,{"current-page":U(Y).currentPage,"page-size":U(Y).pagesize,"page-sizes":[20,50,200,500],total:U(le).length,onCurrentChange:Ee,onSizeChange:qe,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),I(na,{modelValue:U(Y).pFlag,"onUpdate:modelValue":_[26]||(_[26]=e=>U(Y).pFlag=e),title:U(Y).pTitle,width:"800px","before-close":Xe,"close-on-click-modal":!1},{footer:S((()=>[z("span",Ve,[I(V,{onClick:_[24]||(_[24]=e=>Ke())},{default:S((()=>[T("取消")])),_:1}),I(V,{type:"primary",onClick:_[25]||(_[25]=e=>{We.value.validate((e=>{if(console.log("valid",e),!e)return!1;{let e={};e.name=Y.propertyForm.name,e.label=Y.propertyForm.label,e.type=Y.propertyForm.type,e.decimals=Y.propertyForm.decimals,e.unit=Y.propertyForm.unit;let a={collName:Y.propertyForm.collName,deviceName:Y.propertyForm.deviceName,propertyName:Y.propertyForm.propertyName,formula:Y.propertyForm.formula,saveEnable:Y.propertyForm.saveEnable},l={};3!==Y.propertyForm.type?(l.min=Y.propertyForm.min,l.max=Y.propertyForm.max,l.minMaxAlarm=Y.propertyForm.minMaxAlarm,l.step=Y.propertyForm.step,l.stepAlarm=Y.propertyForm.stepAlarm):(l.dataLength=Y.propertyForm.dataLength,l.dataLengthAlarm=Y.propertyForm.dataLengthAlarm),e.alarmParams=l,e.params=a,console.log("submitPorpertyForm -> property",e);const t={token:Q.token,data:{deviceName:K.curVirtualDevice.name,property:e}};Y.pTitle.includes("添加")?(console.log("添加属性"),$(t).then((e=>{ra(e,G),Ke()}))):(console.log("编辑属性"),ee(t).then((e=>{ra(e,G),Ke()})))}}))})},{default:S((()=>[T("保存")])),_:1})])])),default:S((()=>[z("div",we,[I(pa,{model:U(Y).propertyForm,rules:U(Y).propertyRules,ref_key:"propertyFormRef",ref:We,"status-icon":"","label-position":"right","label-width":"120px",inline:!0},{default:S((()=>[I(Je,{label:"属性名称",prop:"name"},{default:S((()=>[I(k,{style:{width:"220px"},disabled:U(Y).pTitle.includes("编辑"),readonly:!0,type:"text",modelValue:U(Y).propertyForm.name,"onUpdate:modelValue":_[6]||(_[6]=e=>U(Y).propertyForm.name=e),autocomplete:"off",placeholder:"请选择属性名称"},{append:S((()=>[I(V,{onClick:_[5]||(_[5]=e=>Be())},{default:S((()=>[T("同步")])),_:1})])),_:1},8,["disabled","modelValue"])])),_:1}),I(Je,{label:"属性标签",prop:"label"},{default:S((()=>[I(k,{style:{width:"220px"},type:"text",readonly:!0,modelValue:U(Y).propertyForm.label,"onUpdate:modelValue":_[7]||(_[7]=e=>U(Y).propertyForm.label=e),autocomplete:"off",placeholder:"请选择属性名称同步属性标签"},null,8,["modelValue"])])),_:1}),I(Je,{label:"数据类型",prop:"type"},{default:S((()=>[I(ea,{modelValue:U(Y).propertyForm.type,"onUpdate:modelValue":_[8]||(_[8]=e=>U(Y).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择数据类型"},{default:S((()=>[(j(!0),M(q,null,O(U(Y).typeOptions,(e=>(j(),R(Ze,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),2===U(Y).propertyForm.type?(j(),R(Je,{key:0,label:"小数位数",prop:"decimals"},{default:S((()=>[I(k,{style:{width:"220px"},type:"text",modelValue:U(Y).propertyForm.decimals,"onUpdate:modelValue":_[9]||(_[9]=e=>U(Y).propertyForm.decimals=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入小数位数"},null,8,["modelValue"])])),_:1})):B("",!0),3!==U(Y).propertyForm.type?(j(),R(Je,{key:1,label:"单位",prop:"unit"},{default:S((()=>[I(k,{style:{width:"220px"},type:"text",modelValue:U(Y).propertyForm.unit,"onUpdate:modelValue":_[10]||(_[10]=e=>U(Y).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1})):B("",!0),I(ta,{"content-position":"center"},{default:S((()=>[T(" 映射参数 ")])),_:1}),I(Je,{label:"采集接口名称",prop:"collName"},{default:S((()=>[I(ea,{modelValue:U(Y).propertyForm.collName,"onUpdate:modelValue":_[11]||(_[11]=e=>U(Y).propertyForm.collName=e),style:{width:"220px"},placeholder:"请选择采集接口名称",onChange:Ge,clearable:"",filterable:""},{default:S((()=>[(j(!0),M(q,null,O(U(Y).collOptions,(e=>(j(),R(Ze,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),I(Je,{label:"设备名称",prop:"deviceName"},{default:S((()=>[I(ea,{modelValue:U(Y).propertyForm.deviceName,"onUpdate:modelValue":_[12]||(_[12]=e=>U(Y).propertyForm.deviceName=e),style:{width:"220px"},placeholder:"请选择设备名称",onChange:$e,clearable:"",filterable:""},{default:S((()=>[(j(!0),M(q,null,O(U(Y).nodeOptions,(e=>(j(),R(Ze,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),I(Je,{label:"设备属性名称",prop:"propertyName"},{default:S((()=>[I(ea,{modelValue:U(Y).propertyForm.propertyName,"onUpdate:modelValue":_[13]||(_[13]=e=>U(Y).propertyForm.propertyName=e),style:{width:"220px"},placeholder:"请选择设备属性名称",clearable:"",filterable:""},{default:S((()=>[(j(!0),M(q,null,O(U(Y).propertyOptions,(e=>(j(),R(Ze,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),I(Je,{label:"掉电保存"},{default:S((()=>[I(oa,{style:{width:"220px"},modelValue:U(Y).propertyForm.saveEnable,"onUpdate:modelValue":_[14]||(_[14]=e=>U(Y).propertyForm.saveEnable=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1}),I(Je,{label:"计算公式"},{default:S((()=>[I(k,{style:{width:"220px"},type:"text",readonly:"",modelValue:U(Y).propertyForm.formula,"onUpdate:modelValue":_[16]||(_[16]=e=>U(Y).propertyForm.formula=e),autocomplete:"off",placeholder:"请编辑计算公式"},{append:S((()=>[I(V,{onClick:_[15]||(_[15]=e=>(Y.fFlag=!0,Y.curFormula=Y.propertyForm.formula,void aa()))},{default:S((()=>[T("编辑")])),_:1})])),_:1},8,["modelValue"])])),_:1}),I(ta,{"content-position":"center"},{default:S((()=>[T(" 报警参数 ")])),_:1}),3!==U(Y).propertyForm.type?(j(),R(Je,{key:2,label:"范围报警",prop:"minMaxAlarm"},{default:S((()=>[I(oa,{style:{width:"220px"},modelValue:U(Y).propertyForm.minMaxAlarm,"onUpdate:modelValue":_[17]||(_[17]=e=>U(Y).propertyForm.minMaxAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):B("",!0),3!==U(Y).propertyForm.type?(j(),R(Je,{key:3,label:"步长报警",prop:"stepAlarm"},{default:S((()=>[I(oa,{style:{width:"220px"},modelValue:U(Y).propertyForm.stepAlarm,"onUpdate:modelValue":_[18]||(_[18]=e=>U(Y).propertyForm.stepAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):B("",!0),3!==U(Y).propertyForm.type&&U(Y).propertyForm.minMaxAlarm?(j(),R(Je,{key:4,label:"最小值",prop:"min"},{default:S((()=>[I(k,{style:{width:"220px"},type:"text",modelValue:U(Y).propertyForm.min,"onUpdate:modelValue":_[19]||(_[19]=e=>U(Y).propertyForm.min=e),autocomplete:"off",placeholder:"请输入最小值"},null,8,["modelValue"])])),_:1})):B("",!0),3!==U(Y).propertyForm.type&&U(Y).propertyForm.minMaxAlarm?(j(),R(Je,{key:5,label:"最大值",prop:"max"},{default:S((()=>[I(k,{style:{width:"220px"},type:"text",modelValue:U(Y).propertyForm.max,"onUpdate:modelValue":_[20]||(_[20]=e=>U(Y).propertyForm.max=e),autocomplete:"off",placeholder:"请输入最大值"},null,8,["modelValue"])])),_:1})):B("",!0),3!==U(Y).propertyForm.type&&U(Y).propertyForm.stepAlarm?(j(),R(Je,{key:6,label:"步长",prop:"step"},{default:S((()=>[I(k,{style:{width:"220px"},type:"text",modelValue:U(Y).propertyForm.step,"onUpdate:modelValue":_[21]||(_[21]=e=>U(Y).propertyForm.step=e),autocomplete:"off",placeholder:"请输入步长"},null,8,["modelValue"])])),_:1})):B("",!0),3===U(Y).propertyForm.type?(j(),R(Je,{key:7,label:"字符串长度报警",prop:"dataLengthAlarm"},{default:S((()=>[I(oa,{style:{width:"220px"},modelValue:U(Y).propertyForm.dataLengthAlarm,"onUpdate:modelValue":_[22]||(_[22]=e=>U(Y).propertyForm.dataLengthAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):B("",!0),3===U(Y).propertyForm.type&&U(Y).propertyForm.dataLengthAlarm?(j(),R(Je,{key:8,label:"字符串长度",prop:"dataLength"},{default:S((()=>[I(k,{style:{width:"220px"},type:"text",modelValue:U(Y).propertyForm.dataLength,"onUpdate:modelValue":_[23]||(_[23]=e=>U(Y).propertyForm.dataLength=e),autocomplete:"off",placeholder:"请输入字符串长度"},null,8,["modelValue"])])),_:1})):B("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),I(na,{modelValue:U(Y).fFlag,"onUpdate:modelValue":_[32]||(_[32]=e=>U(Y).fFlag=e),title:"编辑计算公式",width:"600px"},{footer:S((()=>[z("span",Pe,[I(V,{onClick:_[30]||(_[30]=e=>(Y.fFlag=!1,void(Y.curFormula="")))},{default:S((()=>[T("取消")])),_:1}),I(V,{type:"primary",onClick:_[31]||(_[31]=e=>(Y.fFlag=!1,void(Y.propertyForm.formula=Y.curFormula)))},{default:S((()=>[T("保存")])),_:1})])])),default:S((()=>[z("div",ke,[I(pa,{model:U(Y).formulaForm,"label-position":"right","label-width":"120px"},{default:S((()=>[I(Je,{label:"运算符号"},{default:S((()=>[z("div",Ce,[(j(!0),M(q,null,O(U(Y).operationList,(e=>(j(),M("div",{class:"operation",key:e.name},[z("div",Ne,[I(V,{style:{width:"100%"},onClick:a=>(e=>{let a=Y.curFormula.length;if(a!==Y.selectionStart){let l=Y.curFormula.substr(0,Y.selectionStart),t=Y.curFormula.substr(Y.selectionStart,a-Y.selectionStart);Y.curFormula=l+e.name+t,Y.selectionStart+=e.name.length}else Y.curFormula+=e.name,Y.selectionStart+=e.name.length})(e)},{default:S((()=>[T(E(e.label),1)])),_:2},1032,["onClick"])])])))),128))])])),_:1}),I(Je,{label:"设备属性"},{default:S((()=>[I(ea,{modelValue:U(Y).pItem,"onUpdate:modelValue":_[27]||(_[27]=e=>U(Y).pItem=e),filterable:"",placeholder:"请选择设备属性",onChange:_[28]||(_[28]=e=>(e=>{let a=Y.curFormula.length;if(a!==Y.selectionStart){let l=Y.curFormula.substr(0,Y.selectionStart),t=Y.curFormula.substr(Y.selectionStart,a-Y.selectionStart);Y.curFormula=l+"("+e+")"+t,Y.selectionStart+=e.length+2}else Y.curFormula+="("+e+")",Y.selectionStart+=e.length+2})(U(Y).pItem)),style:{width:"100%"}},{default:S((()=>[(j(!0),M(q,null,O(U(Y).propertyInfo,(e=>(j(),R(Ze,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),I(Je,{label:"当前公式"},{default:S((()=>[I(k,{type:"text",clearable:"",modelValue:U(Y).curFormula,"onUpdate:modelValue":_[29]||(_[29]=e=>U(Y).curFormula=e),autocomplete:"off",placeholder:"请编辑计算公式",onBlur:la},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),I(na,{modelValue:U(Y).mpFlag,"onUpdate:modelValue":_[37]||(_[37]=e=>U(Y).mpFlag=e),title:"模型属性选择",width:"1000px"},{footer:S((()=>[z("span",Te,[I(V,{onClick:_[35]||(_[35]=e=>Oe())},{default:S((()=>[T("取消")])),_:1}),I(V,{type:"primary",onClick:_[36]||(_[36]=e=>(Y.propertyForm.name=Y.curProperty.name,Y.propertyForm.label=Y.curProperty.label,void Oe()))},{default:S((()=>[T("保存")])),_:1})])])),default:S((()=>[z("div",Le,[z("div",De,[I(ma,{class:"card-box",shadow:"hover"},{header:S((()=>[Ae])),default:S((()=>[z("div",je,[I(sa,{modelValue:U(Y).curModelName,"onUpdate:modelValue":_[33]||(_[33]=e=>U(Y).curModelName=e),style:{width:"100%"}},{default:S((()=>[(j(!0),M(q,null,O(U(Y).modelList,(e=>(j(),M("div",{class:W(["upload-item",{isClicked:e.isClicked}]),key:"tml"+e.name},[z("div",{class:"upload-item-text",onClick:a=>(e=>{Y.curModelName=e.name,Re()})(e)},[I(ia,{label:e.name},{default:S((()=>[T(E(e.label+" ("+e.name+")"),1)])),_:2},1032,["label"])],8,Me)],2)))),128))])),_:1},8,["modelValue"])])])),_:1})]),z("div",ze,[I(ma,{class:"card-box",shadow:"hover"},{header:S((()=>[Ie])),default:S((()=>[z("div",Se,[I(sa,{modelValue:U(Y).curPropertyName,"onUpdate:modelValue":_[34]||(_[34]=e=>U(Y).curPropertyName=e),style:{width:"100%"}},{default:S((()=>[(j(!0),M(q,null,O(U(Y).propertyList,(e=>(j(),M("div",{class:W(["upload-item",{isClicked:e.isClicked}]),key:"tml"+e.name},[z("div",{class:"upload-item-text",onClick:a=>(e=>{Y.curProperty=e})(e)},[I(ia,{label:e.name},{default:S((()=>[T(E(e.label+" ("+e.name+")"),1)])),_:2},1032,["label"])],8,Ue)],2)))),128))])),_:1},8,["modelValue"])])])),_:1})])])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-641ea1e7"]]);const qe={class:"main-container"},Oe={key:0,class:"main"},Re={class:"title",style:{"justify-content":"space-between"}},Be=(e=>(K("data-v-13a21f49"),e=e(),Q(),e))((()=>z("div",null,"无数据",-1))),He={class:"pagination"},We={class:"dialog-content"},Ke={class:"dialog-footer"};var Qe=x({__name:"VirtualDevice",setup(e){const n=_(),d=P(null),c=L({virtualDeviceInfo:"",headerCellStyle:{background:w.primaryColor,color:w.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,tableData:[],dpFlag:!0,vdFlag:!1,vdTitle:"添加虚拟设备",curVirtualDevice:{},virtualForm:{name:"",label:""},virtualRules:{name:[{required:!0,message:"虚拟设备名称不能为空",trigger:"blur"}],label:[{required:!0,message:"虚拟设备标识不能为空",trigger:"blur"}]},selectedDevice:[]}),u=e=>{const l={token:n.token,data:{}};X(l).then((async l=>{l&&("0"===l.code?(c.tableData=l.data,1===e&&a({type:"success",message:"刷新成功！"})):E(l),await H((()=>{c.tableMaxHeight=d.value.clientHeight-34-36-22})))}))};u();const g=D((()=>c.tableData.filter((e=>{var a=!c.virtualDeviceInfo,l=e.name.toLowerCase().includes(c.virtualDeviceInfo.toLowerCase());return a||l})).slice((c.currentPage-1)*c.pagesize,c.currentPage*c.pagesize))),h=D((()=>c.tableData.filter((e=>{var a=!c.virtualDeviceInfo,l=e.name.toLowerCase().includes(c.virtualDeviceInfo.toLowerCase());return a||l})))),b=e=>{c.currentPage=e},v=e=>{c.pagesize=e},F=P(null),x=()=>{c.vdFlag=!1,F.value.resetFields(),C()},V=()=>{x()},k=e=>{c.selectedDevice=e,console.log("handleSelectionChange -> val =",e)},C=()=>{c.virtualForm={name:"",label:""}},E=e=>{a({type:"error",message:e.message})},q=(e,l)=>{a({type:"0"===e.code?"success":"error",message:e.message}),"0"===e.code&&l&&l()};return(e,_)=>{const w=t,C=o,P=A("Icon"),L=r,D=p,E=i,O=s,B=m,H=y,W=f;return j(),M("div",qe,[U(c).dpFlag?(j(),M("div",Oe,[z("div",Re,[I(C,{style:{width:"200px"},placeholder:"请输入虚拟设备名/标签",modelValue:U(c).virtualDeviceInfo,"onUpdate:modelValue":_[0]||(_[0]=e=>U(c).virtualDeviceInfo=e)},{prefix:S((()=>[I(w,{class:"el-input__icon"},{default:S((()=>[I(U(N))])),_:1})])),_:1},8,["modelValue"]),z("div",null,[I(L,{type:"primary",bg:"",class:"right-btn",onClick:_[1]||(_[1]=e=>(c.vdFlag=!0,void(c.vdTitle="添加虚拟设备")))},{default:S((()=>[I(w,{class:"btn-icon"},{default:S((()=>[I(P,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),T(" 添加 ")])),_:1}),I(L,{type:"danger",bg:"",class:"right-btn",onClick:_[2]||(_[2]=e=>(()=>{let e=[];0!==c.selectedDevice.length?(c.selectedDevice.forEach((a=>{e.push(a.name)})),l.confirm("确定要删除这些虚拟设备吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const a={token:n.token,data:{names:e}};J(a).then((e=>{q(e,u)}))})).catch((()=>{a({type:"info",message:"取消删除"})}))):a.info("请至少选择一个虚拟设备！")})())},{default:S((()=>[I(w,{class:"btn-icon"},{default:S((()=>[I(P,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),T(" 删除 ")])),_:1}),I(L,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:_[3]||(_[3]=e=>{u(1)})},{default:S((()=>[I(w,{class:"btn-icon"},{default:S((()=>[I(P,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),T(" 刷新 ")])),_:1})])]),z("div",{class:"content",ref_key:"contentRef",ref:d},[I(E,{data:U(g),"cell-style":U(c).cellStyle,"header-cell-style":U(c).headerCellStyle,"max-height":U(c).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:k},{empty:S((()=>[Be])),default:S((()=>[I(D,{type:"selection",width:"55"}),I(D,{sortable:"",prop:"name",label:"虚拟设备名称",width:"auto","min-width":"150",align:"center"}),I(D,{sortable:"",prop:"label",label:"虚拟设备标签",width:"auto","min-width":"150",align:"center"}),I(D,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:S((e=>[I(L,{onClick:a=>{return l=e.row,console.log("showVariableDetail ->",l),c.curVirtualDevice=l,void(c.dpFlag=!1);var l},text:"",type:"success"},{default:S((()=>[T("变量详情")])),_:2},1032,["onClick"]),I(L,{onClick:a=>{return l=e.row,c.vdFlag=!0,c.vdTitle="编辑虚拟设备",void(c.virtualForm={name:l.name,label:l.label});var l},text:"",type:"primary"},{default:S((()=>[T("编辑")])),_:2},1032,["onClick"]),I(L,{onClick:t=>{return r=e.row,void l.confirm("确定要删除这个虚拟设备吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:n.token,data:{names:[r.name]}};J(e).then((e=>{q(e,u)}))})).catch((()=>{a({type:"info",message:"取消删除"})}));var r},text:"",type:"danger"},{default:S((()=>[T("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),z("div",He,[I(O,{"current-page":U(c).currentPage,"page-size":U(c).pagesize,"page-sizes":[20,50,200,500],total:U(h).length,onCurrentChange:b,onSizeChange:v,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):(j(),R(Ee,{key:1,curVirtualDevice:U(c).curVirtualDevice,onChangeDpFlag:_[4]||(_[4]=e=>{c.dpFlag=!0})},null,8,["curVirtualDevice"])),I(W,{modelValue:U(c).vdFlag,"onUpdate:modelValue":_[9]||(_[9]=e=>U(c).vdFlag=e),title:U(c).vdTitle,width:"600px","before-close":V,"close-on-click-modal":!1},{footer:S((()=>[z("span",Ke,[I(L,{onClick:_[7]||(_[7]=e=>x())},{default:S((()=>[T("取消")])),_:1}),I(L,{type:"primary",onClick:_[8]||(_[8]=e=>{F.value.validate((e=>{if(!e)return!1;{const e={token:n.token,data:c.virtualForm};c.vdTitle.includes("添加")?Y(e).then((e=>{q(e,u),x()})):G(e).then((e=>{q(e,u),x()}))}}))})},{default:S((()=>[T("保存")])),_:1})])])),default:S((()=>[z("div",We,[I(H,{model:U(c).virtualForm,rules:U(c).virtualRules,ref_key:"virtualFormRef",ref:F,"status-icon":"","label-position":"right","label-width":"120px"},{default:S((()=>[I(B,{label:"虚拟设备名称",prop:"name"},{default:S((()=>[I(C,{type:"text",disabled:U(c).vdTitle.includes("编辑"),modelValue:U(c).virtualForm.name,"onUpdate:modelValue":_[5]||(_[5]=e=>U(c).virtualForm.name=e),autocomplete:"off",placeholder:"请输入虚拟设备名称"},null,8,["disabled","modelValue"])])),_:1}),I(B,{label:"虚拟设备标签",prop:"label"},{default:S((()=>[I(C,{type:"text",modelValue:U(c).virtualForm.label,"onUpdate:modelValue":_[6]||(_[6]=e=>U(c).virtualForm.label=e),autocomplete:"off",placeholder:"请输入虚拟设备标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-13a21f49"]]);export{Qe as default};
