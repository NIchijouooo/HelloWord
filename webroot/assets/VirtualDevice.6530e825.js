import{R as e,g as a,L as l,e as t,p as r,m as o,A as p,B as n,C as i,D as s,n as m,v as d,w as c,N as u,K as y,o as f,q as g,x as h,y as b,u as v}from"./element-plus.64650d13.js";import{s as F,_ as x,u as _,v as w}from"./index.98f42e56.js";import{I as V}from"./interface.c4e57716.js";import{D as k}from"./deviceModel.a85a7758.js";import{I as C,J as N}from"./@element-plus.aa3ef65f.js";import{f as L,Y as P,p as D,X as A,o as M,c as j,a as z,S as I,Q as U,u as S,U as T,a0 as E,M as q,af as O,P as R,L as H,O as B,at as W,au as J,H as K}from"./@vue.5db09832.js";import"./@vueuse.af8df401.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./vue-router.d969f71f.js";import"./pinia.69c74452.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./vue-echarts.8f00425b.js";import"./resize-detector.4e96b72b.js";import"./echarts.62a08783.js";import"./zrender.56caf4f2.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";var Q=e=>F.request({url:"/virtual/devices",method:"get",data:e}),X=e=>F.request({url:"/virtual/device",method:"post",data:e}),Y=e=>F.request({url:"/virtual/device",method:"put",data:e}),G=e=>F.request({url:"/virtual/devices",method:"delete",data:e}),Z=e=>F.request({url:"/virtual/properties",method:"get",data:e}),$=e=>F.request({url:"/virtual/property",method:"post",data:e}),ee=e=>F.request({url:"/virtual/property",method:"put",data:e}),ae=e=>F.request({url:"/virtual/properties",method:"delete",data:e});const le=e=>(W("data-v-7957a015"),e=e(),J(),e),te={class:"main"},re={class:"title",style:{"justify-content":"space-between"}},oe={class:"title-left"},pe=E(" 返回上报模型 "),ne={class:"title",style:{top:"60px",height:"76px",padding:"20px 0","justify-content":"space-between"}},ie={class:"tName"},se={style:{display:"flex","align-items":"center"}},me=E(" 添加 "),de=E(" 删除 "),ce=E(" 刷新 "),ue={class:"param-content"},ye={class:"pc-title"},fe={class:"pct-info"},ge=E(" "+T("参数详情")),he={class:"pc-content"},be={class:"param-item"},ve={class:"param-value"},Fe={class:"param-name"},xe={class:"param-content"},_e={class:"pc-title"},we={class:"pct-info"},Ve=E(" "+T("参数详情")),ke={class:"pc-content"},Ce={class:"param-item"},Ne={class:"param-value"},Le={class:"param-name"},Pe=E("编辑"),De=le((()=>z("div",null,"无数据",-1))),Ae={class:"pagination"},Me={class:"dialog-content"},je=E("同步"),ze=E(" 映射参数 "),Ie=E("编辑"),Ue=E(" 报警参数 "),Se={class:"dialog-footer"},Te=E("取消"),Ee=E("保存"),qe={class:"dialog-content"},Oe={style:{width:"100%"}},Re={class:"operation"},He={style:{"padding-right":"10px"}},Be={class:"dialog-footer"},We=E("取消"),Je=E("保存"),Ke={class:"dialog-content"},Qe={class:"dialog-cLeft"},Xe=le((()=>z("div",{class:"card-header"},[z("span",null,"请选择采集模型")],-1))),Ye={class:"card-main"},Ge=["onClick"],Ze={class:"dialog-cRight"},$e=le((()=>z("div",{class:"card-header"},[z("span",null,"请选择模型属性")],-1))),ea={class:"card-main"},aa=["onClick"],la={class:"dialog-footer"},ta=E("取消"),ra=E("保存");var oa=x({props:{curVirtualDevice:{type:Object,default:{}}},emits:["changeDpFlag"],setup(F,{emit:x}){const W=F,J=_();console.log(W);const Q=L(null),X=P({formulaForm:{},headerCellStyle:{background:w.primaryColor,color:w.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,PropertyTableData:[],pFlag:!1,pTitle:"添加属性",PropertyInfo:"",propertyForm:{name:"",label:"",type:0,unit:"",decimals:0,collName:"",deviceName:"",propertyName:"",saveEnable:!1,formula:"",min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,dataLength:"",dataLengthAlarm:!1},typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},paramName:{name:"属性名称",label:"属性标签",type:"数据类型",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"布长",stepAlarm:"布长报警",unit:"单位",decimals:"小数位数",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警",collName:"采集接口名称",deviceName:"设备名称",propertyName:"属性名称",saveEnable:"掉电保存",formula:"计算公式"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],label:[{required:!0,message:"属性标签不能为空",trigger:"blur"}],type:[{required:!0,message:"数据类型不能为空",trigger:"blur"}],decimals:[{type:"number",message:"小数位数只能输入数字"}],collName:[{required:!0,message:"采集接口名称不能为空",trigger:"blur"}],deviceName:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],propertyName:[{required:!0,message:"设备属性名称不能为空",trigger:"blur"}]},collOptions:[],nodeOptions:[],propertyOptions:[],nameTotsl:{},propertyInfo:[],operationList:[{name:"+",label:"+",describe:"加"},{name:"-",label:"-",describe:"减"},{name:"*",label:"*",describe:"乘"},{name:"/",label:"/",describe:"除"},{name:"%",label:"%",describe:"模"},{name:"^",label:"^",describe:"次幂"},{name:"(",label:"(",describe:"左括号"},{name:")",label:")",describe:"右括号"}],curFormula:"",selectionStart:0,pItem:"",fFlag:!1,selectedProperties:[],modelList:[],curModelName:"",curPropertyName:"",propertyList:[],mpFlag:!1,curProperty:{}}),Y=e=>{const l={token:J.token,data:{deviceName:W.curVirtualDevice.name}};Z(l).then((async l=>{l&&("0"===l.code?(X.PropertyTableData=l.data,1===e&&a({type:"success",message:"刷新成功！"})):wa(l),await K((()=>{X.tableMaxHeight=Q.value.clientHeight-34-36-22})))}))};Y();const G=D((()=>{let e=X.PropertyInfo;return X.PropertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase()))).slice((X.currentPage-1)*X.pagesize,X.currentPage*X.pagesize)})),le=D((()=>{let e=X.PropertyInfo;return X.PropertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase())))})),oa=e=>{X.currentPage=e},pa=e=>{X.pagesize=e},na=()=>{X.mpFlag=!1},ia=()=>{const e={token:J.token,data:{name:X.curModelName}};k.getDeviceModelProperty(e).then((e=>{console.log("getDeviceModelProperty -> res",e),e&&("0"===e.code?X.propertyList=e.data:wa(e))}))},sa=()=>{X.mpFlag=!0,(()=>{const e={token:J.token,data:{}};k.getDeviceModelList(e).then((e=>{console.log("getDeviceModelList -> res = ",e),e&&("0"===e.code?X.modelList=e.data:wa(e))}))})()},ma=e=>{console.log("editProperty -> row ",e),X.pFlag=!0,X.pTitle="编辑属性",X.propertyForm.name=e.name,X.propertyForm.label=e.label,X.propertyForm.type=e.type,X.propertyForm.decimals=e.decimals,X.propertyForm.unit=e.unit,X.propertyForm.collName=e.params.collName,X.propertyForm.deviceName=e.params.deviceName,X.propertyForm.propertyName=e.params.propertyName,X.propertyForm.formula=e.params.formula,X.propertyForm.saveEnable=e.params.saveEnable,3!==e.type?(X.propertyForm.min=e.alarmParams.min,X.propertyForm.max=e.alarmParams.max,X.propertyForm.minMaxAlarm=e.alarmParams.minMaxAlarm,X.propertyForm.step=e.alarmParams.step,X.propertyForm.stepAlarm=e.alarmParams.stepAlarm):(X.propertyForm.dataLength=e.alarmParams.dataLength,X.propertyForm.dataLengthAlarm=e.alarmParams.dataLengthAlarm),console.log("ctxData.propertyForm",X.propertyForm),ba(X.propertyForm.collName).then((e=>{ha(e),Fa(X.propertyForm.deviceName)}))},da=L(null),ca=()=>{X.pFlag=!1,da.value.resetFields(),ua()},ua=()=>{X.propertyForm={name:"",label:"",type:0,unit:"",decimals:0,collName:"",deviceName:"",propertyName:"",saveEnable:!1,formula:"",min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,dataLength:"",dataLengthAlarm:!1}},ya=e=>{ca()},fa=e=>{X.selectedProperties=e};(()=>{const e={token:J.token,data:{}};V.getInterfaceList(e).then((e=>{console.log("getInterfaceList -> res",e),"0"===e.code?(X.collOptions=[],e.data.forEach((e=>{const a={label:e.collInterfaceName,name:e.collInterfaceName};X.collOptions.push(a)}))):wa(e)}))})();const ga=e=>{ba(e).then((e=>{ha(e)})),X.propertyOptions=[]},ha=e=>{"0"===e.code?(X.nodeOptions=[],X.nameTotsl={},e.data.deviceNodeMap.forEach((e=>{const a={label:e.label,name:e.name,tsl:e.tsl};X.nameTotsl[""+e.name]=e.tsl,X.nodeOptions.push(a)}))):wa(e)},ba=e=>{const a={token:J.token,data:{name:e}};return V.getCollDevices(a)},va=e=>{Fa(e)},Fa=e=>{const a={token:J.token,data:{name:X.nameTotsl[e]}};k.getDeviceModelProperty(a).then((e=>{"0"===e.code?(X.propertyOptions=[],e.data.forEach((e=>{const a={label:e.name+"("+e.label+")",name:e.name};X.propertyOptions.push(a)}))):wa(e)}))},xa=()=>{X.propertyInfo=[{name:"t",label:"当前属性"}],X.PropertyTableData.forEach((e=>{X.propertyInfo.push({name:e.name,label:e.label})}))},_a=e=>{X.selectionStart=e.srcElement.selectionStart},wa=e=>{a({type:"error",message:e.message})},Va=(e,l)=>{a({type:"0"===e.code?"success":"error",message:e.message}),"0"===e.code&&l&&l()};return(F,_)=>{const w=t,V=r,k=o,L=A("Icon"),P=p,D=n,K=e,Z=i,ua=s,ha=m,ba=d,Fa=c,wa=u,ka=y,Ca=f,Na=g,La=h,Pa=b,Da=v;return M(),j("div",te,[z("div",re,[z("div",oe,[I(V,{type:"primary",plain:"",onClick:_[0]||(_[0]=e=>{x("changeDpFlag")}),style:{"margin-right":"20px"}},{default:U((()=>[I(w,{class:"el-input__icon"},{default:U((()=>[I(S(C))])),_:1}),pe])),_:1})])]),z("div",ne,[z("div",ie,T(W.curVirtualDevice.label),1),z("div",se,[I(k,{style:{width:"200px"},placeholder:"请输入属性名称或者标签",clearable:"",modelValue:S(X).PropertyInfo,"onUpdate:modelValue":_[1]||(_[1]=e=>S(X).PropertyInfo=e)},{prefix:U((()=>[I(w,{class:"el-input__icon"},{default:U((()=>[I(S(N))])),_:1})])),_:1},8,["modelValue"]),I(V,{type:"primary",bg:"",class:"right-btn",onClick:_[2]||(_[2]=e=>(X.pFlag=!0,void(X.pTitle="添加属性")))},{default:U((()=>[I(w,{class:"btn-icon"},{default:U((()=>[I(L,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),me])),_:1}),I(V,{type:"danger",bg:"",class:"right-btn",onClick:_[3]||(_[3]=e=>(()=>{let e=[];0!==X.selectedProperties.length?(X.selectedProperties.forEach((a=>{e.push(a.name)})),console.log("pList",e),l.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const a={token:J.token,data:{deviceName:W.curVirtualDevice.name,PropertyNames:e}};ae(a).then((e=>{Va(e,Y)}))})).catch((()=>{a({type:"info",message:"取消删除"})}))):a.info("请至少选择一个属性！")})())},{default:U((()=>[I(w,{class:"btn-icon"},{default:U((()=>[I(L,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),de])),_:1}),I(V,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:_[4]||(_[4]=e=>{Y(1)})},{default:U((()=>[I(w,{class:"btn-icon"},{default:U((()=>[I(L,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),ce])),_:1})])]),z("div",{class:"content",ref_key:"contentRef",ref:Q,style:{top:"136px"}},[I(Z,{data:S(G),"cell-style":S(X).cellStyle,"header-cell-style":S(X).headerCellStyle,"max-height":S(X).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:fa,onRowDblclick:ma},{empty:U((()=>[De])),default:U((()=>[I(P,{type:"selection",width:"55"}),I(P,{prop:"name",label:"属性名称",width:"auto","min-width":"180",align:"center"}),I(P,{prop:"label",label:"属性标签",width:"auto","min-width":"180",align:"center"}),I(P,{label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:U((e=>[E(T(S(X).typeNames["t"+e.row.type]),1)])),_:1}),I(P,{label:"小数位数",width:"auto","min-width":"80",align:"center"},{default:U((e=>[E(T(void 0===e.row.decimals||""===e.row.decimals?0:e.row.decimals),1)])),_:1}),I(P,{prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),I(P,{label:"映射参数详情",width:"auto","min-width":"300",align:"center"},{default:U((e=>[I(K,{trigger:"hover","show-after":500,"auto-close":500,effect:"light",width:"auto",placement:"left"},{default:U((()=>[z("div",ue,[z("div",ye,[z("div",fe,[z("b",null,T(e.row.name),1),ge])]),z("div",he,[(M(!0),j(q,null,O(e.row.params,((e,a,l)=>(M(),j("div",be,[z("div",ve,T(S(X).paramName[a])+"：",1),z("div",Fe,T("boolean"==typeof e?e?"是":"否":e),1)])))),256))])])])),reference:U((()=>[I(D,{size:"large"},{default:U((()=>[E(T(e.row.params),1)])),_:2},1024)])),_:2},1024)])),_:1}),I(P,{label:"报警参数详情",width:"auto","min-width":"300",align:"center"},{default:U((e=>[I(K,{trigger:"hover","show-after":500,"auto-close":500,effect:"light",width:"auto",placement:"left"},{default:U((()=>[z("div",xe,[z("div",_e,[z("div",we,[z("b",null,T(e.row.name),1),Ve])]),z("div",ke,[(M(!0),j(q,null,O(e.row.alarmParams,((e,a,l)=>(M(),j("div",Ce,[z("div",Ne,T(S(X).paramName[a])+"：",1),z("div",Le,T("boolean"==typeof e?e?"是":"否":e),1)])))),256))])])])),reference:U((()=>[I(D,{size:"large"},{default:U((()=>[E(T(e.row.alarmParams),1)])),_:2},1024)])),_:2},1024)])),_:1}),I(P,{label:"操作",width:"auto","min-width":"150",align:"center",fixed:"right"},{default:U((e=>[I(V,{onClick:a=>ma(e.row),text:"",type:"primary"},{default:U((()=>[Pe])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),z("div",Ae,[I(ua,{"current-page":S(X).currentPage,"page-size":S(X).pagesize,"page-sizes":[20,50,200,500],total:S(le).length,onCurrentChange:oa,onSizeChange:pa,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),I(Na,{modelValue:S(X).pFlag,"onUpdate:modelValue":_[26]||(_[26]=e=>S(X).pFlag=e),title:S(X).pTitle,width:"800px","before-close":ya,"close-on-click-modal":!1},{footer:U((()=>[z("span",Se,[I(V,{onClick:_[24]||(_[24]=e=>ca())},{default:U((()=>[Te])),_:1}),I(V,{type:"primary",onClick:_[25]||(_[25]=e=>{da.value.validate((e=>{if(console.log("valid",e),!e)return!1;{let e={};e.name=X.propertyForm.name,e.label=X.propertyForm.label,e.type=X.propertyForm.type,e.decimals=X.propertyForm.decimals,e.unit=X.propertyForm.unit;let a={collName:X.propertyForm.collName,deviceName:X.propertyForm.deviceName,propertyName:X.propertyForm.propertyName,formula:X.propertyForm.formula,saveEnable:X.propertyForm.saveEnable},l={};3!==X.propertyForm.type?(l.min=X.propertyForm.min,l.max=X.propertyForm.max,l.minMaxAlarm=X.propertyForm.minMaxAlarm,l.step=X.propertyForm.step,l.stepAlarm=X.propertyForm.stepAlarm):(l.dataLength=X.propertyForm.dataLength,l.dataLengthAlarm=X.propertyForm.dataLengthAlarm),e.alarmParams=l,e.params=a,console.log("submitPorpertyForm -> property",e);const t={token:J.token,data:{deviceName:W.curVirtualDevice.name,property:e}};X.pTitle.includes("添加")?(console.log("添加属性"),$(t).then((e=>{Va(e,Y),ca()}))):(console.log("编辑属性"),ee(t).then((e=>{Va(e,Y),ca()})))}}))})},{default:U((()=>[Ee])),_:1})])])),default:U((()=>[z("div",Me,[I(Ca,{model:S(X).propertyForm,rules:S(X).propertyRules,ref_key:"propertyFormRef",ref:da,"status-icon":"","label-position":"right","label-width":"120px",inline:!0},{default:U((()=>[I(ha,{label:"属性名称",prop:"name"},{default:U((()=>[I(k,{style:{width:"220px"},disabled:S(X).pTitle.includes("编辑"),readonly:!0,type:"text",modelValue:S(X).propertyForm.name,"onUpdate:modelValue":_[6]||(_[6]=e=>S(X).propertyForm.name=e),autocomplete:"off",placeholder:"请选择属性名称"},{append:U((()=>[I(V,{onClick:_[5]||(_[5]=e=>sa())},{default:U((()=>[je])),_:1})])),_:1},8,["disabled","modelValue"])])),_:1}),I(ha,{label:"属性标签",prop:"label"},{default:U((()=>[I(k,{style:{width:"220px"},type:"text",readonly:!0,modelValue:S(X).propertyForm.label,"onUpdate:modelValue":_[7]||(_[7]=e=>S(X).propertyForm.label=e),autocomplete:"off",placeholder:"请选择属性名称同步属性标签"},null,8,["modelValue"])])),_:1}),I(ha,{label:"数据类型",prop:"type"},{default:U((()=>[I(Fa,{modelValue:S(X).propertyForm.type,"onUpdate:modelValue":_[8]||(_[8]=e=>S(X).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"220px"},placeholder:"请选择数据类型"},{default:U((()=>[(M(!0),j(q,null,O(S(X).typeOptions,(e=>(M(),R(ba,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),2===S(X).propertyForm.type?(M(),R(ha,{key:0,label:"小数位数",prop:"decimals"},{default:U((()=>[I(k,{style:{width:"220px"},type:"text",modelValue:S(X).propertyForm.decimals,"onUpdate:modelValue":_[9]||(_[9]=e=>S(X).propertyForm.decimals=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入小数位数"},null,8,["modelValue"])])),_:1})):H("",!0),3!==S(X).propertyForm.type?(M(),R(ha,{key:1,label:"单位",prop:"unit"},{default:U((()=>[I(k,{style:{width:"220px"},type:"text",modelValue:S(X).propertyForm.unit,"onUpdate:modelValue":_[10]||(_[10]=e=>S(X).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1})):H("",!0),I(wa,{"content-position":"center"},{default:U((()=>[ze])),_:1}),I(ha,{label:"采集接口名称",prop:"collName"},{default:U((()=>[I(Fa,{modelValue:S(X).propertyForm.collName,"onUpdate:modelValue":_[11]||(_[11]=e=>S(X).propertyForm.collName=e),style:{width:"220px"},placeholder:"请选择采集接口名称",onChange:ga,clearable:"",filterable:""},{default:U((()=>[(M(!0),j(q,null,O(S(X).collOptions,(e=>(M(),R(ba,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),I(ha,{label:"设备名称",prop:"deviceName"},{default:U((()=>[I(Fa,{modelValue:S(X).propertyForm.deviceName,"onUpdate:modelValue":_[12]||(_[12]=e=>S(X).propertyForm.deviceName=e),style:{width:"220px"},placeholder:"请选择设备名称",onChange:va,clearable:"",filterable:""},{default:U((()=>[(M(!0),j(q,null,O(S(X).nodeOptions,(e=>(M(),R(ba,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),I(ha,{label:"设备属性名称",prop:"propertyName"},{default:U((()=>[I(Fa,{modelValue:S(X).propertyForm.propertyName,"onUpdate:modelValue":_[13]||(_[13]=e=>S(X).propertyForm.propertyName=e),style:{width:"220px"},placeholder:"请选择设备属性名称",clearable:"",filterable:""},{default:U((()=>[(M(!0),j(q,null,O(S(X).propertyOptions,(e=>(M(),R(ba,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),I(ha,{label:"掉电保存"},{default:U((()=>[I(ka,{style:{width:"220px"},modelValue:S(X).propertyForm.saveEnable,"onUpdate:modelValue":_[14]||(_[14]=e=>S(X).propertyForm.saveEnable=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1}),I(ha,{label:"计算公式"},{default:U((()=>[I(k,{style:{width:"220px"},type:"text",readonly:"",modelValue:S(X).propertyForm.formula,"onUpdate:modelValue":_[16]||(_[16]=e=>S(X).propertyForm.formula=e),autocomplete:"off",placeholder:"请编辑计算公式"},{append:U((()=>[I(V,{onClick:_[15]||(_[15]=e=>(X.fFlag=!0,X.curFormula=X.propertyForm.formula,void xa()))},{default:U((()=>[Ie])),_:1})])),_:1},8,["modelValue"])])),_:1}),I(wa,{"content-position":"center"},{default:U((()=>[Ue])),_:1}),3!==S(X).propertyForm.type?(M(),R(ha,{key:2,label:"范围报警",prop:"minMaxAlarm"},{default:U((()=>[I(ka,{style:{width:"220px"},modelValue:S(X).propertyForm.minMaxAlarm,"onUpdate:modelValue":_[17]||(_[17]=e=>S(X).propertyForm.minMaxAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0),3!==S(X).propertyForm.type?(M(),R(ha,{key:3,label:"布长报警",prop:"stepAlarm"},{default:U((()=>[I(ka,{style:{width:"220px"},modelValue:S(X).propertyForm.stepAlarm,"onUpdate:modelValue":_[18]||(_[18]=e=>S(X).propertyForm.stepAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0),3!==S(X).propertyForm.type&&S(X).propertyForm.minMaxAlarm?(M(),R(ha,{key:4,label:"最小值",prop:"min"},{default:U((()=>[I(k,{style:{width:"220px"},type:"text",modelValue:S(X).propertyForm.min,"onUpdate:modelValue":_[19]||(_[19]=e=>S(X).propertyForm.min=e),autocomplete:"off",placeholder:"请输入最小值"},null,8,["modelValue"])])),_:1})):H("",!0),3!==S(X).propertyForm.type&&S(X).propertyForm.minMaxAlarm?(M(),R(ha,{key:5,label:"最大值",prop:"max"},{default:U((()=>[I(k,{style:{width:"220px"},type:"text",modelValue:S(X).propertyForm.max,"onUpdate:modelValue":_[20]||(_[20]=e=>S(X).propertyForm.max=e),autocomplete:"off",placeholder:"请输入最大值"},null,8,["modelValue"])])),_:1})):H("",!0),3!==S(X).propertyForm.type&&S(X).propertyForm.stepAlarm?(M(),R(ha,{key:6,label:"布长",prop:"step"},{default:U((()=>[I(k,{style:{width:"220px"},type:"text",modelValue:S(X).propertyForm.step,"onUpdate:modelValue":_[21]||(_[21]=e=>S(X).propertyForm.step=e),autocomplete:"off",placeholder:"请输入布长"},null,8,["modelValue"])])),_:1})):H("",!0),3===S(X).propertyForm.type?(M(),R(ha,{key:7,label:"字符串长度报警",prop:"dataLengthAlarm"},{default:U((()=>[I(ka,{style:{width:"220px"},modelValue:S(X).propertyForm.dataLengthAlarm,"onUpdate:modelValue":_[22]||(_[22]=e=>S(X).propertyForm.dataLengthAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):H("",!0),3===S(X).propertyForm.type&&S(X).propertyForm.dataLengthAlarm?(M(),R(ha,{key:8,label:"字符串长度",prop:"dataLength"},{default:U((()=>[I(k,{style:{width:"220px"},type:"text",modelValue:S(X).propertyForm.dataLength,"onUpdate:modelValue":_[23]||(_[23]=e=>S(X).propertyForm.dataLength=e),autocomplete:"off",placeholder:"请输入字符串长度"},null,8,["modelValue"])])),_:1})):H("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),I(Na,{modelValue:S(X).fFlag,"onUpdate:modelValue":_[32]||(_[32]=e=>S(X).fFlag=e),title:"编辑计算公式",width:"600px"},{footer:U((()=>[z("span",Be,[I(V,{onClick:_[30]||(_[30]=e=>(X.fFlag=!1,void(X.curFormula="")))},{default:U((()=>[We])),_:1}),I(V,{type:"primary",onClick:_[31]||(_[31]=e=>(X.fFlag=!1,void(X.propertyForm.formula=X.curFormula)))},{default:U((()=>[Je])),_:1})])])),default:U((()=>[z("div",qe,[I(Ca,{model:S(X).formulaForm,"label-position":"right","label-width":"120px"},{default:U((()=>[I(ha,{label:"运算符号"},{default:U((()=>[z("div",Oe,[(M(!0),j(q,null,O(S(X).operationList,(e=>(M(),j("div",Re,[z("div",He,[I(V,{style:{width:"100%"},onClick:a=>(e=>{let a=X.curFormula.length;if(a!==X.selectionStart){let l=X.curFormula.substr(0,X.selectionStart),t=X.curFormula.substr(X.selectionStart,a-X.selectionStart);X.curFormula=l+e.name+t,X.selectionStart+=e.name.length}else X.curFormula+=e.name,X.selectionStart+=e.name.length})(e)},{default:U((()=>[E(T(e.label),1)])),_:2},1032,["onClick"])])])))),256))])])),_:1}),I(ha,{label:"设备属性"},{default:U((()=>[I(Fa,{modelValue:S(X).pItem,"onUpdate:modelValue":_[27]||(_[27]=e=>S(X).pItem=e),filterable:"",placeholder:"请选择设备属性",onChange:_[28]||(_[28]=e=>(e=>{let a=X.curFormula.length;if(a!==X.selectionStart){let l=X.curFormula.substr(0,X.selectionStart),t=X.curFormula.substr(X.selectionStart,a-X.selectionStart);X.curFormula=l+"("+e+")"+t,X.selectionStart+=e.length+2}else X.curFormula+="("+e+")",X.selectionStart+=e.length+2})(S(X).pItem)),style:{width:"100%"}},{default:U((()=>[(M(!0),j(q,null,O(S(X).propertyInfo,(e=>(M(),R(ba,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),I(ha,{label:"当前公式"},{default:U((()=>[I(k,{type:"text",clearable:"",modelValue:S(X).curFormula,"onUpdate:modelValue":_[29]||(_[29]=e=>S(X).curFormula=e),autocomplete:"off",placeholder:"请编辑计算公式",onBlur:_a},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"]),I(Na,{modelValue:S(X).mpFlag,"onUpdate:modelValue":_[37]||(_[37]=e=>S(X).mpFlag=e),title:"模型属性选择",width:"1000px"},{footer:U((()=>[z("span",la,[I(V,{onClick:_[35]||(_[35]=e=>na())},{default:U((()=>[ta])),_:1}),I(V,{type:"primary",onClick:_[36]||(_[36]=e=>(X.propertyForm.name=X.curProperty.name,X.propertyForm.label=X.curProperty.label,void na()))},{default:U((()=>[ra])),_:1})])])),default:U((()=>[z("div",Ke,[z("div",Qe,[I(Da,{class:"card-box",shadow:"hover"},{header:U((()=>[Xe])),default:U((()=>[z("div",Ye,[I(Pa,{modelValue:S(X).curModelName,"onUpdate:modelValue":_[33]||(_[33]=e=>S(X).curModelName=e),style:{width:"100%"}},{default:U((()=>[(M(!0),j(q,null,O(S(X).modelList,(e=>(M(),j("div",{class:B(["upload-item",{isClicked:e.isClicked}]),key:"tml"+e.name},[z("div",{class:"upload-item-text",onClick:a=>(e=>{X.curModelName=e.name,ia()})(e)},[I(La,{label:e.name},{default:U((()=>[E(T(e.label+" ("+e.name+")"),1)])),_:2},1032,["label"])],8,Ge)],2)))),128))])),_:1},8,["modelValue"])])])),_:1})]),z("div",Ze,[I(Da,{class:"card-box",shadow:"hover"},{header:U((()=>[$e])),default:U((()=>[z("div",ea,[I(Pa,{modelValue:S(X).curPropertyName,"onUpdate:modelValue":_[34]||(_[34]=e=>S(X).curPropertyName=e),style:{width:"100%"}},{default:U((()=>[(M(!0),j(q,null,O(S(X).propertyList,(e=>(M(),j("div",{class:B(["upload-item",{isClicked:e.isClicked}]),key:"tml"+e.name},[z("div",{class:"upload-item-text",onClick:a=>(e=>{X.curProperty=e})(e)},[I(La,{label:e.name},{default:U((()=>[E(T(e.label+" ("+e.name+")"),1)])),_:2},1032,["label"])],8,aa)],2)))),128))])),_:1},8,["modelValue"])])])),_:1})])])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-7957a015"]]);const pa=e=>(W("data-v-540c4e7b"),e=e(),J(),e),na={class:"main-container"},ia={key:0,class:"main"},sa={class:"title",style:{"justify-content":"space-between"}},ma=E(" 添加 "),da=E(" 删除 "),ca=E(" 刷新 "),ua=E("变量详情"),ya=E("编辑"),fa=E("删除"),ga=pa((()=>z("div",null,"无数据",-1))),ha={class:"pagination"},ba={class:"dialog-content"},va={class:"dialog-footer"},Fa=E("取消"),xa=E("保存");var _a=x({setup(e){const n=_(),d=L(null),c=P({virtualDeviceInfo:"",headerCellStyle:{background:w.primaryColor,color:w.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,tableData:[],dpFlag:!0,vdFlag:!1,vdTitle:"添加虚拟设备",curVirtualDevice:{},virtualForm:{name:"",label:""},virtualRules:{name:[{required:!0,message:"虚拟设备名称不能为空",trigger:"blur"}],label:[{required:!0,message:"虚拟设备标识不能为空",trigger:"blur"}]},selectedDevice:[]}),u=e=>{const l={token:n.token,data:{}};Q(l).then((async l=>{l&&("0"===l.code?(c.tableData=l.data,1===e&&a({type:"success",message:"刷新成功！"})):T(l),await K((()=>{c.tableMaxHeight=d.value.clientHeight-34-36-22})))}))};u();const y=D((()=>c.tableData.filter((e=>{var a=!c.virtualDeviceInfo,l=e.name.toLowerCase().includes(c.virtualDeviceInfo.toLowerCase());return a||l})).slice((c.currentPage-1)*c.pagesize,c.currentPage*c.pagesize))),h=D((()=>c.tableData.filter((e=>{var a=!c.virtualDeviceInfo,l=e.name.toLowerCase().includes(c.virtualDeviceInfo.toLowerCase());return a||l})))),b=e=>{c.currentPage=e},v=e=>{c.pagesize=e},F=L(null),x=()=>{c.vdFlag=!1,F.value.resetFields(),C()},V=()=>{x()},k=e=>{c.selectedDevice=e,console.log("handleSelectionChange -> val =",e)},C=()=>{c.virtualForm={name:"",label:""}},T=e=>{a({type:"error",message:e.message})},E=(e,l)=>{a({type:"0"===e.code?"success":"error",message:e.message}),"0"===e.code&&l&&l()};return(e,_)=>{const w=t,C=o,L=A("Icon"),P=r,D=p,T=i,q=s,O=m,H=f,B=g;return M(),j("div",na,[S(c).dpFlag?(M(),j("div",ia,[z("div",sa,[I(C,{style:{width:"200px"},placeholder:"请输入虚拟设备名/标签",modelValue:S(c).virtualDeviceInfo,"onUpdate:modelValue":_[0]||(_[0]=e=>S(c).virtualDeviceInfo=e)},{prefix:U((()=>[I(w,{class:"el-input__icon"},{default:U((()=>[I(S(N))])),_:1})])),_:1},8,["modelValue"]),z("div",null,[I(P,{type:"primary",bg:"",class:"right-btn",onClick:_[1]||(_[1]=e=>(c.vdFlag=!0,void(c.vdTitle="添加虚拟设备")))},{default:U((()=>[I(w,{class:"btn-icon"},{default:U((()=>[I(L,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),ma])),_:1}),I(P,{type:"danger",bg:"",class:"right-btn",onClick:_[2]||(_[2]=e=>(()=>{let e=[];0!==c.selectedDevice.length?(c.selectedDevice.forEach((a=>{e.push(a.name)})),l.confirm("确定要删除这些虚拟设备吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const a={token:n.token,data:{names:e}};G(a).then((e=>{E(e,u)}))})).catch((()=>{a({type:"info",message:"取消删除"})}))):a.info("请至少选择一个虚拟设备！")})())},{default:U((()=>[I(w,{class:"btn-icon"},{default:U((()=>[I(L,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),da])),_:1}),I(P,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:_[3]||(_[3]=e=>{u(1)})},{default:U((()=>[I(w,{class:"btn-icon"},{default:U((()=>[I(L,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),ca])),_:1})])]),z("div",{class:"content",ref_key:"contentRef",ref:d},[I(T,{data:S(y),"cell-style":S(c).cellStyle,"header-cell-style":S(c).headerCellStyle,"max-height":S(c).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:k},{empty:U((()=>[ga])),default:U((()=>[I(D,{type:"selection",width:"55"}),I(D,{prop:"name",label:"虚拟设备名称",width:"auto","min-width":"150",align:"center"}),I(D,{prop:"label",label:"虚拟设备标签",width:"auto","min-width":"150",align:"center"}),I(D,{label:"操作",width:"auto","min-width":"300",align:"center",fixed:"right"},{default:U((e=>[I(P,{onClick:a=>{return l=e.row,console.log("showVariableDetail ->",l),c.curVirtualDevice=l,void(c.dpFlag=!1);var l},text:"",type:"success"},{default:U((()=>[ua])),_:2},1032,["onClick"]),I(P,{onClick:a=>{return l=e.row,c.vdFlag=!0,c.vdTitle="编辑虚拟设备",void(c.virtualForm={name:l.name,label:l.label});var l},text:"",type:"primary"},{default:U((()=>[ya])),_:2},1032,["onClick"]),I(P,{onClick:t=>{return r=e.row,void l.confirm("确定要删除这个虚拟设备吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:n.token,data:{names:[r.name]}};G(e).then((e=>{E(e,u)}))})).catch((()=>{a({type:"info",message:"取消删除"})}));var r},text:"",type:"danger"},{default:U((()=>[fa])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),z("div",ha,[I(q,{"current-page":S(c).currentPage,"page-size":S(c).pagesize,"page-sizes":[20,50,200,500],total:S(h).length,onCurrentChange:b,onSizeChange:v,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):(M(),R(oa,{key:1,curVirtualDevice:S(c).curVirtualDevice,onChangeDpFlag:_[4]||(_[4]=e=>{c.dpFlag=!0})},null,8,["curVirtualDevice"])),I(B,{modelValue:S(c).vdFlag,"onUpdate:modelValue":_[9]||(_[9]=e=>S(c).vdFlag=e),title:S(c).vdTitle,width:"600px","before-close":V,"close-on-click-modal":!1},{footer:U((()=>[z("span",va,[I(P,{onClick:_[7]||(_[7]=e=>x())},{default:U((()=>[Fa])),_:1}),I(P,{type:"primary",onClick:_[8]||(_[8]=e=>{F.value.validate((e=>{if(!e)return!1;{const e={token:n.token,data:c.virtualForm};c.vdTitle.includes("添加")?X(e).then((e=>{E(e,u),x()})):Y(e).then((e=>{E(e,u),x()}))}}))})},{default:U((()=>[xa])),_:1})])])),default:U((()=>[z("div",ba,[I(H,{model:S(c).virtualForm,rules:S(c).virtualRules,ref_key:"virtualFormRef",ref:F,"status-icon":"","label-position":"right","label-width":"120px"},{default:U((()=>[I(O,{label:"虚拟设备名称",prop:"name"},{default:U((()=>[I(C,{type:"text",disabled:S(c).vdTitle.includes("编辑"),modelValue:S(c).virtualForm.name,"onUpdate:modelValue":_[5]||(_[5]=e=>S(c).virtualForm.name=e),autocomplete:"off",placeholder:"请输入虚拟设备名称"},null,8,["disabled","modelValue"])])),_:1}),I(O,{label:"虚拟设备标签",prop:"label"},{default:U((()=>[I(C,{type:"text",modelValue:S(c).virtualForm.label,"onUpdate:modelValue":_[6]||(_[6]=e=>S(c).virtualForm.label=e),autocomplete:"off",placeholder:"请输入虚拟设备标签"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-540c4e7b"]]);export{_a as default};
