import{h as e,e as a,p as l,m as t,D as o,F as n,G as c,v as i,q as s,n as r,y as d,A as p,o as u,H as m,I as f,J as g,C as h}from"./element-plus.795748f2.js";import{_ as b,u as v,v as y}from"./index.c4bb92fc.js";import{D as _}from"./deviceModel.de9e06d6.js";import{I as C}from"./interface.650ae22c.js";import{Y as D,f as w,p as x,X as F,o as k,c as V,a as I,S as T,Q as L,u as N,U as j,J as z,K as S,a0 as P,as as U,at as O,H as M,P as R,M as H,af as E}from"./@vue.8518410d.js";import{J as q,I as A,K as B,L as J,M as W}from"./@element-plus.102632fb.js";import"./@vueuse.c0256496.js";import"./dayjs.b9b14681.js";import"./axios.765908e4.js";import"./lodash-es.8ca9079f.js";import"./async-validator.ed4c92a2.js";import"./@ctrl.82a509e0.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./vue-router.ae8a7199.js";import"./pinia.4a496763.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.258ac312.js";import"./nprogress.aae2b787.js";const K=e=>(U("data-v-5bcaa67d"),e=e(),O(),e),G={class:"main-container"},Q={class:"main"},X={class:"title",style:{"justify-content":"space-between"}},Y={class:"title-left"},Z=P(" 返回采集设备 "),$={class:"title-right"},ee=P(" 写属性 "),ae=P(" 刷新 "),le={class:"title",style:{top:"60px",height:"76px",padding:"20px 0","justify-content":"flex-start"}},te={class:"tName"},oe=P("查看历史数据"),ne=K((()=>I("div",null,"无数据",-1))),ce={class:"pagination"},ie={class:"dialog-content",style:{"min-height":"408px",overflow:"unset",padding:"0"}},se={class:"dialog-content-head"},re=P(" 写属性 "),de={class:"dialog-content-content"},pe=P(" 操作成功 "),ue=P(" 操作失败 "),me={class:"pagination dialog-pagination"},fe={class:"dialog-footer"},ge=P("关闭");var he=b({props:{curDevice:{type:Object,default:{}},collInterfaceName:{type:String,default:""}},emits:["changeIdFlag"],setup(r,{emit:d}){const p=r,u=v();console.log("id -> props",p);const m=D({headerCellStyle:{background:y.primaryColor,color:y.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,propertyTableData:[],propertyInfo:"",pFlag:!1,pInfo:"",pCurrentPage:1,pPagesize:5,userHeadStyle:{color:y.headerTextColor,borderColor:"#C0C4CC",height:"48px"},userCellStyle:{borderColor:"#C0C4CC",height:"48px"},pTableData:[],pTableData1:[],selectPorperties:[],isLoading:!1}),f=w(null),g=a=>{const l={token:u.token,data:{collInterfaceName:p.curDevice.collInterfaceName,deviceName:p.curDevice.name}};m.isLoading=!0,C.getDeviceDataReal(l).then((async l=>{console.log("getDeviceDataReal -> res",l),l&&("0"===l.code?(m.propertyTableData=l.data,1===a&&e.success("刷新成功！")):W(l),m.isLoading=!1,console.log("getDeviceDataReal -> ctxData.propertyTableData",m.propertyTableData),await M((()=>{m.tableMaxHeight=f.value.clientHeight-34-36-22})))}))};g();const h=x((()=>{let e=m.propertyInfo;return m.propertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase()))).slice((m.currentPage-1)*m.pagesize,m.currentPage*m.pagesize)})),b=x((()=>{let e=m.propertyInfo;return m.propertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase())))})),P=e=>{m.currentPage=e},U=e=>{m.pagesize=e},O=()=>{m.pFlag=!1},R=e=>{O()},H=e=>{m.pCurrentPage=e,m.pTableData=m.pTableData1.slice((m.pCurrentPage-1)*m.pPagesize,m.pCurrentPage*m.pPagesize)},E=e=>{m.pPagesize=e,m.pTableData=m.pTableData1.slice((m.pCurrentPage-1)*m.pPagesize,m.pCurrentPage*m.pPagesize)},J=e=>{console.log("handleSelectionChange val = ",e),console.log("handleSelectionChange pTableData = ",m.pTableData),m.selectPorperties=e},W=a=>{e({type:"error",message:a.message})};return(r,v)=>{const y=a,D=l,w=t,x=F("Icon"),M=o,K=n,he=c,be=i,ve=s;return k(),V("div",G,[I("div",Q,[I("div",X,[I("div",Y,[T(D,{type:"primary",plain:"",onClick:v[0]||(v[0]=e=>{d("changeIdFlag")}),style:{"margin-right":"20px"}},{default:L((()=>[T(y,{class:"el-input__icon"},{default:L((()=>[T(N(q))])),_:1}),Z])),_:1}),T(w,{style:{width:"200px"},placeholder:"请输入 名称/标签 过滤",clearable:"",modelValue:N(m).propertyInfo,"onUpdate:modelValue":v[1]||(v[1]=e=>N(m).propertyInfo=e)},{prefix:L((()=>[T(y,{class:"el-input__icon"},{default:L((()=>[T(N(A))])),_:1})])),_:1},8,["modelValue"])]),I("div",$,[T(D,{type:"primary",plain:"",class:"right-btn",onClick:v[2]||(v[2]=e=>(()=>{const e={token:u.token,data:{name:p.curDevice.tsl}};_.getDeviceModelProperty(e).then((e=>{"0"===e.code?(m.pTableData=[],m.pTableData1=[],e.data.filter((e=>0!==e.accessMode)).forEach((e=>{const a={name:e.name,label:e.label,sendValue:"",result:{Code:"",Message:""}};m.pTableData.push(a),m.pTableData1.push(a)})),console.log("ctxData.pTableData -> ",m.pTableData),m.pFlag=!0):W(e)}))})())},{default:L((()=>[T(y,{class:"el-input__icon"},{default:L((()=>[T(N(B))])),_:1}),ee])),_:1}),T(D,{style:{color:"#fff"},color:"#2EA554",loading:N(m).isLoading,class:"right-btn",onClick:v[3]||(v[3]=e=>{g(1)})},{default:L((()=>[T(y,{class:"btn-icon"},{default:L((()=>[T(x,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),ae])),_:1},8,["loading"])])]),I("div",le,[I("div",te,j(p.curDevice.name)+"("+j(p.curDevice.label)+")",1)]),I("div",{class:"content",ref_key:"contentRef",ref:f,style:{top:"136px"}},[T(K,{data:N(h),"cell-style":N(m).cellStyle,"header-cell-style":N(m).headerCellStyle,"max-height":N(m).tableMaxHeight,style:{width:"100%"},stripe:""},{empty:L((()=>[ne])),default:L((()=>[T(M,{prop:"index",label:"序号",width:"55"}),T(M,{prop:"name",label:"变量名称",width:"auto","min-width":"180",align:"center"}),T(M,{prop:"label",label:"变量标签",width:"auto","min-width":"180",align:"center"}),T(M,{prop:"type",label:"变量类型",width:"auto","min-width":"120",align:"center"}),T(M,{prop:"value",label:"变量值",width:"auto","min-width":"200",align:"center"}),T(M,{prop:"unit",label:"单位",width:"auto","min-width":"200",align:"center"}),T(M,{prop:"explain",label:"说明",width:"auto","min-width":"200",align:"center"}),T(M,{prop:"timestamp",label:"实测时间",width:"auto","min-width":"220",align:"center"}),T(M,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:L((a=>[T(D,{onClick:l=>(a.row,void e.info("功能完善中...")),text:"",type:"success"},{default:L((()=>[oe])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),I("div",ce,[T(he,{"current-page":N(m).currentPage,"page-size":N(m).pagesize,"page-sizes":[20,50,200,500],total:N(b).length,onCurrentChange:P,onSizeChange:U,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),T(ve,{modelValue:N(m).pFlag,"onUpdate:modelValue":v[8]||(v[8]=e=>N(m).pFlag=e),title:"写属性",width:"1000px","before-close":R,"close-on-click-modal":!1},{footer:L((()=>[I("span",fe,[T(D,{onClick:v[7]||(v[7]=e=>O())},{default:L((()=>[ge])),_:1})])])),default:L((()=>[I("div",ie,[I("div",se,[T(w,{placeholder:"请输入属性名称或标签",style:{width:"200px"},modelValue:N(m).pInfo,"onUpdate:modelValue":v[4]||(v[4]=e=>N(m).pInfo=e),onChange:v[5]||(v[5]=e=>{m.pTableData=m.pTableData1.filter((e=>!m.pInfo||e.name.includes(m.pInfo)||e.label.includes(m.pInfo)))})},{prefix:L((()=>[T(y,{class:"el-input__icon"},{default:L((()=>[T(N(A))])),_:1})])),_:1},8,["modelValue"]),T(D,{type:"primary",class:"right-btn",onClick:v[6]||(v[6]=a=>(a=>{if(console.log("sendCmd",m.selectPorperties),m.selectPorperties.length<1)return void e.warning("请至少选择一个属性操作");const l={};m.selectPorperties.forEach((e=>{l[e.name]=e.sendValue})),console.log(l);const t={token:u.token,data:{collInterfaceName:p.curDevice.collInterfaceName,deviceName:p.curDevice.name,serviceName:"SetVariables",serviceParam:l}};"Read"===a||C.invokeDeviceService(t).then((a=>{e.success("写属性命令下发成功！"),m.pTableData.forEach((e=>{m.selectPorperties.forEach((l=>{e.name===l.name&&(e.result=a)}))}))}))})("Write"))},{default:L((()=>[T(y,{class:"el-input__icon"},{default:L((()=>[T(N(B))])),_:1}),re])),_:1})]),I("div",de,[T(K,{data:N(m).pTableData,onSelectionChange:J,"header-cell-style":N(m).userHeadStyle,"cell-style":N(m).userCellStyle,style:{border:"1px solid #c0c4cc"},"max-height":"290",stripe:""},{default:L((()=>[T(M,{type:"selection",width:"55"}),T(M,{prop:"name",label:"属性名称","min-width":"120",align:"center"}),T(M,{prop:"label",label:"属性标签","min-width":"140",align:"center"}),T(M,{label:"写入值","min-width":"100",align:"center"},{default:L((e=>[T(w,{placeholder:"请输入写入值",modelValue:e.row.sendValue,"onUpdate:modelValue":a=>e.row.sendValue=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),T(M,{label:"返回结果","min-width":"250",align:"center"},{default:L((e=>[z(T(be,{type:"success"},{default:L((()=>[pe])),_:2},1536),[[S,"0"===e.row.result.Code]]),z(T(be,{type:"danger"},{default:L((()=>[ue])),_:2},1536),[[S,"1"===e.row.result.Code]]),z(I("span",null,"-",512),[[S,""===e.row.result.Code]]),z(I("span",null,j(e.row.result.Message),513),[[S,"1"===e.row.result.Code]])])),_:1})])),_:1},8,["data","header-cell-style","cell-style"]),I("div",me,[T(he,{"current-page":N(m).pCurrentPage,"page-size":N(m).pPagesize,"page-sizes":[5,10,20,50],total:N(m).pTableData1.length,onCurrentChange:H,onSizeChange:E,background:"",layout:"total, sizes, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])])])])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-5bcaa67d"]]);const be=e=>(U("data-v-1b01d589"),e=e(),O(),e),ve={class:"main-container"},ye={key:0,class:"main"},_e={class:"title",style:{"justify-content":"space-between"}},Ce={class:"title-left"},De=P(" 筛选 "),we=P(" 导入设备 "),xe=P(" 导出设备 "),Fe=P(" 添加 "),ke=P(" 批量采集 "),Ve=P(" 刷新 "),Ie=P(" 删除 "),Te={class:"title",style:{top:"60px",height:"76px",padding:"20px 0","justify-content":"space-between"}},Le={style:{"margin-right":"10px"}},Ne=P("在线"),je=P("离线"),ze=P("查看变量"),Se=P("编辑"),Pe=be((()=>I("div",null,"无数据",-1))),Ue={class:"pagination"},Oe={class:"dialog-content"},Me={class:"dialog-footer"},Re=P("取消"),He=P("保存"),Ee=P("选择文件"),qe=be((()=>I("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),Ae={class:"dialog-footer"},Be=P("取消"),Je=P("上传"),We={class:"dialog-content",style:{"min-height":"280px"}},Ke=P("全部"),Ge=P("在线"),Qe=P("离线"),Xe={class:"dialog-footer"},Ye=P("取消"),Ze=P("筛选");var $e=b({setup(b){const z=v(),S=D({headerCellStyle:{background:y.primaryColor,color:y.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,deviceTableData:[],screenData:[],deviceTotal:0,deviceOnline:0,dFlag:!1,dTitle:"添加设备",deviceInfo:"",deviceForm:{interfaceName:"",name:"",label:"",addr:"",tsl:""},deviceRules:{interfaceName:[{required:!0,validator:"采集接口不能为空",trigger:"blur"}],name:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],label:[{required:!0,message:"设备标签不能为空",trigger:"blur"}],addr:[{required:!0,message:"通信地址不能为空",trigger:"blur"}],tsl:[{required:!0,message:"物模型不能为空",trigger:"blur"}]},deviceModelList:[],selectedDevices:[],idFlag:!0,uFlag:!1,commStatusOptions:[{label:"全部",value:"Line"},{label:"在线",value:"onLine"},{label:"离线",value:"offLine"}],sFlag:!1,screenForm:{name:"",label:"",tsl:"",commStatus:"Line",collInterfaceName:[],addr:""},interfaceList:[],interfaces:[],checkedInterfaceList:[],collDeviceObj:{}}),P=()=>{S.idFlag=!0,O()};(()=>{const e={token:z.token,data:{}};C.getInterfaceList(e).then((e=>{e&&("0"===e.code?(S.interfaceList=e.data,S.interfaces=[],S.interfaceList.forEach((e=>{S.interfaces.push(e.collInterfaceName),S.checkedInterfaceList.push(e.collInterfaceName)})),O()):re(e))}))})();const U=w(null),O=a=>{const l={token:z.token,data:{names:S.checkedInterfaceList}};C.getAllCollDevices(l).then((async l=>{console.log("getCollDevices -> res",l),l&&("0"===l.code?(S.deviceTableData=null==l.data.node?[]:l.data.node,S.screenData=S.deviceTableData,S.deviceTotal=l.data.commTotalCnt,S.deviceOnline=l.data.commSuccessCnt,1===a&&e({type:"success",message:"刷新成功！"})):re(l),await M((()=>{S.tableMaxHeight=U.value.clientHeight-34-36-22})))}))};(()=>{const e={token:z.token,data:{}};_.getDeviceModelList(e).then((e=>{console.log("getDeviceModelList -> res",e),"0"===e.code?S.deviceModelList=e.data:re(e)}))})();const q=e=>{S.selectedDevices=e},A=e=>{S.currentPage=e},B=x((()=>S.screenData.slice((S.currentPage-1)*S.pagesize,S.currentPage*S.pagesize))),K=x((()=>S.screenData)),G=e=>{S.pagesize=e},Q=e=>{S.dFlag=!0,S.dTitle="编辑设备",S.deviceForm={interfaceName:e.collInterfaceName,name:e.name,label:e.label,addr:e.addr,tsl:e.tsl}},X=w(null),Y=()=>{S.dFlag=!1,X.value.resetFields(),$()},Z=e=>{Y()},$=()=>{S.deviceForm={interfaceName:"",name:"",label:"",addr:"",tsl:""}},ee=async a=>{const l={token:z.token,data:{interfaceName:a,deviceNames:S.collDeviceObj[a]}};await C.deleteCollDevices(l).then((l=>{"0"===l.code?(l.message=a+l.message,de(l,O)):e({type:"error",message:l.message})}))},ae=()=>{te.value&&te.value.submit()},le=e=>{},te=w(null),oe=e=>{te.value.clearFiles();const a=e[0];te.value.handleStart(a)},ne=a=>{console.log("beforeUpload -> file",a);let l=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(a.type)||""!=a.name&&a.name.indexOf("xlsx")>-1;if(l){if(l){let l=new FormData;l.append("name",""),l.append("fileName",a);const t={token:z.token,contentType:"multipart/form-data",data:l};C.addDeviceFromCSV(t).then((a=>{"0"===a.code?(e.success(a.message),S.uFlag=!1,O()):re(a)}))}}else e({type:"error",message:"文件格式不正确,必须是xlsx文件！"})},ce=()=>{S.uFlag=!1,te.value.clearFiles()},ie=()=>{ce()},se=()=>{S.screenForm={name:"",tsl:"",label:"",commStatus:"Line",collInterfaceName:[],addr:""}},re=a=>{e({type:"error",message:a.message})},de=(a,l)=>{e({type:"0"===a.code?"success":"error",message:a.message}),"0"===a.code&&l&&l()};return(b,v)=>{const y=F("Icon"),_=a,D=l,w=o,x=i,M=n,$=c,pe=t,ue=r,me=d,fe=p,ge=u,be=s,$e=m,ea=f,aa=g;return k(),V("div",ve,[N(S).idFlag?(k(),V("div",ye,[I("div",_e,[I("div",Ce,[T(D,{type:"success",bg:"",onClick:v[0]||(v[0]=e=>{S.sFlag=!0})},{default:L((()=>[T(_,{class:"btn-icon"},{default:L((()=>[T(y,{name:"el-icon-Menu",size:"14px",color:"#ffffff"})])),_:1}),De])),_:1})]),I("div",null,[T(D,{type:"primary",plain:"",class:"right-btn",onClick:v[1]||(v[1]=e=>{S.uFlag=!0})},{default:L((()=>[T(_,{class:"el-input__icon"},{default:L((()=>[T(N(J))])),_:1}),we])),_:1}),T(D,{type:"primary",plain:"",class:"right-btn",onClick:v[2]||(v[2]=e=>(()=>{console.log("exportDevice interfaces => ",S.interfaces);const e={token:z.token,responseType:"blob",data:{names:S.interfaces}};C.exportDevice(e).then((e=>{if(e&&"1"===e.code)return void re(e);const a=new Blob([e.blob]),l=e.fileName,t=document.createElement("a");t.download=l,t.style.display="none",t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t)}))})())},{default:L((()=>[T(_,{class:"el-input__icon"},{default:L((()=>[T(N(W))])),_:1}),xe])),_:1}),T(D,{type:"primary",bg:"",class:"right-btn",onClick:v[3]||(v[3]=e=>(S.dFlag=!0,void(S.dTitle="添加设备")))},{default:L((()=>[T(_,{class:"btn-icon"},{default:L((()=>[T(y,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),Fe])),_:1}),T(D,{type:"primary",bg:"",class:"right-btn",onClick:v[4]||(v[4]=a=>(()=>{if(0!==S.selectedDevices.length){let a=0;S.selectedDevices.forEach((l=>{console.log("allCollect -> item = ",l);const t={token:z.token,data:{collInterfaceName:l.collInterfaceName,deviceName:l.name}};C.getDeviceDataReal(t).then((t=>{a++,"0"===t.code?e.success(l.label+"：采集成功！"):re(t),a===S.selectedDevices.length&&O(1)}))}))}else e.info("请至少选择一个设备！")})())},{default:L((()=>[T(_,{class:"btn-icon"},{default:L((()=>[T(y,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),ke])),_:1}),T(D,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:v[5]||(v[5]=e=>{O(1)})},{default:L((()=>[T(_,{class:"btn-icon"},{default:L((()=>[T(y,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),Ve])),_:1}),T(D,{type:"danger",bg:"",class:"right-btn",onClick:v[6]||(v[6]=a=>{0!==S.selectedDevices.length?(S.collDeviceObj={},console.log("ctxData.selectedDevices = ",S.selectedDevices),S.selectedDevices.forEach((e=>{null==S.collDeviceObj[e.collInterfaceName]?(S.collDeviceObj[e.collInterfaceName]=[],S.collDeviceObj[e.collInterfaceName].push(e.name)):S.collDeviceObj[e.collInterfaceName].push(e.name)})),h.confirm("确定要删除这些吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{let e=Object.getOwnPropertyNames(S.collDeviceObj).length;for(var a in console.log("cdList",e),S.collDeviceObj)ee(a)})).catch((a=>{console.log(a),e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个设备！")})},{default:L((()=>[T(_,{class:"btn-icon"},{default:L((()=>[T(y,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),Ie])),_:1})])]),I("div",Te,[I("div",null,[I("span",Le,"设备总数："+j(N(S).deviceTotal),1),I("span",null,"在线："+j(N(S).deviceOnline),1)])]),I("div",{class:"content",ref_key:"contentRef",ref:U,style:{top:"136px"}},[T(M,{data:N(B),"cell-style":N(S).cellStyle,"header-cell-style":N(S).headerCellStyle,"max-height":N(S).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:q,onRowDblclick:Q},{empty:L((()=>[Pe])),default:L((()=>[T(w,{type:"selection",width:"55",fixed:"left"}),T(w,{prop:"name",label:"设备名称",width:"auto","min-width":"160",align:"center",fixed:"left"}),T(w,{prop:"label",label:"设备标签",width:"auto","min-width":"160",align:"center"}),T(w,{prop:"tsl",label:"设备模型",width:"auto","min-width":"160",align:"center"}),T(w,{prop:"collInterfaceName",label:"采集接口",width:"auto","min-width":"160",align:"center"}),T(w,{prop:"addr",label:"通讯地址",width:"auto","min-width":"100",align:"center"}),T(w,{label:"当前通信状态",width:"auto","min-width":"150",align:"center"},{default:L((e=>["onLine"===e.row.commStatus?(k(),R(x,{key:0,type:"success"},{default:L((()=>[Ne])),_:1})):(k(),R(x,{key:1,type:"danger"},{default:L((()=>[je])),_:1}))])),_:1}),T(w,{prop:"lastCommRTC",label:"最后通信时间",width:"auto","min-width":"200",align:"center"}),T(w,{prop:"commTotalCnt",label:"通信总次数",width:"auto","min-width":"150",align:"center"}),T(w,{prop:"commSuccessCnt",label:"通信成功次数",width:"auto","min-width":"150",align:"center"}),T(w,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:L((e=>[T(D,{onClick:a=>{return l=e.row,S.idFlag=!1,void(S.curDevice=l);var l},text:"",type:"success"},{default:L((()=>[ze])),_:2},1032,["onClick"]),T(D,{onClick:a=>Q(e.row),text:"",type:"primary"},{default:L((()=>[Se])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),I("div",Ue,[T($,{"current-page":N(S).currentPage,"page-size":N(S).pagesize,"page-sizes":[20,50,200,500],total:N(K).length,onCurrentChange:A,onSizeChange:G,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):(k(),R(he,{key:1,curDevice:N(S).curDevice,onChangeIdFlag:P},null,8,["curDevice"])),T(be,{modelValue:N(S).dFlag,"onUpdate:modelValue":v[14]||(v[14]=e=>N(S).dFlag=e),title:N(S).dTitle,width:"600px","before-close":Z,"close-on-click-modal":!1},{footer:L((()=>[I("span",Me,[T(D,{onClick:v[12]||(v[12]=e=>Y())},{default:L((()=>[Re])),_:1}),T(D,{type:"primary",onClick:v[13]||(v[13]=e=>{X.value.validate((e=>{if(!e)return!1;{const e={token:z.token,data:S.deviceForm};S.dTitle.includes("添加")?C.addCollDevice(e).then((e=>{de(e,O),Y()})):C.editCollDevice(e).then((e=>{de(e,O),Y()}))}}))})},{default:L((()=>[He])),_:1})])])),default:L((()=>[I("div",Oe,[T(ge,{model:N(S).deviceForm,rules:N(S).deviceRules,ref_key:"deviceFormRef",ref:X,"status-icon":"","label-position":"right","label-width":"100px"},{default:L((()=>[T(ue,{label:"设备名称",prop:"name"},{default:L((()=>[T(pe,{disabled:N(S).dTitle.includes("编辑"),type:"text",modelValue:N(S).deviceForm.name,"onUpdate:modelValue":v[7]||(v[7]=e=>N(S).deviceForm.name=e),autocomplete:"off",placeholder:"请输入设备名称"},null,8,["disabled","modelValue"])])),_:1}),T(ue,{label:"设备标签",prop:"label"},{default:L((()=>[T(pe,{type:"text",modelValue:N(S).deviceForm.label,"onUpdate:modelValue":v[8]||(v[8]=e=>N(S).deviceForm.label=e),autocomplete:"off",placeholder:"请输入设备标签"},null,8,["modelValue"])])),_:1}),T(ue,{label:"设备模型",prop:"tsl"},{default:L((()=>[T(fe,{modelValue:N(S).deviceForm.tsl,"onUpdate:modelValue":v[9]||(v[9]=e=>N(S).deviceForm.tsl=e),style:{width:"100%"},placeholder:"请选择设备模型"},{default:L((()=>[(k(!0),V(H,null,E(N(S).deviceModelList,((e,a)=>(k(),R(me,{key:"dm_"+a,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(ue,{label:"采集接口",prop:"interfaceName"},{default:L((()=>[T(fe,{modelValue:N(S).deviceForm.interfaceName,"onUpdate:modelValue":v[10]||(v[10]=e=>N(S).deviceForm.interfaceName=e),clearable:"",style:{width:"100%"},placeholder:"请选择采集接口"},{default:L((()=>[(k(!0),V(H,null,E(N(S).interfaceList,((e,a)=>(k(),R(me,{key:"in_"+a,label:e.collInterfaceName,value:e.collInterfaceName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(ue,{label:"通讯地址",prop:"addr"},{default:L((()=>[T(pe,{type:"text",modelValue:N(S).deviceForm.addr,"onUpdate:modelValue":v[11]||(v[11]=e=>N(S).deviceForm.addr=e),autocomplete:"off",placeholder:"请输入通讯地址"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),T(be,{modelValue:N(S).uFlag,"onUpdate:modelValue":v[15]||(v[15]=e=>N(S).uFlag=e),title:"上传设备xlsx文件",width:"600px","before-close":ie,"close-on-click-modal":!1},{footer:L((()=>[I("span",Ae,[T(D,{onClick:ce},{default:L((()=>[Be])),_:1}),T(D,{type:"primary",onClick:ae},{default:L((()=>[Je])),_:1})])])),default:L((()=>[T($e,{ref_key:"uploadRef",ref:te,action:"","auto-upload":!1,"http-request":le,limit:1,"on-exceed":oe,"before-upload":ne},{tip:L((()=>[qe])),default:L((()=>[T(D,{type:"primary"},{default:L((()=>[Ee])),_:1})])),_:1},512)])),_:1},8,["modelValue"]),T(be,{modelValue:N(S).sFlag,"onUpdate:modelValue":v[24]||(v[24]=e=>N(S).sFlag=e),title:"筛选设备",width:"400px"},{footer:L((()=>[I("span",Xe,[T(D,{onClick:v[22]||(v[22]=e=>(S.sFlag=!1,void se()))},{default:L((()=>[Ye])),_:1}),T(D,{type:"primary",onClick:v[23]||(v[23]=e=>(console.log("doScreen ctxData.deviceTableData = ",S.deviceTableData),console.log("doScreen ctxData.screenForm = ",S.screenForm),S.screenData=[],S.deviceTotal=0,S.deviceOnline=0,S.deviceTableData.forEach((e=>{var a=e.name.includes(S.screenForm.name),l=e.label.includes(S.screenForm.label),t=e.addr.includes(S.screenForm.addr),o=""===S.screenForm.tsl||e.tsl==S.screenForm.tsl,n=0===S.screenForm.collInterfaceName.length||S.screenForm.collInterfaceName.includes(e.collInterfaceName),c="Line"===S.screenForm.commStatus||e.commStatus.includes(S.screenForm.commStatus);a&&l&&t&&o&&n&&c&&(S.screenData.push(e),"onLine"==e.commStatus&&S.deviceOnline++,S.deviceTotal++)})),void(S.sFlag=!1)))},{default:L((()=>[Ze])),_:1})])])),default:L((()=>[I("div",We,[T(ge,{model:N(S).screenForm,ref:"screenFormRef","status-icon":"","label-position":"right","label-width":"100px"},{default:L((()=>[T(ue,{label:"设备名称",prop:"name"},{default:L((()=>[T(pe,{type:"text",modelValue:N(S).screenForm.name,"onUpdate:modelValue":v[16]||(v[16]=e=>N(S).screenForm.name=e),autocomplete:"off",placeholder:"请输入设备名称"},null,8,["modelValue"])])),_:1}),T(ue,{label:"设备标签",prop:"label"},{default:L((()=>[T(pe,{type:"text",modelValue:N(S).screenForm.label,"onUpdate:modelValue":v[17]||(v[17]=e=>N(S).screenForm.label=e),autocomplete:"off",placeholder:"请输入设备标签"},null,8,["modelValue"])])),_:1}),T(ue,{label:"设备地址",prop:"addr"},{default:L((()=>[T(pe,{type:"text",modelValue:N(S).screenForm.addr,"onUpdate:modelValue":v[18]||(v[18]=e=>N(S).screenForm.addr=e),autocomplete:"off",placeholder:"请输入设备地址"},null,8,["modelValue"])])),_:1}),T(ue,{label:"设备模型",prop:"tsl"},{default:L((()=>[T(fe,{modelValue:N(S).screenForm.tsl,"onUpdate:modelValue":v[19]||(v[19]=e=>N(S).screenForm.tsl=e),clearable:"",style:{width:"100%"},placeholder:"请选择设备模型"},{default:L((()=>[(k(!0),V(H,null,E(N(S).deviceModelList,((e,a)=>(k(),R(me,{key:"dm_"+a,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(ue,{label:"采集接口",prop:"collInterfaceName"},{default:L((()=>[T(fe,{modelValue:N(S).screenForm.collInterfaceName,"onUpdate:modelValue":v[20]||(v[20]=e=>N(S).screenForm.collInterfaceName=e),clearable:"",style:{width:"100%"},placeholder:"请选择采集接口",multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:L((()=>[(k(!0),V(H,null,E(N(S).interfaceList,((e,a)=>(k(),R(me,{key:"cin_"+a,label:e.collInterfaceName,value:e.collInterfaceName},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),T(ue,{label:"通信状态"},{default:L((()=>[T(aa,{modelValue:N(S).screenForm.commStatus,"onUpdate:modelValue":v[21]||(v[21]=e=>N(S).screenForm.commStatus=e)},{default:L((()=>[T(ea,{label:"Line"},{default:L((()=>[Ke])),_:1}),T(ea,{label:"onLine"},{default:L((()=>[Ge])),_:1}),T(ea,{label:"offLine"},{default:L((()=>[Qe])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-1b01d589"]]);export{$e as default};
