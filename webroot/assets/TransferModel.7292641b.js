import{g as e,O as a,L as l,e as t,p as o,n as r,o as p,m as n,A as s,C as i,D as d,w as m,K as c,q as u,M as f,v as y}from"./element-plus.3300f756.js";import{_ as g,u as h,v as b}from"./index.f61f902c.js";import{T as x}from"./transferModel.573073ff.js";import{D as F}from"./deviceModel.7d24566f.js";import{b as _,d as v}from"./@element-plus.0bef5fa5.js";import{K as w,f as C,k,af as V,o as P,c as M,a as L,P as A,S as T,u as N,W as z,X as j,Q as D,ak as U,T as S,Y as R,V as q,n as I,aw as H,ax as O}from"./@vue.73d14ebc.js";import"./lodash-es.98e49362.js";import"./async-validator.fb49d0f5.js";import"./@vueuse.3d90a471.js";import"./dayjs.2790329b.js";import"./axios.765908e4.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./vue-router.43b9a342.js";import"./pinia.3f4aff4f.js";import"./vue-demi.b3a9cad9.js";import"./screenfull.7cf96174.js";import"./vue-echarts.7828944a.js";import"./resize-detector.4e96b72b.js";import"./echarts.2b8dcc79.js";import"./zrender.54f191d6.js";import"./tslib.60310f1a.js";import"./nprogress.aae2b787.js";const B=e=>(H("data-v-6b9f16fe"),e=e(),O(),e),E={class:"main-container"},W={class:"main"},K={class:"search-bar"},Q={class:"search-bar",style:{display:"flex"}},X={class:"title",style:{position:"relative","margin-right":"40px",height:"40px",padding:"0px 0","justify-content":"flex-start"}},Y={class:"tName"},G={class:"param-content"},J={class:"pc-title"},Z={class:"pct-info"},$={class:"pc-content"},ee={class:"param-value"},ae={class:"param-name"},le=B((()=>L("div",null,"无数据",-1))),te={class:"pagination"},oe={class:"dialog-content"},re={class:"dialog-footer"},pe=B((()=>L("div",{class:"el-upload__tip"},"只能上传一个文件，只支持xlsx格式文件！",-1))),ne={class:"dialog-footer"},se={class:"dialog-content",style:{"min-height":"408px",overflow:"unset",padding:"0"}},ie={class:"dialog-content-head"},de={class:"dialog-content-content"},me={class:"pagination dialog-pagination"},ce={class:"dialog-footer"};var ue=g({__name:"ModelProperty",props:{curTransferModel:{type:Object,default:{}}},emits:["changeTmFlag"],setup(g,{emit:H}){const O=g,B=h();console.log("id -> props",O);const ue=w({headerCellStyle:{background:b.primaryColor,color:b.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:20,PropertyTableData:[],pFlag:!1,pTitle:"添加属性",PropertyInfo:"",propertyForm:{name:"",label:"",uploadName:"",type:0,min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,unit:"",decimals:0,dataLength:"",dataLengthAlarm:!1},typeOptions:[{label:"uint32",value:0},{label:"int32",value:1},{label:"double",value:2},{label:"string",value:3}],typeNames:{t0:"uint32",t1:"int32",t2:"double",t3:"string"},paramName:{name:"属性名称",label:"属性标签",uploadName:"上报属性名称",type:"数据类型",min:"最小值",max:"最大值",minMaxAlarm:"范围报警",step:"步长",stepAlarm:"步长报警",unit:"单位",decimals:"小数位数",dataLength:"字符串长度",dataLengthAlarm:"字符串长度报警"},propertyRules:{name:[{required:!0,message:"属性名称不能为空",trigger:"blur"}],label:[{required:!0,message:"属性标签不能为空",trigger:"blur"}],uploadName:[{required:!0,message:"上报属性名称不能为空",trigger:"blur"}],type:[{required:!0,message:"数据类型不能为空",trigger:"blur"}],decimals:[{type:"number",message:"小数位数只能输入数字"}]},psFlag:!1,selectedProperties:[],collDeviceModelList:[],curCollName:"",selectList:[],AllPropertyNameList:[],pName:"",pTableData:[],pHeadStyle:{color:b.headerTextColor,borderColor:"#C0C4CC",height:"48px"},pCellStyle:{borderColor:"#C0C4CC",height:"48px"},pCurrentPage:1,pPagesize:5}),fe=C(null),ye=a=>{const l={token:B.token,data:{name:O.curTransferModel.name}};x.getPropertiesByModelIdList(l).then((async l=>{console.log("getPropertiesByModelIdList -> res",l),l&&("0"===l.code?(ue.PropertyTableData=l.data,ue.AllPropertyNameList=[],ue.PropertyTableData.forEach((e=>{ue.AllPropertyNameList.push(e.name)})),console.log("AllPropertyNameList ->",ue.AllPropertyNameList),1===a&&e({type:"success",message:"刷新成功！"})):Ue(l),await I((()=>{ue.tableMaxHeight=fe.value.clientHeight-34-36-132})))}))};ye();const ge=k((()=>{let e=ue.PropertyInfo;return ue.PropertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase()))).slice((ue.currentPage-1)*ue.pagesize,ue.currentPage*ue.pagesize)})),he=k((()=>{let e=ue.PropertyInfo;return ue.PropertyTableData.filter((a=>!e||a.name.toLowerCase().includes(e.toLowerCase())||a.label.toLowerCase().includes(e.toLowerCase())))})),be=e=>{ue.currentPage=e},xe=e=>{ue.pagesize=e},Fe=()=>{const e={token:B.token,data:{name:ue.curCollName}};F.getDeviceModelProperty(e).then((e=>{console.log("getDeviceModelProperty -> res",e),"0"===e.code?ue.pTableData=e.data:(ue.pTableData=[],Ue(e))}))},_e=e=>{ue.selectList=e},ve=()=>{ue.plFlag=!0,(()=>{const e={token:B.token,data:{}};F.getDeviceModelList(e).then((e=>{console.log("getDeviceModelList -> res = ",e),"0"===e.code?(ue.collDeviceModelList=e.data,e.data.length>0&&(ue.curCollName=e.data[0].name),Fe()):Ue(e)}))})()},we=()=>{Fe()},Ce=e=>{ue.pCurrentPage=e},ke=e=>{ue.pPagesize=e},Ve=e=>!ue.AllPropertyNameList.includes(e.name),Pe=async()=>{const l=a.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});if(console.log("saveProperties"),ue.selectList.length>0){let a=[];ue.selectList.map((e=>{let l={};l.name=e.name,l.label=e.label,l.uploadName=e.name,l.type=e.type,l.decimals=e.decimals,l.unit=e.unit;let t={};3!==e.type?(t.min="",t.max="",t.minMaxAlarm=!1,t.step="",t.stepAlarm=!1):(t.dataLength="",t.dataLengthAlarm=!1),l.params=t,a.push(l)})),console.log("saveProperties -> properties",a);const t={token:B.token,data:{name:O.curTransferModel.name,property:a}},o=await x.addProperties(t),r=a.length;if(o.data==r)l.close(),Se(o,ye),Me();else if(o.data){l.close();let a=o.data+"个添加成功，"+(r-o.data)+"个添加失败";e({type:"error",message:a}),we()}else{l.close(),e({type:"error",message:"添加失败"}),we()}}},Me=()=>{ue.plFlag=!1},Le=e=>{Me()},Ae=e=>{ue.pFlag=!0,ue.pTitle="编辑属性",ue.propertyForm.name=e.name,ue.propertyForm.label=e.label,ue.propertyForm.uploadName=e.uploadName,console.log("editProperty -> row ",e),ue.propertyForm.type=e.type,ue.propertyForm.decimals=e.decimals,ue.propertyForm.unit=e.unit,3!==e.type?(ue.propertyForm.min=e.params.min,ue.propertyForm.max=e.params.max,ue.propertyForm.minMaxAlarm=e.params.minMaxAlarm,ue.propertyForm.step=e.params.step,ue.propertyForm.stepAlarm=e.params.stepAlarm):(ue.propertyForm.dataLength=e.params.dataLength,ue.propertyForm.dataLengthAlarm=e.params.dataLengthAlarm),console.log("ctxData.propertyForm",ue.propertyForm)},Te=C(null),Ne=()=>{ue.pFlag=!1,Te.value.resetFields(),De()},ze=e=>{Ne()},je=e=>{ue.selectedProperties=e,console.log("handleSelectionChange -> val =",e)},De=()=>{ue.propertyForm={name:"",label:"",type:0,min:"",max:"",minMaxAlarm:!1,step:"",stepAlarm:!1,unit:"",decimals:0,dataLength:"",dataLengthAlarm:!1}},Ue=a=>{e({type:"error",message:a.message})},Se=(a,l)=>{e({type:"0"===a.code?"success":"error",message:a.message}),"0"===a.code&&l&&l()};return(a,g)=>{const h=t,F=o,w=r,C=p,k=n,I=V("Icon"),Fe=s,De=i,Ue=d,Re=y,qe=m,Ie=c,He=u,Oe=f;return P(),M("div",E,[L("div",W,[L("div",K,[A(C,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:T((()=>[A(w,{style:{"margin-left":"20px"}},{default:T((()=>[A(F,{type:"primary",plain:"",onClick:g[0]||(g[0]=e=>{H("changeTmFlag")}),style:{"margin-right":"20px"}},{default:T((()=>[A(h,{class:"el-input__icon"},{default:T((()=>[A(N(_))])),_:1}),z(" 返回上报模型 ")])),_:1})])),_:1})])),_:1},512)]),L("div",Q,[L("div",X,[L("div",Y,j(O.curTransferModel.label),1)]),A(C,{inline:!0,ref:"searchFormRef2","status-icon":"","label-width":"90px"},{default:T((()=>[A(w,{label:""},{default:T((()=>[A(k,{style:{width:"200px"},placeholder:"请输入属性名称或者标签",clearable:"",modelValue:N(ue).PropertyInfo,"onUpdate:modelValue":g[1]||(g[1]=e=>N(ue).PropertyInfo=e)},{prefix:T((()=>[A(h,{class:"el-input__icon"},{default:T((()=>[A(N(v))])),_:1})])),_:1},8,["modelValue"])])),_:1}),A(w,null,{default:T((()=>[A(F,{type:"primary",bg:"",class:"right-btn",onClick:g[2]||(g[2]=e=>(console.log("addDeviceModelProperty"),ue.pFlag=!0,void(ue.pTitle="添加属性")))},{default:T((()=>[A(h,{class:"btn-icon"},{default:T((()=>[A(I,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),z(" 手动添加 ")])),_:1})])),_:1}),A(w,null,{default:T((()=>[A(F,{type:"primary",bg:"",class:"right-btn",onClick:g[3]||(g[3]=e=>ve())},{default:T((()=>[A(h,{class:"btn-icon"},{default:T((()=>[A(I,{name:"local-tongbu",size:"14px",color:"#ffffff"})])),_:1}),z(" 同步 ")])),_:1})])),_:1}),A(w,null,{default:T((()=>[A(F,{type:"danger",bg:"",class:"right-btn",onClick:g[4]||(g[4]=a=>(()=>{let a=[];0!==ue.selectedProperties.length?(ue.selectedProperties.forEach((e=>{a.push(e.name)})),console.log("pList",a),l.confirm("确认要删除这些属性吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:B.token,data:{name:O.curTransferModel.name,properties:a}};x.deleteProperty(e).then((e=>{Se(e,ye)}))})).catch((()=>{e({type:"info",message:"取消删除"})}))):e.info("请至少选择一个属性！")})())},{default:T((()=>[A(h,{class:"btn-icon"},{default:T((()=>[A(I,{name:"local-delete",size:"14px",color:"#ffffff"})])),_:1}),z(" 删除 ")])),_:1})])),_:1}),A(w,null,{default:T((()=>[A(F,{style:{color:"#fff"},color:"#2EA554",class:"right-btn",onClick:g[5]||(g[5]=e=>{ye(1)})},{default:T((()=>[A(h,{class:"btn-icon"},{default:T((()=>[A(I,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),z(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),L("div",{class:"content",ref_key:"contentRef",ref:fe,style:{top:"136px"}},[A(De,{data:N(ge),"cell-style":N(ue).cellStyle,"header-cell-style":N(ue).headerCellStyle,"max-height":N(ue).tableMaxHeight,style:{width:"100%"},stripe:"",onSelectionChange:je,onRowDblclick:Ae},{empty:T((()=>[le])),default:T((()=>[A(Fe,{type:"selection",width:"55"}),A(Fe,{type:"expand"},{default:T((e=>[L("div",G,[L("div",J,[L("div",Z,[L("b",null,j(e.row.name),1),z(" "+j("参数详情"))])]),L("div",$,[(P(!0),M(D,null,U(e.row.params,((e,a,l)=>(P(),M("div",{class:"param-item",key:l},[L("div",ee,j(N(ue).paramName[a])+"：",1),L("div",ae,j("boolean"==typeof e?e?"是":"否":e||"-"),1)])))),128))])])])),_:1}),A(Fe,{sortable:"",prop:"name",label:"属性名称",width:"auto","min-width":"180",align:"center"}),A(Fe,{sortable:"",prop:"label",label:"属性标签",width:"auto","min-width":"180",align:"center"}),A(Fe,{sortable:"",prop:"uploadName",label:"上报属性名称",width:"auto","min-width":"180",align:"center"}),A(Fe,{sortable:"",label:"数据类型",width:"auto","min-width":"100",align:"center"},{default:T((e=>[z(j(N(ue).typeNames["t"+e.row.type]),1)])),_:1}),A(Fe,{sortable:"",label:"小数位数",width:"auto","min-width":"80",align:"center"},{default:T((e=>[z(j(void 0===e.row.decimals||""===e.row.decimals?0:e.row.decimals),1)])),_:1}),A(Fe,{sortable:"",prop:"unit",label:"单位",width:"auto","min-width":"80",align:"center"}),A(Fe,{label:"操作",width:"auto","min-width":"150",align:"center",fixed:"right"},{default:T((e=>[A(F,{onClick:a=>Ae(e.row),text:"",type:"primary"},{default:T((()=>[z("编辑")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",te,[A(Ue,{"current-page":N(ue).currentPage,"page-size":N(ue).pagesize,"page-sizes":[20,50,200,500],total:N(he).length,onCurrentChange:be,onSizeChange:xe,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512),A(He,{modelValue:N(ue).pFlag,"onUpdate:modelValue":g[21]||(g[21]=e=>N(ue).pFlag=e),title:N(ue).pTitle,width:"600px","before-close":ze,"close-on-click-modal":!1},{footer:T((()=>[L("span",re,[A(F,{onClick:g[19]||(g[19]=e=>Ne())},{default:T((()=>[z("取消")])),_:1}),A(F,{type:"primary",onClick:g[20]||(g[20]=e=>{Te.value.validate((e=>{if(console.log("valid",e),!e)return!1;{let e={};e.name=ue.propertyForm.name,e.label=ue.propertyForm.label,e.uploadName=ue.propertyForm.uploadName,e.type=ue.propertyForm.type,e.decimals=ue.propertyForm.decimals,e.unit=ue.propertyForm.unit;let a={};3!==ue.propertyForm.type?(a.min=ue.propertyForm.min,a.max=ue.propertyForm.max,a.minMaxAlarm=ue.propertyForm.minMaxAlarm,a.step=ue.propertyForm.step,a.stepAlarm=ue.propertyForm.stepAlarm):(a.dataLength=ue.propertyForm.dataLength,a.dataLengthAlarm=ue.propertyForm.dataLengthAlarm),e.params=a,console.log("submitPorpertyForm -> property",e);const l={token:B.token,data:{name:O.curTransferModel.name,property:e}};ue.pTitle.includes("添加")?(console.log("添加属性"),x.addProperty(l).then((e=>{Se(e,ye),Ne()}))):(console.log("编辑属性"),x.editProperty(l).then((e=>{Se(e,ye),Ne()})))}}))})},{default:T((()=>[z("保存")])),_:1})])])),default:T((()=>[L("div",oe,[A(C,{model:N(ue).propertyForm,rules:N(ue).propertyRules,ref_key:"propertyFormRef",ref:Te,"status-icon":"","label-position":"right","label-width":"120px"},{default:T((()=>[A(w,{label:"属性名称",prop:"name"},{default:T((()=>[A(k,{disabled:N(ue).pTitle.includes("编辑"),type:"text",modelValue:N(ue).propertyForm.name,"onUpdate:modelValue":g[6]||(g[6]=e=>N(ue).propertyForm.name=e),autocomplete:"off",placeholder:"请输入属性名称"},null,8,["disabled","modelValue"])])),_:1}),A(w,{label:"属性标签",prop:"label"},{default:T((()=>[A(k,{type:"text",modelValue:N(ue).propertyForm.label,"onUpdate:modelValue":g[7]||(g[7]=e=>N(ue).propertyForm.label=e),autocomplete:"off",placeholder:"请输入属性标签"},null,8,["modelValue"])])),_:1}),A(w,{label:"上报属性名称",prop:"uploadName"},{default:T((()=>[A(k,{type:"text",modelValue:N(ue).propertyForm.uploadName,"onUpdate:modelValue":g[8]||(g[8]=e=>N(ue).propertyForm.uploadName=e),autocomplete:"off",placeholder:"请输入上报属性名称"},null,8,["modelValue"])])),_:1}),A(w,{label:"数据类型",prop:"type"},{default:T((()=>[A(qe,{modelValue:N(ue).propertyForm.type,"onUpdate:modelValue":g[9]||(g[9]=e=>N(ue).propertyForm.type=e),modelModifiers:{number:!0},style:{width:"100%"},placeholder:"请选择数据类型"},{default:T((()=>[(P(!0),M(D,null,U(N(ue).typeOptions,(e=>(P(),S(Re,{key:"type_"+e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),3!==N(ue).propertyForm.type?(P(),S(w,{key:0,label:"范围报警",prop:"minMaxAlarm"},{default:T((()=>[A(Ie,{modelValue:N(ue).propertyForm.minMaxAlarm,"onUpdate:modelValue":g[10]||(g[10]=e=>N(ue).propertyForm.minMaxAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):R("",!0),3!==N(ue).propertyForm.type&&N(ue).propertyForm.minMaxAlarm?(P(),S(w,{key:1,label:"最小值",prop:"min"},{default:T((()=>[A(k,{type:"text",modelValue:N(ue).propertyForm.min,"onUpdate:modelValue":g[11]||(g[11]=e=>N(ue).propertyForm.min=e),autocomplete:"off",placeholder:"请输入最小值"},null,8,["modelValue"])])),_:1})):R("",!0),3!==N(ue).propertyForm.type&&N(ue).propertyForm.minMaxAlarm?(P(),S(w,{key:2,label:"最大值",prop:"max"},{default:T((()=>[A(k,{type:"text",modelValue:N(ue).propertyForm.max,"onUpdate:modelValue":g[12]||(g[12]=e=>N(ue).propertyForm.max=e),autocomplete:"off",placeholder:"请输入最大值"},null,8,["modelValue"])])),_:1})):R("",!0),3!==N(ue).propertyForm.type?(P(),S(w,{key:3,label:"步长报警",prop:"stepAlarm"},{default:T((()=>[A(Ie,{modelValue:N(ue).propertyForm.stepAlarm,"onUpdate:modelValue":g[13]||(g[13]=e=>N(ue).propertyForm.stepAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):R("",!0),3!==N(ue).propertyForm.type&&N(ue).propertyForm.stepAlarm?(P(),S(w,{key:4,label:"步长",prop:"step"},{default:T((()=>[A(k,{type:"text",modelValue:N(ue).propertyForm.step,"onUpdate:modelValue":g[14]||(g[14]=e=>N(ue).propertyForm.step=e),autocomplete:"off",placeholder:"请输入步长"},null,8,["modelValue"])])),_:1})):R("",!0),2===N(ue).propertyForm.type?(P(),S(w,{key:5,label:"小数位数",prop:"decimals"},{default:T((()=>[A(k,{type:"text",modelValue:N(ue).propertyForm.decimals,"onUpdate:modelValue":g[15]||(g[15]=e=>N(ue).propertyForm.decimals=e),modelModifiers:{number:!0},autocomplete:"off",placeholder:"请输入小数位数"},null,8,["modelValue"])])),_:1})):R("",!0),3!==N(ue).propertyForm.type?(P(),S(w,{key:6,label:"单位",prop:"unit"},{default:T((()=>[A(k,{type:"text",modelValue:N(ue).propertyForm.unit,"onUpdate:modelValue":g[16]||(g[16]=e=>N(ue).propertyForm.unit=e),autocomplete:"off",placeholder:"请输入单位"},null,8,["modelValue"])])),_:1})):R("",!0),3===N(ue).propertyForm.type?(P(),S(w,{key:7,label:"字符串长度报警",prop:"dataLengthAlarm"},{default:T((()=>[A(Ie,{modelValue:N(ue).propertyForm.dataLengthAlarm,"onUpdate:modelValue":g[17]||(g[17]=e=>N(ue).propertyForm.dataLengthAlarm=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1})):R("",!0),3===N(ue).propertyForm.type&&N(ue).propertyForm.dataLengthAlarm?(P(),S(w,{key:8,label:"字符串长度",prop:"dataLength"},{default:T((()=>[A(k,{type:"text",modelValue:N(ue).propertyForm.dataLength,"onUpdate:modelValue":g[18]||(g[18]=e=>N(ue).propertyForm.dataLength=e),autocomplete:"off",placeholder:"请输入字符串长度"},null,8,["modelValue"])])),_:1})):R("",!0)])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"]),A(He,{modelValue:N(ue).psFlag,"onUpdate:modelValue":g[22]||(g[22]=e=>N(ue).psFlag=e),title:"导入属性",width:"600px","before-close":a.beforeCloseUploadProperty,"close-on-click-modal":!1},{footer:T((()=>[L("span",ne,[A(F,{onClick:a.cancelUploadProperty},{default:T((()=>[z("取消")])),_:1},8,["onClick"]),A(F,{type:"primary",onClick:a.submitUploadProperty},{default:T((()=>[z("上传")])),_:1},8,["onClick"])])])),default:T((()=>[A(Oe,{ref:"uploadPropertyRef",action:"","auto-upload":!1,"http-request":a.myRequestProperty,limit:1,"on-exceed":a.handleExceedProperty,"before-upload":a.beforeUploadProperty},{tip:T((()=>[pe])),default:T((()=>[A(F,{type:"primary"},{default:T((()=>[z("选择文件")])),_:1})])),_:1},8,["http-request","on-exceed","before-upload"])])),_:1},8,["modelValue","before-close"]),A(He,{title:"同步采集属性",modelValue:N(ue).plFlag,"onUpdate:modelValue":g[26]||(g[26]=e=>N(ue).plFlag=e),width:"1000px","before-close":Le,"close-on-click-modal":!1},{footer:T((()=>[L("span",ce,[A(F,{onClick:Me},{default:T((()=>[z("取消")])),_:1}),A(F,{type:"primary",onClick:Pe},{default:T((()=>[z("保存")])),_:1})])])),default:T((()=>[L("div",se,[L("div",ie,[A(qe,{modelValue:N(ue).curCollName,"onUpdate:modelValue":g[23]||(g[23]=e=>N(ue).curCollName=e),placeholder:"请选择采集模型",onChange:g[24]||(g[24]=e=>we())},{default:T((()=>[(P(!0),M(D,null,U(N(ue).collDeviceModelList,(e=>(P(),S(Re,{key:e.name,label:e.label,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),A(k,{placeholder:"请输入属性名称或者标签",style:{width:"200px"},clearable:"",modelValue:N(ue).pName,"onUpdate:modelValue":g[25]||(g[25]=e=>N(ue).pName=e)},{prefix:T((()=>[A(h,{class:"el-input__icon"},{default:T((()=>[A(N(v))])),_:1})])),_:1},8,["modelValue"])]),L("div",de,[A(De,{data:N(ue).pTableData.filter((e=>!N(ue).pName||e.name.includes(N(ue).pName)||e.label.includes(N(ue).pName))).slice((N(ue).pCurrentPage-1)*N(ue).pPagesize,N(ue).pCurrentPage*N(ue).pPagesize),"header-cell-style":N(ue).pHeadStyle,"cell-style":N(ue).pCellStyle,style:{border:"1px solid #c0c4cc"},"max-height":"290",onSelectionChange:_e,stripe:""},{default:T((()=>[A(Fe,{type:"selection",width:"60",selectable:Ve}),A(Fe,{prop:"name",label:"属性名称","min-width":"200",width:"auto",align:"center"}),A(Fe,{prop:"label",label:"属性标签","min-width":"200",width:"auto",align:"center"}),A(Fe,{label:"状态","min-width":"120",width:"auto",align:"center"},{default:T((e=>[L("span",{style:q({color:N(ue).AllPropertyNameList.includes(e.row.name)?N(b).successColor:N(b).dangerColor})},j(N(ue).AllPropertyNameList.includes(e.row.name)?"已选择":"未选择"),5)])),_:1})])),_:1},8,["data","header-cell-style","cell-style"]),L("div",me,[A(Ue,{"current-page":N(ue).pCurrentPage,"page-size":N(ue).pPagesize,"page-sizes":[5,20,50,200],total:N(ue).pTableData.length,onCurrentChange:Ce,onSizeChange:ke,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"22px"}},null,8,["current-page","page-size","total"])])])])])),_:1},8,["modelValue"])])])}}},[["__scopeId","data-v-6b9f16fe"]]);const fe={class:"main-container"},ye={key:0,class:"main"},ge={class:"search-bar"},he={class:"tool-bar"},be=(e=>(H("data-v-7c5934a5"),e=e(),O(),e))((()=>L("div",null,"无数据",-1))),xe={class:"pagination"},Fe={class:"dialog-content"},_e={class:"dialog-footer"};var ve=g({__name:"TransferModel",setup(a){const c=h(),f=C(null),g=w({headerCellStyle:{background:b.primaryColor,color:b.fontWhiteColor,height:"54px"},cellStyle:{height:"48px"},tableMaxHeight:0,currentPage:1,pagesize:10,transferName:"",transferTableData:[{name:"测试01",label:"测试01"}],isModel:!0,curTransferModel:null,tFlag:!1,tTitle:"添加上报模型",transferForm:{name:"",label:"",code:""},transferRules:{name:[{required:!0,message:"上报模型名称不能为空",trigger:"blur"}],label:[{required:!0,message:"上报模型标签不能为空",trigger:"blur"}],code:[{required:!0,message:"上报模型编号不能为空",trigger:"blur"}]},collectOptions:[]}),_=a=>{const l={token:c.token,data:{}};x.getModelList(l).then((async l=>{console.log("getModelList -> res",l),l&&("0"===l.code?(g.transferTableData=l.data,1===a&&e({type:"success",message:"刷新成功！"})):Q(l),await I((()=>{g.tableMaxHeight=f.value.clientHeight-34-36-22})))}))};_();(()=>{const e={token:c.token,data:{}};F.getDeviceModelList(e).then((e=>{e&&("0"===e.code?g.collectOptions=e.data:Q(e))}))})();const j=e=>{g.currentPage=e},R=e=>{g.pagesize=e},q=k((()=>g.transferTableData.filter((e=>!g.transferModelName||e.name.toLowerCase().includes(g.transferModelName.toLowerCase()))).slice((g.currentPage-1)*g.pagesize,g.currentPage*g.pagesize))),H=k((()=>g.transferTableData.filter((e=>!g.transferModelName||e.name.toLowerCase().includes(g.transferModelName.toLowerCase()))))),O=()=>{g.transferForm={name:"",label:"",code:""},g.tTitle="添加上报模型",g.tFlag=!0},B=e=>{g.tTitle="编辑上报模型",g.tFlag=!0,g.transferForm.name=e.name,g.transferForm.label=e.label,g.transferForm.code=e.code},E=C(null),W=()=>{g.tFlag=!1},K=()=>{W()},Q=a=>{e({type:"error",message:a.message})},X=(a,l)=>{e({type:"0"===a.code?"success":"error",message:a.message}),"0"===a.code&&l&&l()};return(a,h)=>{const b=t,F=n,w=r,C=V("Icon"),k=o,I=p,Q=s,Y=i,G=d,J=y,Z=m,$=u;return P(),M("div",fe,[N(g).isModel?(P(),M("div",ye,[L("div",ge,[A(I,{inline:!0,ref:"searchFormRef","status-icon":"","label-width":"120px"},{default:T((()=>[A(w,{label:"上报模型名称"},{default:T((()=>[A(F,{style:{width:"200px"},placeholder:"请输入上报模型名称",clearable:"",modelValue:N(g).transferModelName,"onUpdate:modelValue":h[0]||(h[0]=e=>N(g).transferModelName=e)},{prefix:T((()=>[A(b,{class:"el-input__icon"},{default:T((()=>[A(N(v))])),_:1})])),_:1},8,["modelValue"])])),_:1}),A(w,null,{default:T((()=>[A(k,{style:{color:"#fff","margin-left":"20px"},color:"#2EA554",class:"right-btn",onClick:h[1]||(h[1]=e=>{_(1)})},{default:T((()=>[A(b,{class:"btn-icon"},{default:T((()=>[A(C,{name:"local-refresh",size:"14px",color:"#ffffff"})])),_:1}),z(" 刷新 ")])),_:1})])),_:1})])),_:1},512)]),L("div",he,[A(k,{type:"primary",bg:"",class:"right-btn",onClick:h[2]||(h[2]=e=>O())},{default:T((()=>[A(b,{class:"btn-icon"},{default:T((()=>[A(C,{name:"local-add",size:"14px",color:"#ffffff"})])),_:1}),z(" 添加 ")])),_:1})]),L("div",{class:"content",ref_key:"contentRef",ref:f},[A(Y,{data:N(q),"cell-style":N(g).cellStyle,"header-cell-style":N(g).headerCellStyle,"max-height":N(g).tableMaxHeight,style:{width:"100%"},stripe:"",onRowDblclick:B},{empty:T((()=>[be])),default:T((()=>[A(Q,{sortable:"",prop:"name",label:"上报模型名称",width:"auto","min-width":"200",align:"center"}),A(Q,{sortable:"",prop:"label",label:"上报模型标签",width:"auto","min-width":"200",align:"center"}),A(Q,{sortable:"",prop:"code",label:"上报模型编号",width:"auto","min-width":"200",align:"center"}),A(Q,{label:"操作",width:"auto","min-width":"200",align:"center",fixed:"right"},{default:T((a=>[A(k,{onClick:e=>{return l=a.row,g.curTransferModel=l,void(g.isModel=!1);var l},text:"",type:"success"},{default:T((()=>[z("变量详情")])),_:2},1032,["onClick"]),A(k,{onClick:e=>B(a.row),text:"",type:"primary"},{default:T((()=>[z("编辑")])),_:2},1032,["onClick"]),A(k,{onClick:t=>{return o=a.row,void l.confirm("确定要删除这个上报模型吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={token:c.token,data:{name:o.name}};x.deleteModel(e).then((e=>{X(e,_)}))})).catch((()=>{e({type:"info",message:"取消删除"})}));var o},text:"",type:"danger"},{default:T((()=>[z("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","cell-style","header-cell-style","max-height"]),L("div",xe,[A(G,{"current-page":N(g).currentPage,"page-size":N(g).pagesize,"page-sizes":[5,10,20,50],total:N(H).length,onCurrentChange:j,onSizeChange:R,background:"",layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"46px"}},null,8,["current-page","page-size","total"])])],512)])):(P(),S(ue,{key:1,curTransferModel:N(g).curTransferModel,onChangeTmFlag:h[3]||(h[3]=e=>{g.isModel=!0}),style:{width:"100%",height:"100%",overflow:"hidden"}},null,8,["curTransferModel"])),A($,{modelValue:N(g).tFlag,"onUpdate:modelValue":h[9]||(h[9]=e=>N(g).tFlag=e),title:N(g).tTitle,width:"600px","before-close":K,"close-on-click-modal":!1},{footer:T((()=>[L("span",_e,[A(k,{onClick:h[7]||(h[7]=e=>W())},{default:T((()=>[z("取消")])),_:1}),A(k,{type:"primary",onClick:h[8]||(h[8]=e=>{E.value.validate((e=>{if(!e)return!1;{const e={token:c.token,data:g.transferForm};g.tTitle.includes("添加")?x.addModel(e).then((e=>{X(e,_),W()})):x.editModel(e).then((e=>{X(e,_),W()}))}}))})},{default:T((()=>[z("保存")])),_:1})])])),default:T((()=>[L("div",Fe,[A(I,{model:N(g).transferForm,rules:N(g).transferRules,ref_key:"transferFormRef",ref:E,"status-icon":"","label-position":"right","label-width":"120px"},{default:T((()=>[A(w,{label:"上报模型名称",prop:"name"},{default:T((()=>[A(Z,{modelValue:N(g).transferForm.name,"onUpdate:modelValue":h[4]||(h[4]=e=>N(g).transferForm.name=e),filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或者输入上报模型名称",style:{width:"100%"}},{default:T((()=>[(P(!0),M(D,null,U(N(g).collectOptions,(e=>(P(),S(J,{key:e.name,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),A(w,{label:"上报模型标签",prop:"label"},{default:T((()=>[A(Z,{modelValue:N(g).transferForm.label,"onUpdate:modelValue":h[5]||(h[5]=e=>N(g).transferForm.label=e),filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或者输入上报模型标签",style:{width:"100%"}},{default:T((()=>[(P(!0),M(D,null,U(N(g).collectOptions,(e=>(P(),S(J,{key:e.label,label:e.label,value:e.label},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),A(w,{label:"上报模型编号",prop:"code"},{default:T((()=>[A(F,{type:"text",modelValue:N(g).transferForm.code,"onUpdate:modelValue":h[6]||(h[6]=e=>N(g).transferForm.code=e),autocomplete:"off",placeholder:"请输入上报模型编号"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-7c5934a5"]]);export{ve as default};
